[{"title":"NumPy å®˜æ–¹å¿«é€Ÿå…¥é—¨æ•™ç¨‹(è¯‘)","date":"2018-02-04T03:27:00.000Z","path":"2018/02/04/NumPyOfficialQuickstartTutorial/","text":"å†™åœ¨å‰é¢ï¼šæœ¬æ¥æ˜¯å­¦ä¹ ä¸‹ \\( NumPy \\)ï¼Œçœ‹åˆ°å®˜ç½‘çš„å…¥é—¨æ•™ç¨‹æƒ³è·Ÿç€å®éªŒä¸€ä¸‹ï¼Œæ€•ä¸å¸¸ç”¨ï¼Œè€Œæˆ‘è¿™äººå¥å¿˜ï¼Œæ‰€ä»¥è®°å½•ä¸‹æ¥ã€‚ç´¢æ€§å°±ç…§ç€ç¿»è¯‘ä¸€ä¸‹ï¼ŒåŒæ ·å¯ä»¥æå‡è‡ªå·±çš„é˜…è¯»å’Œå†™ä½œèƒ½åŠ›ï¼Œéœ€è¦çš„å¯ä»¥å­˜ä¸€ä¸‹ã€‚è¿™é‡Œæ˜¯åŸºäº \\( NumPy v1.13.dev0\\ Manual \\) ç¿»è¯‘çš„ã€‚æˆªæ­¢æ—¶é—´\\( 2018/02/04 \\) å¿«é€Ÿå…¥é—¨æ•™ç¨‹1 å‡†å¤‡å·¥ä½œåœ¨ä½ æµè§ˆè¿™ä¸ªæŒ‡å¯¼ä¹‹å‰ï¼Œä½ åº”è¯¥æ‡‚ä¸€ç‚¹ \\( Python \\) ã€‚å¦‚æœä½ æƒ³å›é¡¾ä¸€ä¸‹å¯ä»¥çœ‹Python tutorialã€‚å¦‚æœä½ æƒ³è·Ÿç€æ•™ç¨‹å†™ä»£ç ï¼Œå¿…é¡»å®‰è£…ä¸€äº›è½¯ä»¶ï¼Œè¯·å‚è€ƒhttp://scipy.org/install.html 2 åŸºç¡€çŸ¥è¯†\\( NumPy \\) çš„ä¸»è¦æ“ä½œå¯¹è±¡æ˜¯åŒç±»å‹çš„å¤šç»´æ•°ç»„ã€‚å®ƒæ˜¯ä¸€ä¸ªç”±æ­£æ•´æ•°å…ƒç»„ç´¢å¼•ï¼Œå…ƒç´ ç±»å‹ç›¸åŒçš„è¡¨ï¼ˆé€šå¸¸å…ƒç´ æ˜¯æ•°å­—ï¼‰ã€‚åœ¨ \\( NumPy \\) ç»´åº¦è¢«ç§°ä¸º axes, axes çš„æ•°é‡ç§°ä¸º rankã€‚ ä¾‹å¦‚ï¼Œåœ¨ \\( 3D \\) ç©ºé—´çš„ä¸€ä¸ªç‚¹ \\( [1, 2, 1] \\) æ˜¯ä¸€ä¸ª rank = 1 çš„æ•°ç»„ï¼Œå› ä¸ºå®ƒåªæœ‰ä¸€ä¸ª axesã€‚è¿™ä¸ª axes çš„é•¿åº¦æ˜¯ \\( 3 \\)ã€‚åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ•°ç»„ rank = 2 ï¼ˆå®ƒæ˜¯ \\( 2 \\)ç»´çš„ï¼‰ã€‚ç¬¬ä¸€ç»´ï¼ˆaxesï¼‰é•¿åº¦æ˜¯ \\( 2 \\)ï¼Œç¬¬äºŒä½é•¿åº¦æ˜¯ \\( 3 \\) 12[[ 1., 0., 0. ], [ 0., 1., 2. ]] \\( NumPy \\) çš„æ•°ç»„ç±»æ˜¯ ndarrayã€‚ä¹Ÿå¯ä»¥å«åš arrayã€‚è¯´åˆ°è¿™é‡Œï¼Œnumpy.array å’Œæ ‡å‡† ( Python \\) åº“ä¸­çš„ array.array æ˜¯ä¸ä¸€æ ·çš„ï¼Œå®ƒåªèƒ½å¤„ç†ä¸€ç»´çš„æ•°ç»„å’Œæä¾›æ›´å°‘çš„åŠŸèƒ½ã€‚ndarray å¯¹è±¡çš„ä¸€äº›é‡è¦å±æ€§å¦‚ä¸‹ï¼š ndarray.ndim æ•°ç»„çš„ axes ï¼ˆç»´æ•°ï¼‰æ•°å€¼å¤§å°ã€‚åœ¨ \\( Python \\) ä¸­ç»´æ•°çš„å¤§å°å¯ä»¥å‚è€ƒ rank ndarray.shape æ•°ç»„çš„ç»´æ•°ï¼Œè¿™æ˜¯ç”±æ¯ä¸ªç»´åº¦çš„å¤§å°ç»„æˆçš„ä¸€ä¸ªå…ƒç»„ã€‚å¯¹äºä¸€ä¸ª \\( n \\) è¡Œ \\( m \\) åˆ—çš„çŸ©é˜µã€‚shape æ˜¯ (n, m)ã€‚ç”± shape å…ƒç»„çš„é•¿åº¦å¾—å‡º rank æˆ–è€…ç»´æ•° ndimã€‚ ndarray.size æ•°ç»„å…ƒç´ çš„ä¸ªæ•°æ€»å’Œï¼Œè¿™ç­‰äº shape å…ƒç»„æ•°å­—çš„ä¹˜ç§¯ã€‚","tags":[{"name":"Math","slug":"Math","permalink":"http://fitzeng.org/tags/Math/"},{"name":"MachineLearning","slug":"MachineLearning","permalink":"http://fitzeng.org/tags/MachineLearning/"},{"name":"Python","slug":"Python","permalink":"http://fitzeng.org/tags/Python/"},{"name":"NumPy","slug":"NumPy","permalink":"http://fitzeng.org/tags/NumPy/"}]},{"title":"ä» TensorFlow å…¥é—¨æœºå™¨å­¦ä¹ ","date":"2018-02-03T03:27:00.000Z","path":"2018/02/03/TensorFlowIntroduction/","text":"å†™åœ¨å‰é¢ï¼šç´§è·Ÿæ—¶ä»£æ­¥ä¼ï¼Œå¼€å§‹å­¦ä¹ æœºå™¨å­¦ä¹ ï¼ŒæŠ±ç€äº‰å–åœ¨æ¯•ä¸šä¹‹å‰å¤šçœ‹çœ‹å„ä¸ªæ–¹å‘æ˜¯ä»€ä¹ˆæ ·å­çš„å¿ƒæ€ï¼Œå‘ç°è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ½œåŠ›ä¹Ÿå¾ˆæœ‰è¶£çš„é¢†åŸŸï¼ˆkengï¼‰ã€‚// ç„¶åå°±å¼€å§‹è¡¥æ•°å­¦äº†â€¦â€¦ 0 TensorFlow ä»‹ç»åˆšåˆšå…¥é—¨çš„å°ç™½ï¼Œç†è§£ä¸æ·±ï¼Œç›´æ¥çœ‹å®˜æ–¹çš„ä»‹ç»å§ GitHub Description: Computation using data flow graphs for scalable machine learning å®˜ç½‘: \\( TensorFlow^{^{TM}} \\)æ˜¯ä¸€ä¸ªä½¿ç”¨æ•°æ®æµå›¾è¿›è¡Œæ•°å€¼è®¡ç®—çš„å¼€æºè½¯ä»¶åº“ã€‚å›¾ä¸­çš„èŠ‚ç‚¹ä»£è¡¨æ•°å­¦è¿ç®—ï¼Œ è€Œå›¾ä¸­çš„è¾¹åˆ™ä»£è¡¨åœ¨è¿™äº›èŠ‚ç‚¹ä¹‹é—´ä¼ é€’çš„å¤šç»´æ•°ç»„ï¼ˆå¼ é‡ï¼‰ã€‚ 0.1 ä»€ä¹ˆæ˜¯ TensorFlow ?\\( Tensor \\) æ˜¯å¼ é‡çš„æ„æ€ï¼Œ\\( Flow \\) æ˜¯æµçš„æ„æ€ã€‚æ‰€ä»¥å¯ä»¥ç›´æ¥çœ‹åšåˆ©ç”¨å¼ é‡ç»„æˆçš„æ•°æ®æµå›¾è¿›è¡Œè®¡ç®—çš„ä¸€ä¸ªå¼€æºåº“ã€‚ 0.2 TensorFlow å¯ä»¥åšä»€ä¹ˆ ?ç›®å‰ä¸»è¦æ˜¯ç”¨äºæœºå™¨å­¦ä¹ ï¼Œè¿™æ ·è¯´æœ‰ç‚¹ä¸äº²æ°‘ï¼Œç¬”è€…ç†è§£æ˜¯å¯ä»¥å°†æ•°æ®è½¬åŒ–ä¸ºå‘é‡æè¿°å¹¶ä¸”æ„å»ºç›¸åº”çš„è®¡ç®—æµå›¾éƒ½æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚ä¸¾ä¸ªä¾‹å­å§ï¼Œè™½ç„¶ä¸çŸ¥é“æ°ä¸æ°å½“ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨è®¡ç®— \\( (1 + 2)*3-4 \\) æ—¶ï¼Œå¯ä»¥æ„å»ºä¸€ä¸ªäºŒå‰æ ‘ è¿™æ£µäºŒå‰æ ‘çš„ä¸­åºéå†å°±æ˜¯ä¸Šé¢çš„è¡¨è¾¾å¼ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¡¨è¾¾å¼å¯ä»¥è½¬åŒ–æˆä¸€ä¸ªå½¢å¦‚äºŒå‰æ ‘çš„å›¾ï¼Œè€Œ \\( TensorFlow \\) æ­£å¥½å¯ä»¥è®¡ç®—è¿™ä¸ªå›¾ã€‚ä¸‹é¢ç»™å‡ºä»£ç ï¼Œçœ‹ä¸æ‡‚æ²¡å…³ç³»ï¼Œåªè¦ç†è§£ä»£ç æµç¨‹æ˜¯å¯¹å›¾(äºŒå‰æ ‘)çš„è®¡ç®—å°±å¯ä»¥äº†ï¼Œä¸‹ä¸€ç« ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨\\( TensorFlow \\)ã€‚ 1234567891011# coding: utf-8import tensorflow as tfa, b, c, d = tf.constant(1), tf.constant(2), tf.constant(3),tf.constant(4)add = tf.add(a,b)mul = tf.multiply(add, c)sub = tf.subtract(mul, d)with tf.Session() as sess: print(sess.run(sub))# output: # 5 0.3 TensorFlow å®‰è£…è¿™é‡Œå°±ä¸åšè¯¦ç»†ä»‹ç»äº†ï¼Œç›¸ä¿¡ç‚¹å¼€è¿™ç¯‡æ–‡ç« çš„ä½ åº”è¯¥æœ‰äº†è¿è¡Œç¯å¢ƒã€‚å¦‚æœæ²¡æœ‰è¿™é‡Œæ¨èä¸¤ä¸ªç½‘ç«™è‹±æ–‡:å®˜ç½‘ å’Œ ä¸­æ–‡:**å­¦é™¢ç¿»è¯‘ç„¶åä»‹ç»ä¸€ä¸‹æˆ‘çš„ç¯å¢ƒï¼š\\( Anaconda + PyCharm \\) æ³¨æ„ \\( PyCharm:\\ Project\\ Interpreter \\) è®¾ç½®ä¸º \\( Conda\\ Environment \\) æ‰èƒ½è·‘ \\( TensorFlow \\)ã€‚å¦‚æœä¸ä¼šå¯ä»¥å¤šçœ‹çœ‹ç½‘ä¸Šçš„æ•™ç¨‹ï¼Œèƒ½å¯¹è™šæ‹Ÿç¯å¢ƒåŠ æ·±äº†è§£ã€‚ 1 åˆè¯† TensorFlowå¥½äº†ï¼Œæœ‰å‰é¢çš„ä»‹ç»ï¼Œä½ åº”è¯¥æœ‰èƒ½å¤Ÿä½¿ç”¨ \\( TensorFlow \\) çš„ç¯å¢ƒäº†ï¼Œä¸‹é¢å¼€å§‹ä»‹ç»å¦‚ä½•ç¼–ç ã€‚ 1.1 åŸºç¡€è¯­æ³• å…¶å®è¯´è¯­æ³•æ˜¯ä¸å‡†ç¡®çš„ï¼Œè¯­æ³•å°±æ˜¯ \\( Python \\) çš„è¯­æ³•(è¿™é‡Œä½¿ç”¨ Python)ï¼Œä¸»è¦æ˜¯ä»‹ç»è°ƒç”¨è¿™ä¸ªè®¡ç®—åº“æ¥å®ç°è¿™ä¸ªç‰¹æ®Šçš„è®¡ç®—ã€‚åŒæ ·æ‘†ä¸Šå®˜ç½‘æ•™ç¨‹ 1.1.1 è®¡ç®—å•å…ƒä»‹ç»å¯ä»¥çœ‹åˆ°åœ¨è®¡ç®—å›¾ä¸­ï¼Œæœ‰ä¸¤ä¸ªä¸»è¦çš„å†…å®¹æ˜¯ç‚¹(å¶å­å’Œéå¶å­èŠ‚ç‚¹)å’Œçº¿ã€‚æˆ‘çš„ç†è§£æ˜¯ç‚¹ä»£è¡¨æ•°æ®ï¼Œçº¿ä»£è¡¨æ“ä½œã€‚ä¸çŸ¥é“å¯¹ä¸å¯¹ï¼Œä¸è¿‡ä¸‹é¢å°±æŒ‰ç…§è¿™æ ·æ€è·¯ä»‹ç»äº†ã€‚ä¸‹é¢å¼€å§‹ä»‹ç»æœ‰å“ªäº›å¸¸ç”¨çš„â€œç‚¹â€ï¼š å¸¸é‡ 1c = tf.constant(2) å˜é‡ 1v = tf.Variable(2) å ä½ç¬¦ 1p = tf.placeholder(tf.float32) ä»¥ä¸Šä»£ç éƒ½æ˜¯ä»¥æœ€å°èƒ½ç”¨åŸåˆ™ä¼ çš„å‚ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹çœ‹æºç ï¼Œè¿™é‡Œä¸»è¦æ˜¯å¾€ \\( Python \\) è¯­æ³•ä¸Šæ‹‰ï¼Œå…ˆä½¿ç”¨èµ·æ¥å†ä»¥åè‡ªå·±æ·±ç©¶ä¸ºä»€ä¹ˆè¦è®¾è®¡æˆè¿™æ ·çš„æ•°æ®ç»“æ„å¯¹è®¡ç®—å›¾æ˜¯å¿…é¡»çš„ã€‚ æ¥ä¸‹æ¥å°±æ˜¯æœ‰å“ªäº›â€œçº¿â€ï¼š å››åˆ™è¿ç®— 1234add = tf.add(a, b)sub = tf.subtract(a, b)mul = tf.multiply(a, b)div = tf.divide(a, b) å…¶ä»–çš„å°±ä¸å†ä»‹ç»äº†ï¼Œè¯¦æƒ…å¯çœ‹ \\( XXX\\ ops.py \\) çš„æºç ã€‚æ¯”å¦‚ä»¥ä¸Šçš„æ“ä½œå®šä¹‰åœ¨ \\( math\\ ops.py \\)ã€‚ 1.1.2 è®¡ç®—æµç¨‹ä»‹ç»çŸ¥é“äº†å¸¸è§æ•°æ®å’Œè®¡ç®—æ–¹æ³•ä¸‹é¢ä»‹ç»è®¡ç®—æµç¨‹ï¼š 1234567891011121314# coding: utf-8import tensorflow as tf# Step1: åˆ›å»ºæ•°æ®a, b, c, d = tf.constant(1), tf.constant(2), tf.constant(3),tf.constant(4)# Step2: æ„é€ è®¡ç®—å›¾add = tf.add(a,b)mul = tf.multiply(add, c)sub = tf.subtract(mul, d)# Step3: è¿›è¡Œè®¡ç®—with tf.Session() as sess: print(sess.run(sub)) ä¸Šé¢è¿™ä¸ªä¾‹å­æ˜¯ä¸€ä¸ªæ ‡å‡†çš„å¸¸é‡è®¡ç®—è¿‡ç¨‹ï¼Œä½ å¯ä»¥è¯•ç€ print(a, add) çœ‹çœ‹ä½ åˆ›å»ºçš„æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œä½ ä¼šå‘ç°ä»–æ˜¯ä¸€ä¸ª \\( Tensor \\) è€Œä¸”é‡Œé¢çš„å€¼æ˜¯ \\( 0 \\)ã€‚å¯ä»¥çŒœæµ‹ï¼Œè¿™é‡Œåªæ‰“å°ä¸è®¡ç®—ï¼Œçœ‹ \\( Tensor \\) æºç ï¼š 12345678910# ops.pydef __repr__(self): return \"&lt;tf.Tensor '%s' shape=%s dtype=%s&gt;\" % (self.name, self.get_shape(),self._dtype.name)@propertydef name(self): \"\"\"The string name of this tensor.\"\"\" if not self._op.name: raise ValueError(\"Operation was not named: %s\" % self._op) return \"%s:%d\" % (self._op.name, self._value_index) å­¦ä¼šäº†è®¡ç®—å¸¸é‡ï¼Œå˜é‡æ˜¯ä¸æ˜¯ä¹Ÿä¸€æ ·ï¼Ÿå¦‚æœä½ è¯•è¿‡å°±çŸ¥é“æ˜¯ä¸ä¸€æ ·çš„ï¼Œå˜é‡éœ€è¦åˆå§‹åŒ–æ“ä½œã€‚ 1234v = tf.Variable(2)with tf.Session() as sess: sess.run(tf.global_variables_initializer()) print(v, sess.run(v)) åˆ°è¿™é‡Œå¯èƒ½ä¼šç–‘é—®ï¼Œé‚£å˜é‡å’Œå¸¸é‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»å­—é¢æ„æ€å¯ä»¥çŸ¥é“å˜é‡åº”è¯¥æ˜¯å¯å˜çš„ï¼Œæ–¹ä¾¿æˆ‘ä»¬åœ¨è®¡ç®—è¿‡ç¨‹ä¸­éšæ—¶è°ƒæ•´å‚æ•°ï¼Œä¸‹é¢é€šè¿‡ä¸€æ®µä»£ç ä»‹ç»å¦‚ä½•ä½¿ç”¨ã€‚ 123456789101112131415161718192021222324v = tf.Variable(2)# å°† v çš„å€¼è‡ªä¹˜ 2update = tf.assign(v, tf.multiply(v, tf.constant(2)))with tf.Session() as sess: sess.run(tf.global_variables_initializer()) for _ in range(4): print(\"-----------------------\") print \"Before : \", sess.run(v) sess.run(update) print \"After : \", sess.run(v)# output:# -----------------------# Before : 2# After : 4# -----------------------# Before : 4# After : 8# -----------------------# Before : 8# After : 16# -----------------------# Before : 16# After : 32 ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸æƒ³æ¯æ¬¡éƒ½è®¾ç½®-æ›´æ–°-è®¡ç®—-æ›´æ–°-è®¡ç®—â€¦â€¦è€Œæ˜¯ç›´æ¥æŠŠæ•°æ®å†™å…¥è®¡ç®—ï¼Œé‚£å ä½ç¬¦å°±èµ·ä½œç”¨äº†ã€‚åŒæ ·ä¸¾ä¸ªå°ä¾‹å­ã€‚ 1234567891011121314151617c = tf.constant(2)# æ³¨æ„ç±»å‹ä¸€è‡´ï¼Œè¿™é‡Œæ˜¯ tf.int32p = tf.placeholder(tf.int32)mul = tf.multiply(c, p)with tf.Session() as sess: # tmp = 2 ç›¸å½“äºä¸Šä¸€ä¸ªä¾‹å­å˜é‡çš„åˆå§‹å€¼æ˜¯ 2 tmp = 2; for _ in range(4): # ç›´æ¥å¡«å…… feed_dict tmp = sess.run(mul, feed_dict=&#123;p:tmp&#125;) print tmp# output:# 4# 8# 16# 32 ä¸‹é¢æ€»ç»“ä¸‹è®¡ç®—è¿‡ç¨‹ï¼š åˆ›å»ºæ•°æ®ï¼šå¯ä»¥åˆ›å»ºå¸¸é‡ã€å˜é‡å’Œå ä½ç¬¦ã€‚ æ„å»ºå›¾ï¼šé€šè¿‡å‰é¢çš„æ•°æ®æ„å»ºä¸€å¼ å›¾ã€‚ åˆå§‹åŒ–ï¼šæŠŠå˜é‡åˆå§‹åŒ–ã€‚ è®¡ç®—ï¼šå¿…é¡»é€šè¿‡å¼€å¯ä¸€ä¸ª Session æ¥è®¡ç®—å›¾ 1.2 å¯è§†åŒ–\\( TensorFlow \\)æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–å·¥å…·â€”â€”\\( TensorBoard \\)ï¼Œä¸‹é¢å¼€å§‹ä»‹ç»å¦‚ä½•ä½¿ç”¨ã€‚ è¿™é‡Œå¯¹ä¸Šé¢äºŒå‰æ ‘çš„ä¾‹å­è¿›è¡Œå¯è§†åŒ–å¤„ç†ã€‚ 1234567891011# coding: utf-8import tensorflow as tfa, b, c, d = tf.constant(1), tf.constant(2), tf.constant(3),tf.constant(4)add = tf.add(a,b)mul = tf.multiply(add, c)sub = tf.subtract(mul, d)with tf.Session() as sess: writer = tf.summary.FileWriter('./graphs', sess.graph) print(sess.run(sub))writer.close() ç„¶åä½¿ç”¨å‘½ä»¤è¡Œåˆ°å­˜å‚¨ graphs çš„æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œ tensorboard --logdir=&quot;./graphs&quot; å‘½ä»¤ï¼Œç„¶åæŒ‰ç…§æç¤ºåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:6006 å¦‚æœæˆåŠŸæ˜¾ç¤º \\( TensorBoard \\) ç•Œé¢å°±è¯´æ˜æˆåŠŸäº†ã€‚ 2 åˆ©ç”¨ TensorFlow è¿›è¡Œæœºå™¨å­¦ä¹ è¿™é‡Œä¹Ÿç®—æ˜¯æœºå™¨å­¦ä¹ çš„å…¥é—¨ä»‹ç»å§ã€‚ç›´æ¥ä»‹ç»æœºå™¨å­¦ä¹ ç›¸å…³çŸ¥è¯†å¯èƒ½ä¸å¤ªç°å®ï¼Œè€Œä¸”ç¬”è€…ä¹Ÿæ˜¯åœ¨å­¦ä¹ é˜¶æ®µï¼Œæ‰€ä»¥ä¸¾ä¸€äº›å°ä¾‹å­æ¥ä½“ä¼šæœºå™¨å­¦ä¹ çš„è¿‡ç¨‹å§ã€‚ 2.1 çº¿æ€§å›å½’è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æœ€ç†Ÿæ‚‰çš„çº¿æ€§å›å½’æ¥ä½“ä¼šä¸€ä¸‹æœºå™¨å­¦ä¹ çš„è¿‡ç¨‹ï¼š 2.1.1 å‡†å¤‡æ•°æ®è¿™é‡Œå¾ˆç®€å•ï¼Œå°±æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªçº¿æ€§å›å½’ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è‡ªå·±æ‹Ÿå®šä¸€äº›æ•°æ®å¥½é¢„æµ‹ç»“æœå’Œè‡ªå·±è®¾æƒ³çš„æ˜¯å¦ä¸€è‡´ã€‚ 12train_X = numpy.asarray([1.1, 1.8, 3.2, 4.7, 5.9, 6.7])train_Y = numpy.asarray([1.2, 2.1, 3.1, 4.6, 5.5, 6.9]) 2.1.2 æ„å»ºæ¨¡å‹æˆ‘ä»¬é‡‡ç”¨å ä½ç¬¦çš„å½¢å¼è¿›è¡Œè®¡ç®—ï¼Œåœ¨è¿ç®—æ—¶ç›´æ¥å¯¼å…¥æ•°æ®ä¾¿å¯ã€‚è¿™é‡Œå› ä¸ºæˆ‘ä»¬é‡‡ç”¨çº¿æ€§å›å½’ï¼Œæ‰€ä»¥ç›®æ ‡å‡½æ•°æ˜¯å½¢å¦‚ \\( Y = XW + b \\) çš„å½¢å¼çš„ä¸€æ¬¡å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é€šè¿‡ç»™å‡ºçš„ç‚¹å»æ‹Ÿåˆä¸€æ¡æ¯”è¾ƒç¬¦åˆè¿™äº›ç‚¹åˆ†å¸ƒçš„ç›´çº¿ã€‚ 123456789X = tf.placeholder(tf.float32)Y = tf.placeholder(tf.float32)W = tf.Variable(-1., name=\"weight\")b = tf.Variable(-1., name=\"bias\")# linear model # activation = X*W + bactivation = tf.add(tf.multiply(X, W), b) 2.1.3 å‚æ•°è¯„ä¼°æˆ‘ä»¬é‡‡ç”¨æ¯ä¸ªç‚¹ç»™å‡ºçš„çºµåæ ‡å’Œçº¿æ€§æ¨¡å‹ç®—å‡ºçš„çºµåæ ‡çš„å·®\\( (activation - Y) \\)çš„å¹³æ–¹å’Œ\\( (tf.reduce\\_ sum(tf.pow(activation - Y, 2))) \\)ä½œä¸ºæŸå¤±å‡½æ•°ï¼Œåœ¨è®­ç»ƒä¸­é‡‡ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•å°½é‡ä½¿å’Œæœ€å°ï¼Œå­¦åˆ©ç‡é€‰æ‹© \\( 0.01 \\)ã€‚å…¶ä¸­çš„æ•°å­¦åŸç†è¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œä»¥åä¼šå†™å…³äºæœºå™¨å­¦ä¹ ç®—æ³•çš„ç›¸å…³æ–‡ç« ã€‚ä¸€èˆ¬é€‰å–æŸå¤±å‡½æ•°å’Œé€šè¿‡æŸäº›æœ€ä¼˜åŒ–æ‰‹æ®µæ›´æ–°æƒé‡æ˜¯è¿™é‡Œçš„ä¸€å¤§éš¾ç‚¹ï¼Œå¦‚æœè¦çŸ¥é“åŸç†ï¼Œéœ€è¦å­¦ä¹ å¤§é‡æ•°å­¦åŸºç¡€çŸ¥è¯†ï¼ˆæ¦‚ç‡è®ºï¼Œçº¿æ€§ä»£æ•°ï¼Œå¾®ç§¯åˆ†â€¦â€¦ï¼‰ã€‚ 1234learning_rate = 0.01cost = tf.reduce_sum(tf.pow(activation - Y, 2))optimizer = tf.train.GradientDescentOptimizer(learning_rate).minimize(cost) 2.1.4 è®­ç»ƒæ•°æ®è¿™é‡Œå°±æ˜¯å–æ•°æ®ï¼Œå–‚ç»™å›¾ä¸­çš„è¾“å…¥èŠ‚ç‚¹ï¼Œç„¶åæ¨¡å‹ä¼šè‡ªå·±è¿›è¡Œä¼˜åŒ–ï¼Œå¯ä»¥å°†æ•°æ®å¤šæ¬¡è¿­ä»£ä½¿å¾—æ‹Ÿåˆå‡½æ•°èƒ½å¤Ÿæ›´å¥½çš„é€‚åº”è¿™äº›æ•°æ®ç‚¹ã€‚ 1234567891011121314151617181920212223242526training_epochs = 2000display_step = 100with tf.Session() as sess: sess.run(tf.global_variables_initializer()) for epoch in range(training_epochs): for (x, y) in zip(train_X, train_Y): sess.run(optimizer, feed_dict=&#123;X: x, Y: y&#125;) if epoch % display_step == 0: print(\"Epoch:\", '%04d' % (epoch + 1), \"cost=\", \"&#123;:.9f&#125;\".format(sess.run(cost, feed_dict=&#123;X: train_X, Y: train_Y&#125;)), \"W=\", sess.run(W), \"b=\", sess.run(b)) print(\"Optimization Finished!\") print(\"cost=\", sess.run(cost, feed_dict=&#123;X: train_X, Y: train_Y&#125;), \"W=\", sess.run(W), \"b=\", sess.run(b))``` #### 2.1.5 å¯è§†åŒ–å¯ä»¥ç›´æ¥ç»˜åˆ¶äºŒç»´å›¾å½¢çœ‹ç»“æœã€‚ä¸ç†Ÿæ‚‰çš„å¯ä»¥å‚è€ƒ[Matplotlib æ•™ç¨‹](https://liam0205.me/2014/09/11/matplotlib-tutorial-zh-cn/)```python writer = tf.summary.FileWriter('./graphs', sess.graph) plt.scatter(train_X, train_Y, color='red', label='Original data') plt.plot(train_X, sess.run(W) * train_X + sess.run(b), color='blue', label='Fitted line') plt.show()writer.close() äºŒç»´å›¾ï¼šæ•°æ®æµå›¾ï¼š 2.1.6 å°ç»“å…¶å®æ•´ä¸ªè¿‡ç¨‹å¦‚æœä¸æ·±ç©¶å…¶ä¸­çš„åŸç†ï¼Œè¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ï¼Œæ— éå°±æ˜¯æä¾›æ•°æ®-é€‰å–æ‹Ÿåˆå‡½æ•°-æ„å»ºå›¾-é€‰å–æŸå¤±å‡½æ•°-æœ€ä¼˜åŒ–-è®­ç»ƒæ•°æ®ï¼ˆæ›´æ–°æƒé‡ï¼‰-å¾—å‡ºç»“è®ºã€‚è¿™ä¸ªè¿‡ç¨‹ç¬¦åˆæˆ‘ä»¬å¯¹çº¿æ€§å›å½’è¿™ä¸ªé—®é¢˜è§£å†³çš„åŸºæœ¬æ€è·¯çš„é¢„æœŸã€‚å½“ç„¶ï¼Œç¬”è€…è®¤ä¸ºè¿™åªæ˜¯å¼€å§‹ï¼Œè¦æƒ³æ·±å…¥ï¼Œå­¦ä¹ å¿…è¦çš„æ•°å­¦çŸ¥è¯†æ˜¯æœºå™¨å­¦ä¹ çš„å¿…ç»ä¹‹è·¯ã€‚ è¿™é‡Œå¯ä»¥å‚è€ƒTensorFlow å…¥é—¨æ•´ä½“ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768# coding: utf-8from __future__ import print_functionimport tensorflow as tfimport numpyimport matplotlib.pyplot as plttrain_X = numpy.asarray([1.1, 1.8, 3.2, 4.7, 5.9, 6.7])train_Y = numpy.asarray([1.2, 2.1, 3.1, 4.6, 5.5, 6.9])X = tf.placeholder(tf.float32)Y = tf.placeholder(tf.float32)W = tf.Variable(-1., name=\"weight\")b = tf.Variable(-1., name=\"bias\")activation = tf.add(tf.multiply(X, W), b)learning_rate = 0.01cost = tf.reduce_sum(tf.pow(activation - Y, 2))optimizer = tf.train.GradientDescentOptimizer(learning_rate).minimize(cost)training_epochs = 2000display_step = 100with tf.Session() as sess: sess.run(tf.global_variables_initializer()) for epoch in range(training_epochs): for (x, y) in zip(train_X, train_Y): sess.run(optimizer, feed_dict=&#123;X: x, Y: y&#125;) if epoch % display_step == 0: print(\"Epoch:\", '%04d' % (epoch + 1), \"cost=\", \"&#123;:.9f&#125;\".format(sess.run(cost, feed_dict=&#123;X: train_X, Y: train_Y&#125;)), \"W=\", sess.run(W), \"b=\", sess.run(b)) print(\"Optimization Finished!\") print(\"cost=\", sess.run(cost, feed_dict=&#123;X: train_X, Y: train_Y&#125;), \"W=\", sess.run(W), \"b=\", sess.run(b)) writer = tf.summary.FileWriter('./graphs', sess.graph) plt.scatter(train_X, train_Y, color='red', label='Original data') plt.plot(train_X, sess.run(W) * train_X + sess.run(b), color='blue', label='Fitted line') plt.show()writer.close()# output:# Epoch: 0001 cost= 0.785177052 W= 1.07263 b= -0.448403# Epoch: 0101 cost= 0.440001398 W= 1.02555 b= -0.0137608# Epoch: 0201 cost= 0.437495589 W= 1.02078 b= 0.0176154# Epoch: 0301 cost= 0.437433660 W= 1.02043 b= 0.0199056# Epoch: 0401 cost= 0.437430561 W= 1.02041 b= 0.0200727# Epoch: 0501 cost= 0.437429130 W= 1.0204 b= 0.0200851# Epoch: 0601 cost= 0.437429696 W= 1.0204 b= 0.0200854# Epoch: 0701 cost= 0.437429696 W= 1.0204 b= 0.0200854# Epoch: 0801 cost= 0.437429696 W= 1.0204 b= 0.0200854# Epoch: 0901 cost= 0.437429696 W= 1.0204 b= 0.0200854# Epoch: 1001 cost= 0.437429696 W= 1.0204 b= 0.0200854# Epoch: 1101 cost= 0.437429696 W= 1.0204 b= 0.0200854# Epoch: 1201 cost= 0.437429696 W= 1.0204 b= 0.0200854# Epoch: 1301 cost= 0.437429696 W= 1.0204 b= 0.0200854# Epoch: 1401 cost= 0.437429696 W= 1.0204 b= 0.0200854# Epoch: 1501 cost= 0.437429696 W= 1.0204 b= 0.0200854# Epoch: 1601 cost= 0.437429696 W= 1.0204 b= 0.0200854# Epoch: 1701 cost= 0.437429696 W= 1.0204 b= 0.0200854# Epoch: 1801 cost= 0.437429696 W= 1.0204 b= 0.0200854# Epoch: 1901 cost= 0.437429696 W= 1.0204 b= 0.0200854# Optimization Finished!# cost= 0.43743 W= 1.0204 b= 0.0200854# å¯ä»¥çœ‹åˆ°è¿­ä»£æ¬¡æ•°åˆ° 500 æ¬¡å·¦å³æ•°æ®å°±ç¨³å®šäº†ã€‚ 3 æ€»ç»“å…¶å®è¿™åªæ˜¯ä¸€ä¸ªå¼€å§‹ï¼Œè¿˜æœ‰å¥½å¤šå¥½å¤šä¸œè¥¿è¦å»å­¦ä¹ ã€‚è¶Šæ¥è¶Šè§‰å¾—åŸºç¡€çš„é‡è¦æ€§ï¼Œä¸ä»…ä»…æ˜¯è®¡ç®—æœºåŸºç¡€ï¼Œæ•°å­¦åŸºç¡€ä¹Ÿæ˜¯åŒç­‰é‡è¦ï¼Œç‰¹åˆ«æ˜¯æœªæ¥çš„ç‰©è”ç½‘è¶‹åŠ¿ï¼Œå¯èƒ½ç¼–ç è¿™ç§ä¸“ä¸šè¶Šæ¥è¶Šæ·¡åŒ–ï¼Œåªæ˜¯ä½œä¸ºæŸäº›ä¸“ä¸šäººå‘˜çš„ä¸€ç§å·¥å…·/æŠ€èƒ½ä½¿ç”¨ã€‚é©¬ä¸Šé¢ä¸´æ¯•ä¸šï¼Œåªèƒ½è‡ªå·±æ…¢æ…¢å•ƒè¿™äº›ä¸œè¥¿äº†â€¦â€¦ 4 å‚è€ƒèµ„æ–™ 0. å®˜ç½‘ 1. ä¸­æ–‡:**å­¦é™¢ç¿»è¯‘ 2. Matplotlib æ•™ç¨‹ 3. TensorFlow å…¥é—¨","tags":[{"name":"Math","slug":"Math","permalink":"http://fitzeng.org/tags/Math/"},{"name":"MachineLearning","slug":"MachineLearning","permalink":"http://fitzeng.org/tags/MachineLearning/"},{"name":"Python","slug":"Python","permalink":"http://fitzeng.org/tags/Python/"},{"name":"TensorFlow","slug":"TensorFlow","permalink":"http://fitzeng.org/tags/TensorFlow/"}]},{"title":"æœºå™¨å­¦ä¹ ä¹‹é‡æ‹¾æ¦‚ç‡è®º","date":"2018-01-26T03:27:00.000Z","path":"2018/01/26/reProbabilityTheory/","text":"0. å‰è¨€ è¿™é‡Œä¸»è¦æ˜¯å›´ç»•æµ™å¤§çš„ã€Šæ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡ã€‹ç¬¬å››ç‰ˆçš„å†…å®¹è¿›è¡Œæ€»ç»“, å…¶ä¸­æˆªå–äº†ä¸€äº›å›¾ç‰‡ä½œä¸ºå†…å®¹æœ‰åŠ©äºå¯¹å…¬å¼çš„ç†è§£ã€‚ç¬”è€…æŠŠè¿™ç¯‡æ–‡ç« ä½œä¸ºè‡ªå·±çš„è¯»ä¹¦ç¬”è®°, ä¸ºä»¥åç³»ç»Ÿå›é¡¾æ¦‚ç‡è®ºæä¾›ä¾¿æ·ã€‚åŒæ—¶ä¼šç»§ç»­æ›´æ–°, ä¿è¯è‡ªå·±è¯»æ‡‚ä¹‹åå†æ¥ä¹¦å†™ã€‚ 1. åŸºæœ¬æ¦‚å¿µ1.1 äº‹ä»¶å…³ç³» åŒ…å«äº‹ä»¶ \\( A \\subset B \\) : äº‹ä»¶ \\( B \\) åŒ…å«äº‹ä»¶ \\( A \\)ï¼Œäº‹ä»¶ \\( A \\) å‘ç”Ÿå¿…ç„¶å¯¼è‡´äº‹ä»¶ \\( B \\) çš„å‘ç”Ÿã€‚ å’Œäº‹ä»¶ \\( A \\cup B = \\{ x|x \\in A\\ or\\ x \\in B \\} \\) : \\( A \\) \\( B \\) ä¸­è‡³å°‘æœ‰ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿã€‚ \\( \\bigcup\\limits_{k=1}\\limits^{n} A_k \\) : \\( n \\) ä¸ªäº‹ä»¶ \\( A_1, A_2, \\ldots , A_n \\) çš„å’Œäº‹ä»¶ã€‚ \\( \\bigcup\\limits_{k=1}\\limits^{\\infty} A_k \\) : å¯åˆ—ä¸ªäº‹ä»¶ \\( A_1, A_2, \\ldots \\) çš„å’Œäº‹ä»¶ã€‚ ç§¯äº‹ä»¶ \\( A \\cap B = \\{ x|x \\in A\\ and\\ x \\in B \\} \\) : \\( A \\) \\( B \\) äº‹ä»¶åŒæ—¶å‘ç”Ÿã€‚ \\( \\bigcap\\limits_{k=1}\\limits^{n} A_k \\) : \\( n \\) ä¸ªäº‹ä»¶ \\( A_1, A_2, \\ldots , A_n \\) çš„ç§¯äº‹ä»¶ã€‚ \\( \\bigcap\\limits_{k=1}\\limits^{\\infty} A_k \\) : å¯åˆ—ä¸ªäº‹ä»¶ \\( A_1, A_2, \\ldots \\) çš„ç§¯äº‹ä»¶ã€‚ å·®äº‹ä»¶ \\( A - B = \\{x|x=\\in A\\ and\\ \\notin B \\} \\) : å½“ä¸”ä»…å½“ \\( A \\) å‘ç”Ÿï¼Œ \\( B \\) ä¸å‘ç”Ÿã€‚ äº’æ–¥äº‹ä»¶ \\( A \\cap B = \\emptyset \\) : \\( A \\) ä¸ \\( B \\) äº‹ä»¶ä¸ç›¸å®¹ï¼Œä¸èƒ½åŒæ—¶å‘ç”Ÿã€‚ å¯¹ç«‹äº‹ä»¶ \\( A \\cup B = S\\ and\\ A \\cap B = \\emptyset \\) : \\( A \\) \\( B \\)äº‹ä»¶äº’é€†ï¼Œæ¯æ¬¡å®éªŒ \\( A, B \\) å¿…æœ‰ä¸€ä¸ªå‘ç”Ÿä¸”åªæœ‰ä¸€ä¸ªå‘ç”Ÿã€‚\\( A \\) çš„å¯¹ç«‹äº‹ä»¶è®°ä¸º \\( \\overline{A}.\\ \\overline{A} = S - A \\)ã€‚ 1.2 åŸºæœ¬è¿ç®— äº¤æ¢å¾‹ $$ A \\cup B = B \\cup A;\\ A \\cap B = B \\cap A $$ ç»“åˆå¾‹ $$ A \\cup (B \\cup C) = (A \\cup B) \\cup C \\\\ A \\cap (B \\cap C) = (A \\cap B) \\cap C $$ åˆ†é…ç‡ $$ A \\cup (B \\cap C) = (A \\cup B) \\cap (A \\cup C) \\\\ A \\cap (B \\cup C) = (A \\cap B) \\cup (A \\cap C) $$ å¾·æ‘©æ ¹ç‡ $$ \\overline{A \\cap B} = \\overline{A} \\cap \\overline{B};\\ \\overline{A \\cap B} = \\overline{A} \\cup \\overline{B} $$ 1.3 æ¦‚ç‡ éè´Ÿæ€§ : å¯¹äºæ¯ä¸€ä¸ªäº‹ä»¶ \\( A \\), æœ‰ \\( P(A) \\geq 0 \\); è§„èŒƒæ€§ : å¯¹äºå¿…ç„¶äº‹ä»¶ \\( S \\), æœ‰ \\( P(S) = 1 \\); å¯åˆ—å¯åŠ æ€§ : è®¾ \\( A_1, A_2, \\ldots \\) æ˜¯ä¸¤ä¸¤ä¸ç›¸å®¹çš„äº‹ä»¶ï¼Œå³å¯¹äº \\( A_iA_j = \\emptyset,\\ i \\neq j, i, j = 1, 2, \\ldots \\), æœ‰ \\( P(A_1 \\cup A_2 \\cup \\ldots) = P(A_1) + P(A_2) + \\ldots \\)ã€‚ Tips : \\( n \\to \\infty \\Longrightarrow f_n(A) = P(A) \\) 1.3.1 åŸºæœ¬æ€§è´¨ \\( P(\\emptyset) = 0\\ and\\ P(A) \\leq 1 \\) æœ‰é™å¯åŠ æ€§ : \\( A_1, A_2, \\ldots, A_n \\) ä¸ºäº’æ–¥äº‹ä»¶, åˆ™ $$ P(A_1 \\cup A_2 \\cup \\ldots \\cup A_n) = P(A_1) + P(A_2) + \\ldots + P(A_n) $$ è‹¥ \\( A \\in B \\), åˆ™ $$ P(B - A) = P(B) - P(A) \\\\ P(B) \\geq P(A) $$ è¯æ˜æç¤º : \\( B = A \\cup (B - A)\\ and\\ A(B - A) = \\emptyset \\) \\( P(\\overline{A}) = 1 - P(A) \\) åŠ æ³•å…¬å¼ : ä»»æ„ \\( A, B \\) äº‹ä»¶, æœ‰ $$ P(A \\cup B) = P(A) + P(B) - P(AB) $$ è¯æ˜æç¤º : \\( A \\cup B = A \\cup (B - AB) \\) åŠ æ³•å…¬å¼æ¨å¹¿$$ P(A_1 \\cup A_2 \\cup A_3) = P(A_1) + P(A_2) + P(A_3) - P(A_1A_2) - P(A_1A_3) - P(A_2A_3) + P(A_1A_2A_3) $$ ä¸€èˆ¬çš„æœ‰$$\\begin{aligned} P(A_1 \\cup A_2 \\cup \\ldots \\cup A_n) = {}&amp; \\sum_{i = 1}^{n}P(A_i) - \\sum_{1 \\leq i &lt; j \\leq n}P(A_iA_j) {} \\\\&amp; + \\sum_{1 \\leq i &lt; j &lt; k \\leq n}P(A_iA_jA_k) + \\ldots + (-1)^{n-1}P(A_1A_2 \\ldots A_n) \\end{aligned}$$ 1.4 å¤å…¸æ¦‚å‹ ä¹Ÿç§°ç­‰å¯èƒ½äº‹ä»¶, æ ·æœ¬ç©ºé—´åŒ…å«æœ‰é™ä¸ªå…ƒç´ , æ¯ä¸ªåŸºæœ¬äº‹ä»¶å‘ç”Ÿçš„å¯èƒ½æ€§ç›¸åŒã€‚ 1.4.1 åŸºæœ¬æ€§è´¨ ç­‰å¯èƒ½æ€§ : åœ¨æ ·æœ¬ç©ºé—´ \\( S = \\{ e_1, e_2, \\ldots, e_n \\} \\) åˆ™ $$ P(\\{e_1\\}) = P(\\{e_2\\}) = \\ldots = P(\\{e_n\\}) $$ ä¸¤ä¸¤ä¸ç›¸å®¹ : æœ‰$$\\begin{aligned}1 {}&amp; = P(S) = P(\\{e_1\\} \\cup \\{e_2\\} \\cup \\ldots \\cup \\{e_n\\}) {} \\\\&amp; = P(\\{e_1\\}) + P(\\{e_2\\}) + \\ldots + P(\\{e_n\\}) {} \\\\&amp; = nP(\\{e_i\\}) \\\\&amp; P(\\{e_i\\}) = \\frac{1}{n}, i = 1, 2, \\ldots, n.\\end{aligned}$$ è‹¥äº‹ä»¶ \\( A \\) åŒ…å« \\( k \\) ä¸ªåŸºæœ¬äº‹ä»¶, å³ \\( A = \\{e_{i_1}\\} \\cup \\{e_{i_2}\\} \\cup \\dots \\cup \\{e_{i_k}\\} \\) è¿™é‡Œ \\( i_1, i_2, \\ldots, i_k \\) æ˜¯ \\( 1, 2, \\ldots, n \\) ä¸­æŸ \\( k \\)ä¸ªä¸åŒçš„æ•°ã€‚åˆ™æœ‰ $$ P(A) = \\sum{j = 1}^{k} P(\\{ e\\{i_j} \\}) = \\frac{k}{n} = \\frac{the\\ number\\ of\\ event\\ A}{the\\ number\\ of\\ event\\ S} $$ 1.5 æ¡ä»¶æ¦‚ç‡ ä¸»è¦ç†è§£å°±æ˜¯åœ¨äº‹ä»¶ \\( A \\) å‘ç”Ÿäº†çš„æƒ…å†µä¸‹, äº‹ä»¶ \\( B \\) å‘ç”Ÿçš„æ¦‚ç‡ \\( P(B|A) \\)ã€‚å¯ç†è§£æ ·æœ¬ç©ºé—´ä¸ºäº‹ä»¶ \\( A \\) å‘ç”Ÿä¹‹åçš„ã€‚ 1.5.1 å®šä¹‰äº‹ä»¶ \\( A \\) å‘ç”Ÿçš„æ¡ä»¶ä¸‹å‘ç”Ÿäº‹ä»¶ \\( B \\) çš„æ¡ä»¶æ¦‚ç‡ : $$ P(B|A) = \\frac{P(AB)}{P(A)} $$ å¦‚æœä¸å¤ªå¥½ç†è§£å¯ä»¥æ¢æˆ \\( P(AB) = P(A)P(B|A) \\), äº‹ä»¶ \\( AB \\) å‘ç”Ÿçš„è¿‡ç¨‹æ˜¯äº‹ä»¶ \\( A \\) å‘ç”Ÿå, å†å‘ç”Ÿäº‹ä»¶ \\( B \\), è¿™æ ·å°±å¯ä»¥å¾—å‡ºäº‹ä»¶ \\( AB \\) çš„æ¦‚ç‡ \\( P(AB) \\) ä¸ äº‹ä»¶ \\( A \\) å‘ç”Ÿçš„æ¦‚ç‡ \\( P(A) \\) ä»¥åŠäº‹ä»¶ \\( A \\) åå‘ç”Ÿçš„äº‹ä»¶ \\( B \\) çš„æ¦‚ç‡ \\( P(B|A) \\) çš„ä¹˜ç§¯ç›¸ç­‰ã€‚ åŒç†, æ¦‚ç‡çš„éè´Ÿæ€§ã€è§„èŒƒæ€§ã€å¯åˆ—å¯åŠ æ€§æ¡ä»¶æ¦‚ç‡åŒæ ·å…·å¤‡, ä¸‹é¢è§£é‡Šç¬¬ä¸‰æ¡ã€‚ å¯åˆ—å¯åŠ æ€§ : è®¾ \\( B_1, B_2, \\ldots \\) æ˜¯ä¸¤ä¸¤ä¸ç›¸å®¹çš„äº‹ä»¶, åˆ™ $$ P(\\bigcup\\limits_{i=1}\\limits^{\\infty} B_i | A) = \\sum\\limits_{i = 1}\\limits^{\\infty} P(B_i | A) $$ ç†è§£ : ä½“ä¼šåŸºäºäº‹ä»¶ \\( A \\) åå‘ç”Ÿçš„äº‹ä»¶ \\( B_i \\) çš„æ ·æœ¬ç©ºé—´æ˜¯äº‹ä»¶ \\( A \\) å‘ç”Ÿåçš„æ ·æœ¬ç©ºé—´, å…¸å‹ä¾‹å­æ˜¯åœ¨ä¸€ä¸ªé»‘ç›’ä¸­ä¸æ”¾å›çš„å–çƒ, æ±‚å¤šæ¬¡å–å‡ºæŸç§ç»„åˆçƒçš„æ¦‚ç‡ã€‚ ä¹˜æ³•å®šç† : è®¾ \\( P(A) &gt; 0 \\) åˆ™$$ P(AB) = P(B|A)P(A) $$ ä¹˜æ³•å®šç†æ¨å¹¿ : è®¾ \\( P(AB) &gt; 0 \\) åˆ™$$ P(ABC) = P(C|AB)P(B|A)P(A) $$ Tips : \\( P(A) \\geq P(AB) &gt; 0 \\) æ˜¯éšè—æ¡ä»¶ã€‚ä¸€èˆ¬åŒ–, è®¾ \\( A_1, A_2, \\ldots, A_n \\ and\\ n \\geq 2 \\ and \\ P(A_1A_2\\ldots A_{n-1}) &gt; 0\\), åˆ™æœ‰ $$ P(A_1A_2\\ldots A_{n}) = P(A_n|A_1A_2\\ldots A_{n-1})P(A_{n-1}A_1A_2\\ldots A_{n-2}) \\ldots P(A_2|A_1)P(A_1)$$ å¾ˆå¥½ç†è§£, ä»ååˆ°å‰, ä¸€ä¸ªä¸€ä¸ªäº‹ä»¶å‘ç”Ÿå»æ€è€ƒã€‚ 1.5.2 é‡è¦å…¬å¼ å…¨æ¦‚ç‡å…¬å¼ : è®¾å®éªŒ \\( E \\) çš„æ ·æœ¬ç©ºé—´ä¸º \\( S \\), \\( A \\) ä¸º \\( E \\) çš„äº‹ä»¶, \\( B_1, B_2, \\ldots, B_n \\) ä¸º \\( S \\) çš„ä¸€ä¸ªåˆ’åˆ†, ä¸” \\( P(B_i) &gt; 0 (i = 0, 1, \\dots, n) \\), åˆ™ $$ P(A) = P(A|B_1)P(B_1) + P(A|B_2)P(B_2) + \\ldots + P(A|B_n)P(B_n) $$ ç…§å‰é¢æ ·æœ¬ç©ºé—´æ¥ç†è§£å°±å¥½äº†, \\( P(A|B_i) \\) ä»£è¡¨ \\( A \\) äº‹ä»¶åœ¨ \\( B_i \\) æ ·æœ¬ç©ºé—´çš„æ¦‚ç‡, ä¹˜ä»¥ \\( P(B_i) \\) ä»£è¡¨åœ¨æ ·æœ¬ç©ºé—´ \\( S \\) ä¸­, \\( B_i \\) ä¸­çš„æ ·æœ¬è§¦å‘äº‹ä»¶ \\( A \\) çš„æ¦‚ç‡ã€‚å½“æ‰€æœ‰åˆ’åˆ†æ ·æœ¬çš„æ¦‚ç‡åŠ èµ·æ¥æ—¶, å°±æ˜¯äº‹ä»¶ \\( A \\) åœ¨ \\( S \\) ä¸­å‘ç”Ÿçš„æ¦‚ç‡äº†ã€‚è¯æ˜ï¼šå‡è®¾ \\( P(B_i) &gt; 0 \\ (i = 1, 2, \\ldots, n) \\ and \\ (AB_i)(AB_j) = \\emptyset, i \\neq j, i, j = 1, 2, \\ldots, n \\)$$A = AS = A(B_1 \\cup B_2 \\cup \\ldots \\cup B_n) = AB_1 \\cup AB_2 \\cup \\ldots \\cup AB_n, \\\\\\begin{aligned}P(A) {} &amp; = P(AB_1) + P(AB_2) + \\ldots + P(AB_n) {} \\\\&amp; = P(A|B_1)P(B_1) + P(A|B_2)P(B_2) + \\ldots + P(A|B_n)P(B_n)\\end{aligned}$$ è´å¶æ–¯å…¬å¼ : è®¾å®éªŒ \\( E \\) çš„æ ·æœ¬ç©ºé—´ä¸º \\( S \\), \\( A \\) ä¸º \\( E \\) çš„äº‹ä»¶, \\( B_1, B_2, \\ldots, B_n \\) ä¸º \\( S \\) çš„ä¸€ä¸ªåˆ’åˆ†, ä¸” \\( P(A) &gt; 0,P(B_i) &gt; 0 (i = 0, 1, \\dots, n) \\), åˆ™ $$ P(B_i|A) = \\frac{P(A|B_i)P(B_i)}{\\sum\\limits_{j = 1}\\limits^{n}P(A|B_j)P(B_j)}, i= 1,2, \\ldots, n.$$ å½“ \\( n = 2 \\) æ—¶, è¿™ä¸¤ä¸ªå…¬å¼åˆ†åˆ«ä¸º : $$ P(A) = P(A|B)P(B) + P(A|\\overline{B})P(\\overline{B}) = P(AB) + P(A\\overline{B}) \\\\ P(B|A) = \\frac{P(AB)}{P(A)} = \\frac{P(A|B)P(B)}{P(A|B)P(B) + P(A|\\overline{B})P(\\overline{B})} = \\frac{P(A|B)P(B)}{P(AB) + P(A\\overline{B})} $$ è¿™ä¸¤ä¸ªå…¬å¼æ¯”è¾ƒé‡è¦, è¿™é‡Œæˆªå–ä¸€ä¸ªä¾‹å­ä¾›åŠ æ·±ç†è§£: 1.6 ç‹¬ç«‹æ€§ ç†è§£äº‹ä»¶ \\( A, B \\) æœ‰ \\( P(A|B) = P(A) \\) æ¡ä»¶æˆç«‹æ—¶, \\( A, B \\) ç›¸äº’ç‹¬ç«‹ã€‚ 1.6.1 å®šä¹‰è®¾äº‹ä»¶ \\( A, B \\) æ»¡è¶³ $$ P(AB) = P(A)P(B) $$ åˆ™ç§°äº‹ä»¶ \\( A, B \\) äº’ç›¸ç‹¬ç«‹ã€‚ 1.6.2 æ€§è´¨è‹¥ \\( A, B \\) äº’ç›¸ç‹¬ç«‹, åˆ™ \\( (A,\\overline{B})\\ (\\overline{A}, B)\\ (\\overline{A}, \\overline{B}) \\) ä¹Ÿç›¸äº’ç‹¬ç«‹ã€‚ å¤šäº‹ä»¶ç‹¬ç«‹ : \\( A, B, C \\) ç‹¬ç«‹æ¡ä»¶ $$ \\begin{aligned} &amp; P(AB) = P(A)P(B) \\\\ &amp; P(AC) = P(A)P(C) \\\\ &amp; P(BC) = P(B)P(C) \\\\ &amp; P(ABC) = P(A)P(B)P(C) \\end{aligned}$$ ä¸€èˆ¬, è®¾äº‹ä»¶ \\( A_1, A_2, \\ldots, A_n \\) æ˜¯ \\( n \\ (n \\geq 2) \\) ä¸ªäº‹ä»¶, å¦‚æœå¯¹äºå…¶ä¸­ä»»æ„ \\( 2, 3, \\ldots, n \\)ä¸ªäº‹ä»¶çš„ç§¯äº‹ä»¶çš„æ¦‚ç‡éƒ½ç­‰äºå„äº‹ä»¶æ¦‚ç‡ä¹‹ç§¯, åˆ™ç§°äº‹ä»¶ \\( A_1, A_2, \\ldots, A_n \\) ç›¸äº’ç‹¬ç«‹ã€‚ Tips : é€šè¿‡å…³é”®è¯è‡ªå·±ä¸€ä¸€å›é¡¾è¿™ä¸€ç« çš„å†…å®¹å§ã€‚éšæœºè¯•éªŒ, æ ·æœ¬ç©ºé—´, éšæœºäº‹ä»¶, åŸºæœ¬äº‹ä»¶, é¢‘ç‡, æ¦‚ç‡, å¤å…¸æ¦‚å‹, \\( A \\) çš„å¯¹ç«‹äº‹ä»¶ \\( \\overline{A} \\) åŠå…¶æ¦‚ç‡, ä¸¤äº’ä¸ç›¸å®¹äº‹ä»¶çš„å’Œäº‹ä»¶çš„æ¦‚ç‡, æ¦‚ç‡çš„åŠ æ³•å®šç†, æ¡ä»¶æ¦‚ç‡, æ¦‚ç‡çš„ä¹˜æ³•å…¬å¼, å…¨æ¦‚ç‡å…¬å¼, è´å¶æ–¯å…¬å¼, äº‹ä»¶çš„ç‹¬ç«‹æ€§, å®é™…æ¨æ–­åŸç† 2. éšæœºå˜é‡åŠå…¶åˆ†å¸ƒ2.1 éšæœºå˜é‡ åœ¨å‰é¢éšæœºè¯•éªŒä¸­, ç»“æœå¯ä»¥ç”¨æ•°æ¥è¡¨ç¤º, ä½†æ˜¯æœ‰äº›æè¿°èµ·æ¥ä¸æ–¹ä¾¿, ä¸ºäº†å¤„ç†æ–¹ä¾¿, å°† \\( S \\) ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´  \\( e \\) ä¸å®æ•° \\( x \\) å¯¹åº”èµ·æ¥, éšæœºå˜é‡å°±è¿™æ ·å¼•å…¥äº†ã€‚ 2.2 ç¦»æ•£å‹éšæœºå˜é‡åŠå…¶åˆ†å¸ƒ éšæœºå˜é‡ \\( X \\) çš„å–å€¼æ˜¯ç¦»æ•£çš„, å¦‚ \\( 0, 1, 2, 3 \\) 2.2.1 å®šä¹‰è®¾ç¦»æ•£å‹éšæœºå˜é‡ \\( X \\) æ‰€æœ‰å¯èƒ½çš„å–å€¼ä¸º \\( x_k(k = 1, 2, \\ldots) , X \\) å–å„ä¸ªå¯èƒ½å€¼çš„æ¦‚ç‡, åŠæ—¶é—´ \\( \\{ X = x_k\\} \\) çš„æ¦‚ç‡ä¸º : $$ P\\{X = x_k\\} = p_k, k = 1, 2, \\ldots . $$ åŒç†, æ¦‚ç‡çš„éè´Ÿæ€§ã€è§„èŒƒæ€§ã€å¯åˆ—å¯åŠ æ€§ç¦»æ•£å‹éšæœºå˜é‡æ¦‚ç‡åŒæ ·å…·å¤‡ã€‚ç”¨è¡¨æ ¼è¡¨ç¤º \\( X \\) çš„åˆ†å¸ƒå¾‹:$$\\begin{array}{c|ccccc}X &amp; x_1 &amp; x_2 &amp; \\ldots &amp; x_n &amp; \\ldots \\\\\\hlinep_k &amp; p_1 &amp; p_2 &amp; \\ldots &amp; p_n &amp; \\dots\\end{array}$$ 2.2.2 å‡ ç§å…¸å‹çš„ç¦»æ•£åˆ†å¸ƒ 0-1 åˆ†å¸ƒ : éšæœºå˜é‡ \\( X \\) åªèƒ½å–å€¼ \\( 0, 1 \\) åˆ†å¸ƒå¾‹æ˜¯ $$ P\\{X = k\\} = p^k(1 - p)^{1 - k}, k = 0, 1 \\ (0 &lt; p &lt; 1) $$å¯¹äºéšæœºè¯•éªŒ \\( S = \\{ e_1, e_2 \\}\\), æˆ‘ä»¬æ€»èƒ½åœ¨ \\( S \\) ä¸Šå®šä¹‰ä¸€ä¸ªæœä» ï¼ˆ0 â€” 1ï¼‰åˆ†å¸ƒçš„éšæœºå˜é‡ \\( X \\) : $$ X = X(e) = \\begin{cases} 0,\\ when\\ e = e_1 \\\\ 1,\\ when\\ e = e_2 \\end{cases} $$ æ¥æè¿°ã€‚ ä¼¯åŠªåˆ©è¯•éªŒã€äºŒé¡¹åˆ†å¸ƒ : è¯•éªŒ \\( E \\) åªæœ‰ä¸¤ä¸ªå¯èƒ½çš„ç»“æœ \\( \\{ A, \\overline{A} \\} \\), åˆ™ç§° \\( E \\) ä¸ºä¼¯åŠªåˆ©è¯•éªŒã€‚å°† \\( E \\) é‡å¤åœ°è¿›è¡Œ \\( n \\) æ¬¡, ç§°è¿™ä¸€ä¸²é‡å¤çš„ç‹¬ç«‹å®è¯•éªŒä¸ºé‡å¤ä¼¯åŠªåˆ©è¯•éªŒã€‚è®¾ \\( P(A) = p \\) åˆ™åœ¨ \\( n \\) æ¬¡è¯•éªŒä¸­ \\( A \\) å‘ç”Ÿ \\( k \\) æ¬¡çš„æ¦‚ç‡ä¸º : $$ P\\{X = k\\} = \\left( \\begin{array}{c} n \\\\ k \\end{array} \\right) p^k{(1 - p)}^{n - k}, k = 0, 1, 2, \\ldots, n.$$ æ˜¾ç„¶ $$ \\sum\\limits_{k = 0}\\limits^{n}P\\{X = k\\} = \\sum\\limits_{k = 0}\\limits^{n} \\left( \\begin{array}{c} n \\\\ k \\end{array} \\right) p^k{(1 - p)}^{n - k} = {(p + (1 - p))}^n = 1 $$ äºŒé¡¹å¼ \\( {(p + (1 - p))}^n \\) çš„ç¬¬ \\( k \\) é¡¹å±•å¼€ \\( \\left( \\begin{array}{c} n \\\\ k \\end{array} \\right) p^k{(1 - p)}^{n - k} \\)ã€‚ æ‰€ä»¥, æˆ‘ä»¬ç§° \\( X \\) æœä»å‚æ•°ä¸º \\( n, p \\) çš„äºŒé¡¹åˆ†å¸ƒ, è®°ä½œ : $$ X \\sim b(n, p) $$ ç‰¹åˆ«çš„, å½“ \\( n = 1 \\)æ—¶ä¸ºäºŒé¡¹åˆ†å¸ƒ : $$ P\\{X = k\\} = p^k{(1 - p)}^{1 - k}, k = 0, 1.$$ æ³Šæ¾åˆ†å¸ƒ : éšæœºå˜é‡ \\( X = \\{0, 1, 2, \\ldots \\} \\), è€Œå„ä¸ªæ¦‚ç‡çš„å–å€¼ä¸º $$ P\\{X = k\\} = \\frac{\\lambda^k e^{-\\lambda}}{k!}, k = 0, 1, 2, \\ldots, \\lambda &gt; 0 $$ åˆ™ç§° \\( X \\)æœä»å‚æ•°ä¸º \\( \\lambda \\) çš„æ³Šæ¾åˆ†å¸ƒ, è®°ä½œ : $$ X \\sim \\pi(\\lambda) $$ æ˜¾ç„¶ $$ \\sum\\limits_{k = 0}^{\\infty}P\\{X = k\\} = \\sum\\limits_{k = 0}^{\\infty} \\frac{\\lambda^k e^{-\\lambda}}{k!} = e^{-\\lambda} \\sum\\limits_{k = 0}^{\\infty}\\frac{\\lambda^k}{k!} = e^{-\\lambda}e^\\lambda = 1 $$ å…·ä½“ä½¿ç”¨åé¢ä¼šæ…¢æ…¢ä»‹ç»ã€‚ æ³Šæ¾å®šç† : è®¾ \\( \\lambda &gt; 0, np_n = \\lambda \\ n \\)ä¸ºä»»æ„æ­£æ•´æ•°, åˆ™å¯¹äºä»»æ„ä¸€ä¸ªå›ºå®šçš„éè´Ÿæ•´æ•° \\( k \\), æœ‰ $$ \\lim_{n \\rightarrow \\infty} \\left( \\begin{array}{c} n \\\\ k \\end{array} \\right) p_n^k{(1 - p_n)}^{n - k} = \\frac{\\lambda^k e^{-\\lambda}}{k!} $$ è¿™å°±æ˜¯ç”¨æ³Šæ¾åˆ†å¸ƒé€¼è¿‘äºŒé¡¹åˆ†å¸ƒçš„æ³Šæ¾å®šç†ã€‚è¯æ˜æˆªå›¾å¦‚ä¸‹ :ä¸Šé¢çš„è¯æ˜è¯´æ˜äº†, å½“ \\( n \\rightarrow \\infty\\) æ—¶, ä»¥ \\( n, p \\) ä¸ºå‚æ•°çš„äºŒé¡¹åˆ†å¸ƒæ¦‚ç‡å€¼å¯ä»¥ç”±å‚æ•°ä¸º \\( \\lambda = np \\) çš„æ³Šæ¾åˆ†å¸ƒçš„æ¦‚ç‡å€¼è¿‘ä¼¼ã€‚ä¸¾ä¸ªæ —å­ 2.3 éšæœºå˜é‡çš„åˆ†å¸ƒå‡½æ•° å¯¹äºéç¦»æ•£çš„éšæœºå˜é‡ \\( X \\) æŒ‡å®šæŸä¸€å®æ•°å€¼å¾—æ¦‚ç‡éƒ½ä¸º \\( 0 \\)ã€‚æ‰€ä»¥è¿™é‡Œå°±æ”¹ä¸ºç ”ç©¶éšæœºå˜é‡æ‰€è½åŒºé—´çš„æ¦‚ç‡ : $$ P\\{x_1 &lt; X \\leq x_2\\} = P(X \\leq x_2) - P(X \\leq x_1) $$ ç”»ä¸ªæ•°è½´å°±å¾ˆå¥½ç†è§£äº†ã€‚ 2.3.1 å®šä¹‰è®¾ \\( X \\) æ˜¯ä¸€ä¸ªéšæœºå˜é‡, \\( x \\) æ˜¯ä»»æ„å®æ•°, å‡½æ•° : $$ F(x) = P\\{ X \\leq x\\}, -\\infty &lt; x &lt; \\infty $$ ç§°ä¸º \\( X \\) çš„åˆ†å¸ƒå‡½æ•°ã€‚å¯¹ä»»æ„å®æ•° \\( x_1, x_2 (x_1 &lt; x_2) \\), æœ‰ $$ P\\{x_1 &lt; X \\leq x_2\\} = P(X \\leq x_2) - P(X \\leq x_1) = F(x_2) - F(x_1) $$ 2.3.2 åŸºæœ¬æ€§è´¨ \\( F(x) \\) æ˜¯ä¸€ä¸ªä¸å‡å‡½æ•°ã€‚ \\( 0 \\leq F(x) \\leq 1 \\ and\\ F(-\\infty) = \\lim\\limits_{x\\rightarrow-\\infty}F(x) = 0 \\ F(\\infty) = \\lim\\limits_{x\\rightarrow\\infty}F(x) = 1 \\) 2.4 è¿ç»­å‹éšæœºå˜é‡åŠå…¶æ¦‚ç‡å¯†åº¦ å¦‚ä¸Šä¸€èŠ‚åˆ†æ, éšæœºå˜é‡ \\( X \\) çš„åˆ†å¸ƒå‡½æ•° \\( F(x) \\)å­˜åœ¨éè´Ÿå‡½æ•° \\( f(x) \\), ä½¿å¾—ä»»æ„å®æ•° \\( x \\)æœ‰ $$ F(x) = \\int_{-\\infty}^{x}f(x)dt $$ åˆ™ç§° \\( X \\)ä¸ºè¿ç»­å‹éšæœºå˜é‡, å…¶ä¸­å‡½æ•° \\( f(x) \\) ç§°ä¸º \\( X \\) çš„æ¦‚ç‡å¯†åº¦å‡½æ•°, ç®€ç§°æ¦‚ç‡å¯†åº¦ã€‚ \\( f(x) \\geq 0 \\) \\( \\int_{-\\infty}^{\\infty} f(x)dx = 1 \\) å¯¹äºä»»æ„å®æ•° \\( x_1, x_2 (x_1 \\leq x_2) \\) $$ P(x_1 &lt; X \\leq x_2) = F(x_2) - F(x_1) = \\int_{x_1}^{x_2}f(x)dx $$ è‹¥ \\( f(x) \\) åœ¨ \\( x \\)å‡ºè¿ç»­, åˆ™ \\( F^{â€˜}(x) = f(x) \\) 2.4.1 å‡ ç§å…¸å‹çš„è¿ç»­å‹éšæœºå˜é‡ å‡åŒ€åˆ†å¸ƒ : è‹¥è¿ç»­å‹éšæœºå˜é‡ \\( X \\) çš„æ¦‚ç‡å¯†åº¦ä¸º $$ f(x) = \\begin{cases} \\frac{1}{b - a},\\ a &lt; x &lt; b \\\\ 0,\\ others \\end{cases} $$ åˆ™ç§° \\( X \\) åœ¨åŒºé—´ \\( (a, b) \\) ä¸Šæœä»å‡åŒ€åˆ†å¸ƒã€‚è®°ä¸º \\( X \\sim U(a, b) \\)ã€‚åˆ†å¸ƒå‡½æ•°ä¸º $$ F(x) = \\begin{cases} 0,\\ x &lt; a \\\\ \\frac{x - a}{b - a},\\ a \\leq x &lt; b \\\\ 1,\\ x \\geq b \\end{cases} $$ æŒ‡æ•°åˆ†å¸ƒ : è‹¥è¿ç»­å‹éšæœºå˜é‡ \\( X \\) çš„æ¦‚ç‡å¯†åº¦ä¸º $$ f(x) = \\begin{cases} \\frac{1}{\\theta}e^{-x/\\theta},\\ x &gt; 0 \\\\ 0,\\ others \\end{cases} $$ å…¶ä¸­ \\( \\theta &gt; 0 \\) ä¸ºå¸¸æ•°, åˆ™ç§° \\( X \\) æœä»å‚æ•°ä¸º \\( \\theta \\) çš„æŒ‡æ•°åˆ†å¸ƒã€‚åˆ†å¸ƒå‡½æ•°ä¸º $$ f(x) = \\begin{cases} 1 - e^{-x/\\theta},\\ x &gt; 0 \\\\ 0,\\ others \\end{cases} $$æŒ‡æ•°åˆ†å¸ƒçš„æ— è®°å¿†æ€§ : å¯¹äºä»»æ„ \\( s, t &gt; 0 \\), æœ‰ $$ P\\{ X &gt; s + t | X &gt; s\\} = P\\{ X &gt; t \\} $$ è¯æ˜ : æ­£æ€åˆ†å¸ƒ : è‹¥è¿ç»­å‹éšæœºå˜é‡ \\( X \\) çš„æ¦‚ç‡å¯†åº¦ä¸º $$ f(x) = \\frac{1}{\\sqrt{2\\pi}\\sigma} e ^{- \\frac{(x - \\mu)^2}{2\\sigma^2}}, \\ -\\infty &lt; x &lt; \\infty $$ å…¶ä¸­ \\( \\mu, \\sigma (\\sigma &gt; 0) \\) ä¸ºå¸¸æ•°, åˆ™ç§° \\( X \\) æœä»å‚æ•°ä¸º \\( \\mu, \\sigma \\) çš„æ­£æ€åˆ†å¸ƒæˆ–é«˜æ–¯åˆ†å¸ƒ, è®°ä¸º \\( X \\sim N(\\mu, \\sigma^2) \\)ã€‚è¯æ˜ : æ›²çº¿å…³äº \\( x = \\mu \\) å¯¹ç§°, è¿™è¡¨æ˜å¯¹äºä»»æ„ \\( h &gt; 0 \\) æœ‰ $$ P\\{ \\mu - h &lt; X \\leq \\mu \\} = P\\{ \\mu &lt; X \\leq \\mu + h \\} $$ å½“ \\( x = \\mu \\) æ—¶å–æœ€å¤§å€¼ $$ f(\\mu) = \\frac{1}{\\sqrt{2\\pi}\\sigma} $$ åœ¨ \\( x = \\mu \\pm \\sigma \\) å¤„æ›²çº¿æœ‰æ‹ç‚¹ã€‚ç‰¹åˆ«, å½“ \\( \\mu = 0, \\sigma = 1 \\) æ—¶, ç§°éšæœºå˜é‡ \\( X \\) æœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒã€‚å…¶æ¦‚ç‡å¯†åº¦å’Œåˆ†å¸ƒå‡½æ•°åˆ†åˆ«ç”¨ \\( \\varphi (x), \\Phi (x) \\) è¡¨ç¤º, å³æœ‰ $$ \\varphi (x) = \\frac{1}{\\sqrt{2\\pi}}e^{-t^2/2} \\\\ \\Phi (x) = \\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^{x}e^{-t^2/2}dt \\\\ \\Phi (-x) = 1 - \\Phi (x) $$ 2.5 éšæœºå˜é‡çš„å‡½æ•°çš„åˆ†å¸ƒ è¿™é‡Œä¸»è¦ä»‹ç»åœ¨å·²çŸ¥éšæœºå˜é‡ \\( X \\) çš„æ¦‚ç‡æ±‚ \\( Y = g(X) \\ g(\\cdot) \\) æ˜¯å·²çŸ¥è¿ç»­å‡½æ•°ã€‚ ä¸¾ä¸ªæ —å­ è®¾éšæœºå˜é‡ \\( X \\) å…·æœ‰æ¦‚ç‡å¯†åº¦ \\( f_X(x), \\ -\\infty &lt; x &lt; \\infty \\), åˆè®¾å‡½æ•° \\( g(x) \\) å¤„å¤„å¯å¯¼, æ’æœ‰ \\( g(x)^{â€˜} &gt; 0 \\ or \\ g(x)^{â€˜} &lt; 0 \\), åˆ™ \\( Y = g(X) \\) æ˜¯è¿ç»­å‹éšæœºå˜é‡, å…¶æ¦‚ç‡å¯†åº¦ä¸º $$ f_Y(y) = \\begin{cases} f_X[h(y)]|h^{â€˜}(y)|, \\ \\alpha &lt; y &lt; \\beta \\\\ 0, \\ others \\end{cases} $$ å…¶ä¸­ \\( \\alpha = min\\{ g(-\\infty), g(\\infty) \\} \\ \\beta = max\\{ g(-\\infty), g(\\infty) \\} \\ h(x) \\) æ˜¯ \\( g(x) \\) çš„åå‡½æ•°ã€‚è¯æ˜æç¤º : è§ä¸Šä¸€ä¸ªğŸŒ° å°ç»“ : 3. TODOæœªå®Œå¾…ç»­â€¦","tags":[{"name":"Math","slug":"Math","permalink":"http://fitzeng.org/tags/Math/"},{"name":"MachineLearning","slug":"MachineLearning","permalink":"http://fitzeng.org/tags/MachineLearning/"},{"name":"ProbabilityTheory","slug":"ProbabilityTheory","permalink":"http://fitzeng.org/tags/ProbabilityTheory/"}]},{"title":"MarkDown æ’å…¥æ•°å­¦å…¬å¼å®éªŒå¤§é›†åˆ","date":"2018-01-23T03:27:00.000Z","path":"2018/01/23/LaTexFormula/","text":"0. å‰è¨€ æœ€è¿‘åœ¨å­¦ä¹ ä¸€äº›æœºå™¨å­¦ä¹ ç›¸å…³çš„çŸ¥è¯†ï¼Œæƒ³æŠŠè‡ªå·±å­¦ä¹ çš„ä¸œè¥¿é€šè¿‡ MD çš„å½¢å¼åœ¨çº¿è®°å½•ä¸‹æ¥ï¼Œä½†æ˜¯ä¹‹å‰ä¸€ç›´æ²¡æœ‰å¼€å§‹è¡ŒåŠ¨ï¼Œå› ä¸ºé‡Œé¢çš„å…¬å¼ä»€ä¹ˆçš„æ„Ÿè§‰å®åœ¨æ˜¯éº»çƒ¦ã€‚äºæ˜¯ä»Šå¤©æ‰“ç®—èŠ±ç‚¹æ—¶é—´äº†è§£ä¸€ä¸‹å¦‚ä½•åœ¨ markdown ä¸­æ’å…¥æ•°å­¦å…¬å¼ï¼Œå‘ç°å…¶å®å¾ˆç®€å•ï¼Œå¤§æ¦‚èŠ±ä¸€ä¸ªå°æ—¶å·¦å³å°±èƒ½çŸ¥é“å¦‚ä½•ç¼–å†™äº†ã€‚ 1. åŸºç¡€è®¤è¯† ç¬”è€…è®¤ä¸ºæ‰€è°“æ’å…¥æ•°å­¦å…¬å¼å…¶å®å°±æ˜¯å¼•å…¥ä¸€ç§è§„åˆ™ï¼Œç„¶åé€šè¿‡æ¨¡æ¿ï¼Ÿæ¸²æŸ“æˆå…¬å¼ï¼Œä¸çŸ¥é“è¿™ä¸ªç†è§£å¯¹ä¸å¯¹ï¼Œä¸å¯¹æœ›æŒ‡æ­£ã€‚å…¶å®ä½ ä»¥å‰å¯èƒ½å°±çœ‹åˆ°è¿‡æœ‰çš„åšå®¢æœ¬è¯¥å‡ºç°å…¬å¼çš„æ—¶å€™ä¸æ˜¾ç¤ºï¼Œç‚¹å‡»åä¼šé“¾æ¥åˆ°ä¸€ä¸ª new tab ç„¶åæ˜¾ç¤ºä¸€å¼ å…¬å¼çš„å›¾ç‰‡ï¼Œæœ‰æ—¶å´å‡ºç°ä¸€å¤§å †çš„ä»£ç ã€‚è¿™é‡Œå°±æ˜¯é€šè¿‡è¿™æ®µä»£ç è§£ææˆå…¬å¼ç„¶åæ˜¾ç¤ºçš„ã€‚ è¿™é‡Œæˆ‘ä»¬é€‰å– MathJax å¼•æ“ã€‚å¼•å…¥è„šæœ¬ï¼ŒæŠŠä¸‹é¢ä»£ç æ’å…¥ MD æ–‡ä»¶é‡Œé¢ï¼Œå¦‚æœä½ æ€•è¿™ä»½åœ¨çº¿æ–‡ä»¶æºåˆ«äººè®¿é—®ä¸åˆ°çš„è¯ï¼Œå¯ä»¥æŠŠè¿™ä¸ªä¸‹ä¸‹æ¥è‡ªå·±åšä¸€ä¸ªæºï¼Œè¿™æ ·æ¯”è¾ƒç¨³å®šç¼ºç‚¹æ˜¯è¦è‡ªå·±æ‰‹åŠ¨æ›´æ–°æºã€‚ 1&lt;script type=&quot;text/javascript&quot; src=&quot;http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default&quot;&gt;&lt;/script&gt; å¥½äº†åˆ°è¿™é‡Œå°±å¯ä»¥æ’å…¥å…¬å¼äº†ï¼Œå¦‚æœä½ æ‡‚ LaTeX çš„è¯é‚£çœ‹ä¸€ä¸¤ä¸ªä¾‹å­å°±çŸ¥é“äº†ï¼Œä¸æ‡‚ä¹Ÿæ²¡å…³ç³»ï¼Œè‡ªå·±å†™ä¸€å†™ä»£ç å°±çŸ¥é“äº†ï¼Œå¯ä»¥æ‰¾ä¸€ä¸ªå¯ä»¥é¢„è§ˆ MD çš„å·¥å…·ä¸€ç›´å°è¯•ã€‚ 1.1 æ’å…¥æ–¹å¼ è¿™é‡Œåˆ†ä¸¤ç§ï¼Œä¸€ç§æ˜¯è¡Œé—´æ’å…¥ï¼Œå¦ä¸€ç§æ˜¯å¦å–ä¸€è¡Œ 1.1.1 è¡Œé—´æ’å…¥1\\\\(a + b\\\\) è¿™é‡Œæ˜¯è¡Œé—´æ’å…¥å…¬å¼ a + b : \\(a + b\\)ï¼Œç‰¹ç‚¹å°±æ˜¯é€šè¿‡( å’Œ ) åŒ…å«å…¬å¼ï¼Œç„¶åä¸ºäº†æ¨¡æ¿å¼•æ“èƒ½å¤ŸåŒºåˆ†è¯¥ ( ä¸æ˜¯æ™®é€šæ–‡æœ¬çš„ ( è€Œæ˜¯å…¬å¼çš„ (ï¼Œé€šè¿‡ \\\\ è½¬ä¹‰ä¸€ä¸‹ã€‚è¿™æ ·åº”è¯¥å°±å¾ˆå¥½ç†è§£è¿™ä¸ªè¯­æ³•æ„æˆäº†ã€‚æ³¨æ„è¿™é‡Œæ–¹å¼ä¸å”¯ä¸€ï¼Œè¿™æ˜¯ç¬”è€…å–œæ¬¢çš„æ–¹å¼ï¼Œå…¶ä»–çš„ä½¿ç”¨æ–¹å¼è‡ªè¡Œæœç´¢ã€‚ä¸‹é¢çš„ä»‹ç»åŒæ ·æ˜¯è¿™æ ·ã€‚ 1.1.2 å¦å–ä¸€è¡Œ1$$a + b$$ è¿™é‡Œæ˜¯å¦å–ä¸€è¡Œ$$a + b$$ ç‰¹ç‚¹å°±æ˜¯é€šè¿‡$$åŒ…å«å…¬å¼ã€‚ ç¬”è€…è®¤ä¸ºç¬¬äºŒç§æ–¹å¼æ›´å¥½ï¼Œä»¥ä¸‹æ²¡çœ‹ JS æºç çº¯å±çŒœæµ‹ï¼šè¡Œé—´çš„éœ€è¦è€ƒè™‘åˆ°å½“å‰è¡Œçš„è¡Œé«˜å¹¶å¯¹å…¬å¼è¿›è¡Œå¤„ç†ï¼Œè€Œå¦å–ä¸€è¡Œå°±æ›´ç®€å•ä¸€äº›ï¼Œå¯èƒ½è§£æèµ·æ¥æ›´å¿«ã€‚æœ€æœ€æœ€æœ€æœ€æœ€ä¸»è¦æ˜¯çœ‹èµ·æ¥æ¼‚äº® ^_^ ä¸å¤ªè¦è€ƒè™‘ç©ºé—´ä¸å¤Ÿæ¢è¡Œã€‚ 1.2 åŸºæœ¬ç±»å‹çš„æ’å…¥ è¿™é‡Œå¯¹ @houkai ï¼šLATEXæ•°å­¦å…¬å¼åŸºæœ¬è¯­æ³• çš„æ€è·¯ç¨åŠ ä¿®æ”¹ï¼Œç„¶åè¿›è¡Œä»‹ç»ã€‚ 1.2.1 ä¸Šã€ä¸‹æ ‡å…ˆçœ‹ç»“æœå†æ€»ç»“è¯­æ³•å§ã€‚ 1234567891011$$x_1$$$$x_1^2$$$$x^2_1$$$$x_&#123;22&#125;^&#123;(n)&#125;$$$$&#123;&#125;^*x^*$$$$x_&#123;balabala&#125;^&#123;bala&#125;&amp;&amp; $$x_1$$ $$x_1^2$$ $$x^2_1$$ $$x_{22}^{(n)}$$ $${}^*x^*$$ $$x_{balabala}^{bala}$$ å¯ä»¥çœ‹åˆ° x å…ƒç´ çš„ä¸Šæ ‡é€šè¿‡ ^ ç¬¦å·åæ¥çš„å†…å®¹ä½“ç°ï¼Œä¸‹è¡¨é€šè¿‡ _ ç¬¦å·åæ¥çš„å†…å®¹ä½“ç°ï¼Œå¤šäºä¸€ä½æ˜¯è¦åŠ  {} åŒ…è£¹çš„ã€‚ç¬”è€…ä¹ æƒ¯å…ˆä¸‹æ ‡åä¸Šæ ‡çš„å†™æ³•ï¼Œå’Œæˆ‘çš„ä¹¦å†™ä¹ æƒ¯ä¸€è‡´ï¼šx_{balabala}^{bala}ï¼Œä¸ç®¡ä½ ä½¿ç”¨å“ªä¸€ç§é£æ ¼ï¼Œæœ€å¥½è‡ªå·±æ³¨æ„ç»Ÿä¸€ï¼Œä¸è¦æ··ç”¨ã€‚ 1.2.2 åˆ†å¼123$$\\frac&#123;x+y&#125;&#123;2&#125;$$$$\\frac&#123;1&#125;&#123;1+\\frac&#123;1&#125;&#123;2&#125;&#125;$$ $$\\frac{x+y}{2}$$ $$\\frac{1}{1+\\frac{1}{2}}$$ è¿™é‡Œå°±å‡ºç°äº†ä¸€ä¸ª frac{}{} å‡½æ•°çš„ä¸œè¥¿ï¼ŒåŒæ ·ï¼Œä¸ºäº†åŒºåˆ†è¿™æ˜¯å‡½æ•°ä¸æ˜¯å‡ ä¸ªå­—æ¯ï¼Œé€šè¿‡ \\frac è½¬ä¹‰ï¼Œäºæ˜¯ frac è¢«è§£ææˆå‡½æ•°ï¼Œç„¶åç¬¬ä¸€ä¸ª {} é‡Œé¢çš„è¢«è§£ææˆåˆ†å­ï¼Œç¬¬äºŒä¸ª {} è¢«è§£ææˆåˆ†æ¯ã€‚è¿™é‡Œå¯ä»¥è¯•è¯•åˆ†æ•°çš„è¡Œé—´è§£æ\\(\\frac{1}{1+\\frac{1}{2}}\\)ã€‚æˆ‘è¦çœ‹è¡Œé—´å¡«å……æ•ˆæœæˆ‘è¦çœ‹è¡Œé—´å¡«å……æ•ˆæœæˆ‘è¦çœ‹è¡Œé—´å¡«å……æ•ˆæœæˆ‘è¦çœ‹è¡Œé—´å¡«å……æ•ˆæœæˆ‘è¦çœ‹è¡Œé—´å¡«å……æ•ˆæœæˆ‘è¦çœ‹è¡Œé—´å¡«å……æ•ˆæœæˆ‘è¦çœ‹è¡Œé—´å¡«å……æ•ˆæœæˆ‘è¦çœ‹è¡Œé—´å¡«å……æ•ˆæœæˆ‘è¦çœ‹è¡Œé—´å¡«å……æ•ˆæœæˆ‘è¦çœ‹è¡Œé—´å¡«å……æ•ˆæœæˆ‘è¦çœ‹è¡Œé—´å¡«å……æ•ˆæœæˆ‘è¦çœ‹è¡Œé—´å¡«å……æ•ˆæœã€‚ 1.2.3 æ ¹å¼12345$$\\sqrt&#123;2&#125;&lt;\\sqrt[3]&#123;3&#125;$$$$\\sqrt&#123;1+\\sqrt[p]&#123;1+a^2&#125;&#125;$$$$\\sqrt&#123;1+\\sqrt[^p\\!]&#123;1+a^2&#125;&#125;$$ $$\\sqrt{2}&lt;\\sqrt[3]{3}$$ $$\\sqrt{1+\\sqrt[p]{1+a^2}}$$ $$\\sqrt{1+\\sqrt[^p]{1+a^2}}$$ è¯»åˆ°è¿™é‡Œä½ å·²ç»äº†è§£äº†å‡½æ•°çš„æ¦‚å¿µï¼Œé‚£ä¹ˆè¿™å†ä¹…å¾ˆç®€å•äº†ï¼Œè¯­æ³•å°±æ˜¯ sqrt[]{} ã€‚[] ä¸­ä»£è¡¨æ˜¯å‡ æ¬¡æ ¹å¼ï¼Œ{} ä»£è¡¨æ ¹å·ä¸‹çš„è¡¨è¾¾å¼ã€‚ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªçš„åŒºåˆ«åœ¨äºä¸ºäº†ç¾è§‚å¾®è°ƒä½ç½® ^_^ã€‚ 1.2.4 æ±‚å’Œã€ç§¯åˆ†1234567$$\\sum_&#123;k=1&#125;^&#123;n&#125;\\frac&#123;1&#125;&#123;k&#125;$$\\\\(\\sum_&#123;k=1&#125;^n\\frac&#123;1&#125;&#123;k&#125;\\\\)$$\\int_a^b f(x)dx$$\\\\(\\int_a^b f(x)dx\\\\) $$\\sum_{k=1}^{n}\\frac{1}{k}$$ \\(\\sum_{k=1}^n\\frac{1}{k}\\) $$\\int_{a}^b f(x)dx$$ \\(\\int_a^b f(x)dx\\) è¿™é‡Œå¾ˆå®¹æ˜“çœ‹å‡ºæ±‚å’Œå‡½æ•°è¡¨è¾¾å¼ sum_{èµ·ç‚¹}^{ç»ˆç‚¹}è¡¨è¾¾å¼ï¼Œç§¯åˆ†å‡½æ•°è¡¨è¾¾å¼ int_ä¸‹é™^ä¸Šé™ è¢«ç§¯å‡½æ•°dè¢«ç§¯é‡ã€‚è¿˜æœ‰ä¸€ä¸ªæœ‰è¶£çš„æ˜¯è¡Œé—´çš„å…¬å¼éƒ½è¢«å‹ç¼©äº†ã€‚ 1.2.5 ç©ºæ ¼1234567ç´§è´´ $a\\\\!b$æ²¡æœ‰ç©ºæ ¼ $ab$å°ç©ºæ ¼ a\\,bä¸­ç­‰ç©ºæ ¼ a\\;bå¤§ç©ºæ ¼ a\\ bquadç©ºæ ¼ $a\\quad b$ä¸¤ä¸ªquadç©ºæ ¼ $a\\qquad b$ $$a\\!b$$$$ab$$$$a\\,b$$$$a\\;b$$$$a\\ b$$$$a\\quad b$$$$a\\qquad b$$ è¿™ä¸ªç›´æ¥çœ‹ä¸Šé¢çš„æ–‡å­—ï¼Œä»‹ç»å¾ˆæ¸…æ¥šï¼Œä¸»è¦æŒ‡å¾®è°ƒè·ç¦»ï¼Œä½¿å¾—å…¬å¼æ›´åŠ æ¼‚äº®ã€‚è¯·æ¯”è¾ƒä¸‹é¢çš„ç§¯åˆ†å…¬å¼ï¼š 123$$\\int_a^b f(x)\\mathrm&#123;d&#125;x$$$$\\int_a^b f(x)\\,\\mathrm&#123;d&#125;x$$ $$\\int_a^b f(x)\\mathrm{d}x$$ $$\\int_a^b f(x)\\,\\mathrm{d}x$$ 1.2.6 å…¬å¼ç•Œå®šç¬¦12345678\\\\( ( \\\\)\\\\( ) \\\\)\\\\( [ \\\\)\\\\( ] \\\\)\\\\( \\\\&#123; \\\\)\\\\( \\\\&#125; \\\\)\\\\( | \\\\)\\\\( \\\\| \\\\) ä¸»è¦ç¬¦å·æœ‰\\( ( \\)\\( ) \\)\\( [ \\)\\( ] \\)\\( \\{ \\)\\( \\} \\)\\( | \\)\\( \\| \\)é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿé€šè¿‡ \\left å’Œ \\right åé¢è·Ÿç•Œå®šç¬¦æ¥å¯¹åŒæ—¶è¿›è¡Œç•Œå®šã€‚ 1$$\\left(\\sum_&#123;k=\\frac&#123;1&#125;&#123;2&#125;&#125;^&#123;N^2&#125;\\frac&#123;1&#125;&#123;k&#125;\\right)$$ $$\\left(\\sum_{k=\\frac{1}{2}}^{N^2}\\frac{1}{k}\\right)$$ 1.2.7 çŸ©é˜µ12345678910111213$$\\begin&#123;matrix&#125;1 &amp; 2\\\\\\\\3 &amp;4\\end&#123;matrix&#125;$$$$\\begin&#123;pmatrix&#125;1 &amp; 2\\\\\\\\3 &amp;4\\end&#123;pmatrix&#125;$$$$\\begin&#123;bmatrix&#125;1 &amp; 2\\\\\\\\3 &amp;4\\end&#123;bmatrix&#125;$$$$\\begin&#123;Bmatrix&#125;1 &amp; 2\\\\\\\\3 &amp;4\\end&#123;Bmatrix&#125;$$$$\\begin&#123;vmatrix&#125;1 &amp; 2\\\\\\\\3 &amp;4\\end&#123;vmatrix&#125;$$$$\\left|\\begin&#123;matrix&#125;1 &amp; 2\\\\\\\\3 &amp;4\\end&#123;matrix&#125;\\right|$$$$\\begin&#123;Vmatrix&#125;1 &amp; 2\\\\\\\\3 &amp;4\\end&#123;Vmatrix&#125;$$ $$\\begin{matrix}1 &amp; 2\\\\3 &amp;4\\end{matrix}$$ $$\\begin{pmatrix}1 &amp; 2\\\\3 &amp;4\\end{pmatrix}$$ $$\\begin{bmatrix}1 &amp; 2\\\\3 &amp;4\\end{bmatrix}$$ $$\\begin{Bmatrix}1 &amp; 2\\\\3 &amp;4\\end{Bmatrix}$$ $$\\begin{vmatrix}1 &amp; 2\\\\3 &amp;4\\end{vmatrix}$$ $$\\left|\\begin{matrix}1 &amp; 2\\\\3 &amp;4\\end{matrix}\\right|$$ $$\\begin{Vmatrix}1 &amp; 2\\\\3 &amp;4\\end{Vmatrix}$$ ç±»ä¼¼äº left rightï¼Œè¿™é‡Œæ˜¯ begin å’Œ endã€‚è€Œä¸”é‡Œé¢æœ‰å…·ä½“çš„çŸ©é˜µè¯­æ³•ï¼Œ&amp; åŒºåˆ†è¡Œé—´å…ƒç´ ï¼Œ\\\\\\\\ ä»£è¡¨æ¢è¡Œã€‚å¯ä»¥ç†è§£ä¸º HTML çš„æ ‡ç­¾ä¹‹ç±»çš„ã€‚ 1.2.8 æ’ç‰ˆæ•°ç»„123456\\mathbf&#123;X&#125; =\\left( \\begin&#123;array&#125;&#123;ccc&#125;x\\_&#123;11&#125; &amp; x\\_&#123;12&#125; &amp; \\ldots \\\\\\\\x\\_&#123;21&#125; &amp; x\\_&#123;22&#125; &amp; \\ldots \\\\\\\\\\vdots &amp; \\vdots &amp; \\ddots\\end&#123;array&#125; \\right) $$\\mathbf{X} =\\left( \\begin{array}{ccc}x_{11} &amp; x_{12} &amp; \\ldots \\\\x_{21} &amp; x_{22} &amp; \\ldots \\\\\\vdots &amp; \\vdots &amp; \\ddots\\end{array} \\right)$$ 2. å¸¸ç”¨å…¬å¼ä¸¾ä¾‹ æŒç»­æ›´æ–°â€¦â€¦ 2.1 å¤šè¡Œå…¬å¼ ä¸»è¦æ˜¯å„ç§æ–¹ç¨‹çš„è¡¨è¾¾ 2.1.1 é•¿å…¬å¼12345678910111213$$\\begin&#123;multline&#125;x = a+b+c+&#123;&#125; \\\\\\\\d+e+f+g\\end&#123;multline&#125;$$$$\\begin&#123;aligned&#125;x =&#123;&#125;&amp; a+b+c+&#123;&#125; \\\\\\\\&amp;d+e+f+g\\end&#123;aligned&#125;$$ ä¸å¯¹é½ $$\\left| \\begin{multline}x = a+b+c+{} \\\\d+e+f+g\\end{multline} \\right|$$ å¯¹é½ $$\\left| \\begin{aligned}x ={}&amp; a+b+c+{} \\\\&amp;d+e+f+g\\end{aligned} \\right|$$ 2.1.2 å…¬å¼ç»„12345678910111213$$\\begin&#123;gather&#125;a = b+c+d \\\\\\\\x = y+z\\end&#123;gather&#125;$$$$\\begin&#123;align&#125;a &amp;= b+c+d \\\\\\\\x &amp;= y+z\\end&#123;align&#125;$$ $$\\begin{gather}a = b+c+d \\\\x = y+z\\end{gather}$$ $$\\begin{align}a &amp;= b+c+d \\\\x &amp;= y+z\\end{align}$$ 2.1.3 åˆ†æ®µå‡½æ•°123456$$y=\\begin&#123;cases&#125;-x,\\quad x\\leq 0 \\\\\\\\x,\\quad x&gt;0\\end&#123;cases&#125;$$ $$y=\\begin{cases}-x,\\quad x\\leq 0 \\\\x,\\quad x&gt;0\\end{cases}$$ é‡Œé¢ç”¨åˆ°äº† \\(\\leq\\) ç¬¦å·ï¼Œä¸‹ä¸€ç« ä¼šä»‹ç»å¸¸ç”¨æ•°å­¦ç¬¦å·ã€‚ 2.2 æ•°ç»„çš„å…¶ä»–ä½¿ç”¨2.2.1 åˆ’çº¿1234567$$\\left(\\begin&#123;array&#125;&#123;|c|c|&#125;1 &amp; 2 \\\\\\\\\\\\hline3 &amp; 4\\end&#123;array&#125;\\right)$$ $$\\left( \\begin{array}{|c|c|}1 &amp; \\ldots \\\\\\hline\\vdots &amp; \\ddots\\end{array} \\right)$$ 2.2.2 åˆ¶è¡¨123456789$$\\begin&#123;array&#125;&#123;|c|c|&#125;\\hline&#123;1111111111&#125; &amp; 2 \\\\\\\\\\hline3 &amp; 4 \\\\\\\\\\hline\\end&#123;array&#125;$$ $$\\begin{array}{|c|c|}\\hline{1111111111} &amp; 2 \\\\\\hline{balabala} &amp; ä½ å¥½å•Š {}^\\land\\_{}^\\land \\\\\\hline\\end{array}$$ å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®å…¶ä»–å¾ˆå¤šä¸œè¥¿éƒ½å¯ä»¥å¾ˆçµæ´»çš„è¡¨è¾¾å‡ºæ¥ã€‚ç¢°åˆ°å…¶ä»–æœ‰è¶£çš„æˆ‘ä¼šç»§ç»­å†™å‡ºæ¥çš„ã€‚ 3. å¸¸ç”¨æ•°å­¦ç¬¦å· è¿™é‡Œæä¾›ä¸€ä¸ªæ–‡æ¡£ä¸‹è½½ï¼Œå¦‚æœä¸Šé¢çš„é“¾æ¥å¤±æ•ˆï¼Œä¹Ÿå¯ä»¥åˆ°æˆ‘çš„ GitHub ä¸‹è½½ pdf ç‰ˆã€‚ä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­ã€‚ 3.1 å¸Œè…Šå­—æ¯123456789101112131415161718192021222324252627$$\\begin&#123;array&#125;&#123;|c|c|c|c|c|c|c|c|&#125;\\hline&#123;\\alpha&#125; &amp; &#123;\\backslash alpha&#125; &amp; &#123;\\theta&#125; &amp; &#123;\\backslash theta&#125; &amp; &#123;o&#125; &amp; &#123;o&#125; &amp; &#123;\\upsilon&#125; &amp; &#123;\\backslash upsilon&#125; \\\\\\\\\\hline&#123;\\beta&#125; &amp; &#123;\\backslash beta&#125; &amp; &#123;\\vartheta&#125; &amp; &#123;\\backslash vartheta&#125; &amp; &#123;\\pi&#125; &amp; &#123;\\backslash pi&#125; &amp; &#123;\\phi&#125; &amp; &#123;\\backslash phi&#125; \\\\\\\\\\hline&#123;\\gamma&#125; &amp; &#123;\\backslash gamma&#125; &amp; &#123;\\iota&#125; &amp; &#123;\\backslash iota&#125; &amp; &#123;\\varpi&#125; &amp; &#123;\\backslash varpi&#125; &amp; &#123;\\varphi&#125; &amp; &#123;\\backslash varphi&#125; \\\\\\\\\\hline&#123;\\delta&#125; &amp; &#123;\\backslash delta&#125; &amp; &#123;\\kappa&#125; &amp; &#123;\\backslash kappa&#125; &amp; &#123;\\rho&#125; &amp; &#123;\\backslash rho&#125; &amp; &#123;\\chi&#125; &amp; &#123;\\backslash chi&#125; \\\\\\\\\\hline&#123;\\epsilon&#125; &amp; &#123;\\backslash epsilon&#125; &amp; &#123;\\lambda&#125; &amp; &#123;\\backslash lambda&#125; &amp; &#123;\\varrho&#125; &amp; &#123;\\backslash varrho&#125; &amp; &#123;\\psi&#125; &amp; &#123;\\backslash psi&#125; \\\\\\\\\\hline&#123;\\varepsilon&#125; &amp; &#123;\\backslash varepsilon&#125; &amp; &#123;\\mu&#125; &amp; &#123;\\backslash mu&#125; &amp; &#123;\\sigma&#125; &amp; &#123;\\backslash sigma&#125; &amp; &#123;\\omega&#125; &amp; &#123;\\backslash omega&#125; \\\\\\\\\\hline&#123;\\zeta&#125; &amp; &#123;\\backslash zeta&#125; &amp; &#123;\\nu&#125; &amp; &#123;\\backslash nu&#125; &amp; &#123;\\varsigma&#125; &amp; &#123;\\backslash varsigma&#125; &amp; &#123;&#125; &amp; &#123;&#125; \\\\\\\\\\hline&#123;\\eta&#125; &amp; &#123;\\backslash eta&#125; &amp; &#123;\\xi&#125; &amp; &#123;\\backslash xi&#125; &amp; &#123;\\tau&#125; &amp; &#123;\\backslash tau&#125; &amp; &#123;&#125; &amp; &#123;&#125; \\\\\\\\\\hline&#123;\\Gamma&#125; &amp; &#123;\\backslash Gamma&#125; &amp; &#123;\\Lambda&#125; &amp; &#123;\\backslash Lambda&#125; &amp; &#123;\\Sigma&#125; &amp; &#123;\\backslash Sigma&#125; &amp; &#123;\\Psi&#125; &amp; &#123;\\backslash Psi&#125; \\\\\\\\\\hline&#123;\\Delta&#125; &amp; &#123;\\backslash Delta&#125; &amp; &#123;\\Xi&#125; &amp; &#123;\\backslash Xi&#125; &amp; &#123;\\Upsilon&#125; &amp; &#123;\\backslash Upsilon&#125; &amp; &#123;\\Omega&#125; &amp; &#123;\\backslash Omega&#125; \\\\\\\\\\hline&#123;\\Omega&#125; &amp; &#123;\\backslash Omega&#125; &amp; &#123;\\Pi&#125; &amp; &#123;\\backslash Pi&#125; &amp; &#123;\\Phi&#125; &amp; &#123;\\backslash Phi&#125; &amp; &#123;&#125; &amp; &#123;&#125; \\\\\\\\\\hline\\end&#123;array&#125;$$ $$\\begin{array}{|c|c|c|c|c|c|c|c|}\\hline{\\alpha} &amp; {\\backslash alpha} &amp; {\\theta} &amp; {\\backslash theta} &amp; {o} &amp; {o} &amp; {\\upsilon} &amp; {\\backslash upsilon} \\\\\\hline{\\beta} &amp; {\\backslash beta} &amp; {\\vartheta} &amp; {\\backslash vartheta} &amp; {\\pi} &amp; {\\backslash pi} &amp; {\\phi} &amp; {\\backslash phi} \\\\\\hline{\\gamma} &amp; {\\backslash gamma} &amp; {\\iota} &amp; {\\backslash iota} &amp; {\\varpi} &amp; {\\backslash varpi} &amp; {\\varphi} &amp; {\\backslash varphi} \\\\\\hline{\\delta} &amp; {\\backslash delta} &amp; {\\kappa} &amp; {\\backslash kappa} &amp; {\\rho} &amp; {\\backslash rho} &amp; {\\chi} &amp; {\\backslash chi} \\\\\\hline{\\epsilon} &amp; {\\backslash epsilon} &amp; {\\lambda} &amp; {\\backslash lambda} &amp; {\\varrho} &amp; {\\backslash varrho} &amp; {\\psi} &amp; {\\backslash psi} \\\\\\hline{\\varepsilon} &amp; {\\backslash varepsilon} &amp; {\\mu} &amp; {\\backslash mu} &amp; {\\sigma} &amp; {\\backslash sigma} &amp; {\\omega} &amp; {\\backslash omega} \\\\\\hline{\\zeta} &amp; {\\backslash zeta} &amp; {\\nu} &amp; {\\backslash nu} &amp; {\\varsigma} &amp; {\\backslash varsigma} &amp; {} &amp; {} \\\\\\hline{\\eta} &amp; {\\backslash eta} &amp; {\\xi} &amp; {\\backslash xi} &amp; {\\tau} &amp; {\\backslash tau} &amp; {} &amp; {} \\\\\\hline{\\Gamma} &amp; {\\backslash Gamma} &amp; {\\Lambda} &amp; {\\backslash Lambda} &amp; {\\Sigma} &amp; {\\backslash Sigma} &amp; {\\Psi} &amp; {\\backslash Psi} \\\\\\hline{\\Delta} &amp; {\\backslash Delta} &amp; {\\Xi} &amp; {\\backslash Xi} &amp; {\\Upsilon} &amp; {\\backslash Upsilon} &amp; {\\Omega} &amp; {\\backslash Omega} \\\\\\hline{\\Omega} &amp; {\\backslash Omega} &amp; {\\Pi} &amp; {\\backslash Pi} &amp; {\\Phi} &amp; {\\backslash Phi} &amp; {} &amp; {} \\\\\\hline\\end{array}$$ å†™å¤ªç´¯äº†ğŸ˜‚ğŸ˜‚ğŸ˜‚ã€‚ã€‚ã€‚å…¶ä»–çš„è¯¦è§ PDFã€‚ 4. æ€»ç»“ é€šè¿‡è¿™æ ·æ¢³ç†ä¸€ä¸‹åŸºæœ¬çš„å…¬å¼éƒ½èƒ½æ’å…¥äº†ï¼Œè€Œä¸”ä¹Ÿä¼šå¦‚ä½•æŸ¥èµ„æ–™ã€‚å¯¹äºè‡ªå·±æ—¥åå­¦ä¹  LaTeX å†™è®ºæ–‡æœ‰å¾ˆå¤§å¸®åŠ©ã€‚ä»¥ä¸‹å»ºè®®å¸¦æœ‰å¾ˆå¼ºçš„ä¸»è§‚æ€§ï¼Œä»…ä¾›å‚è€ƒã€‚ å…¬å¼ä¸€å¾‹ä½¿ç”¨å¦å–ä¸€è¡Œï¼Œå¹¶ä¸”ä¸Šä¸‹éƒ½ç©ºä¸€è¡Œ ä¸€ä¸ªå…¬å¼ä¸€ä¸ªè¯­å¥ï¼Œä¸è¦å†™åœ¨ä¸€ä¸ª $$***$$ é‡Œï¼Œä¿è¯ç‹¬ç«‹æ€§ï¼Œä¸€ä¸ªå…¬å¼é”™è¯¯ä¸å½±å“å¦ä¸€ä¸ªå…¬å¼ã€‚ é£æ ¼ç»Ÿä¸€ï¼Œä¸è¦æ··ç”¨ã€‚æ¯”å¦‚ä¸Šä¸‹æ ‡çš„å†™æ³•ï¼šx_{balabala}^{bala} è¡Œé—´å­—æ¯å¯ä»¥ä½¿ç”¨ \\\\(a\\\\) ä»£æ›¿ a ï¼Œå…»æˆè‡ªå·±çš„å†™ä½œé£æ ¼ã€‚ æœ€åï¼šæˆ‘çš„ Blog å’Œ GitHubï¼Œæ„Ÿè°¢é˜…è¯»ã€‚ 5. å‚è€ƒèµ„æ–™ ååˆ†æ„Ÿè°¢ä»¥ä¸‹ä½œè€…çš„æ— ç§åˆ†äº«ã€‚ Markdownä¸­æ’å…¥æ•°å­¦å…¬å¼çš„æ–¹æ³• LATEXæ•°å­¦å…¬å¼åŸºæœ¬è¯­æ³• ä¸€ä»½å…¶å®å¾ˆçŸ­çš„ LaTeX å…¥é—¨æ–‡æ¡£","tags":[{"name":"Math","slug":"Math","permalink":"http://fitzeng.org/tags/Math/"},{"name":"MarkDown","slug":"MarkDown","permalink":"http://fitzeng.org/tags/MarkDown/"},{"name":"Formula","slug":"Formula","permalink":"http://fitzeng.org/tags/Formula/"},{"name":"LaTeX","slug":"LaTeX","permalink":"http://fitzeng.org/tags/LaTeX/"}]},{"title":"GitNote","date":"2017-12-16T03:27:00.000Z","path":"2017/12/16/GitNote/","text":"0. å‰è¨€ åœ¨ä½¿ç”¨ Git æ—¶æœ‰ä¸€ç§æ„Ÿè§‰å°±æ˜¯åªä¼š add | commit | push ä¸‰ä¸ªå‘½ä»¤ã€‚å› ä¸ºè¿™ä¸‰ä¸ªå‘½ä»¤ä¼¼ä¹è¶³ä»¥æŠŠä»£ç æäº¤åˆ° GitHub ä¸Šï¼Œå³ä½¿æ˜¯ç¢°åˆ°æŸä¸ªé—®é¢˜ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ Googleã€‚ä½†æ˜¯å¯¹äºå…¶ä¸­çš„é€»è¾‘å’Œç‰ˆæœ¬ç®¡ç†çš„ç²¾é«“æ²¡æœ‰ä½“ä¼šåˆ°ï¼Œè€Œåªæ˜¯ä½œä¸ºä¸€ä¸ªåœ¨çº¿ä»£ç ä»“åº“åœ¨ä½¿ç”¨ï¼Œè¿™æ ·åšä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¸å¯ä»¥ï¼Œä½†æ˜¯å¦‚æœèƒ½ç³»ç»Ÿçš„äº†è§£ä¸ºä»€ä¹ˆè¦æœ‰ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œä»¥åŠç‰ˆæœ¬ç®¡ç†å·¥å…·èƒ½å¤Ÿç»™æˆ‘ä»¬æä¾›æ€ä¹ˆæ ·çš„ç®¡ç†æœåŠ¡ï¼Œå¯¹äºä½¿ç”¨å·¥å…·çš„æˆ‘ä»¬æ¥è¯´æœ‰å¾ˆå¤§å¸®åŠ©ã€‚ä¸ç”¨è®°ä½å‘½ä»¤ï¼Œåªæ˜¯ä»¥åé‡åˆ°é—®é¢˜æ—¶çŸ¥é“è¿™ä¸ªå·¥å…·æœ‰å®ç°çš„æ–¹å¼å°±è¶³å¤Ÿäº†ã€‚ ç°åœ¨æˆ‘ç³»ç»Ÿçš„çœ‹äº†ä¸€ä¸‹å®˜æ–¹çš„ Git å…¥é—¨æ•™ç¨‹ Git å®˜æ–¹æ•™ç¨‹ï¼ˆä¸­å­—ï¼‰ é‡Œé¢é€šè¿‡æè¿°å¯¹å‘½ä»¤çš„ä½¿ç”¨æƒ…æ™¯è¿›è€Œé€‰æ‹©å‘½ä»¤è¿›è¡Œæ“ä½œçš„æ–¹å¼ï¼Œä½¿å¾—å‘½ä»¤å¾ˆå®¹æ˜“ç†è§£ä¹Ÿå®¹æ˜“åŠ æ·±è®°å¿†ã€‚æ¯”èµ·å•ä¸€çš„å‘½ä»¤ç”¨æ–‡å­—è§£é‡Šè¿™ç§æ–¹å¼ï¼Œå¯¹äºä¸ç†Ÿæ‚‰ Git çš„äººæ¥è¯´æ˜¯ååˆ†å‹å¥½çš„ã€‚ä½†æ˜¯ï¼Œçœ‹å®Œå®¹æ˜“å¿˜ï¼Œæ‰€ä»¥å†™äº†è¿™ç¯‡æ•´ç†ç¬”è®°ç”¨ä½œè¾…åŠ©æŸ¥è¯¢ã€‚ 1. åŸºæœ¬å‘½ä»¤1.1 äº†è§£å¸®åŠ©å‘½ä»¤ git help : æŸ¥çœ‹å‘½ä»¤ git help add : æŸ¥çœ‹ git add å‘½ä»¤çš„å…·ä½“è§£é‡Š 1.2 ä»“åº“åˆå§‹åŒ– git init : åˆ›å»º .git, é€‚åˆåœ¨å·²å­˜åœ¨é¡¹ç›®è¿½åŠ ç‰ˆæœ¬æ§åˆ¶ git init projectname : åˆ›å»º projectname/.git, é€‚åˆé¡¹ç›®å¼€å§‹æ—¶åŠ å…¥ç‰ˆæœ¬æ§åˆ¶ 1.3 æ–‡ä»¶åŸºæœ¬æ“ä½œ git add filename/* : æ·»åŠ æ–‡ä»¶[äº§ç”Ÿæš‚å­˜æ–‡ä»¶] git commmit -m &quot;message&quot; : å°†æ·»åŠ çš„æ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“[äº§ç”Ÿæäº¤æ–‡ä»¶] git rm filename : ç§»é™¤æ–‡ä»¶ï¼Œä½¿ç”¨ rm filename çš„æœ‰æš‚å­˜ git add -u . : å¦‚æœä¹‹å‰ä½¿ç”¨é git å‘½ä»¤åˆ é™¤æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æŠŠå½“å‰ç›®å½•çš„æ–‡ä»¶é‡æ–°éå†æ¸…é™¤ git rm --cache filename : æš‚å­˜ä½†æ˜¯ä¸å‚ä¸è·Ÿè¸ª git mv filepath newfilepath : ç§»åŠ¨æ–‡ä»¶ git rm filepath &amp;&amp; git add newfilepath : ç§»åŠ¨æ–‡ä»¶ï¼Œä¹‹å‰ä½¿ç”¨é git å‘½ä»¤ç§»åŠ¨æ–‡ä»¶ git add -A . : å¦‚æœä¹‹å‰ä½¿ç”¨é git å‘½ä»¤ç§»åŠ¨æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æŠŠå½“å‰ç›®å½•çš„æ–‡ä»¶é‡æ–°éå†ç§»åŠ¨ï¼Œå’Œ rm å‘½ä»¤ç±»ä¼¼ git reset etc... : å†å²æäº¤ç®¡ç†(å›é€€ï¼Œåˆå¹¶â€¦)ï¼Œcheckout æ›´å…³æ³¨æ–‡ä»¶ 1.4 æŸ¥çœ‹æ–‡ä»¶ä¿®æ”¹ git status : æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯ git diff : æŸ¥çœ‹ä¿®æ”¹[å·¥ä½œæ ‘å’Œæš‚å­˜æ–‡ä»¶] git diff --staged : æŸ¥çœ‹ä¿®æ”¹[æš‚å­˜æ–‡ä»¶å’Œæœ€è¿‘æäº¤æ–‡ä»¶] git diff HEAD : æŸ¥çœ‹ä¿®æ”¹[å·¥ä½œæ ‘å’Œæœ€è¿‘æäº¤æ–‡ä»¶] git diff --word-diff : æŸ¥çœ‹ä¿®æ”¹çš„å•è¯ç”¨é¢œè‰²æ ‡å‡º git diff --stat : æŸ¥çœ‹ä¿®æ”¹çš„æ–‡ä»¶å å‚è€ƒèµ„æ–™ 0. Git å­¦ä¹ ï¼ˆä¸‰ï¼‰æœ¬åœ°ä»“åº“æ“ä½œâ€”â€”git add &amp; commit äº†è§£ git ç‰ˆæœ¬åº“å®ç° 1.5 æŸ¥çœ‹æäº¤ Log git log : æ˜¾ç¤ºæäº¤ä¿¡æ¯ git log --oneline : æ˜¾ç¤ºæäº¤ Message git log --stat : æ˜¾ç¤ºæäº¤æ–‡ä»¶åçº§è¯¦ç»†ä¿®æ”¹ä¿¡æ¯ git log --patch : æ˜¾ç¤ºæäº¤æ–‡ä»¶å†…å®¹çº§è¯¦ç»†ä¿®æ”¹ä¿¡æ¯ git log --graph : ç”¨å›¾æ˜¾ç¤ºæäº¤è®°å½• git log --graph --all --decorate --oneline : å»é™¤å†—ä½™ä¿¡æ¯ï¼Œæ›´åŠ ç›´è§‚æ˜¾ç¤ºæ¯æ¡åˆ†æ”¯æ¯æ¬¡æäº¤ git log --stat -- filename : æ–‡ä»¶æäº¤è®°å½•ï¼ˆä¸è®°å½•è·¯å¾„ç§»åŠ¨ï¼‰ git log --stat -M --follow -- filename : çœ‹åˆ°å®Œæ•´çš„æ–‡ä»¶æ“ä½œè¿‡ç¨‹ 1.6 å¿½ç•¥æ–‡ä»¶ touch .gitignore : åˆ›å»ºæ–‡ä»¶(æ¬¡çº§ç›®å½•ä¹Ÿå¯ä»¥åˆ›å»º) vim .gitignore : ç¼–è¾‘æ–‡ä»¶æ·»åŠ  ignore æ–‡ä»¶ã€‚*.log | tmp/ | .sass-cache etc... git ls-files --others --ignored --exclude-standard : æŸ¥çœ‹è¢« ignore çš„æ–‡ä»¶ git reflog : è¯¦ç»†ä¿®æ”¹æ—¥å¿— 1.7 åˆ†æ”¯æ“ä½œ git branch branchname : åˆ›å»ºåˆ†æ”¯ git branch : æ˜¾ç¤ºåˆ†æ”¯ git branch -d branchname : åˆ é™¤åˆ†æ”¯ git branch -D branchname : åˆ é™¤æœªåˆå¹¶åˆ†æ”¯ git checkout branchname : åˆ‡æ¢åˆ†æ”¯ git checkout commitID : å·¥ä½œæ ‘åˆ‡æ¢åˆ° commitID æ—¶ git checkout -- filename : æ¸…ç†æ‰æœ€åä¸€æ¬¡æäº¤å†…å®¹ git checkout -b branchname : åˆ›å»ºæ–°åˆ†æ”¯å¹¶ä¸”è¿›å…¥è¯¥åˆ†æ”¯ git merge branchname : å’Œå¹¶ branchname åˆ†æ”¯åˆ°ç›®å‰æ‰€åœ¨åˆ†æ”¯(åˆå¹¶æ—¶æ–‡ä»¶å†²çªè¦æ‰‹åŠ¨è§£å†³) git merge --abort : æ¸…é™¤å·¥ä½œç›®å½•å’Œæš‚å­˜åŒº git merge squash branchname : å°†åˆå¹¶çš„åˆ†æ”¯æ”¹å˜å˜æˆä¸€ä¸ª commit git rebase branchname : å°†å½“å‰åˆ†æ”¯å†å²æäº¤åˆå¹¶åˆ° branchname åˆ†æ”¯ å‚è€ƒèµ„æ–™ 2. ä»£ç åˆå¹¶ï¼šMergeã€Rebase çš„é€‰æ‹© 1.8 è¿œç¨‹æ“ä½œ git remote add origin https://github.com/accountname/projectname git remote set-url origin newUrl : æ”¹å˜ URL git remote rm origin : åˆ é™¤ git remote -v : æŸ¥çœ‹ URL git fetch origin : æŠ“å–è¿œç¨‹åˆ†æ”¯ï¼Œæœ¬åœ°ä¼šæœ‰ä¸€ä¸ª remotehostname/branchname çš„åˆ†æ”¯ï¼Œä¸€èˆ¬ç”¨äºæŸ¥çœ‹ä¼™ä¼´ä»£ç  git pull origin : å’Œ fetch ç±»ä¼¼ï¼Œä½†æ˜¯æ˜¯å–å›è¿œç¨‹æ›´æ–°å’Œæœ¬åœ°åˆå¹¶ã€‚ç›¸å½“äºå…ˆ fetch å† mergeã€‚ git push origin : push åˆ°è¿œç¨‹ä»“åº“ å‚è€ƒèµ„æ–™ 1. Gitè¿œç¨‹æ“ä½œè¯¦è§£ 2. æ€»ç»“ å…¶å®åœ¨å¼€å§‹æŠŠ Git æ•´ä¸ªå‘½ä»¤æµç¨‹å­¦ä¹ ä¸‹æ¥ä¹‹å‰ï¼Œå¯¹ Git ç†è§£ååˆ†æµ…æ˜¾ï¼Œä½¿ç”¨å‘½ä»¤ä¹Ÿæ˜¯æŠ±ç€è¯•è¯•çœ‹çš„å¿ƒæ€ï¼Œé”™äº†æœç´¢è§£å†³æ–¹æ³•é‡è¯•ï¼Œå¯¹äº†å°±ä¸è¿½ç©¶åŸå› äº†ã€‚è¿™ç§æ–¹å¼æ„Ÿè§‰æ›´åŠ æµªè´¹æ—¶é—´ï¼Œè€Œä¸”å¾ˆå¯èƒ½å¤šæ¬¡é‡åˆ°é‡å¤é—®é¢˜ã€‚è§‰å¾—ä»¥åå­¦ä¹ æŸä¸ªä¸œè¥¿è¿˜æ˜¯å¾—å¤§æ¦‚äº†è§£æ•´ä¸ªç³»ç»Ÿæ‰å¥½ï¼Œæƒ³å¿«é€Ÿå…¥é—¨æœªå°ä¸å¯ï¼Œä½†æ˜¯é—²ä¸‹æ¥çš„æ—¶å€™è¦å»å¤šé—®é—®ä¸ºä»€ä¹ˆï¼Œè¿™æ ·æœ‰äº†å®è§‚çš„æ¦‚å¿µï¼Œå‡ºäº†é—®é¢˜è¯´ä¸å®šèƒ½è‡ªå·±æ‘¸ç´¢ç€è§£å†³ã€‚è¿˜æœ‰ä¸€ç‚¹ï¼Œå®è·µç¡®å®æ˜¯æ¯”å•ä¸€çš„é˜…è¯»æˆ–çœ‹è§†é¢‘æ›´åŠ è®°å¿†æ·±åˆ»ï¼Œå¯¹å‘½ä»¤çš„ç†è§£ä¹Ÿæ˜¯åŒç†ï¼Œæ‰€ä»¥æœ€å¥½éƒ½æ•²ä¸€éã€‚ GitHub Blog æ˜é‡‘ å¤šè°¢é˜…è¯» ^_^ 3. å‚è€ƒèµ„æ–™ -1. GitHub&amp;Gitå…¥é—¨åŸºç¡€ 0. Git å­¦ä¹ ï¼ˆä¸‰ï¼‰æœ¬åœ°ä»“åº“æ“ä½œâ€”â€”git add &amp; commit 1. Gitè¿œç¨‹æ“ä½œè¯¦è§£ 2. ä»£ç åˆå¹¶ï¼šMergeã€Rebase çš„é€‰æ‹© 3. GitHub é«˜è´¨é‡çš„Gitä¸­æ–‡æ•™ç¨‹","tags":[{"name":"Git","slug":"Git","permalink":"http://fitzeng.org/tags/Git/"},{"name":"GitHub","slug":"GitHub","permalink":"http://fitzeng.org/tags/GitHub/"},{"name":"Tool","slug":"Tool","permalink":"http://fitzeng.org/tags/Tool/"}]},{"title":"ä¸€ä¸ªå°ç™½ä½¿ç”¨ devstack éƒ¨ç½² openstack çš„å¿ƒè·¯å†ç¨‹","date":"2017-11-04T03:27:00.000Z","path":"2017/11/04/deployOpenstackByDevstack/","text":"0.å‰è¨€ ä½œä¸ºä¸€ä¸ªæƒ³è¦å…¥é—¨äº‘è®¡ç®—çš„äººæ¥è¯´ï¼Œå¤§å¤šæ•°äººçš„ç¬¬ä¸€æ­¥å°±æ˜¯å­¦ä¹  openstackï¼Œè€Œå­¦ä¹  openstack çš„äººé¢ä¸´çš„ç¬¬ä¸€æ­¥å°±æ˜¯ç¬¬ä¸€ä¸ªâ€˜éš¾é¢˜â€™ï¼Œä½¿ç”¨è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…· devstack éƒ¨ç½² openstack ç¯å¢ƒã€‚ç¬¬ä¸€æ¬¡æ¥è§¦è¿™ä¸ªä¸œè¥¿ï¼ŒèŠ±äº†ä¸¤å¤©å¤šæ—¶é—´åœ¨ Ubuntu Server å’Œ Ubuntu Desktop çš„ 16.04 ç‰ˆæœ¬ä¸ŠæˆåŠŸéƒ¨ç½²ã€‚æœ‰å¾ˆå¤šäººè¯´ Desktop ç‰ˆæœ‰å¾ˆå¤šå‘ï¼Œäº²æµ‹é—®é¢˜ç¡®å®æ¯” Server ç‰ˆå¤šï¼Œä½†éƒ½æ˜¯å¯è§£å†³çš„ã€‚å…¶ä¸­æœ€å¯¹åˆå­¦è€…ä¸å‹å¥½çš„å°±æ˜¯ç½‘ç»œé—®é¢˜ï¼Œä¸‹é¢ä¼šä»‹ç»ä¸ºä»€ä¹ˆã€‚æ‰€ä»¥å¦‚æœä½ è‡ªå·±ä¹°äº†å›½å¤–çš„ VPS é‚£å°±å¥½åŠäº†ï¼Œå› ä¸ºæœ‰ä¸ªéªšæ“ä½œè¦ç”¨åˆ°ï¼Œå¦‚æœä½ ç½‘é€Ÿå¥½å¯èƒ½ä½ é‡ä¸åˆ°è¿™äº›é—®é¢˜å°±å¯ä»¥å¿½ç•¥ã€‚ ä¸‹é¢ä¼šåˆ†ä¸¤ä¸ªéƒ¨åˆ†ä»‹ç»ï¼Œéƒ½ä¼šå°† Server å’Œ Desktop ä¸Šçš„éƒ¨ç½²è¿‡ç¨‹æè¿°ä¸€éã€‚æ•™ç¨‹æ¨è å®˜æ–¹çš„ Docå’Œé¿å‘æŒ‡å—æ•™ç¨‹è¿™ä¸ªä¸œè¥¿å¯¹äºåˆå­¦è€…ä¸å®œå¤ªå¤šï¼Œå®¹æ˜“ä¹±ï¼Œåªè¦æœ‰ä¸€ä¸ªæ­£ç¡®çš„æ‰§è¡Œæ¡†æ¶å°±å¥½ã€‚ç¢°åˆ°å…¶ä»– bug ç›´æ¥ Google å°±å¥½ã€‚ ç„¶åä»‹ç»ä¸‹æˆ‘çš„ç¯å¢ƒå§ Mac 10.12.6 VirtualBox 5.1.28 Ubuntu Server 16.04 4G+20G (ä¸´æ—¶æµ‹è¯• devstackï¼Œå¬è¯´å‘å°‘) Ubuntu Desktop 16.04 4G+80G (å¹³æ—¶ä½¿ç”¨) VPS(æœ€å¥½æœ‰) (ç”±äºæ˜¯ä¹ä¸ç‰ˆï¼Œä¸é€‚åˆç›´æ¥éƒ¨ç½²å’Œå¹³æ—¶å­¦ä¹ ) 1.Ubuntu Server ç‰ˆå®‰è£… Ubuntu Serveré¦–å…ˆè‚¯å®šæ˜¯è¦åœ¨ Virtual Box å®‰è£… Ubuntu Server äº†ï¼Œè¿™ä¸€æ­¥ç•¥è¿‡ã€‚ç›¸ä¿¡ä½ å·²ç»æ˜¯æ¥è§¦è¿‡ä¸€æ®µæ—¶é—´è™šæ‹Ÿæœºçš„äººäº†ï¼Œä½†æ˜¯ä¸€ç‚¹æ³¨æ„ï¼Œç«Ÿå¯èƒ½åˆ†å¤šä¸€ç‚¹å†…å­˜å’Œç¡¬ç›˜ã€‚ç”±äºæˆ‘ä¸æ‰“ç®—æ—¥åå†è¿™ Server ç‰ˆä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘çš„é…ç½®æ˜¯ 4G + 20G SSH ç™»å½•è™šæ‹Ÿæœºå½“ä½ åˆ›å»ºå®Œæˆä¹‹åé¢ä¸´çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯é‚£ä¸ªç•Œé¢å¤ªä¸‘äº†ã€‚ã€‚ã€‚æ‰€ä»¥å¦‚æœå¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ“ä½œå°±å¥½äº†ï¼ŒSSH æ­£å¥½æ»¡è¶³ä½ ã€‚è‡³äº SSH ä¸é€šä½¿ç”¨ä¸äº†çš„è‡ªå·±æŸ¥æŸ¥èµ„æ–™å§ï¼Œè¿™é‡Œæˆ‘ä¸»è¦ä»‹ç»ç½‘å¡é…ç½®ï¼Œæˆ‘ä½¿ç”¨äº†ä¸¤ä¸ªç½‘å¡ï¼šç¬¬ä¸€ä¸ªï¼šåšç«¯å£æ˜ å°„ï¼Œå°†ä¸»æœºçš„ 2222 æ˜ å°„åˆ°è™šæ‹Ÿæœºçš„ 22ï¼Œè¿™æ¡æ˜¯ä¸ºäº†ä»¥åä½¿ç”¨ SSHã€‚ç¬¬äºŒä¸ªï¼šé…å®Œä¹‹åå†åœ¨å…¨å±€é…ç½®ä¸­è®¾ç½®ä½ æ‰€é€‰ä¸­çš„ç½‘å¡å¯ç”¨ DHCPã€‚å¯¹äºç½‘å¡å„ç§è¿æ¥æ¨¡å¼ä¸ç†Ÿçš„å¯ä»¥æŸ¥æŸ¥èµ„æ–™äº†è§£ä¸€ä¸‹ã€‚ ç„¶åè¿æ¥å°±æ˜¯ç›´æ¥åœ¨ä¸»æœºä¸‹ä½¿ç”¨ 1ssh -p 2222 fitzeng@127.0.0.1 fitzeng æ”¹æˆä½ çš„ç”¨æˆ·åã€‚å¦‚æœä½ å‡ºç°å„ç§é—®é¢˜è¿ä¸ä¸Šå¯ä»¥æ³¨æ„ä¸€ä¸‹ä¸¤ç‚¹ï¼š1.é˜²ç«å¢™2.æŠŠ ~/.ssh æ–‡ä»¶å¤¹ä¸‹çš„ known_hosts æ–‡ä»¶åˆ äº†å†é‡è¿ å¼€å§‹éƒ¨ç½² è¿™é‡Œçš„ä¸»æ•™ç¨‹ä»¥å®˜æ–¹æä¾›çš„ä¸ºå‡†ï¼Œå¹¶ä¸”é‚£äº›æ³¨æ„ç‚¹æˆ‘ä¼šæ›´æ–°ã€‚ éƒ¨ç½²çš„è„šæœ¬è¦æ±‚æ˜¯æ‹¥æœ‰ root æƒé™çš„é root ç”¨æˆ·ã€‚ 12345678sudo useradd -s /bin/bash -d /opt/stack -m stackecho &quot;stack ALL=(ALL) NOPASSWD: ALL&quot; | sudo tee /etc/sudoers.d/stacksudo su - stackcd /opt/stackgit clone https://git.openstack.org/openstack-dev/devstackcd devstack å¦‚æœä¸Šé¢ clone å¤ªæ…¢æˆ–è€… clone ä¸ä¸‹æ¥çš„è¯å¯ä»¥è¯•è¯• github çš„æºã€‚ 1git clone https://github.com/openstack-dev/devstack.git ç„¶åå°±æ˜¯æ·»åŠ é…ç½®äº†ï¼Œå¦‚æœä¸æ‡‚æ¨èç›´æ¥ä½¿ç”¨å®˜æ–¹é¡µé¢ä»‹ç»çš„ã€‚æˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ 12cp samples/local.conf ./vim local.conf å¦‚æœä½ å¹¸è¿ï¼Œè®²é“ç†æœ€åæ‰§è¡Œ ./stack.sh ç›´æ¥ä¸€è·¯åˆ°åº•ã€‚ã€‚ã€‚ä½†æ˜¯è¿˜æœ‰å¾ˆå¤šå‘æ­£åœ¨ç­‰å¾…ç€æˆ‘ä»¬ã€‚ä½†ä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ˜¯ä»–çš„ Log å’ŒæŠ¥é”™ååˆ†æ¸…æ–°ï¼Œå¾ˆå¿«å¯ä»¥å®šä½é—®é¢˜æ‰€åœ¨ï¼Œæœ‰æ—¶å€™ç›´æ¥æœ Log éƒ½ä¼šå‡ºç°è§£å†³æ–¹æ³•ã€‚å¦‚æœè„šæœ¬ç›´æ¥é€€å‡ºæç¤ºæ²¡æœ‰ HOST_IPã€‚é‚£ä¹ˆç›´æ¥åœ¨ local.conf åé¢æ·»åŠ  12HOST_IP=x.x.x.xGIT_BASE=https://github.com HOST_IPå…·ä½“æ˜¯ä»€ä¹ˆåœ¨ä½ çš„è™šæ‹Ÿæœºä¸Š ifconfig æŸ¥çœ‹ã€‚ç„¶åæ¨èæŠŠ git æºæ¢æˆ github çš„ã€‚è¿™é‡Œä½ å¯ä»¥æ£€æµ‹ä¸€ä¸‹ä½ çš„æºæœ‰æ²¡æœ‰é—®é¢˜ apt-get update æœ‰çš„è¯ç›´æ¥æŠŠæœ‰é—®é¢˜çš„æºåœ¨ /etc/apt/sources.list.d/ ç›®å½•ä¸‹ç§»é™¤ï¼Œç§»é™¤å‰å»ºè®®å¤‡ä»½ä¸€ä¸‹ã€‚ç„¶åæ¨è apt-get upgrade ä¸€ä¸‹ï¼ŒPython ç‰ˆæœ¬ä¿æŒé»˜è®¤çš„ 2.7.X å°±å¥½ï¼Œå¦‚æœå‡ºç°ä»€ä¹ˆå’Œ Python 3.4 ä¸åŒ¹é…çš„ Log ç›´æ¥å¿½ç•¥ã€‚å¦‚æœä½ æ¢æˆ 3.4 å¾ˆå¤šåº“ä¼šå‡ºé—®é¢˜ã€‚å¦‚æœä½ æ˜¯ Python 3.Xï¼Œå¯ä»¥æŠŠ /user/bin/ ä¸‹çš„ Python2.X é“¾æ¥åˆ°è¯¥ç›®å½•ä¸‹çš„ Python æ–‡ä»¶ã€‚è¿™æ—¶æ‰§è¡Œ python -V å°±èƒ½çœ‹åˆ°ç»“æœäº†ã€‚ ä½†ä½†ä½†æ˜¯ï¼Œä¸Šé¢åªæ˜¯è§£å†³äº†æœ‰å½¢çš„ Bugï¼Œè¿˜æœ‰å°±æ˜¯æ— å½¢çš„ Bugï¼Œä½ å°†é¢ä¸´ç½‘ç»œé—®é¢˜ï¼Œå¦‚æœä½ æƒ³é¡ºç•…ç‚¹å¯ä»¥ç›´æ¥æ›´æ¢æºã€‚ä¿®æ”¹ pip æº 1234567mkdir ~/.pipvim ~/.pip/pip.confå¡«å…¥ï¼š[global]trusted-host=mirrors.aliyun.comindex-url=http://mirrors.aliyun.com/pypi/simple ä¿®æ”¹ sources.listï¼š 12345678910111213141516171819202122sudo cp /etc/apt/sources.list /etc/apt/sources.list.baksudo vim /etc/apt/sources.listå¡«å…¥ï¼š# deb cdrom:[Ubuntu 16.04 LTS _Xenial Xerus_ - Release amd64 (20160420.1)]/ xenial main restricteddeb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-propertiesdeb http://mirrors.aliyun.com/ubuntu/ xenial main restricteddeb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-propertiesdeb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricteddeb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-propertiesdeb http://mirrors.aliyun.com/ubuntu/ xenial universedeb http://mirrors.aliyun.com/ubuntu/ xenial-updates universedeb http://mirrors.aliyun.com/ubuntu/ xenial multiversedeb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiversedeb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse #Added by software-propertiesdeb http://archive.canonical.com/ubuntu xenial partnerdeb-src http://archive.canonical.com/ubuntu xenial partnerdeb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricteddeb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe #Added by software-propertiesdeb http://mirrors.aliyun.com/ubuntu/ xenial-security universedeb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse éƒ½æ”¹æˆ aliyun çš„ã€‚åˆ°è¿™æ—¶å€™å¦‚æœä½ çš„ç½‘ç»œæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå¯èƒ½ä¼šå‡ºç‚¹ç¯å¢ƒå°é—®é¢˜ï¼Œdkpg å’Œå„ç§åŒ…ç­‰ä¹‹ç±»çš„é—®é¢˜ï¼Œä¸€æœç½‘ä¸ŠåŸºæœ¬éƒ½æœ‰è§£å†³æ–¹æ¡ˆã€‚ ä½†ä½†ä½†æ˜¯ï¼Œå¦‚æœä½ çš„ç½‘é€Ÿä¸‹è½½æŸäº›åŒ…ä¸è¶… 10Kb/s é‚£å°±è¦ç”¨éªšæ“ä½œäº†ã€‚ã€‚ã€‚å› ä¸ºä¼šä¸€ç›´å¡ç€ï¼Œç½‘ä¸€æ–­åˆå¾—é‡æ–°å¼€å§‹ï¼Œå…ˆ unstackï¼Œclean å† stackï¼Œååˆ†ä¸å‹å¥½ã€‚å‡ºç°é—®é¢˜å¤§å¤šæ˜¯åœ¨ä¸‹è½½æŸä¸ª git ä»“åº“å’ŒæŸäº›åŒ…çš„æ—¶å€™ã€‚å°¤å…¶æ˜¯ nova horizon ä¹‹ç±»çš„ï¼Œå¤§å°åˆ°äº† 300+Mã€‚ è¿™é‡Œä»‹ç»ä¸€ä¸ªæ–¹æ³•ï¼šæ€è·¯æ˜¯å…ˆ SSH ä¸Šä½ çš„å›½å¤– VPSï¼Œä¸‹è½½ä½ çš„ git ä»“åº“æˆ–å…¶ä»–æ–‡ä»¶ã€‚ç„¶åå† SCP åˆ°ä½ çš„è™šæ‹Ÿæœºä¸Šã€‚ä¸»è¦æ˜¯è¿™æ ·ä¸ä¼šä¸­æ–­ï¼Œè€Œä¸”æ— å½¢ä¸­å°±å¯ä»¥æ˜¯å¤šçº¿ç¨‹æ“ä½œï¼Œå¼€å‡ ä¸ªç»ˆç«¯ SCP å¥½å‡ ä¸ªæ–‡ä»¶ã€‚çœ‹çœ‹é€Ÿåº¦å¯¹æ¯”æ•ˆæœå§ï¼Œè™šæ‹Ÿæœºä¸Šä¸‹è½½ï¼šVPS ä¸Šä¸‹è½½ï¼šä¹‹åè‡ªå·± SCP å°±å¥½äº† 1sudo scp -P 10800 -r root@xx.xx.xx.xx:/fitzeng/horizon /etc/stack/ -r æ˜¯ cp æ–‡ä»¶å¤¹ï¼Œç„¶åç«¯å£ï¼ŒIP å¡«ä½ è‡ªå·±çš„åé¢è·Ÿç›®å½•ã€‚è¿™é‡Œå¯èƒ½ä¹Ÿæœ‰ç‚¹æ…¢ï¼Œä½†æ˜¯æ¯”ä¹‹å‰çš„å¥½è€Œä¸”ç¨³å®šã€‚ è¿™ä¸€åˆ‡æ“ä½œéƒ½æºäºå‹å¥½çš„ log æœºåˆ¶ï¼Œçœ‹ä¸Šé¢çš„å›¾ç‰‡æˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸‹è½½åœ°å€å’Œå­˜æ”¾ç›®å½•ï¼Œæ‰€ä»¥ï¼ŒçŸ¥é“è¿™äº›æ‰‹æ®µå°±å¤šäº†èµ·æ¥ã€‚ç½‘é€Ÿå¤Ÿå¿«ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æœ¬åœ° cloneã€‚ æœ‰äº†è¿™äº›æ“ä½œåŸºæœ¬å°±æ„å‘³ç€ä½ è§£å†³äº†ç½‘ç»œé—®é¢˜ï¼Œå€ŸåŠ© google åŸºæœ¬å¯ä»¥è§£å†³å…¶ä»–åº“å’Œç¯å¢ƒçš„é—®é¢˜ã€‚æˆåŠŸå›¾ä¸Šä¼ ä¸€æ³¢ï¼š 2.Ubuntu Desktop ç‰ˆåŸºæœ¬æ­¥éª¤æ˜¯å’Œå‰é¢ä¸€è‡´çš„ï¼Œå‡ºçš„é—®é¢˜å¯èƒ½å°±æ˜¯ä½ ä¹‹å‰åœ¨ Ubuntu ä¸Šè£…è¿‡å„ç§è½¯ä»¶(æˆ‘è£…çš„ Sogou è¾“å…¥æ³•ï¼Œé‡Œé¢çš„ fcitx æºå½±å“äº†é€Ÿåº¦ï¼Œç”šè‡³æœ‰æ—¶å€™ç›´æ¥å¡è¿™ä¸åŠ¨)ï¼Œæ›´æ”¹äº†è½¯ä»¶æºæˆ–è€…åšè¿‡å…¶å®ƒçš„å·¥å…·æ›´æ”¹ï¼ŒæŒ‰ç…§å‰é¢çš„é…ç½®äº²æµ‹å¯è¡Œã€‚å¦‚æœä½ ä¹‹å‰åœ¨ Ubuntu Server ç‰ˆä¸Šè£…è¿‡ï¼Œç›´æ¥æŠŠæ–‡ä»¶ SCP è¿‡æ¥ï¼Œå¦‚æœè™šæ‹Ÿæœºä¹‹é—´ä¸èƒ½é€šè®¯ï¼Œå¯ä»¥å…ˆ SCP åˆ°å®¿ä¸»æœºï¼Œå†ä»å®¿ä¸»æœºé€šè¿‡æ–‡ä»¶å…±äº«çš„æ–¹å¼å…±äº«åˆ° Ubuntu Desktopã€‚ç„¶åè¿è¡Œå°±å¯ä»¥äº†ï¼Œæœ‰äº†å‰é¢çš„åŸºç¡€å°±å¾ˆç®€å•äº†ã€‚ é‚£å°±çœ‹ç›´æ¥çœ‹ç»“æœå§ï¼š 3.åè®°è¯´å®è¯ï¼Œè¿™ä¸å¤ªç®—æŠ€æœ¯æ–‡ç« ï¼Œçº¯å±ä¸ªäººè®°å½•ã€‚æœ¬æ¥ä¸å¤ªæƒ³å†™ï¼Œä½†æ˜¯æ„Ÿè§‰å›½å†…ç¯å¢ƒå¯¹å¼€å‘è€…æœ‰ç‚¹ä¸å‹å¥½ï¼Œå¦‚æœè¿™ç¯‡æ–‡ç« èƒ½å¯¹åˆå­¦è€…æœ‰éƒ¨åˆ†å¸®åŠ©æˆ‘å°±æ»¡æ„äº†ï¼Œèƒ½å¤Ÿä½¿åˆå­¦è€…ç»§ç»­å­¦ä¹ ä¸‹å»ã€‚ç„¶åè¿™æ˜¯éƒ¨ç½²å®Œä¹‹åå†™çš„ï¼Œéƒ¨ç½²çš„è¿‡ç¨‹è¿œä¸å¦‚å†™çš„è¿™ä¹ˆè½»æ¾ï¼Œä½†æ˜¯æˆ‘ç°åœ¨æœ‰ä¿¡å¿ƒå»è§£å†³éƒ¨ç½²è¿‡ç¨‹ä¸­ç¢°åˆ°çš„é—®é¢˜ï¼Œè¿™æ‰æ˜¯é‡ç‚¹ã€‚å¸Œæœ›ä½ ä¹Ÿæ˜¯ã€‚æ¯ä¸ªäººçš„ç¯å¢ƒéƒ½ä¸ä¸€æ ·ï¼Œå‡ºç°çš„é—®é¢˜ä¹Ÿä¸å¯èƒ½ä¸€æ ·ï¼Œæ‰€ä»¥å¦‚æœä½ ç…§ä¸Šé¢åšäº†è¿˜æ²¡æœ‰è§£å†³å¯ä»¥ç•™è¨€å¤§å®¶ä¸€èµ·è®¨è®ºã€‚ æœ€åï¼šå¤šè°¢é˜…è¯»ç¥å¤§å®¶ä¸€éè¿‡ ^_^","tags":[{"name":"devstack","slug":"devstack","permalink":"http://fitzeng.org/tags/devstack/"},{"name":"openstack","slug":"openstack","permalink":"http://fitzeng.org/tags/openstack/"}]},{"title":"å®Œç¾è§£å†³ Linux çš„ã€dpkgï¼š warningï¼š files list file for package 'XXXXXXX' missing, assuming package has no files currently installedã€‘Bug","date":"2017-11-04T03:27:00.000Z","path":"2017/11/04/linuxDpkgBug/","text":"0.å‰è¨€ ä¼°è®¡æ˜¯ä¹‹å‰åŠ¨äº†æˆ–è€…æŸåäº† /var/lib/dpkg/info é‡Œé¢çš„æ–‡ä»¶ï¼Œæ¯æ¬¡æ‰§è¡Œ apt ç±»çš„å‘½ä»¤æ€»æ˜¯è¾“å‡ºä¸€å¤§æ®µä¸œè¥¿ï¼Œåœ¨ç½‘ä¸Šæ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œæœ‰è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ä¸å…¨ã€‚ã€‚ã€‚å¾ˆå¤šéƒ½æ˜¯å¤±è´¥çš„ã€‚æœ€åæˆ‘å‘ç° reinstall å¯ä»¥è§£å†³ï¼Œæ‰€ä»¥æ‰“ç®—å†™ä¸ªè„šæœ¬æ‰§è¡Œæ–‡ä»¶ã€‚ 1.è§£å†³æ–¹æ³•1.1 åˆ›å»ºä¸€ä¸‹ä¸‰ä¸ªæ–‡ä»¶ fixit.py fix.sh txt 1.2 å¡«å†™å†…å®¹å…ˆæ¥æœ€ç®€å•çš„ fix.shï¼Œä¸ç”¨å¡«å†™å†…å®¹ï¼Œæ˜¯ç©ºæ–‡ä»¶ã€‚ æ¥ç€å°±å†™ txtï¼Œç›´æ¥æŠŠé”™è¯¯æ—¥å¿—å¤åˆ¶è¿›å»ï¼Œå¦‚ï¼š 1234567891011dpkg: warning: files list file for package &apos;libodbc1:amd64&apos; missing; assuming package has no files currently installeddpkg: warning: files list file for package &apos;dh-autoreconf&apos; missing; assuming package has no files currently installeddpkg: warning: files list file for package &apos;erlang-webtool&apos; missing; assuming package has no files currently installeddpkg: warning: files list file for package &apos;libhtml-template-perl&apos; missing; assuming package has no files currently installed.......dpkg: warning: files list file for package &apos;libvirt-dev:amd64&apos; missing; assuming package has no files currently installeddpkg: warning: files list file for package &apos;autopoint&apos; missing; assuming package has no files currently installeddpkg: warning: files list file for package &apos;libconfig-general-perl&apos; missing; assuming package has no files currently installeddpkg: warning: files list file for package &apos;ubuntu-cloud-keyring&apos; missing; assuming package has no files currently installeddpkg: warning: files list file for package &apos;tgt&apos; missing; assuming package has no files currently installeddpkg: warning: files list file for package &apos;libfdt1:amd64&apos; missing; assuming package has no files currently installed ä¸‹é¢å†™ fixit.py 1234567891011121314151617#!/usr/bin/env python# -*- coding: utf-8 -*-__author__ = &apos;Fitzeng&apos;import redef main(): fix = open(&apos;fix.sh&apos;, &apos;w+&apos;) for line in open(&quot;txt&quot;): pkg = re.match(re.compile(&apos;&apos;&apos;dpkg: warning: files list file for package &apos;(.+)&apos; &apos;&apos;&apos;), line) if pkg: cmd = &quot;sudo apt-get install --reinstall &quot; + pkg.group(1) fix.write(cmd + &apos;\\n&apos;)if __name__ == &quot;__main__&quot;: main() 1.3 æ‰§è¡Œå‘½ä»¤å¦‚æœæƒé™ä¸å¤Ÿå¯ä»¥ç›´æ¥å…ˆ chmod 777 *ï¼Œç„¶åæ‰§è¡Œ python fixit.pyï¼Œè¿™æ—¶ fix.sh å°±å˜æˆä¸‹é¢çš„æ ·å­äº†ã€‚ 123456789101112131415sudo apt-get install --reinstall libodbc1:amd64sudo apt-get install --reinstall dh-autoreconfsudo apt-get install --reinstall erlang-webtoolsudo apt-get install --reinstall libhtml-template-perlsudo apt-get install --reinstall erlang-base.......sudo apt-get install --reinstall qemu-system-miscsudo apt-get install --reinstall libvirt-dev:amd64sudo apt-get install --reinstall autopointsudo apt-get install --reinstall libconfig-general-perlsudo apt-get install --reinstall ubuntu-cloud-keyringsudo apt-get install --reinstall tgtsudo apt-get install --reinstall libfdt1:amd64 æœ€åæ‰§è¡Œ ./fix.shã€‚ ç„¶åå°±æ˜¯ç­‰å¾…æ‰§è¡Œç»“æŸäº†ã€‚ æ•ˆæœå¦‚ä¸‹ï¼Œä¸€è¡Œä¸€è¡Œ dpkg: warning: åœ¨å‡å°‘ã€‚","tags":[{"name":"linux","slug":"linux","permalink":"http://fitzeng.org/tags/linux/"},{"name":"dpkg","slug":"dpkg","permalink":"http://fitzeng.org/tags/dpkg/"}]},{"title":"Restart","date":"2017-09-22T03:27:00.000Z","path":"2017/09/22/restart/","text":"0. å‰è¨€ æˆ‘çš„æ±‚èŒç”Ÿæ´»æ˜¯ä»ä»Šå¹´çš„ 04-16 æ‰¾å®ä¹ å¼€å§‹åˆ° 09-22 æ‹¿åˆ°ä¼˜æ‹›(ç§‹æ‹›) Offerç»“æŸï¼Œä¸­é—´å…±ç»å†è¿‡äº†ä¸‰å®¶å…¬å¸é¢è¯•ï¼Œé¢è¯•ç»éªŒä¸è¶³ï¼Œè€Œä¸”æœ€è¿‘çš„é¢è¯•å·²è·ç°åœ¨ä¸¤ä¸ªå¤šæœˆäº†ï¼Œç»†èŠ‚è®°ä¸æ¸…äº†ï¼Œæ‰€ä»¥è¿™ä¸å¤ªç®—æ˜¯é¢ç»ï¼Œåªæ˜¯æˆ‘ä¸ªäººå¯¹æˆ‘è‡ªå·±æ‰¾å·¥ä½œè¿™å°åŠå¹´çš„æ€»ç»“ä»¥åŠæˆ‘å¯¹æ‰¾å·¥ä½œè¿™ä»¶äº‹çš„è®¤è¯†ã€‚é¦–å…ˆè¯´æ˜æˆ‘ä¸æ˜¯å¤§ç¥ï¼Œåªèƒ½ä»å¹³é™å™è¿°æ•´ä¸ªæ‰¾å·¥ä½œçš„è¿‡ç¨‹ï¼Œå¸Œæœ›ä½ èƒ½ä»ä¸­ä½“ä¼šåˆ°ä¸€ç‚¹ä»€ä¹ˆå°±å¾ˆæ»¡æ„äº†ï¼Œåœ¨æ­¤å…ˆç¥å¤§å®¶æ‰¾å·¥ä½œé¡ºåˆ©ï¼ 1. é¢è¯•è¿‡ç¨‹ è‡ªå·±è¦ä»‹ç»è‡ªå·±åœ¨ä¸‰å®¶å…¬å¸çš„é¢è¯•è¿‡ç¨‹ï¼Œä¸æ¶‰åŠé¢è¯•é¢˜ç›®ä»€ä¹ˆçš„ï¼Œçº¯å±å™è¿°æ•´ä¸ªå¿ƒç†è¿‡ç¨‹ã€‚ä¸è¿‡åé¢æˆ‘ä¼šè¡¥å……ä¸€äº›èµ„æ–™å’Œæˆ‘å‚è€ƒçš„ä¸€äº›å…¶ä»–é¢è¯•è€…çš„é¢ç»ã€‚ ä¸‹é¢æˆ‘æ ¹æ®é‚®ä»¶ç†ä¸€ä¸‹æ—¶é—´çº¿ï¼š ç¬¬ä¸€å®¶å…¬å¸ï¼ˆè…¾è®¯ï¼‰å®ä¹ -è·ªä¸€é¢ï¼š04-16å¤§æ¦‚è®°å¿†å°±æ˜¯å•¥éƒ½é—®ï¼Œè¯»è¿‡æˆ‘ä»¥å‰æ–‡ç« çš„éƒ½çŸ¥é“ï¼Œæˆ‘ä»¥å‰æ˜¯å†™ Android çš„ï¼Œä½†æ˜¯ä»–é—®äº† Linuxï¼ŒC/C++ï¼Œæ“ä½œç³»ç»Ÿï¼ŒJVMï¼Œè®¾è®¡æ¨¡å¼ï¼Œç®—æ³•ï¼ŒAndriodï¼Œè¿˜æœ‰ä¸€äº›å°æ™ºåŠ›æµ‹è¯•é¢˜ã€‚ç›®å‰æˆ‘åªèƒ½è®°æ¸…è¿™äº›çŸ¥è¯†ç‚¹ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸€å¼€å§‹é—®äº†åå¤šåˆ†é’Ÿé¡¹ç›®ï¼Œå†é—®é—® Android åŸºç¡€(ç­”å¾—å¾ˆçƒ‚)ï¼Œå†é—® JVM(ä¹Ÿå¾ˆçƒ‚ğŸ˜­)ï¼Œæ¥ç€å°±ç»™æˆ‘ä¸€å¼ çº¸ä¸Šé¢ä¸¤é“é¢˜æ‰‹å†™ä»£ç ï¼Œé¢è¯•å®˜å°±å–æ°´å»äº†ï¼Œç„¶åæˆ‘æ²¡æ„è¯†åˆ°æœ‰ä¸¤é¢é¢˜ï¼Œåªåšäº†ç¬¬ä¸€é¢çš„ä¸¤é“å‘Šè¯‰é¢è¯•å®˜æˆ‘åšå¥½äº†ï¼Œä»–è¿‡æ¥äº†ï¼Œæˆ‘è·Ÿä»–è®²è§£ä»£ç ï¼ˆå› ä¸ºå­—è¿¹å®åœ¨éš¾çœ‹æ¸…ğŸ˜‚ï¼‰ï¼Œåœ¨ä»–çš„å¼•å¯¼ä¸‹æ…¢æ…¢æŠŠç¬¬äºŒé¢˜è¿›è¡Œä¼˜åŒ–ã€‚æ¥ç€å°±æ˜¯é—®é—®è®¡ç®—æœºåŸºç¡€çš„ä¸€äº›çŸ¥è¯†ã€‚é¢äº†æœ‰å°†è¿‘ä¸€ä¸ªå°æ—¶ï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡é¢è¯•ï¼Œæµäº†ä¸€èº«çš„æ±—ã€‚æˆ‘å¯¹é¢è¯•ç»“æœæ˜¯å¾ˆä¸ä¹è§‚çš„ï¼Œå› ä¸ºæˆ‘æ˜¯åœ¨ 04-1X æ‰çŸ¥é“è¿™æ˜¯å·²ç»æ¥è¿‘å®ä¹ æ‹›è˜å°¾å£°ã€‚åŸºæœ¬ä¸Šå¤§å¤šæ•°å…¬å¸çš„å†…æ¨ä»€ä¹ˆçš„éƒ½å¼„å®Œäº†ï¼Œè€Œæˆ‘ä¹Ÿæ˜¯åçŸ¥åè§‰ï¼Œ04-14 æ™šä¸Šåšç®€å†ï¼Œå› ä¸ºå¬è¯´è…¾è®¯ 04-15 æˆªæ­¢æŠ•é€’å®ä¹ ç®€å†ï¼Œåˆ° 04-15 æ—©ä¸Šï¼Œæˆ‘åšå®Œç®€å†å°±æŠ•äº†ã€‚å¯èƒ½æ˜¯é‡Œé¢æœ‰ä¸€äº›å­¦é•¿å­¦å§å§ï¼Œå½“å¤©ä¸‹åˆå°±æ”¶åˆ°å†…æ¨é€šçŸ¥å¹¶å‘ŠçŸ¥å®Œå–„ç®€å†ï¼Œæ¥ç€æ™šä¸Šå°±æ”¶åˆ°é€šçŸ¥æ˜å¤©å»é¢è¯•ã€‚æ•´ä¸ªæ„Ÿè§‰å¾ˆæƒŠå–œï¼Œä½†æ˜¯å…¶å®åæ¥è·ªäº†ä¹‹åæƒ³æƒ³å…¶å®æ˜¯è‡ªå·±æ²¡æœ‰åšå¥½å‡†å¤‡ï¼Œæ ¹æœ¬ä¸çŸ¥é“å‡†å¤‡å®ä¹ äººå®¶ä»ä¸‰æœˆä»½å°±å¼€å§‹æ‰¾äº†ï¼Œæ‰€ä»¥æœ‰ä¿¡æ¯æ¥æºå¾ˆé‡è¦ã€‚æœ¬æ¥ä»¥ä¸ºä¸€é¢è¦æŒ‚çš„ç»“æœç¬¬äºŒå¤©æ™šä¸Šå°±é€šçŸ¥è¿‡äº†å¹¶ä¸”è¿‡ä¸€å¤©ç¬¬äºŒé¢ã€‚ äºŒé¢ï¼š04-18è¿™ä¸€é¢å¾ˆå´©ï¼Œåæ¥æ‰çŸ¥é“å¯èƒ½æ˜¯å‹åŠ›é¢ã€‚è¯´å®è¯ï¼Œç¬¬ä¸€é¢èƒ½è¿‡ä¹‹åæˆ‘å·²ç»æ”¾æ¾äº†å¾ˆå¤šã€‚äºŒé¢å†…å®¹å’Œ Android ä¸€æ¯›é’±å…³ç³»éƒ½æ²¡æœ‰ã€‚åŒæ ·ä¸€å¼€å§‹èŠèŠé¡¹ç›®ï¼Œç„¶åæ¡Œå­ä¸Šæœ‰ä¸€å †å¤§æ¦‚åå˜ç±³åšçš„ A4 çº¸ï¼Œæ‹¿ä¸€å¼ ï¼Œå£è¿°ä¸€é“é¢˜ç„¶åå†™ä»£ç ï¼Œè¿™é‡Œæé†’ä¸‹å¤§å®¶å¦‚æœé‡åˆ°è¿™ç§æƒ…å†µï¼Œæœ€å¥½åœ¨åŠ¨ç¬”å‰é—®æ¸…æ¥šé—®é¢˜æ¡ä»¶ï¼Œæ¯”å¦‚æˆ‘ä¸€åŠ¨ç¬”å†™äº†ä¸€ç‚¹ç„¶åé—®ä»–å­—ç¬¦ä¸²æ˜¯ä»¥ä»€ä¹ˆå½¢å¼å­˜å‚¨çš„ï¼Œç„¶åä»–å›ç­”äº† char *ï¼Œæ¥ç€ç»™æˆ‘æ„Ÿè§‰æœ‰ç‚¹ä¸å¤ªèˆ’æœï¼Œæ°”æ°›å¾ˆä¸¥è‚ƒï¼Œä½†æ˜¯æˆ‘åˆé—®äº†ä¸€ä¸ªé—®é¢˜ï¼šæ˜¯å†™ä¼ªä»£ç è¿˜æ˜¯ï¼Ÿç»“æœå´©äº†ï¼Œä»–ç«‹é©¬è¯´ï¼Œéƒ½è¿™æ—¶å€™äº†è¿˜å†™ä»€ä¹ˆä¼ªä»£ç ï¼å¥½ï¼Œæˆ‘é»˜é»˜çš„åˆ’æ‰ï¼Œåˆå†™äº†ä¸€æ®µä»£ç ï¼Œç”±äºæ··åœ¨ä¸€èµ·ï¼Œæˆ‘å°±æŠŠä»£ç åˆæŠ„äº†ä¸€éï¼Œä½†æ˜¯æœ‰äº›è¯­å¥ä¸€å¼€å§‹æŠ„æ¼æ‰€ä»¥å‡ºç°äº†ä¸¤å¥ä»£ç åœ¨ä¸€è¡Œçš„æƒ…å†µã€‚ã€‚ã€‚ä»–çœ‹äº†è¾¹å¹æ°”è¾¹è¯´ï¼šâ€œè¿™äº›çš„ä»€ä¹ˆï¼Œä¹±ä¸ƒå…«ç³Ÿçš„ï¼Œç¼©è¿›XXXXXXXXXâ€ï¼Œç„¶åæˆ‘å¼±å¼±åœ°è¯´è¦ä¸æˆ‘å†æŠ„ä¸€éæŠŠæ ¼å¼è°ƒè°ƒï¼Ÿç»“æœä»–è¯´è¿˜è°ƒä»€ä¹ˆè°ƒï¼Œæµªè´¹æˆ‘æ—¶é—´ï¼ğŸ˜‚ğŸ˜‚ğŸ˜‚ğŸ˜‚ğŸ˜‚ğŸ˜‚æŠŠæˆ‘å“åäº†ï¼Œç„¶åå¼±å¼±çš„ç»™ä»–è®²è§£äº†ä»£ç ï¼Œç”±äºä»£ç å†™çš„è¿˜ä¸é”™ï¼Œè¿™é‡Œä»–æ²¡æªæˆ‘çš„å°è¾«å­ã€‚ç„¶åä»–åˆè¯´ç»™ä½ æ¥ä¸€é“åšå¼ˆé¢˜ï¼Ÿï¼Ÿï¼Ÿæˆ‘é»‘äººé—®å·ï¼Œæˆ‘é¢çš„æ˜¯ Android å—ï¼Ÿå£è¿°å®Œé¢˜ç›®åï¼Œä»–çœ‹åˆ°äº†æˆ‘æœ‰ç‚¹é«˜å…´ï¼Œé—®æˆ‘æ˜¯ä¸æ˜¯çœ‹è¿‡ç±»ä¼¼çš„é¢˜ç›®ï¼Ÿæˆ‘è¯šå®çš„å›ç­”æ˜¯ã€‚ç»“æœä»–è¯´ç»™ä½ å‡ºé“ç®€å•ä¸€ç‚¹çš„é¢˜ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿå¿µå®Œé¢˜ç›®ä¹‹åæˆ‘ä¸€è„¸æ‡µé€¼ï¼Œç»“æœæœ€åæˆ‘å¯¹é¢˜ç›®çš„çœ‹æ³•å’Œé¢è¯•å®˜ä¸ç¬¦ï¼Œç„¶åæŒ‚äº†ã€‚æ€»ç»“å°±æ˜¯ï¼šæŠ±æ­‰ï¼Œæˆ‘ä¸ä¼šæ¼”æˆã€‚ã€‚ã€‚å½“æ—¶æƒ³å¦‚æœæˆ‘ç¨å¾®å†·é™ä¸€ç‚¹ï¼ŒæŠŠåšå¼ˆé¢˜æ‹¿ä¸‹åº”è¯¥è¿™é¢èƒ½è¿‡å§ï¼Œä½†æ˜¯æ²¡æœ‰å¦‚æœã€‚ã€‚ã€‚ ç¬¬äºŒå®¶å…¬å¸ï¼ˆåä¸ºï¼‰1. å®ä¹ -è·ªæŠ€æœ¯é¢ï¼š05-13ç”±äºé¢è¯•å®˜ä¸æ˜¯åš Androidï¼Œç»™æˆ‘æ„Ÿè§‰è¿ Java ç›¸å…³éƒ½ä¸æ˜¯ï¼Œæ‰€ä»¥å…¨ç¨‹åœ¨èŠå¤©ï¼Œä»€ä¹ˆä½ å®¶åœ¨å“ªé‡Œï¼Ÿä¸ºä»€ä¹ˆä¸è¯»ç ”ï¼Ÿä½ èƒ½æ¥å—åŠ ç­å—ï¼Ÿä¹‹ç±»çš„ã€‚ã€‚ã€‚ã€‚å¤§æ¦‚äºŒåå¤šåˆ†é’Ÿï¼Œç»“æŸå¾—å¾ˆè½»æ¾ã€‚ ç»¼åˆé¢ï¼š05-13ç”±äºæŠ€æœ¯é¢æ²¡é—®æŠ€æœ¯ï¼Œæ‰€ä»¥è¿™é¢å¤§æ¦‚å°±æ˜¯å’Œå‰é¢é—®çš„é—®é¢˜å·®å¤šï¼Œæ—¶é—´ä¹Ÿæ˜¯å·®ä¸å¤šï¼Œæ„Ÿè§‰å¾ˆæ°´ã€‚ã€‚ã€‚ è¡¥å……ï¼šå‰é¢éƒ½æ˜¯åŒä¸€å¤©é¢å®Œï¼Œæ„Ÿè§‰å¾ˆè¯¡å¼‚ï¼Œä¸å¤ªåƒé¢è¯•ã€‚ã€‚ã€‚å›åˆ°å­¦æ ¡åï¼Œè¿‡å‡ å¤©é¢è¯•çŠ¶æ€å°±æ˜¯å½•ç”¨æ’åºä¸­ã€‚ç®—æ˜¯é¢è¯•è¿‡äº†ï¼Œç„¶åä¸€ä¸¤å‘¨è¿‡åæœ‰åŒç­çš„åŒå­¦æ”¶åˆ°å®ä¹  offerï¼Œè€Œæˆ‘æ²¡æ¶ˆæ¯ã€‚ç›´åˆ°å¬è¯´å®ä¹  offer éƒ½å‘å®Œäº†æˆ‘æ‰çŸ¥é“æˆ‘æŒ‚äº†ã€‚æ‰€ä»¥è¯´åä¸ºçš„é¢è¯•é€šè¿‡å’Œ offer è¿˜æœ‰ä¸€æ®µèµ„æºæ± çš„è·ç¦»ã€‚åæ¥ä¸€ä¸ªå­¦é•¿ hr æ¥åˆ°å­¦æ ¡æ‰¾åŒå­¦è°ˆè¯ï¼Œè¿™æ—¶æˆ‘è¢«å‘ŠçŸ¥æŠ€æœ¯é¢ç»™äº†ä¸ª B+ã€‚ã€‚ã€‚è¿™ä¸ªå¯¹æˆ‘åé¢å½±å“æŒºå¤§çš„ï¼Œç„¶åç»¼åˆé¢æ˜¯ OK çš„ã€‚æ‰€ä»¥é¢è¯•æ—¶ç®—è¿‡ï¼Œæœ¬æ¥ä¹Ÿå¯ä»¥ç»™ offer ä½†æ˜¯æ²¡æœ‰å²—ä½ï¼Œåªæ‹›ä¸€ä¸ª Android å®ä¹ çš„ ğŸ™‚ã€‚ä½†æ˜¯è¿™æ—¶å€™æˆ‘è¿˜å¯ä»¥ç”¨è¿™ä¸ªå®‰æ…°è‡ªå·±ï¼Œä¸æ˜¯ä½ å·®ï¼Œæ˜¯å¸‚åœºéœ€æ±‚ï¼Œè¿™æ˜¯æ²¡åŠæ³•çš„äº‹ã€‚åç»­çš„æ˜¯å°±æ˜¯å­¦é•¿è·Ÿæˆ‘è°ˆäº†è°ˆäººç”Ÿè§„åˆ’å•Šï¼Œç„¶åæ¨èæˆ‘å‚åŠ ä¼˜æ‹›ã€‚åé¢å°±æ˜¯ä¼˜æ‹›çš„æ•…äº‹äº†ï¼› ç¬¬ä¸‰å®¶å…¬å¸ï¼ˆé˜¿é‡Œï¼‰å®ä¹ -è·ªä¸€é¢ï¼š05-20é˜¿é‡Œæ˜¯åœ¨çº¿é¢è¯•ï¼Œç»™æˆ‘çš„æ„Ÿè§‰æ˜¯é¢è¿‡æœ€éš¾çš„ï¼Œé—®å¾—æˆ‘æ— ä»å›ç­”ï¼Œå› ä¸ºæˆ‘åŸºæœ¬æ²¡æœ‰é¡¹ç›®ç»éªŒï¼Œä»€ä¹ˆè¯´è¯´ä½ åœ¨å¼€å‘ä¸­ç¢°åˆ°å°è±¡æœ€æ·±åˆ»çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿé‡åˆ°ç½‘ä¸Šæ€ä¹ˆä¹ŸæŸ¥ä¸åˆ°ç­”æ¡ˆçš„é—®é¢˜æ€ä¹ˆåŠï¼Ÿè¿˜æœ‰ä½ å¯¹ RNï¼ˆå½“æ—¶åªçŸ¥é“æœ‰ä¸ª RN å¼€å‘ï¼Œå¹¶ä¸æ¸…æ¥šæ˜¯ä»€ä¹ˆï¼‰ å¼€å‘æ€ä¹ˆçœ‹ï¼Ÿåæ­£æˆ‘ç­”ä¸ä¸Šæ¥ï¼Œæ‰€ä»¥ç›´æ¥æ¯™äº†ã€‚åé¢ä»–é—®æˆ‘æœ‰ä»€ä¹ˆé—®é¢˜é—®ä»–ï¼Œæˆ‘é—®ä»–ä»–å¯¹æˆ‘é¢è¯•æ„Ÿè§‰æ€ä¹ˆæ ·ï¼Ÿä»–è¯´æˆ‘åŸºç¡€ä¸è¡Œï¼Œç„¶åæˆ‘åˆé—®äº†è¦æ€ä¹ˆå­¦ä¹ ï¼Ÿä»–è¯´ Java è¦å­¦å¥½ï¼Œåå°„æ³¨è§£ä»€ä¹ˆçš„ã€‚æ€»ä¹‹å°±æ˜¯åŸºç¡€è¦æ‰å®ã€‚ã€‚ã€‚ ç¬¬äºŒå®¶å…¬å¸ï¼ˆåä¸ºï¼‰2. ä¼˜æ‹›-è¿‡è¡¥æŠ€æœ¯é¢ï¼š07-14ç”±äºå‰é¢çš„å®ä¹ é¢è¯•ç»™äº†ä¸ª B+ï¼Œæ‰€ä»¥è¿™æ¬¡è¦è¡¥ä¸€ä¸ªæŠ€æœ¯é¢ã€‚é¢è¯•å®˜ä¹Ÿä¸æ˜¯åš Android çš„ï¼Œä¸è¿‡æ˜¯å’Œ Java ç›¸å…³çš„ï¼Œæ‰€ä»¥åŸºæœ¬å°±æ˜¯é—®æˆ‘ Java äº†ã€‚ä¹Ÿæ˜¯å¼€å§‹èŠèŠé¡¹ç›®å’Œç”Ÿæ´»ï¼Œç„¶åé—®é—® Java å†…å­˜æ³„æ¼ï¼ŒGCï¼Œæ¥ç€è€ƒè€ƒç®—æ³•ï¼Œä¸€é“è¿·å®«çš„é¢˜ç›®ï¼Œè¯´ä¸‹ç”¨æ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆéå†çš„å®ç°æ€æƒ³ï¼Œè¿›è€Œé—®å¦‚æœè¦æ‰¾å‡ºä¸€æ¡æœ€å°‘æ­¥éª¤çš„è·¯èµ°å‡ºè¿·å®«æ€ä¹ˆåŠï¼ŸåŸºæœ¬éƒ½ç­”ä¸Šæ¥äº†ï¼Œæœ€åä»–è¯´æˆ‘é—®ä½ ä¸€ä¸ª Java é—®é¢˜ï¼Œæˆ‘ä»¥ä¸ºä¼šå¾ˆéš¾ã€‚ç»“æœä»–è¯´è¢« final å…³é”®å­—ä¿®é¥°çš„ç±»ä¼šæ€ä¹ˆæ ·ï¼Ÿæˆ‘è¿Ÿç–‘äº†ä¸€ä¸‹ï¼Œè¯´äº†ç­”æ¡ˆã€‚ã€‚ã€‚ç„¶åé¢è¯•å°±ç»“æŸäº†ã€‚ç»™æˆ‘çš„æ„Ÿè§‰åº”è¯¥æ˜¯èƒ½è¿‡çš„ã€‚ BOSS é¢ï¼š07-14ç­‰äº†å¥½ä¹…ï¼Œæœ€åæ’é˜Ÿæ’ä¸ä¸Šä¸Šåˆçš„äº†ï¼Œç„¶åå‘äº†é¤åˆ¸å»åƒäº†ä¸ªé¥­å›æ¥é¢è¯•ã€‚é¢è¯•è¿‡ç¨‹å’Œå®ä¹ é¢è¯•æ—¶å·®ä¸å¤šï¼Œä½†æ˜¯é‚£ä¸ªé¢è¯•å®˜çš„çº§åˆ«æ„Ÿè§‰æŒºé«˜çš„ï¼Œç™½å¤´å‘ç‰¹åˆ«å¤šï¼Œä¼°è®¡ 50+ å§ï¼Œæœ€ååŠ äº†ä¸ªç¾¤ï¼Œé¢è¯•ç»“æŸäº†ã€‚æ„Ÿè§‰æ²¡ä»€ä¹ˆæ„Ÿè§‰ï¼Œå½“æ—¶é¢è¯•çš„ç ”ç©¶ç”Ÿç‰¹åˆ«å¤šï¼Œæ‰€ä»¥æˆ‘æ„Ÿè§‰å¯èƒ½è¦ GGã€‚ ç­‰äº†ä¸¤ä¸ªå¤šæœˆåï¼Œç­‰åˆ° 09-21 å‘æ¥çš„ç­¾çº¦çŸ­ä¿¡ï¼Œ09-22 ä»¥ç™½èœä»·ç­¾äº†ä¸‰æ–¹ã€‚æ˜¯è‡ªå·±æ»¡æ„çš„åŸå¸‚åŠ ä¸Šæ•´ä¸ªæš‘å‡éƒ½åœ¨å­¦æ ¡ï¼Œ09 æœˆä»½æŠ•äº†åå¤šå®¶å…¬å¸å’Œåšäº† 7-8ä»½ç¬”è¯•é¢˜ï¼Œå¿ƒå¤ªç´¯å®åœ¨æ˜¯ä¸æƒ³ç­‰äº†ã€‚ã€‚ã€‚ç­¾çš„è¿‡ç¨‹ä¸­æœ‰ä¸ªæ›´æ”¹åŸå¸‚çš„å°æ’æ›²ï¼Œhr å¾ˆå¥½ï¼Œå¿™åˆ°æ™šä¸Š 7 ç‚¹å¤šæ‰ç»“æŸï¼Œåœ¨è¿™è¡¨ç¤ºæ„Ÿè°¢ã€‚è¿˜æœ‰ä¸€ä¸ªå°æ’æ›²æ˜¯å½“å¤©æœ‰ä¸€ä¸ªè…¾è®¯çš„é¢è¯•ï¼Œè¿™æ˜¯æˆ‘çš„æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªç§‹æ‹›é¢è¯•ï¼Œç”±äºç­¾äº†åä¸ºçš„ä¸‰æ–¹ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰å»é¢äº†ï¼Œå‡†ç¡®è¯´ï¼Œå…¶å®æˆ‘æ²¡æœ‰ç§‹æ‹›ï¼Œé™¤äº†æŠ•äº†åå‡ åˆ†ç®€å†å’Œåšäº†å‡ æ¬¡ç¬”è¯•ã€‚ 2. é¢è¯•å‡†å¤‡ è¿™é‡Œä¸»è¦å™è¿°æˆ‘çš„æš‘å‡å’Œä¹æœˆä¸Šæ—¬è¿™ä¸ªé¢è¯•å‡†å¤‡è¿‡ç¨‹å’Œè‡ªå·±å¯¹é¢æ˜¯å‡†å¤‡çš„çœ‹æ³•ã€‚ è¯´å®è¯ï¼Œæ²¡æœ‰å®ä¹  offer å¯¹æˆ‘ç®—æ˜¯æœ‰ç‚¹æ‰“å‡»çš„ã€‚æ‰€ä»¥æˆ‘å°±æ‰“ç®—æš‘å‡ä¸å›å®¶å¥½å¥½å¤ä¹ åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘è§‰å¾—å¯¹äºä¸€ä¸ªæœ¬ç§‘ç”Ÿæ¥è¯´ï¼ŒåŸºç¡€æ‰å®æ‰æ˜¯ä½ çš„ä¼˜åŠ¿ï¼Œå¯¹äºè¿™é‡Œå¯èƒ½æ¯ä¸ªäººçœ‹æ³•ä¸ä¸€ï¼Œå¯¹äºæ¯ä¸ªæ–¹å‘å¯èƒ½æœ‰å·®è·å§ï¼Œè¿™é‡Œæˆ‘åªæ˜¯å¹³é™åœ°è¡¨è¾¾æˆ‘çš„è§‚ç‚¹ã€‚ æ‰€ä»¥æˆ‘åŸºæœ¬æ”¾ä¸‹ Android äº†ï¼Œåªæ˜¯æŒ‘çƒ­ç‚¹é¢è¯•é—®é¢˜è¿‡è¿‡ã€‚è¯´ä¸‹æˆ‘åšè¿‡çš„åŠªåŠ›ï¼š 1.é‡æ‹¾æ•°æ®ç»“æ„2.é‡æ‹¾æ“ä½œç³»ç»Ÿ3.é‡è¯» JVM4.Android Blog Collection5.Handler æœºåˆ¶å†äº†è§£ ä»¥ä¸Šæ˜¯ä»¥ Blog å½¢å¼è¿›è¡Œäº†æ€»ç»“çš„ï¼Œè¿˜æœ‰éƒ¨åˆ†ä¹¦ç±æ²¡æœ‰æ€»ç»“çš„ã€‚ é‡Œé¢çš„çœ‹äº†æœ‰ 30% å§ï¼Œéƒ½æ˜¯é‡‡å–ä¸é‡è¦çš„ç²—è¯»é‡è¦çš„ç²¾è¯»æ¨¡å¼ã€‚ç”µå­ç‰ˆä¸‹è½½ é“¾æ¥ : http://pan.baidu.com/s/1o7LcZCe å¯†ç  : 0p0c ã€‚å¸Œæœ›å¤§å®¶æœ‰æ¡ä»¶å»æ”¯æŒçº¸è´¨ä¹¦å§ï¼Œæˆ‘å¯¹çŸ¥è¯†åˆ›é€ è€…è¿˜æ˜¯å¾ˆå°Šé‡çš„ï¼Œå› ä¸ºè‡ªå·±å‘ç°å†™ Blog æ¯ä¸ªç¤¼æ‹œä¸€ç¯‡éƒ½å†™ä¸æ¥ï¼Œä½†æ˜¯å¯¹äºéƒ¨åˆ†å­¦ä¹ è®¡ç®—æœºçš„äººæ¥è¯´ï¼Œä¹¦ç¡®å®æœ‰ç‚¹å¤šï¼Œä¹Ÿè¦èŠ±å¾ˆå¤šé’±ï¼Œæ‰€ä»¥å–èˆä¹‹ä¸‹å°±æ˜¯æœ‰æ¡ä»¶çš„ç°åœ¨æ”¯æŒåŸä½œè€…ï¼Œæ²¡æ¡ä»¶çš„ä»¥åæœ‰æ¡ä»¶äº†å†æ”¯æŒã€‚å¥½åƒåé¢˜äº†ã€‚ã€‚ã€‚ æœŸé—´çœ‹è¿‡ Android å¼€å‘è‰ºæœ¯æ¢ç´¢ï¼ŒAndroid ç¾¤è‹±ä¼ ï¼ŒAndroid è¿›é˜¶ä¹‹å…‰ã€‚ä¹‹å‰è¿˜çœ‹è¿‡ ç¼–ç¨‹ä¹‹ç¾ï¼Œç¼–ç¨‹ç ç‘ï¼Œç¼–ç¨‹ä¹‹æ³•ï¼Œéƒ½æ²¡æœ‰è‡ªå·±æ•²ä»£ç å®ç°ï¼Œæ‰€ä»¥å¤„äºæœ‰æ€è·¯ä½†ä¸èƒ½å†™ä»£ç å®ç°çš„çŠ¶æ€ã€‚ç„¶åå°±æ˜¯ä¸€äº›ä¸“ä¸šè¯¾è¯¾æœ¬äº†ã€‚å¯¹äºè¯»ä¹¦è¿™ä»¶äº‹æˆ‘è§‰å¾—æ²¡æœ‰å¿…è¦ä¸ºä¸€ä¸ªçŸ¥è¯†ç‚¹æ­»ç£•ï¼Œæˆ‘ä¸€èˆ¬å°±æ˜¯å¾€åç¿»ï¼ŒåŸºæœ¬ä¸¤å¤©è·³ç€â€˜çœ‹â€™å®Œä¸€æœ¬ä¹¦ã€‚æ—¶é—´å›ºå®šçš„æƒ…å†µä¸‹å®æ„¿è·³ç€å¤šçœ‹å‡ éï¼Œä¹Ÿä¸è¿½æ±‚ä¸€éä»”ç»†çœ‹å®Œã€‚å› ä¸ºä½ é¢ä¸´çš„ç»“æœå°±æ˜¯è®°ä¸ä½ï¼Œæ²¡æœ‰é‡ç‚¹çš„é‡å¤åˆºæ¿€ä¸‹çŸ¥è¯†ç½‘ç»œå»ºç«‹ä¸èµ·æ¥ã€‚å¾€å¾€é˜…è¯»åˆ°åé¢ï¼Œå‰é¢çš„ç–‘é—®å°±ä¼šè¿åˆƒè€Œè§£ã€‚ ç„¶åè¯´è¯´å²—ä½å§ï¼Œä»¥åæˆ‘å¯èƒ½å°±ä¸ä¼šå†å†™å’Œ Android ç›¸å…³çš„æ–‡ç« äº†ï¼Œç­¾çš„å·¥ä½œæ˜¯äº‘è®¡ç®—æ‰€ä»¥æ‰“ç®—å­¦å­¦ Python å’Œ OpenStack ä¹‹ç±»çš„ï¼Œä»æ–°å¼€å§‹æ¥è§¦ä¸€ä¸ªæ–°çš„é¢†åŸŸã€‚æ‰€ä»¥å¦‚æœä½ ä¸æ˜¯å¯¹ä¸€ä¸ªå²—ä½æŒæœ‰éåšä¸å¯çš„æ€åº¦ï¼Œå…¶å®æˆ‘è§‰å¾—é‚£å°±ä¸è¦å¤ªåœ¨æ„é‚£äº›èŠ±å“¨çš„ä¸œè¥¿ï¼Œæ³¨é‡åŸºç¡€çš„ç§¯ç´¯ã€‚æ¯”å¦‚ä¹‹å‰é¢è¯•æœ‰é—®æˆ‘å­¦è¿‡ä»€ä¹ˆæ¡†æ¶å—ï¼Ÿæˆ‘è¯´æ²¡å­¦è¿‡ï¼Œç„¶åè¿™ä¸ªè¯é¢˜å°±è·³è¿‡äº†ã€‚å½“ç„¶å­¦è¿‡åŠ åˆ†ï¼Œæ²¡å­¦è¿‡æˆ‘è§‰å¾—ä¸å‡åˆ†å§ï¼Œæ¯•ç«Ÿåº”å±Šç”Ÿã€‚ä½†æ˜¯ä¸€ä¸ª Java åŸºç¡€çš„è¯­è¨€ç‰¹æ€§ç­”ä¸ä¸Šæ¥é‚£å°±æœ‰ç‚¹è¯´ä¸è¿‡å»äº†ã€‚è€Œä¸”æ¡†æ¶çš„ç²¾é«“åœ¨è¯»æºç ä¹‹åè½¬åŒ–ä¸ºè‡ªå·±çš„ç†è§£ä»è€Œåº”ç”¨åœ¨è‡ªå·±ä»£ç ä¸­ï¼Œè€Œä¸æ˜¯ä¼šä½¿ç”¨æ¡†æ¶ï¼Œè¿™ç§ä»·å€¼ä¸å¤§ã€‚å¦‚æœä½ æ˜¯å¤§ç¥ï¼ŒåŸºç¡€æ‰å®ï¼Œé‚£è¿™äº›å°±æ˜¯ä½ çš„è¿›é˜¶ï¼Œä½ çš„åŠ åˆ†é¡¹ï¼Œæœ¬è´¨ä¸ä¸€æ ·ã€‚å°±åƒè¯•å·çš„å¿…ç­”é¢˜ç­”å®Œäº†è‚¯å®šæ˜¯å»ç­”é€‰åšé¢˜ï¼Œä½†æ˜¯æœ‰äº›äººè¿å¿…ç­”é¢˜éƒ½æ²¡åšå®Œå°±è·Ÿç€åˆ«äººç¿»å·å­æ˜¯ä¸æ˜¯æœ‰ç‚¹ã€‚ã€‚ã€‚æ€»ä¹‹å°±æ˜¯æ³¨é‡è¯­è¨€æœ¬èº«ï¼Œè€Œä¸æ˜¯è¯­è¨€è¡ç”Ÿå“ã€‚ æ¥ç€è¯´è¯´é¢ç»ï¼Œè¿™æ˜¯å¾ˆå¥½çš„ä¸œè¥¿ï¼Œä½†æ˜¯ä¹Ÿæ˜¯å¾ˆä¸å¥½çš„ä¸œè¥¿ï¼Œçœ‹ä½ çš„è®¤çŸ¥ã€‚æœ‰äººå¯¹é¢ç»çš„æ€åº¦æ˜¯é¢˜åº“ï¼Œè§‰å¾—çœ‹å®Œè®°ç€æˆ‘é¢è¯•å°±èƒ½è¿‡äº†ï¼ŒåŒä¸€ä¸ªé—®é¢˜ï¼Œä¸åŒçš„äººè¯´ç›¸åŒçš„ç­”æ¡ˆé¢è¯•å®˜ä¹Ÿèƒ½çŸ¥é“å“ªä¸ªå‰å®³å“ªä¸ªæ°´ã€‚å¤§å®¶å¯ä»¥è¯•è¯•å¯¹ä¸€ä¸ªè‡ªå·±ä¸ç†è§£çš„æŠ€æœ¯é—®é¢˜å°è¯•è§£é‡Šä¼šæ€æ ·ï¼Ÿä½ ä¸€è¿Ÿç–‘ï¼Œé¢è¯•å®˜å°±ä¼šåé—®ä½ ï¼Œæœ€ååªæœ‰ä¸€ä¸ªå­—å´©ï¼è€Œä¸”é‚£äº›é¢ç»æä¾›çš„ç­”æ¡ˆå¾€å¾€æ˜¯ç¬¦åˆä½œè€…çš„æ€è€ƒæ€è·¯ï¼Œä¸ä¸€å®šå¯¹ä½ é€‚ç”¨ã€‚æ‰€ä»¥æˆ‘å¯¹é¢ç»çš„æ€åº¦æ˜¯ç±»ä¼¼äºè€ƒçº²ï¼Œè‡³äºè€ƒçº²å’Œé¢˜åº“çš„åŒºåˆ«ç•™ç»™è¯»è€…æ€è€ƒå§ã€‚ ç„¶åæˆ‘é¢è¯•å‡†å¤‡è¿‡ç¨‹ä¸­å‚è€ƒçš„å¥½çš„â€˜è€ƒçº²â€™ [å¹²è´§ï¼Œé˜…åè¿›BATä¸æ˜¯æ¢¦] é¢è¯•å¿ƒå¾—ä¸æ€»ç»“â€”BATã€ç½‘æ˜“ã€è˜‘è‡è¡— è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿï¼Œå‰é¢ä¸€ç¯‡æ˜¯æˆ‘è®¤ä¸ºçš„å¥½é¢ç»ï¼Œå¯ä»¥ä½œä¸ºæŸ¥æ‰¾å‚è€ƒã€‚ 3. æœ€åå¦‚æœä½ è§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©å°±ç‚¹ä¸‹èµå§ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ°ï¼Œå¸Œæœ›èƒ½å¸®åˆ°æ›´å¤šçš„äººã€‚è¿™æ˜¯æˆ‘ç¬¬ä¸€ç¯‡æ±‚èµçš„æ–‡ç« ï¼Œå› ä¸ºç¡®å®æƒ³å’Œå¤§å®¶åˆ†äº«æˆ‘çš„æƒ³æ³•ã€‚è°¢è°¢ã€‚ å†å¦‚æœä½ æœ‰ç›¸åŒæˆ–è€…ä¸åŒçš„æ„è§ï¼Œæ¬¢è¿è¯„è®ºåŒºç•™è¨€å¤§å®¶äº’ç›¸è®¨è®ºå‘€~ ç„¶åå›½é™…æƒ¯ä¾‹ï¼šGitHub &amp;&amp; Blog æ¬¢è¿æ¥è§‚å…‰ ^_^ å¤šè°¢é˜…è¯»ï¼","tags":[{"name":"Life","slug":"Life","permalink":"http://fitzeng.org/tags/Life/"},{"name":"Job","slug":"Job","permalink":"http://fitzeng.org/tags/Job/"}]},{"title":"é‡è¯† Android","date":"2017-09-19T03:27:00.000Z","path":"2017/09/19/reAndroid/","text":"Android åŸºç¡€çŸ¥è¯†æ•´ç†ã€‚ 1. Activity1.1 Activity ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼šrunning paused stopped killed å¯åŠ¨ï¼šonCreate() -&gt; onStart() -&gt; onResume() ç‚¹å‡» Home ï¼š-&gt; onPause() -&gt; onStop() é‡ç°ï¼š-&gt; onRestart() -&gt; onStart() -&gt; onResume() é€€å‡ºï¼š-&gt; onPause() -&gt; onStop() -&gt; onDestory() è¿›ç¨‹ä¼˜å…ˆçº§ï¼šå‰å°(å¯äº¤äº’) å¯è§(å¤±å»ç„¦ç‚¹) æœåŠ¡ åå°(ä¸å¯è§) ç©º(ç¼“å­˜ç”¨) 1.2 Activity ä»»åŠ¡æ ˆstandardï¼šæ ‡å‡†æ¨¡å¼(æ¯æ¬¡éƒ½åˆ›å»º) singleTopï¼šæ ˆé¡¶å¤ç”¨æ¨¡å¼(æ ˆé¡¶æ£€æµ‹) singleTaskï¼šæ ˆå†…å¤ç”¨æ¨¡å¼(æ ˆå†…æ£€æµ‹) singleInstanceï¼šå•å®ä¾‹æ¨¡å¼(ç‹¬ç«‹çš„ä»»åŠ¡æ ˆ) 1.3 Activity å¯åŠ¨æ¨¡å¼1.4 Scheme è·³è½¬åè®®1.5 å‚è€ƒ2. Fragment2.1 ç”Ÿå‘½å‘¨æœŸCreate: å‡†å¤‡è§†å›¾ onAttach: Fragment ä¸ Activity å…³è” onCreate: åˆ›å»º Fragment å¯¹è±¡ onCreateView: åˆ›å»ºè§†å›¾ onActivityCreated: Activity å¯¹è±¡åˆ›å»ºå®Œæˆ Start: åŠ è½½è§†å›¾ onStart: Fragment å¯è§ Resume: è·å–ç„¦ç‚¹ onResume: Fragment å¯äº¤äº’ Pause å¤±å»ç„¦ç‚¹ onPause: Fragment å¤±å»ç„¦ç‚¹ Stop è§†å›¾ä¸å¯è§ onStop: Fragment ä¸å¯è§ Destory é”€æ¯å¯¹è±¡ onDestoryView: Fragment è§†å›¾é”€æ¯ onDestory: å¯¹è±¡é”€æ¯ onDetach: è§£ç»‘ Fragment å¹¶é”€æ¯å¯¹è±¡ ä»¥ä¸Šä¸ºä¸ªäººç†è§£ï¼Œä¸æ˜¯å®Œæ•´çš„è§†å›¾åŠ è½½è¿‡ç¨‹ï¼Œåªæ˜¯å±äºä¸€ä¸ªç†è§£åˆ†æçš„è¿‡ç¨‹ã€‚ 2.2 Fragment æ·»åŠ åˆ° Activity ä¸­é™æ€åŠ è½½ï¼šXML åŠ¨æ€åŠ è½½ï¼š FragmentManager FragmentPagerAdapter(detach) é€‚ç”¨äºé¡µé¢è¾ƒå°‘çš„æƒ…å†µï¼Œä¸é”€æ¯ Fragment åªä¸ Activity è„±ç¦»ã€‚ FragmentStatePagerAdapter(remove) é€‚ç”¨äºé¡µé¢è¾ƒå¤šçš„æƒ…å†µï¼Œç›´æ¥ç§»é™¤ Fragmentã€‚ 2.3 Fragment é€šä¿¡ Fragment ä¸­è°ƒç”¨ Activity : è°ƒç”¨ getActivity() Activity ä¸­è°ƒç”¨ Fragment : Fragment å›è°ƒå‡½æ•° Fragment ä¸­è°ƒç”¨ Fragment : findFragmentById() 2.4 å…¸å‹æ–¹æ³•replace: æ›¿æ¢ Fragment å®ä¾‹ add: æ·»åŠ  Fragment å®ä¾‹ remove: ç§»é™¤ Fragment å®ä¾‹ 2.5å‚è€ƒ Android_Tutor : ä¸¤åˆ†é’Ÿå½»åº•è®©ä½ æ˜ç™½Android Activityç”Ÿå‘½å‘¨æœŸ(å›¾æ–‡)! 3. Service3.1 Service å’Œ ThreadService: ä¾æ‰˜äºæ‰€åœ¨çš„çº¿ç¨‹å¹¶ä¸”åœ¨åå°è¿è¡Œï¼Œä¸å¯åšè€—æ—¶æ“ä½œï¼Œå¦åˆ™ä¼š ANRã€‚Thread: ä¸»è¦æ˜¯å‡ºå¤„ç†è€—æ—¶æ“ä½œã€‚ 4. BroadCast Receiver","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"}]},{"title":"Handler æœºåˆ¶å†äº†è§£","date":"2017-09-11T03:27:00.000Z","path":"2017/09/11/handler/","text":"è¿™é‡Œä¸»è¦æ˜¯å…ˆäº†è§£æ•´ä¸ªæ¶ˆæ¯ä¼ é€’çš„è¿‡ç¨‹ï¼ŒçŸ¥é“è¿™æ ·åšçš„å¥½å¤„å’Œå¿…è¦æ€§ã€‚è€Œä¸æ˜¯ç›´æ¥ä»‹ç»é‡Œé¢çš„å‡ ä¸ªå…³é”®ç±»ï¼Œç„¶åä»‹ç»è¿™ä¸ªæœºåˆ¶ï¼Œè¿™æ ·å®¹æ˜“å¤´æ™•ã€‚è€Œä¸”ç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¤šè¿™æ ·çš„æ–‡ç« äº†ï¼Œé‚£äº›ä½œè€…æ‰€ç«™çš„é«˜åº¦å¯¹äºæˆ‘è¿™ç§åˆå­¦è€…æ¥è¯´æœ‰ç‚¹é«˜ï¼Œæˆ‘ç†è§£èµ·æ¥æ˜¯æ¯”è¾ƒç¨€é‡Œç³Šæ¶‚çš„ï¼Œæ‰€ä»¥è¿™é‡Œä»ä¸€ä¸ªé—®é¢˜å‡ºå‘ï¼Œä¸€æ­¥ä¸€æ­¥è·Ÿè¸ªä»£ç ï¼Œè¿™é‡Œåªæ˜¯ææ¸…æ¥š handler æ˜¯æ€ä¹ˆè·¨çº¿ç¨‹æ”¶å‘æ¶ˆæ¯çš„ï¼Œå…·ä½“å®ç°ç»†èŠ‚è¿˜æ˜¯å‚è€ƒç½‘ä¸Šçš„é‚£äº›å¤§ç¥çš„ Blog æ¯”è¾ƒæƒå¨ã€‚PS. æœ¬æ¥æ˜¯æƒ³åˆ†ç« èŠ‚ä¹¦å†™ï¼Œè°çŸ¥é“è¿™ä¸€å¥—å†›ä½“æ‹³æ‰“ä¸‹æ¥æ”¶ä¸ä½äº†ï¼Œæ‰€ä»¥ä¸‹é¢åŸºæœ¬æ˜¯ä»¥ä¸€ç§å¾ˆæµç•…çš„è¿‡ç¨‹è§£é‡Šè€Œä¸æ˜¯å¾ˆè·³è·ƒï¼Œç»†å¿ƒçœ‹åº”è¯¥ä¼šå¯¹ç†è§£ Handler æœºåˆ¶æœ‰æ‰€æ”¶è·ã€‚ Q1: å‡å¦‚æœ‰ä¸€ä¸ªè€—æ—¶çš„æ•°æ®å¤„ç†ï¼Œè€Œä¸”æ•°æ®å¤„ç†çš„ç»“æœæ˜¯å¯¹ UI æ›´æ–°å½±å“çš„ï¼Œè€Œ Android ä¸­ UI æ›´æ–°ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥è§„å®šåªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°ã€‚ ä¸‹é¢æˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼š 12345678910111213141516171819202122232425262728293031323334353637ä¸»çº¿ç¨‹ç‰ˆæœ¬ï¼špublic class MainActivity extends AppCompatActivity &#123; private static final String TAG = \"MainActivity\"; private Button btnTest; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.layout_test); init(); &#125; private void init() &#123; btnTest = (Button) findViewById(R.id.btn_test); btnTest.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; // å‡è£…æ•°æ®å¤„ç† int i = 0; for (i = 0; i &lt; 10; i++) &#123; try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; // å‡è£…æ›´æ–° UI Log.d(TAG, \"Handle itï¼\" + i); &#125; &#125;); &#125;&#125; ç›´æ¥åœ¨ä¸»çº¿ç¨‹ä¸­å¤„ç†æ•°æ®ï¼Œæ¥ç€ç›´æ¥æ ¹æ®å¤„ç†ç»“æœæ›´æ–° UIã€‚æˆ‘æƒ³å¼Šç«¯å¤§å®¶éƒ½çœ‹åˆ°äº†ï¼Œå°åˆ™ UI å¡é¡¿ï¼Œå¤§åˆ™é€ æˆ ANRã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748å­çº¿ç¨‹ç‰ˆæœ¬ï¼špublic class MainActivity extends AppCompatActivity &#123; private static final String TAG = \"MainActivity\"; private Button btnTest; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.layout_test); init(); &#125; private void init() &#123; btnTest = (Button) findViewById(R.id.btn_test); btnTest.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; // å‡è£…æ•°æ®å¤„ç† int i; for (i = 0; i &lt; 10; i++) &#123; try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; // è¿”å›å¤„ç†ç»“æœ handler.sendEmptyMessage(i); &#125; &#125;).start(); &#125; &#125;); &#125; Handler handler = new Handler() &#123; @Override public void handleMessage(Message msg) &#123; // å‡è£…æ›´æ–° UI Log.d(TAG, \"Handle MSG = \" + msg.what); &#125; &#125;;&#125; è¿™æ˜¯ä¸€ç§å…¸å‹çš„å¤„ç†æ–¹å¼ï¼Œå¼€ä¸€ä¸ªå­çº¿ç¨‹å¤„ç†æ•°æ®ï¼Œé€šè¿‡ Android ä¸­æä¾›çš„ Handler æœºåˆ¶è¿›è¡Œè·¨çº¿ç¨‹é€šè®¯ï¼ŒæŠŠå¤„ç†ç»“æœè¿”å›ç»™ä¸»çº¿ç¨‹ï¼Œè¿›è€Œæ›´æ–° UIã€‚è¿™é‡Œæˆ‘ä»¬å°±æ˜¯æ¢è®¨ Handler æ˜¯å¦‚ä½•æŠŠæ•°æ®å‘é€è¿‡å»çš„ã€‚ åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬äº†è§£åˆ°çš„å°±æ˜¯ä¸€ä¸ª Handler çš„é»‘ç›’æœºåˆ¶ï¼Œå­çº¿ç¨‹å‘é€ï¼Œä¸»çº¿ç¨‹æ¥æ”¶ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ä»‹ç»ä»€ä¹ˆ ThreadLocalã€Looper å’Œ MessageQueueã€‚è€Œæ˜¯ç›´æ¥ä»ä¸Šé¢çš„ä»£ç å¼•å‡ºå®ƒä»¬çš„å­˜åœ¨ï¼Œä»åŸç†äº†è§£å®ƒä»¬å­˜åœ¨çš„å¿…è¦æ€§ï¼Œç„¶ååœ¨è°ˆå®ƒä»¬å†…éƒ¨å­˜åœ¨çš„ç»†èŠ‚ã€‚ ä¸€åˆ‡ç½ªæ¶æºäº handler.sendEmptyMessage();ï¼Œæœ€ç»ˆæ‰¾åˆ°ä»¥ä¸‹å‡½æ•° sendMessageAtTime(Message msg, long uptimeMillis)ï¼š 123456789101112131415161718192021222324252627282930Handler.class/** * Enqueue a message into the message queue after all pending messages * before the absolute time (in milliseconds) &lt;var&gt;uptimeMillis&lt;/var&gt;. * &lt;b&gt;The time-base is &#123;@link android.os.SystemClock#uptimeMillis&#125;.&lt;/b&gt; * Time spent in deep sleep will add an additional delay to execution. * You will receive it in &#123;@link #handleMessage&#125;, in the thread attached * to this handler. * * @param uptimeMillis The absolute time at which the message should be * delivered, using the * &#123;@link android.os.SystemClock#uptimeMillis&#125; time-base. * * @return Returns true if the message was successfully placed in to the * message queue. Returns false on failure, usually because the * looper processing the message queue is exiting. Note that a * result of true does not mean the message will be processed -- if * the looper is quit before the delivery time of the message * occurs then the message will be dropped. */public boolean sendMessageAtTime(Message msg, long uptimeMillis) &#123; MessageQueue queue = mQueue; if (queue == null) &#123; RuntimeException e = new RuntimeException( this + \" sendMessageAtTime() called with no mQueue\"); Log.w(\"Looper\", e.getMessage(), e); return false; &#125; return enqueueMessage(queue, msg, uptimeMillis);&#125; MessageQueue å‡ºæ¥äº†ï¼Œæˆ‘ä»¬é¿å…ä¸äº†äº†ã€‚é‡Œé¢ä¸»è¦æ˜¯ Message next() å’Œ enqueueMessage(Message msg, long when) æ–¹æ³•å€¼å¾—ç ”ç©¶ï¼Œä½†æ˜¯ç°åœ¨è¿˜ä¸æ˜¯æ—¶å€™ã€‚ ä» MessageQueue queue = mQueue; ä¸­å¯ä»¥çœ‹å‡ºæˆ‘ä»¬çš„ handler å¯¹è±¡é‡Œé¢åŒ…å«ä¸€ä¸ª mQueue å¯¹è±¡ã€‚è‡³äºé‡Œé¢å­˜çš„ä»€ä¹ˆæ€ä¹ˆåˆå§‹åŒ–çš„ç°åœ¨ä¹Ÿä¸ç”¨å¤ªå…³å¿ƒã€‚å¤§æ¦‚æœ‰ä¸ªæ¦‚å¿µå°±æ˜¯è¿™æ˜¯ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå­˜çš„æ˜¯æ¶ˆæ¯å°±è¡Œï¼Œå…·ä½“å®ç°ç»†èŠ‚åé¢ä¼šæ…¢æ…¢æ°´è½çŸ³å‡ºã€‚åé¢çš„ä»£ç å°±æ˜¯è¯´å¦‚æœ queue ä¸ºç©ºåˆ™æ‰“å° log è¿”å› falseï¼›å¦åˆ™æ‰§è¡Œ enqueueMessage(queue, msg, uptimeMillis); å…¥é˜Ÿã€‚é‚£å°±å¥½ç†è§£äº†ï¼Œhandler å‘é€ä¿¡æ¯å…¶å®æ˜¯ç›´æ¥æŠŠä¿¡æ¯å°è£…è¿›ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚ 12345678Handler.classprivate boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) &#123; msg.target = this; if (mAsynchronous) &#123; msg.setAsynchronous(true); &#125; return queue.enqueueMessage(msg, uptimeMillis);&#125; è¿™é‡Œæ¶‰åŠ Messageï¼Œå…ˆè¯´ä¸‹è¿™ä¸ªç±»çš„ä¸‰ä¸ªæˆå‘˜å˜é‡ï¼š 12345/*package*/ Handler target; /*package*/ Runnable callback; /*package*/ Message next; æ‰€ä»¥ msg.target = this; æŠŠå½“å‰ handler ä¼ ç»™äº† msgã€‚ ä¸­é—´çš„ if ä»£ç å…ˆå¿½ç•¥ï¼Œå…ˆèµ°ä¸»çº¿ï¼šæ‰§è¡Œäº† MessageQueue çš„ enqueueMessage(msg, uptimeMillis);æ–¹æ³•ã€‚æ¥ç€çœ‹æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354MessageQueue.classboolean enqueueMessage(Message msg, long when) &#123; if (msg.target == null) &#123; throw new IllegalArgumentException(\"Message must have a target.\"); &#125; if (msg.isInUse()) &#123; throw new IllegalStateException(msg + \" This message is already in use.\"); &#125; synchronized (this) &#123; if (mQuitting) &#123; IllegalStateException e = new IllegalStateException( msg.target + \" sending message to a Handler on a dead thread\"); Log.w(TAG, e.getMessage(), e); msg.recycle(); return false; &#125; msg.markInUse(); msg.when = when; Message p = mMessages; boolean needWake; if (p == null || when == 0 || when &lt; p.when) &#123; // New head, wake up the event queue if blocked. msg.next = p; mMessages = msg; needWake = mBlocked; &#125; else &#123; // Inserted within the middle of the queue. Usually we don't have to wake // up the event queue unless there is a barrier at the head of the queue // and the message is the earliest asynchronous message in the queue. needWake = mBlocked &amp;&amp; p.target == null &amp;&amp; msg.isAsynchronous(); Message prev; for (;;) &#123; prev = p; p = p.next; if (p == null || when &lt; p.when) &#123; break; &#125; if (needWake &amp;&amp; p.isAsynchronous()) &#123; needWake = false; &#125; &#125; msg.next = p; // invariant: p == prev.next prev.next = msg; &#125; // We can assume mPtr != 0 because mQuitting is false. if (needWake) &#123; nativeWake(mPtr); &#125; &#125; return true;&#125; ä»£ç æœ‰ç‚¹é•¿ï¼Œä¸å½±å“ä¸»çº¿çš„å°ç»†èŠ‚å°±ä¸ä»‹ç»äº†ï¼Œé‚£äº›ä¹Ÿå¾ˆå®¹æ˜“çœ‹æ‡‚çš„ï¼Œä½†æ˜¯åŸç†è¿˜æ˜¯å€¼å¾—åˆ†æã€‚if (mQuitting)...ï¼Œç›´æ¥çœ‹çœ‹æºç åˆå§‹åŒ–èµ‹å€¼çš„å‡½æ•°æ˜¯åœ¨ void quit(boolean safe) å‡½æ•°é‡Œé¢ï¼Œè¿™é‡ŒçŒœæµ‹å¯èƒ½æ˜¯é€€å‡ºæ¶ˆæ¯è½®è®­ï¼Œæ¶ˆæ¯è½®è®­çš„é€€å‡ºæ–¹å¼ä¹Ÿæ˜¯å€¼å¾—æ·±ç©¶ï¼Œä¸è¿‡è¿™é‡Œä¸å½±å“ä¸»çº¿å°±ä¸çœ‹äº†ã€‚ msg.markInUse(); msg.when = when; æ ‡è®°æ¶ˆæ¯åœ¨ç”¨è€Œä¸”ç»§ç»­å¡«å…… msgï¼Œä¸‹é¢å°±æ˜¯çœ‹æ³¨é‡Šäº†ã€‚æˆ‘ä»¬å‰é¢ä»‹ç»çš„ Message æˆå‘˜å˜é‡ next å°±èµ·ä½œç”¨äº†ï¼ŒæŠŠ msg é“¾åœ¨ä¸€èµ·äº†ã€‚æ‰€ä»¥è¿™é‡Œçš„æ ¸å¿ƒå°±æ˜¯æŠŠ msg ä»¥ä¸€ç§é“¾è¡¨å½¢å¼æ’è¿›å»ã€‚ä¼¼ä¹è¿™ä¸€æ³¢åˆ†æç»“æŸäº†ï¼Œåœ¨è¿™é‡Œåˆ’å¼ å›¾æ€»ç»“ä¸‹ï¼šæ¨èè‡ªå·±æ ¹æ®æ‰€è§‚å¯Ÿåˆ°çš„å˜é‡èµ‹å€¼è¿›è¡Œç»˜åˆ¶å›¾ç”»ï¼Œè¿™æ ·å°è±¡æ›´åŠ æ·±åˆ»ã€‚ OKï¼Œæ¶ˆæ¯æ˜¯å­˜è¿›å»äº†ï¼Œè€Œä¸”ä¹Ÿæ˜¯åœ¨ handler æ‰€åœ¨çš„çº¿ç¨‹ä¸­ã€‚é‚£ä¹ˆåˆ°åº•æ€ä¹ˆå–å‡ºä¿¡æ¯å‘¢ï¼Ÿä¹Ÿå°±æ˜¯å‰é¢å°ä¾‹å­ 1234567Handler handler = new Handler() &#123; @Override public void handleMessage(Message msg) &#123; // å‡è£…æ›´æ–° UI Log.d(TAG, \"Handle MSG = \" + msg.what); &#125;&#125;; handleMessage() ä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼Ÿè¿™é‡ŒåŸºæœ¬æ–­äº†çº¿ç´¢ã€‚ä½†æ˜¯å¦‚æœä½ ä¹‹å‰å“ªæ€•çœ‹è¿‡ç±»ä¼¼çš„ä¸€ç¯‡æ–‡ç« åº”è¯¥éƒ½çŸ¥é“å…¶å®åœ¨ Android å¯åŠ¨æ—¶ main å‡½æ•°å°±åšäº†ä¸€äº›æ“ä½œã€‚è¿™äº›æ“ä½œæ˜¯å¿…è¦çš„ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨å­çº¿ç¨‹ä¸­ new Handler();ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940public static void main(String[] args) &#123; Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, \"ActivityThreadMain\"); SamplingProfilerIntegration.start(); // CloseGuard defaults to true and can be quite spammy. We // disable it here, but selectively enable it later (via // StrictMode) on debug builds, but using DropBox, not logs. CloseGuard.setEnabled(false); Environment.initForCurrentUser(); // Set the reporter for event logging in libcore EventLogger.setReporter(new EventLoggingReporter()); // Make sure TrustedCertificateStore looks in the right place for CA certificates final File configDir = Environment.getUserConfigDirectory(UserHandle.myUserId()); TrustedCertificateStore.setDefaultUserDirectory(configDir); Process.setArgV0(\"&lt;pre-initialized&gt;\"); Looper.prepareMainLooper(); // -------1 ActivityThread thread = new ActivityThread(); thread.attach(false); if (sMainThreadHandler == null) &#123; sMainThreadHandler = thread.getHandler(); // -------2 &#125; if (false) &#123; Looper.myLooper().setMessageLogging(new LogPrinter(Log.DEBUG, \"ActivityThread\")); &#125; // End of event ActivityThreadMain. Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER); Looper.loop(); // -------3 throw new RuntimeException(\"Main thread loop unexpectedly exited\");&#125; å¯ä»¥çœ‹å‡ºè¿™é‡Œåœ¨è·å– sMainThreadHandler ä¹‹å‰è¿›è¡Œäº† Looper.prepareMainLooper(); æ“ä½œï¼Œä¹‹åè¿›è¡Œäº† Looper.loop(); æ“ä½œã€‚ ä¸‹é¢å¼€å§‹åˆ†æï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041Loopr.class /** Initialize the current thread as a looper. * This gives you a chance to create handlers that then reference * this looper, before actually starting the loop. Be sure to call * &#123;@link #loop()&#125; after calling this method, and end it by calling * &#123;@link #quit()&#125;. */public static void prepare() &#123; prepare(true);&#125;private static void prepare(boolean quitAllowed) &#123; if (sThreadLocal.get() != null) &#123; throw new RuntimeException(\"Only one Looper may be created per thread\"); &#125; sThreadLocal.set(new Looper(quitAllowed));&#125;/** * Initialize the current thread as a looper, marking it as an * application's main looper. The main looper for your application * is created by the Android environment, so you should never need * to call this function yourself. See also: &#123;@link #prepare()&#125; */public static void prepareMainLooper() &#123; prepare(false); synchronized (Looper.class) &#123; if (sMainLooper != null) &#123; throw new IllegalStateException(\"The main Looper has already been prepared.\"); &#125; sMainLooper = myLooper(); &#125;&#125;/** * Return the Looper object associated with the current thread. Returns * null if the calling thread is not associated with a Looper. */public static @Nullable Looper myLooper() &#123; return sThreadLocal.get();&#125; å‰ä¸¤ä¸ªæ–¹æ³•æ˜¯åœ¨è‡ªå·±åˆ›å»º Looper çš„æ—¶å€™ç”¨ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ä¸»çº¿ç¨‹è‡ªå·±ç”¨çš„ã€‚ç”±äºè¿™é‡Œæ¶ˆæ¯ä¼ é€’ä»¥ä¸»çº¿ç¨‹ä¸ºçº¿ç´¢ã€‚prepare(false);è¯´æ˜äº†è¿™æ˜¯ä¸»çº¿ç¨‹ï¼Œåœ¨ sThreadLocal.set(new Looper(quitAllowed)); ä¸­çš„ quitAllowed ä¸º false åˆ™è¯´æ˜ä¸»çº¿ç¨‹çš„ MessageQueue è½®è®­ä¸èƒ½ quitã€‚è¿™å¥ä»£ç é‡Œè¿˜æœ‰ ThreadLocal çš„ set() æ–¹æ³•ã€‚å…ˆä¸æ·±ç©¶å®ç°ï¼Œå®¹æ˜“æ™•ï¼Œè¿™é‡Œéœ€è¦çŸ¥é“çš„å°±æ˜¯æŠŠä¸€ä¸ª Looper å¯¹è±¡â€œæ”¾è¿›â€äº† ThreadLocalï¼Œæ¢å¥è¯è¯´ï¼Œé€šè¿‡ ThreadLocal å¯ä»¥è·å–ä¸åŒçš„ Looperã€‚æœ€åçš„ sThreadLocal.get(); å±•ç¤ºäº† get æ–¹æ³•ã€‚è¯´æ˜åˆ°è¿™æ—¶ Looper å·²ç»å­˜åœ¨å•¦ã€‚ç°åœ¨çœ‹çœ‹ Looper ç±»çš„æˆå‘˜å˜é‡å§ï¼ 123456Looper.classstatic final ThreadLocal&lt;Looper&gt; sThreadLocal = new ThreadLocal&lt;Looper&gt;();private static Looper sMainLooper; // guarded by Looper.classfinal MessageQueue mQueue;final Thread mThread; åœ¨è¿™é‡Œå…ˆä»‹ç»ä¸€ä¸‹ ThreadLocal çš„ä¸Šå¸è§†è§’å§ã€‚ç›´æ¥æºç ï¼Œå¯ä»¥çŒœæµ‹è¿™æ˜¯é€šè¿‡ä¸€ä¸ª ThreadLocalMap çš„å†…éƒ¨ç±»å¯¹çº¿ç¨‹è¿›è¡Œä¸€ç§ mapã€‚ä¼ è¿›æ¥çš„æ³›å‹ T æ­£æ˜¯æˆ‘ä»¬çš„ looperã€‚æ‰€ä»¥ ThreadLocal å¯ä»¥æ ¹æ®å½“å‰çº¿ç¨‹æŸ¥æ‰¾è¯¥çº¿ç¨‹çš„ Looperï¼Œå…·ä½“æ€ä¹ˆæŸ¥æ‰¾æ¨èçœ‹æºç ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚1234567891011121314151617181920212223242526272829303132333435/** * Returns the value in the current thread's copy of this * thread-local variable. If the variable has no value for the * current thread, it is first initialized to the value returned * by an invocation of the &#123;@link #initialValue&#125; method. * * @return the current thread's value of this thread-local */public T get() &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) &#123; ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) return (T)e.value; &#125; return setInitialValue();&#125; * Sets the current thread's copy of this thread-local variable * to the specified value. Most subclasses will have no need to * override this method, relying solely on the &#123;@link #initialValue&#125; * method to set the values of thread-locals. * * @param value the value to be stored in the current thread's copy of * this thread-local. */public void set(T value) &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value);&#125; åˆ†æåˆ°è¿™é‡Œï¼Œhandler å’Œ looper éƒ½æœ‰äº†ï¼Œä½†æ˜¯æ¶ˆæ¯è¿˜æ˜¯æ²¡æœ‰å–å‡ºæ¥ï¼Ÿè¿™æ˜¯çœ‹ç¬¬ä¸‰å¥ Looper.loop();ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061Looper.class/** * Run the message queue in this thread. Be sure to call * &#123;@link #quit()&#125; to end the loop. */public static void loop() &#123; final Looper me = myLooper(); if (me == null) &#123; throw new RuntimeException(\"No Looper; Looper.prepare() wasn't called on this thread.\"); &#125; final MessageQueue queue = me.mQueue; // Make sure the identity of this thread is that of the local process, // and keep track of what that identity token actually is. Binder.clearCallingIdentity(); final long ident = Binder.clearCallingIdentity(); for (;;) &#123; Message msg = queue.next(); // might block if (msg == null) &#123; // No message indicates that the message queue is quitting. return; &#125; // This must be in a local variable, in case a UI event sets the logger final Printer logging = me.mLogging; if (logging != null) &#123; logging.println(\"&gt;&gt;&gt;&gt;&gt; Dispatching to \" + msg.target + \" \" + msg.callback + \": \" + msg.what); &#125; final long traceTag = me.mTraceTag; if (traceTag != 0 &amp;&amp; Trace.isTagEnabled(traceTag)) &#123; Trace.traceBegin(traceTag, msg.target.getTraceName(msg)); &#125; try &#123; msg.target.dispatchMessage(msg); &#125; finally &#123; if (traceTag != 0) &#123; Trace.traceEnd(traceTag); &#125; &#125; if (logging != null) &#123; logging.println(\"&lt;&lt;&lt;&lt;&lt; Finished to \" + msg.target + \" \" + msg.callback); &#125; // Make sure that during the course of dispatching the // identity of the thread wasn't corrupted. final long newIdent = Binder.clearCallingIdentity(); if (ident != newIdent) &#123; Log.wtf(TAG, \"Thread identity changed from 0x\" + Long.toHexString(ident) + \" to 0x\" + Long.toHexString(newIdent) + \" while dispatching to \" + msg.target.getClass().getName() + \" \" + msg.callback + \" what=\" + msg.what); &#125; msg.recycleUnchecked(); &#125;&#125; ä¸€å¼€å§‹ä¹Ÿæ˜¯è·å– Looperï¼Œä½†æ˜¯é‚£ä¹ˆå¤š Looper æ€ä¹ˆçŸ¥é“è¿™æ˜¯å“ªä¸ª Looper å‘¢ï¼Ÿè¿™å…ˆæ”¾ç€å¾…ä¼šé©¬ä¸Šè§£é‡Šã€‚æŠŠ loop() å‡½æ•°ä¸»è¦åŠŸèƒ½ææ‡‚å†è¯´ã€‚æ¥ä¸‹æ¥å°±æ˜¯è·å– Looper ä¸­çš„ MessageQueueäº†ï¼Œç­‰ç­‰ï¼Œè¿™é‡Œæå‡ºä¸€ä¸ªç–‘é—®ï¼Œå‰é¢è¯´äº† Handler ä¸­ä¹Ÿå­˜åœ¨ MessageQueueï¼Œé‚£è¿™ä¹‹é—´å­˜åœ¨ä»€ä¹ˆå…³ç³»å—ï¼Ÿï¼ˆæœ€åä½ ä¼šå‘ç°å…¶å®æ˜¯åŒä¸€ä¸ªï¼‰å…ˆå¾€ä¸‹çœ‹ï¼Œä¸€ä¸ªæ­»å¾ªç¯ï¼Œä¹Ÿå°±æ˜¯è½®è®­æ¶ˆæ¯å–½ï¼Œä¸­é—´æœ‰ä¸€å¥ msg.target.dispatchMessage(msg); è€Œå‰é¢ä»‹ç» msg.target æ˜¯ handler å‹å‚æ•°ã€‚æ‰€ä»¥å’Œ handler è”ç³»ä¸Šäº†ã€‚ 12345678910111213141516Handler.class/** * Handle system messages here. */public void dispatchMessage(Message msg) &#123; if (msg.callback != null) &#123; handleCallback(msg); &#125; else &#123; if (mCallback != null) &#123; if (mCallback.handleMessage(msg)) &#123; return; &#125; &#125; handleMessage(msg); &#125;&#125; é€»è¾‘å¾ˆç®€å•ï¼Œæ€»ä¹‹å°±æ˜¯è°ƒåŠ¨äº†æˆ‘ä»¬é‡å†™çš„ handleMessage() æ–¹æ³•ã€‚ Step 1ï¼šLooper.prepare(); åœ¨ Looper ä¸­æœ‰ä¸€ä¸ªé™æ€å˜é‡ sThreadLocalï¼ŒæŠŠåˆ›å»ºçš„ looper â€œå­˜åœ¨â€ é‡Œé¢ï¼Œåˆ›å»º looper çš„åŒæ—¶åˆ›å»º MessageQueueï¼Œå¹¶ä¸”å’Œå½“å‰çº¿ç¨‹æŒ‚é’©ã€‚ Step 2ï¼šnew Handler(); é€šè¿‡ä¸Šå¸ ThreadLocalï¼Œå¹¶æ ¹æ®å½“å‰çº¿ç¨‹ï¼Œå¯è·å– looperï¼Œè¿›è€Œè·å– MessageQueueï¼ŒCallbackä¹‹ç±»çš„ã€‚12345678910111213141516171819202122232425262728293031323334353637Handler.class/** * Use the &#123;@link Looper&#125; for the current thread with the specified callback interface * and set whether the handler should be asynchronous. * * Handlers are synchronous by default unless this constructor is used to make * one that is strictly asynchronous. * * Asynchronous messages represent interrupts or events that do not require global ordering * with respect to synchronous messages. Asynchronous messages are not subject to * the synchronization barriers introduced by &#123;@link MessageQueue#enqueueSyncBarrier(long)&#125;. * * @param callback The callback interface in which to handle messages, or null. * @param async If true, the handler calls &#123;@link Message#setAsynchronous(boolean)&#125; for * each &#123;@link Message&#125; that is sent to it or &#123;@link Runnable&#125; that is posted to it. * * @hide */public Handler(Callback callback, boolean async) &#123; if (FIND_POTENTIAL_LEAKS) &#123; final Class&lt;? extends Handler&gt; klass = getClass(); if ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp; (klass.getModifiers() &amp; Modifier.STATIC) == 0) &#123; Log.w(TAG, \"The following Handler class should be static or leaks might occur: \" + klass.getCanonicalName()); &#125; &#125; mLooper = Looper.myLooper(); if (mLooper == null) &#123; throw new RuntimeException( \"Can't create handler inside thread that has not called Looper.prepare()\"); &#125; mQueue = mLooper.mQueue; // å‰é¢çš„ä¸¤ä¸ª MessageQueue è”ç³»èµ·æ¥äº†ï¼Œç–‘é—®å·²è§£ç­”ã€‚ mCallback = callback; mAsynchronous = async;&#125; è¿™ä¸ªå‡½æ•°å¯ä»¥è¯´æ˜åœ¨ new Handler() ä¹‹å‰è¯¥çº¿ç¨‹å¿…éœ€æœ‰ looperï¼Œæ‰€ä»¥è¦åœ¨è¿™ä¹‹å‰è°ƒç”¨ Looper.prepare();ã€‚ Step 3ï¼šLooper.loop(); è¿›è¡Œæ¶ˆæ¯å¾ªç¯ã€‚ åŸºæœ¬åˆ°è¿™é‡Œæ•´ä¸ªè¿‡ç¨‹åº”è¯¥æ˜¯æ¸…æ¥šäº†ï¼Œè¿™é‡Œæˆ‘ç”»ä¸‹æˆ‘çš„ç†è§£ã€‚ é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸€ä¸‹ handler æ˜¯æ€ä¹ˆå‡†ç¡®å‘é€ä¿¡æ¯å’Œå¤„ç†ä¿¡æ¯çš„ã€‚æ³¨æ„åœ¨ handler å‘é€ä¿¡æ¯ä¹‹å‰ï¼Œ1ã€2ã€3 æ­¥å·²ç»å®Œæˆã€‚æ‰€ä»¥è¯¥è·å–çš„çº¿ç¨‹å·²ç»è·å–ï¼Œç›´æ¥å¾€è¯¥çº¿ç¨‹æ‰€åœ¨çš„ MessageQueue é‡Œé¢å¡ä¿¡æ¯å°±è¡Œäº†ï¼Œåæ­£è¯¥ä¿¡æ¯ä¼šåœ¨è¯¥ handler æ‰€åœ¨çº¿ç¨‹çš„ looper ä¸­å¾ªç¯ï¼Œæœ€ç»ˆä¼šé€šè¿‡æ¶ˆæ¯çš„ target å‚æ•°è°ƒç”¨ dispatchMessage()ï¼Œè€Œåœ¨ dispatchMessage() ä¸­ä¼šè°ƒç”¨æˆ‘ä»¬é‡å†™çš„ handleMessage() å‡½æ•°ã€‚","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"}]},{"title":"ä¸€ä¸ªç¨‹åºå‘˜ä½¿ç”¨ PPT çš„å°æŠ€å·§","date":"2017-09-06T03:27:00.000Z","path":"2017/09/06/pptAndDev/","text":"å‰è¨€å‰æ®µæ—¶é—´ï¼Œæˆ‘å†™äº†ä¸€ç¯‡ã€Šé‡è¯» JVMã€‹ï¼Œåœ¨æ–‡ç« ä¸‹æœ‰äººè¯„è®ºé‡Œé¢çš„å›¾æ˜¯æ€ä¹ˆåšçš„ï¼Œä¸‹é¢æ˜¯æˆ‘ç»™çš„å›å¤ï¼šç„¶åæƒ³åˆ°è‡ªå·±åœ¨é˜…è¯»å…¶ä»–å¤§ç¥äº›çš„ Blog æ—¶ï¼Œä¸‹é¢ä¹Ÿæœ‰ä¸€æ‰¹äººåœ¨é—®ä½œå›¾å·¥å…·ä»€ä¹ˆçš„ã€‚ç„¶åæˆ‘å°±æƒ³æŠŠè‡ªå·±çš„å°æŠ€å·§åˆ†äº«å‡ºæ¥ï¼Œå¦‚æœ‰é›·åŒï¼Œçº¯å±å·§åˆã€‚ WHY IS PPTä½œä¸ºä¸€ä¸ªæœ‰ç‚¹è½»å¾®æ´ç™–çš„ç¨‹åºå‘˜ï¼Œè£…çš„è½¯ä»¶ç›¸åŒåŠŸèƒ½çš„åŸºæœ¬ä¸ä¼šè¶…è¿‡ä¸¤ä¸ªã€‚æ‰€ä»¥ä¸æƒ³ä¸ºå†™ Blog ç”»å›¾è€Œå†è£…ä¸€ä¸ªè½¯ä»¶ï¼Œå†è¯´å¹¶ä¸æ˜¯æ¯ç¯‡ Blog éƒ½è¦ç”»å›¾ï¼Œä½†æ˜¯è¦ç”»å›¾çš„ Blog ä¸€ç”»å°±æ˜¯åå‡ å¼ ï¼Œæ•´ç†èµ·æ¥å¾ˆä¸æ–¹ä¾¿ã€‚æ‰€ä»¥æˆ‘æƒ³åˆ°äº† PPTï¼Œåˆ†é¡µå­˜å‚¨ã€‚å…¶å®åœ¨è¿™ä¹‹å‰æˆ‘ç”¨ PPT çš„å¾ˆå¤§ä¸€åŸå› æ˜¯å†™ç®€å†ï¼Œä¹‹å‰ç®€å†æ˜¯ç”¨ Word åšçš„ï¼Œè‹¦ä¸å ªè¨€ï¼Œè€Œä¸”ç‰ˆæœ¬ä¿å­˜å¾ˆæ¶å¿ƒã€‚ã€‚ã€‚æ–‡ä»¶ä¹±çš„å¾ˆï¼Œæ‰€ä»¥æƒ³åˆ°ç”¨ PPTï¼Œæ²¡æƒ³åˆ°ç‰¹åˆ«å¥½ç”¨ã€‚ä¸‹é¢å¼€å§‹ä»‹ç»ä¸€ä¸‹æˆ‘çš„å®æ“ã€‚ å®æ“ç®€å†ç¯‡ ç¬¬ä¸€æ­¥ï¼šåˆ›å»º A4 å¤§å°çš„å¹»ç¯ç‰‡ ç¬¬äºŒæ­¥ï¼šè®¾è®¡ç®€å† è¿™é‡Œå°±æ˜¯åˆ©ç”¨æ’å…¥å½¢çŠ¶è‡ªå·±è®¾è®¡äº†ï¼ŒåŸºæœ¬å¤Ÿæ—¥å¸¸ä½¿ç”¨ï¼Œæˆ‘ä¹Ÿä¸æ˜¯ä»€ä¹ˆ PPT é«˜æ‰‹ï¼Œå¦‚æœä½ ä¼šä½¿ç”¨åŠ¨ç”»é‚£æ•ˆæœä¼°è®¡æ›´åŠ æƒŠäººã€‚ ç¬¬ä¸‰æ­¥ï¼šç‰ˆæœ¬æ§åˆ¶ åˆ©ç”¨æ³¨é‡Šï¼ ç¬¬å››æ­¥ï¼šå¯¼å‡º PDF ç›´æ¥å¦å­˜ä¸ºPDF å°±å¯ä»¥äº†ï¼Œå¾ˆç®€å•å°±ä¸æˆªå›¾äº†ã€‚ ç®¡ç†å›¾ç‰‡ç¯‡åŸºæœ¬æœ‰äº†ç»˜åˆ¶ç®€å†çš„åŸºç¡€ï¼Œé‚£ä¹ˆè¿™ä¸ªä¸åœ¨è¯ä¸‹ï¼Œå‰©ä¸‹çš„å°±æ˜¯è‡ªå·±çš„ç»˜åˆ¶æ°´å¹³é«˜ä½äº†ã€‚ è§£é‡Šä¸€ä¸‹å¦‚ä½•å¯¼å‡ºå›¾ç‰‡ï¼šç›´æ¥ å…¨é€‰ -&gt; å³é”® -&gt; å¦å­˜ä¸ºå›¾ç‰‡â€¦ æ³¨æ„è¿™é‡Œçš„ PNG å¦‚æœæ²¡æœ‰èƒŒæ™¯å›¾ç¤ºé€æ˜çš„ï¼Œæ‰€ä»¥ç»˜åˆ¶å›¾ç‰‡å‰å¯ä»¥è‡ªå·±åŠ ä¸€å±‚èƒŒæ™¯ç”»å¸ƒã€‚ æœ€åè¿™ç¯‡æ–‡ç« æœ‰ç‚¹æ°´ï¼Œä¸è¿‡å¦‚æœå¯¹å¤§å®¶èƒ½æœ‰å¸®åŠ©å°±çŸ¥è¶³äº†ã€‚ å¦‚æœä½ çœ‹åˆ°è¿™ &amp;&amp; å¦‚æœä½ æ˜¯ä¸€ä¸ªç¨‹åºå‘˜ï¼Œé‚£ä¹ˆæŒ‰ç…§å›½é™…æƒ¯ä¾‹ï¼Œæ¨èä¸€ä¸‹è‡ªå·±çš„ GitHub &amp;&amp; Blog é‡Œé¢è¿˜æ˜¯æœ‰ä¸€äº›å¹²è´§å€¼å¾—å¤§å®¶å‘ç°çš„ã€‚ å¤šè°¢é˜…è¯» ^_^","tags":[{"name":"Tips","slug":"Tips","permalink":"http://fitzeng.org/tags/Tips/"},{"name":"ppt","slug":"ppt","permalink":"http://fitzeng.org/tags/ppt/"}]},{"title":"é‡è¯» JVM","date":"2017-09-01T16:00:00.000Z","path":"2017/09/02/reJVM/","text":"ç§‹æ‹›å¼€å§‹äº†ï¼Œå‰é¢ç”±äºåšåˆ«çš„äº‹è€½è¯¯äº†åŠä¸ªæœˆï¼Œä»¥å‰å­¦çš„ä¸œè¥¿ä¸ç”¨å°±å¾ˆå®¹æ˜“å¿˜è®°ã€‚æ‰€ä»¥ï¼Œè¿™æ¬¡é‡æ–°é˜…è¯»ã€Šæ·±å…¥ç†è§£ JVM è™šæ‹Ÿæœºã€‹æ—¶ï¼Œæƒ³åšä¸€ä¸ªè®°å½•ã€‚å°†ç¢ç‰‡çš„çŸ¥è¯†æ•´åˆï¼Œæ–¹ä¾¿è‡ªå·±ä»¥åé˜…è¯»ï¼ŒåŒæ—¶ä¹Ÿå’Œå¤§å®¶ä¸€èµ·åˆ†äº«ã€‚å†…å®¹ä¸­ä¼šæ·»åŠ æˆ‘è‡ªå·±çš„ç†è§£ï¼Œå…¶ä¸­å¦‚æœæœ‰é”™è¯¯ï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ­£ã€‚ ç›¸å…³é˜…è¯»:1. é‡æ‹¾æ•°æ®ç»“æ„2. é‡æ‹¾æ“ä½œç³»ç»Ÿ3. é‡æ‹¾è®¡ç®—æœºç½‘ç»œ(æœªå®Œæˆ)ï¼‰æ³¨æ„ï¼šä»¥ä¸Šå†…å®¹ä¼šæŒç»­æ›´æ–°ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨ GitHub &amp;&amp; Blog 1. Java å†…å­˜åŒºåŸŸä¸å†…å­˜æº¢å‡ºå¼‚å¸¸1.1 è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ æ ¹æ®ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒ(Java SE 7 ç‰ˆ)ã€‹è§„å®šï¼ŒJava è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 1.1.1 ç¨‹åºè®¡æ•°å™¨ å†…å­˜ç©ºé—´å°ï¼Œçº¿ç¨‹ç§æœ‰ã€‚å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ˜¯å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡ŒæŒ‡ä»¤çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è®¡æ•°å™¨å®Œæˆ å¦‚æœçº¿ç¨‹æ­£åœ¨æ‰§è¡Œä¸€ä¸ª Java æ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼›å¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯ Native æ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨çš„å€¼åˆ™ä¸º (Undefined)ã€‚æ­¤å†…å­˜åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨ Java è™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½• OutOfMemoryError æƒ…å†µçš„åŒºåŸŸã€‚ 1.1.2 Java è™šæ‹Ÿæœºæ ˆ çº¿ç¨‹ç§æœ‰ï¼Œç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ä¸€è‡´ã€‚æè¿°çš„æ˜¯ Java æ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œæ—¶éƒ½ä¼šåºŠåˆ›å»ºä¸€ä¸ªæ ˆå¸§(Stack Frame)ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ‰§è¡Œç»“æŸï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§ä»è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚ å±€éƒ¨å˜é‡è¡¨ï¼šå­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬ç±»å‹(booleanã€byteã€charã€shortã€intã€floatã€longã€double)ã€å¯¹è±¡å¼•ç”¨(reference ç±»å‹)å’Œ returnAddress ç±»å‹(æŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€) StackOverflowErrorï¼šçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ã€‚OutOfMemoryErrorï¼šå¦‚æœè™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œè€Œæ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ã€‚ 1.1.3 æœ¬åœ°æ–¹æ³•æ ˆ åŒºåˆ«äº Java è™šæ‹Ÿæœºæ ˆçš„æ˜¯ï¼ŒJava è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³•(ä¹Ÿå°±æ˜¯å­—èŠ‚ç )æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡ã€‚ä¹Ÿä¼šæœ‰ StackOverflowError å’Œ OutOfMemoryError å¼‚å¸¸ã€‚ 1.1.4 Java å † å¯¹äºç»å¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œè¿™å—åŒºåŸŸæ˜¯ JVM æ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ã€‚çº¿ç¨‹å…±äº«ï¼Œä¸»è¦æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ã€‚å†…éƒ¨ä¼šåˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹ç§æœ‰çš„åˆ†é…ç¼“å†²åŒº(Thread Local Allocation Buffer, TLAB)ã€‚å¯ä»¥ä½äºç‰©ç†ä¸Šä¸è¿ç»­çš„ç©ºé—´ï¼Œä½†æ˜¯é€»è¾‘ä¸Šè¦è¿ç»­ã€‚ OutOfMemoryErrorï¼šå¦‚æœå †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…ï¼Œå¹¶ä¸”å †ä¹Ÿæ— æ³•å†æ‰©å±•æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚ 1.1.5 æ–¹æ³•åŒº å±äºå…±äº«å†…å­˜åŒºåŸŸï¼Œå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚ ç°åœ¨ç”¨ä¸€å¼ å›¾æ¥ä»‹ç»æ¯ä¸ªåŒºåŸŸå­˜å‚¨çš„å†…å®¹ã€‚ 1.1.6 è¿è¡Œæ—¶å¸¸é‡æ±  å±äºæ–¹æ³•åŒºä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚ç¼–è¯‘å™¨å’Œè¿è¡ŒæœŸ(String çš„ intern() )éƒ½å¯ä»¥å°†å¸¸é‡æ”¾å…¥æ± ä¸­ã€‚å†…å­˜æœ‰é™ï¼Œæ— æ³•ç”³è¯·æ—¶æŠ›å‡º OutOfMemoryErrorã€‚ 1.1.7 ç›´æ¥å†…å­˜ éè™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„éƒ¨åˆ† åœ¨ JDK 1.4 ä¸­æ–°åŠ å…¥ NIO (New Input/Output) ç±»ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäºé€šé“(Channel)å’Œç¼“å­˜(Buffer)çš„ I/O æ–¹å¼ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨ Java å †ä¸­çš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚å¯ä»¥é¿å…åœ¨ Java å †å’Œ Native å †ä¸­æ¥å›çš„æ•°æ®è€—æ—¶æ“ä½œã€‚OutOfMemoryErrorï¼šä¼šå—åˆ°æœ¬æœºå†…å­˜é™åˆ¶ï¼Œå¦‚æœå†…å­˜åŒºåŸŸæ€»å’Œå¤§äºç‰©ç†å†…å­˜é™åˆ¶ä»è€Œå¯¼è‡´åŠ¨æ€æ‰©å±•æ—¶å‡ºç°è¯¥å¼‚å¸¸ã€‚ 1.2 HotSpot è™šæ‹Ÿæœºå¯¹è±¡æ¢ç§˜ ä¸»è¦ä»‹ç»æ•°æ®æ˜¯å¦‚ä½•åˆ›å»ºã€å¦‚ä½•å¸ƒå±€ä»¥åŠå¦‚ä½•è®¿é—®çš„ã€‚ 1.2.1 å¯¹è±¡çš„åˆ›å»º åˆ›å»ºè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œå»ºè®®çœ‹ä¹¦äº†è§£ï¼Œè¿™é‡Œæä¾›ä¸ªäººçš„æ€»ç»“ã€‚ é‡åˆ° new æŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½ã€‚ç±»åŠ è½½æ£€æŸ¥é€šè¿‡ä¹‹åï¼Œä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜(å†…å­˜å¤§å°åœ¨ç±»åŠ è½½å®Œæˆåä¾¿å¯ç¡®è®¤)ã€‚åœ¨å †çš„ç©ºé—²å†…å­˜ä¸­åˆ’åˆ†ä¸€å—åŒºåŸŸ(â€˜æŒ‡é’ˆç¢°æ’-å†…å­˜è§„æ•´â€™æˆ–â€˜ç©ºé—²åˆ—è¡¨-å†…å­˜äº¤é”™â€™çš„åˆ†é…æ–¹å¼)ã€‚å‰é¢è®²çš„æ¯ä¸ªçº¿ç¨‹åœ¨å †ä¸­éƒ½ä¼šæœ‰ç§æœ‰çš„åˆ†é…ç¼“å†²åŒº(TLAB)ï¼Œè¿™æ ·å¯ä»¥å¾ˆå¤§ç¨‹åº¦é¿å…åœ¨å¹¶å‘æƒ…å†µä¸‹é¢‘ç¹åˆ›å»ºå¯¹è±¡é€ æˆçš„çº¿ç¨‹ä¸å®‰å…¨ã€‚å†…å­˜ç©ºé—´åˆ†é…å®Œæˆåä¼šåˆå§‹åŒ–ä¸º 0(ä¸åŒ…æ‹¬å¯¹è±¡å¤´)ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¡«å……å¯¹è±¡å¤´ï¼ŒæŠŠå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯å­˜å…¥å¯¹è±¡å¤´ã€‚æ‰§è¡Œ new æŒ‡ä»¤åæ‰§è¡Œ init æ–¹æ³•åæ‰ç®—ä¸€ä»½çœŸæ­£å¯ç”¨çš„å¯¹è±¡åˆ›å»ºå®Œæˆã€‚ 1.2.2 å¯¹è±¡çš„å†…å­˜å¸ƒå±€ åœ¨ HotSpot è™šæ‹Ÿæœºä¸­ï¼Œåˆ†ä¸º 3 å—åŒºåŸŸï¼šå¯¹è±¡å¤´(Header)ã€å®ä¾‹æ•°æ®(Instance Data)å’Œå¯¹é½å¡«å……(Padding) å¯¹è±¡å¤´(Header)ï¼šåŒ…å«ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ã€GC åˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹ IDã€åå‘æ—¶é—´æˆ³ç­‰ï¼Œ32 ä½è™šæ‹Ÿæœºå  32 bitï¼Œ64 ä½è™šæ‹Ÿæœºå  64 bitã€‚å®˜æ–¹ç§°ä¸º â€˜Mark Wordâ€™ã€‚ç¬¬äºŒéƒ¨åˆ†æ˜¯ç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»çš„å…ƒæ•°æ®æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚å¦å¤–ï¼Œå¦‚æœæ˜¯ Java æ•°ç»„ï¼Œå¯¹è±¡å¤´ä¸­è¿˜å¿…é¡»æœ‰ä¸€å—ç”¨äºè®°å½•æ•°ç»„é•¿åº¦çš„æ•°æ®ï¼Œå› ä¸ºæ™®é€šå¯¹è±¡å¯ä»¥é€šè¿‡ Java å¯¹è±¡å…ƒæ•°æ®ç¡®å®šå¤§å°ï¼Œè€Œæ•°ç»„å¯¹è±¡ä¸å¯ä»¥ã€‚å®ä¾‹æ•°æ®(Instance Data)ï¼šç¨‹åºä»£ç ä¸­æ‰€å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µå†…å®¹(åŒ…å«çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å’Œå­ç±»ä¸­å®šä¹‰çš„)ã€‚å¯¹é½å¡«å……(Padding)ï¼šä¸æ˜¯å¿…ç„¶éœ€è¦ï¼Œä¸»è¦æ˜¯å ä½ï¼Œä¿è¯å¯¹è±¡å¤§å°æ˜¯æŸä¸ªå­—èŠ‚çš„æ•´æ•°å€ã€‚ 1.2.3 å¯¹è±¡çš„è®¿é—®å®šä½ ä½¿ç”¨å¯¹è±¡æ—¶ï¼Œé€šè¿‡æ ˆä¸Šçš„ reference æ•°æ®æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚ é€šè¿‡å¥æŸ„è®¿é—® Java å †ä¸­ä¼šåˆ†é…ä¸€å—å†…å­˜ä½œä¸ºå¥æŸ„æ± ã€‚reference å­˜å‚¨çš„æ˜¯å¥æŸ„åœ°å€ã€‚è¯¦æƒ…è§å›¾ã€‚ ä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—® reference ä¸­ç›´æ¥å­˜å‚¨å¯¹è±¡åœ°å€ æ¯”è¾ƒï¼šä½¿ç”¨å¥æŸ„çš„æœ€å¤§å¥½å¤„æ˜¯ reference ä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡ç§»åŠ¨(GC)æ˜¯åªæ”¹å˜å®ä¾‹æ•°æ®æŒ‡é’ˆåœ°å€ï¼Œreference è‡ªèº«ä¸éœ€è¦ä¿®æ”¹ã€‚ç›´æ¥æŒ‡é’ˆè®¿é—®çš„æœ€å¤§å¥½å¤„æ˜¯é€Ÿåº¦å¿«ï¼ŒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ã€‚å¦‚æœæ˜¯å¯¹è±¡é¢‘ç¹ GC é‚£ä¹ˆå¥æŸ„æ–¹æ³•å¥½ï¼Œå¦‚æœæ˜¯å¯¹è±¡é¢‘ç¹è®¿é—®åˆ™ç›´æ¥æŒ‡é’ˆè®¿é—®å¥½ã€‚ 1.3 å®æˆ˜ // å¾…å¡« 2. åƒåœ¾å›æ”¶å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥2.1 æ¦‚è¿° ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ 3 ä¸ªåŒºåŸŸéšçº¿ç¨‹ç”Ÿç­(å› ä¸ºæ˜¯çº¿ç¨‹ç§æœ‰)ï¼Œæ ˆä¸­çš„æ ˆå¸§éšç€æ–¹æ³•çš„è¿›å…¥å’Œé€€å‡ºè€Œæœ‰æ¡ä¸ç´Šåœ°æ‰§è¡Œç€å‡ºæ ˆå’Œå…¥æ ˆæ“ä½œã€‚è€Œ Java å †å’Œæ–¹æ³•åŒºåˆ™ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ¥å£ä¸­çš„å¤šä¸ªå®ç°ç±»éœ€è¦çš„å†…å­˜å¯èƒ½ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ–¹æ³•ä¸­çš„å¤šä¸ªåˆ†æ”¯éœ€è¦çš„å†…å­˜ä¹Ÿå¯èƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬åªæœ‰åœ¨ç¨‹åºå¤„äºè¿è¡ŒæœŸæ‰çŸ¥é“é‚£äº›å¯¹è±¡ä¼šåˆ›å»ºï¼Œè¿™éƒ¨åˆ†å†…å­˜çš„åˆ†é…å’Œå›æ”¶éƒ½æ˜¯åŠ¨æ€çš„ï¼Œåƒåœ¾å›æ”¶æœŸæ‰€å…³æ³¨çš„å°±æ˜¯è¿™éƒ¨åˆ†å†…å­˜ã€‚ 2.2 å¯¹è±¡å·²æ­»å—ï¼Ÿ åœ¨è¿›è¡Œå†…å­˜å›æ”¶ä¹‹å‰è¦åšçš„äº‹æƒ…å°±æ˜¯åˆ¤æ–­é‚£äº›å¯¹è±¡æ˜¯â€˜æ­»â€™çš„ï¼Œå“ªäº›æ˜¯â€˜æ´»â€™çš„ã€‚ 2.2.1 å¼•ç”¨è®¡æ•°æ³• ç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ã€‚ä½†æ˜¯éš¾ä»¥è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚ ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœä¸ä¸‹å°å¿ƒç›´æ¥æŠŠ Obj1-reference å’Œ Obj2-reference ç½® nullã€‚åˆ™åœ¨ Java å †å½“ä¸­çš„ä¸¤å—å†…å­˜ä¾ç„¶ä¿æŒç€äº’ç›¸å¼•ç”¨æ— æ³•å›æ”¶ã€‚ 2.2.2 å¯è¾¾æ€§åˆ†ææ³• é€šè¿‡ä¸€ç³»åˆ—çš„ â€˜GC Rootsâ€™ çš„å¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å‡ºå‘æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ã€‚å½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿çš„æ—¶å€™è¯´æ˜å¯¹è±¡ä¸å¯ç”¨ã€‚ å¯ä½œä¸º GC Roots çš„å¯¹è±¡ï¼š è™šæ‹Ÿæœºæ ˆ(æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨)ä¸­å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI(å³ä¸€èˆ¬è¯´çš„ Native æ–¹æ³•) å¼•ç”¨çš„å¯¹è±¡ 2.2.3 å†è°ˆå¼•ç”¨ å‰é¢çš„ä¸¤ç§æ–¹å¼åˆ¤æ–­å­˜æ´»æ—¶éƒ½ä¸â€˜å¼•ç”¨â€™æœ‰å…³ã€‚ä½†æ˜¯ JDK 1.2 ä¹‹åï¼Œå¼•ç”¨æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œä¸‹é¢å…·ä½“ä»‹ç»ã€‚ ä¸‹é¢å››ç§å¼•ç”¨å¼ºåº¦ä¸€æ¬¡é€æ¸å‡å¼± å¼ºå¼•ç”¨ ç±»ä¼¼äº Object obj = new Object(); åˆ›å»ºçš„ï¼Œåªè¦å¼ºå¼•ç”¨åœ¨å°±ä¸å›æ”¶ã€‚ è½¯å¼•ç”¨ SoftReference ç±»å®ç°è½¯å¼•ç”¨ã€‚åœ¨ç³»ç»Ÿè¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œå°†ä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡ŒäºŒæ¬¡å›æ”¶ã€‚ å¼±å¼•ç”¨ WeakReference ç±»å®ç°å¼±å¼•ç”¨ã€‚å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†ä¹‹å‰ã€‚åœ¨åƒåœ¾æ”¶é›†å™¨å·¥ä½œæ—¶ï¼Œæ— è®ºå†…å­˜æ˜¯å¦è¶³å¤Ÿéƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚ è™šå¼•ç”¨ PhantomReference ç±»å®ç°è™šå¼•ç”¨ã€‚æ— æ³•é€šè¿‡è™šå¼•ç”¨è·å–ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ï¼Œä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„å°±æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚ 2.2.4 ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡ å³ä½¿åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿå¹¶éæ˜¯â€œfacebookâ€çš„ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å‡ºäºâ€œç¼“åˆ‘â€é˜¶æ®µï¼Œä¸€ä¸ªå¯¹è±¡çš„çœŸæ­£æ­»äº¡è‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼šå¦‚æœå¯¹è±¡åœ¨è¿›è¡Œä¸­å¯è¾¾æ€§åˆ†æåå‘ç°æ²¡æœ‰ä¸ GC Roots ç›¸è¿æ¥çš„å¼•ç”¨é“¾ï¼Œé‚£ä»–å°†ä¼šè¢«ç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ finalize() æ–¹æ³•ã€‚å½“å¯¹è±¡æ²¡æœ‰è¦†ç›– finalize() æ–¹æ³•ï¼Œæˆ–è€… finalize() æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡ï¼Œè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µéƒ½è§†ä¸ºâ€œæ²¡æœ‰å¿…è¦æ‰§è¡Œâ€ã€‚å¦‚æœè¿™ä¸ªå¯¹è±¡è¢«åˆ¤å®šä¸ºæœ‰å¿…è¦æ‰§è¡Œ finalize() æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ç«Ÿä¼šæ”¾ç½®åœ¨ä¸€ä¸ªå«åš F-Queue çš„é˜Ÿåˆ—ä¸­ï¼Œå¹¶åœ¨ç¨åç”±ä¸€ä¸ªç”±è™šæ‹Ÿæœºè‡ªåŠ¨å»ºç«‹çš„ã€ä½ä¼˜å…ˆçº§çš„ Finalizer çº¿ç¨‹å»æ‰§è¡Œå®ƒã€‚è¿™é‡Œæ‰€è°“çš„â€œæ‰§è¡Œâ€æ˜¯æŒ‡è™šæ‹Ÿæœºä¼šå‡ºå‘è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸æ‰¿è¯ºæˆ–ç­‰å¾…ä»–è¿è¡Œç»“æŸã€‚finalize() æ–¹æ³•æ˜¯å¯¹è±¡é€ƒè„±æ­»äº¡å‘½è¿çš„æœ€åä¸€æ¬¡æœºä¼šï¼Œç¨å GC å°†å¯¹ F-Queue ä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡å°è§„æ¨¡çš„æ ‡è®°ï¼Œå¦‚æœå¯¹è±¡è¦åœ¨ finalize() ä¸­æˆåŠŸæ‹¯æ•‘è‡ªå·± â€”â€” åªè¦é‡æ–°ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡ç®€å†å…³è”å³å¯ã€‚finalize() æ–¹æ³•åªä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡ã€‚ 2.2.5 å›æ”¶æ–¹æ³•åŒº åœ¨å †ä¸­ï¼Œå°¤å…¶æ˜¯åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œä¸€æ¬¡åƒåœ¾å›æ”¶ä¸€èˆ¬å¯ä»¥å›æ”¶ 70% ~ 95% çš„ç©ºé—´ï¼Œè€Œæ°¸ä¹…ä»£çš„åƒåœ¾æ”¶é›†æ•ˆç‡è¿œä½äºæ­¤ã€‚æ°¸ä¹…ä»£åƒåœ¾å›æ”¶ä¸»è¦ä¸¤éƒ¨åˆ†å†…å®¹ï¼šåºŸå¼ƒçš„å¸¸é‡å’Œæ— ç”¨çš„ç±»ã€‚ åˆ¤æ–­åºŸå¼ƒå¸¸é‡ï¼šä¸€èˆ¬æ˜¯åˆ¤æ–­æ²¡æœ‰è¯¥å¸¸é‡çš„å¼•ç”¨ã€‚åˆ¤æ–­æ— ç”¨çš„ç±»ï¼šè¦ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»å›æ”¶ï¼Œä¹Ÿå°±æ˜¯ Java å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ åŠ è½½è¯¥ç±»çš„ ClassLoader å·²ç»è¢«å›æ”¶ è¯¥ç±»å¯¹åº”çš„ java.lang.Class å¯¹è±¡æ²¡æœ‰ä»»ä½•åœ°æ–¹å‘—å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³• 2.3 åƒåœ¾å›æ”¶ç®—æ³• ä»…æä¾›æ€è·¯ 2.3.1 æ ‡è®° â€”â€” æ¸…é™¤ç®—æ³• ç›´æ¥æ ‡è®°æ¸…é™¤å°±å¯ã€‚ ä¸¤ä¸ªä¸è¶³ï¼š æ•ˆç‡ä¸é«˜ ç©ºé—´ä¼šäº§ç”Ÿå¤§é‡ç¢ç‰‡ 2.3.2 å¤åˆ¶ç®—æ³• æŠŠç©ºé—´åˆ†æˆä¸¤å—ï¼Œæ¯æ¬¡åªå¯¹å…¶ä¸­ä¸€å—è¿›è¡Œ GCã€‚å½“è¿™å—å†…å­˜ä½¿ç”¨å®Œæ—¶ï¼Œå°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šé¢ã€‚ è§£å†³å‰ä¸€ç§æ–¹æ³•çš„ä¸è¶³ï¼Œä½†æ˜¯ä¼šé€ æˆç©ºé—´åˆ©ç”¨ç‡ä½ä¸‹ã€‚å› ä¸ºå¤§å¤šæ•°æ–°ç”Ÿä»£å¯¹è±¡éƒ½ä¸ä¼šç†¬è¿‡ç¬¬ä¸€æ¬¡ GCã€‚æ‰€ä»¥æ²¡å¿…è¦ 1 : 1 åˆ’åˆ†ç©ºé—´ã€‚å¯ä»¥åˆ†ä¸€å—è¾ƒå¤§çš„ Eden ç©ºé—´å’Œä¸¤å—è¾ƒå°çš„ Survivor ç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨ Eden ç©ºé—´å’Œå…¶ä¸­ä¸€å— Survivorã€‚å½“å›æ”¶æ—¶ï¼Œå°† Eden å’Œ Survivor ä¸­è¿˜å­˜æ´»çš„å¯¹è±¡ä¸€æ¬¡æ€§å¤åˆ¶åˆ°å¦ä¸€å— Survivor ä¸Šï¼Œæœ€åæ¸…ç† Eden å’Œ Survivor ç©ºé—´ã€‚å¤§å°æ¯”ä¾‹ä¸€èˆ¬æ˜¯ 8 : 1 : 1ï¼Œæ¯æ¬¡æµªè´¹ 10% çš„ Survivor ç©ºé—´ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚æœå­˜æ´»çš„å¤§äº 10% æ€ä¹ˆåŠï¼Ÿè¿™é‡Œé‡‡ç”¨ä¸€ç§åˆ†é…æ‹…ä¿ç­–ç•¥ï¼šå¤šå‡ºæ¥çš„å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚ 2.3.3 æ ‡è®°-æ•´ç†ç®—æ³• ä¸åŒäºé’ˆå¯¹æ–°ç”Ÿä»£çš„å¤åˆ¶ç®—æ³•ï¼Œé’ˆå¯¹è€å¹´ä»£çš„ç‰¹ç‚¹ï¼Œåˆ›å»ºè¯¥ç®—æ³•ã€‚ä¸»è¦æ˜¯æŠŠå­˜æ´»å¯¹è±¡ç§»åˆ°å†…å­˜çš„ä¸€ç«¯ã€‚ 2.3.4 åˆ†ä»£å›æ”¶ æ ¹æ®å­˜æ´»å¯¹è±¡åˆ’åˆ†å‡ å—å†…å­˜åŒºï¼Œä¸€èˆ¬æ˜¯åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚ç„¶åæ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹åˆ¶å®šç›¸åº”çš„å›æ”¶ç®—æ³•ã€‚ æ–°ç”Ÿä»£ æ¯æ¬¡åƒåœ¾å›æ”¶éƒ½æœ‰å¤§é‡å¯¹è±¡æ­»å»ï¼Œåªæœ‰å°‘é‡å­˜æ´»ï¼Œé€‰ç”¨å¤åˆ¶ç®—æ³•æ¯”è¾ƒåˆç†ã€‚ è€å¹´ä»£ è€å¹´ä»£ä¸­å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜ã€æ²¡æœ‰é¢å¤–çš„ç©ºé—´åˆ†é…å¯¹å®ƒè¿›è¡Œæ‹…ä¿ã€‚æ‰€ä»¥å¿…é¡»ä½¿ç”¨ æ ‡è®° â€”â€” æ¸…é™¤ æˆ–è€… æ ‡è®° â€”â€” æ•´ç† ç®—æ³•å›æ”¶ã€‚ 2.4 HotSpot çš„ç®—æ³•å®ç° // å¾…å¡« 2.5 åƒåœ¾å›æ”¶å™¨ æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„ç†è®ºï¼Œè€Œåƒåœ¾å›æ”¶å™¨æ˜¯å†…å­˜å›æ”¶çš„å®è·µã€‚ è¯´æ˜ï¼šå¦‚æœä¸¤ä¸ªæ”¶é›†å™¨ä¹‹é—´å­˜åœ¨è¿çº¿è¯´æ˜ä»–ä»¬ä¹‹é—´å¯ä»¥æ­é…ä½¿ç”¨ã€‚ 2.5.1 Serial æ”¶é›†å™¨ è¿™æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ã€‚æ„å‘³ç€å®ƒåªä¼šä½¿ç”¨ä¸€ä¸ª CPU æˆ–ä¸€æ¡æ”¶é›†çº¿ç¨‹å»å®Œæˆæ”¶é›†å·¥ä½œï¼Œå¹¶ä¸”åœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶å¿…é¡»æš‚åœå…¶å®ƒæ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ç›´åˆ°æ”¶é›†ç»“æŸã€‚ 2.5.2 ParNew æ”¶é›†å™¨ å¯ä»¥è®¤ä¸ºæ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚ å¹¶è¡Œï¼šParallel æŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œæ­¤æ—¶ç”¨æˆ·çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ å¹¶å‘ï¼šConcurrent æŒ‡ç”¨æˆ·çº¿ç¨‹å’Œåƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œ(ä¸ä¸€å®šæ˜¯å¹¶è¡Œï¼Œæœ‰å¯èƒ½æ˜¯äº¤å‰æ‰§è¡Œ)ï¼Œç”¨æˆ·è¿›ç¨‹åœ¨è¿è¡Œï¼Œè€Œåƒåœ¾å›æ”¶çº¿ç¨‹åœ¨å¦ä¸€ä¸ª CPU ä¸Šè¿è¡Œã€‚ 2.5.3 Parallel Scavenge æ”¶é›†å™¨ è¿™æ˜¯ä¸€ä¸ªæ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œä¹Ÿæ˜¯ä½¿ç”¨å¤åˆ¶ç®—æ³•å®ç°ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¹¶è¡Œçš„å¤šçº¿ç¨‹æ”¶é›†å™¨ã€‚ CMS ç­‰æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½åœ°ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹æ‰€åœé¡¿çš„æ—¶é—´ï¼Œè€Œ Parallel Scavenge æ”¶é›†å™¨çš„ç›®çš„æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡(Throughput = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ / (è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + åƒåœ¾æ”¶é›†æ—¶é—´))ã€‚ä½œä¸ºä¸€ä¸ªååé‡ä¼˜å…ˆçš„æ”¶é›†å™¨ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´åœé¡¿æ—¶é—´ã€‚è¿™å°±æ˜¯ GC çš„è‡ªé€‚åº”è°ƒæ•´ç­–ç•¥(GC Ergonomics)ã€‚ 2.5.4 Serial Old æ”¶é›†å™¨ æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå•çº¿ç¨‹ï¼Œä½¿ç”¨ æ ‡è®° â€”â€” æ•´ç†ã€‚ 2.5.5 Parallel Old æ”¶é›†å™¨ Parallel Old æ˜¯ Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚å¤šçº¿ç¨‹ï¼Œä½¿ç”¨ æ ‡è®° â€”â€” æ•´ç† 2.5.6 CMS æ”¶é›†å™¨ CMS (Concurrent Mark Sweep) æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚åŸºäº æ ‡è®° â€”â€” æ¸…é™¤ ç®—æ³•å®ç°ã€‚ è¿ä½œæ­¥éª¤: åˆå§‹æ ‡è®°(CMS initial mark)ï¼šæ ‡è®° GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ å¹¶å‘æ ‡è®°(CMS concurrent mark)ï¼šè¿›è¡Œ GC Roots Tracing é‡æ–°æ ‡è®°(CMS remark)ï¼šä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´çš„å˜åŠ¨éƒ¨åˆ† å¹¶å‘æ¸…é™¤(CMS concurrent sweep) ç¼ºç‚¹ï¼šå¯¹ CPU èµ„æºæ•æ„Ÿã€æ— æ³•æ”¶é›†æµ®åŠ¨åƒåœ¾ã€æ ‡è®° â€”â€” æ¸…é™¤ ç®—æ³•å¸¦æ¥çš„ç©ºé—´ç¢ç‰‡ 2.5.7 G1 æ”¶é›†å™¨ é¢å‘æœåŠ¡ç«¯çš„åƒåœ¾å›æ”¶å™¨ã€‚ ä¼˜ç‚¹ï¼šå¹¶è¡Œä¸å¹¶å‘ã€åˆ†ä»£æ”¶é›†ã€ç©ºé—´æ•´åˆã€å¯é¢„æµ‹åœé¡¿ã€‚ è¿ä½œæ­¥éª¤: åˆå§‹æ ‡è®°(Initial Marking) å¹¶å‘æ ‡è®°(Concurrent Marking) æœ€ç»ˆæ ‡è®°(Final Marking) ç­›é€‰å›æ”¶(Live Data Counting and Evacuation) 2.6 å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥2.6.1 å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åˆ†é… å¯¹è±¡ä¸»è¦åˆ†é…åœ¨æ–°ç”Ÿä»£çš„ Eden åŒºä¸Šï¼Œå¦‚æœå¯åŠ¨äº†æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²åŒºï¼Œå°†çº¿ç¨‹ä¼˜å…ˆåœ¨ (TLAB) ä¸Šåˆ†é…ã€‚å°‘æ•°æƒ…å†µä¼šç›´æ¥åˆ†é…åœ¨è€å¹´ä»£ä¸­ã€‚ ä¸€èˆ¬æ¥è¯´ Java å †çš„å†…å­˜æ¨¡å‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ–°ç”Ÿä»£ GC (Minor GC) å‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶åŠ¨ä½œï¼Œé¢‘ç¹ï¼Œé€Ÿåº¦å¿«ã€‚ è€å¹´ä»£ GC (Major GC / Full GC) å‘ç”Ÿåœ¨è€å¹´ä»£çš„åƒåœ¾å›æ”¶åŠ¨ä½œï¼Œå‡ºç°äº† Major GC ç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡ Minor GC(éç»å¯¹)ã€‚Major GC çš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯” Minor GC æ…¢åå€ä»¥ä¸Šã€‚ 2.6.2 å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£2.6.3 é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£2.6.4 åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š2.6.5 ç©ºé—´åˆ†é…æ‹…ä¿3. Java å†…å­˜æ¨¡å‹ä¸çº¿ç¨‹ 3.1 Java å†…å­˜æ¨¡å‹ å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ã€‚ 3.1.1 ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜ä¹‹é—´çš„äº¤äº’ æ“ä½œ ä½œç”¨å¯¹è±¡ è§£é‡Š lock ä¸»å†…å­˜ æŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€ unlock ä¸»å†…å­˜ æŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åæ‰å¯è¢«å…¶ä»–çº¿ç¨‹é”å®š read ä¸»å†…å­˜ æŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿ load æ“ä½œä½¿ç”¨ load å·¥ä½œå†…å­˜ æŠŠ read æ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜ä¸­ use å·¥ä½œå†…å­˜ æŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œ æ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨åˆ°å˜é‡å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œ assign å·¥ä½œå†…å­˜ æŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œ æ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œ store å·¥ä½œå†…å­˜ æŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿ write æ“ä½œ write å·¥ä½œå†…å­˜ æŠŠ store æ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ 3.1.2 å¯¹äº volatile å‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™ å…³é”®å­— volatile æ˜¯ Java è™šæ‹Ÿæœºæä¾›çš„æœ€è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ã€‚ ä¸€ä¸ªå˜é‡è¢«å®šä¹‰ä¸º volatile çš„ç‰¹æ€§ï¼š ä¿è¯æ­¤å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§ã€‚ä½†æ˜¯æ“ä½œå¹¶éåŸå­æ“ä½œï¼Œå¹¶å‘æƒ…å†µä¸‹ä¸å®‰å…¨ã€‚ å¦‚æœä¸ç¬¦åˆ è¿ç®—ç»“æœå¹¶ä¸ä¾èµ–å˜é‡å½“å‰å€¼ï¼Œæˆ–è€…èƒ½å¤Ÿç¡®ä¿åªæœ‰å•ä¸€çš„çº¿ç¨‹ä¿®æ”¹å˜é‡çš„å€¼ å’Œ å˜é‡ä¸éœ€è¦ä¸å…¶ä»–çš„çŠ¶æ€å˜é‡å…±åŒå‚ä¸ä¸å˜çº¦æŸ å°±è¦é€šè¿‡åŠ é”(ä½¿ç”¨ synchronize æˆ– java.util.concurrent ä¸­çš„åŸå­ç±»)æ¥ä¿è¯åŸå­æ€§ã€‚ ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ã€‚ é€šè¿‡æ’å…¥å†…å­˜å±éšœä¿è¯ä¸€è‡´æ€§ã€‚ 3.1.3 å¯¹äº long å’Œ double å‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™ Java è¦æ±‚å¯¹äºä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜ä¹‹é—´çš„å…«ä¸ªæ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼Œä½†æ˜¯å¯¹äº 64 ä½çš„æ•°æ®ç±»å‹ï¼Œæœ‰ä¸€æ¡å®½æ¾çš„è§„å®šï¼šå…è®¸è™šæ‹Ÿæœºå°†æ²¡æœ‰è¢« volatile ä¿®é¥°çš„ 64 ä½æ•°æ®çš„è¯»å†™æ“ä½œåˆ’åˆ†ä¸ºä¸¤æ¬¡ 32 ä½çš„æ“ä½œæ¥è¿›è¡Œï¼Œå³å…è®¸è™šæ‹Ÿæœºå®ç°é€‰æ‹©å¯ä»¥ä¸ä¿è¯ 64 ä½æ•°æ®ç±»å‹çš„ loadã€storeã€read å’Œ write è¿™ 4 ä¸ªæ“ä½œçš„åŸå­æ€§ã€‚è¿™å°±æ˜¯ long å’Œ double çš„éåŸå­æ€§åå®šã€‚ 3.1.4 åŸå­æ€§ã€å¯è§æ€§ä¸æœ‰åºæ€§ å›é¡¾ä¸‹å¹¶å‘ä¸‹åº”è¯¥æ³¨æ„æ“ä½œçš„é‚£äº›ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼ŒåŒæ—¶åŠ æ·±ç†è§£ã€‚ åŸå­æ€§(Atomicity) ç”± Java å†…å­˜æ¨¡å‹æ¥ç›´æ¥ä¿è¯çš„åŸå­æ€§å˜é‡æ“ä½œåŒ…æ‹¬ readã€loadã€assignã€useã€store å’Œ writeã€‚å¤§è‡´å¯ä»¥è®¤ä¸ºåŸºæœ¬æ•°æ®ç±»å‹çš„æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚åŒæ—¶ lock å’Œ unlock å¯ä»¥ä¿è¯æ›´å¤§èŒƒå›´æ“ä½œçš„åŸå­æ€§ã€‚è€Œ synchronize åŒæ­¥å—æ“ä½œçš„åŸå­æ€§æ˜¯ç”¨æ›´é«˜å±‚æ¬¡çš„å­—èŠ‚ç æŒ‡ä»¤ monitorenter å’Œ monitorexit æ¥éšå¼æ“ä½œçš„ã€‚ å¯è§æ€§(Visibility) æ˜¯æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿèƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªé€šçŸ¥ã€‚ä¸»è¦æ“ä½œç»†èŠ‚å°±æ˜¯ä¿®æ”¹å€¼åå°†å€¼åŒæ­¥è‡³ä¸»å†…å­˜(volatile å€¼ä½¿ç”¨å‰éƒ½ä¼šä»ä¸»å†…å­˜åˆ·æ–°)ï¼Œé™¤äº† volatile è¿˜æœ‰ synchronize å’Œ final å¯ä»¥ä¿è¯å¯è§æ€§ã€‚åŒæ­¥å—çš„å¯è§æ€§æ˜¯ç”±â€œå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ unlock æ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥ä¼šä¸»å†…å­˜ä¸­( storeã€write æ“ä½œ)â€è¿™æ¡è§„åˆ™è·å¾—ã€‚è€Œ final å¯è§æ€§æ˜¯æŒ‡ï¼šè¢« final ä¿®é¥°çš„å­—æ®µåœ¨æ„é€ å™¨ä¸­ä¸€æ—¦å®Œæˆï¼Œå¹¶ä¸”æ„é€ å™¨æ²¡æœ‰æŠŠ â€œthisâ€ çš„å¼•ç”¨ä¼ é€’å‡ºå»( this å¼•ç”¨é€ƒé€¸æ˜¯ä¸€ä»¶å¾ˆå±é™©çš„äº‹æƒ…ï¼Œå…¶ä»–çº¿ç¨‹æœ‰å¯èƒ½é€šè¿‡è¿™ä¸ªå¼•ç”¨è®¿é—®åˆ°â€œåˆå§‹åŒ–äº†ä¸€åŠâ€çš„å¯¹è±¡)ï¼Œé‚£åœ¨å…¶ä»–çº¿ç¨‹ä¸­å°±èƒ½çœ‹è§ final å­—æ®µçš„å€¼ã€‚ æœ‰åºæ€§(Ordering) å¦‚æœåœ¨è¢«çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼›å¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚å‰åŠå¥æŒ‡â€œçº¿ç¨‹å†…è¡¨ç°ä¸ºä¸²è¡Œçš„è¯­ä¹‰â€ï¼ŒååŠå¥æ˜¯æŒ‡â€œæŒ‡ä»¤é‡æ’â€ç°è±¡å’Œâ€œå·¥ä½œå†…å­˜ä¸ä¸»å†…å­˜åŒæ­¥å»¶è¿Ÿâ€ç°è±¡ã€‚Java è¯­è¨€é€šè¿‡ volatile å’Œ synchronize ä¸¤ä¸ªå…³é”®å­—æ¥ä¿è¯çº¿ç¨‹ä¹‹é—´æ“ä½œçš„æœ‰åºæ€§ã€‚volatile è‡ªèº«å°±ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œè€Œ synchronize åˆ™æ˜¯ç”±â€œä¸€ä¸ªå˜é‡åœ¨åŒä¸€æ—¶åˆ»æŒ‡å…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œ lock æ“ä½œâ€è¿™æ¡è§„åˆ™è·å¾—ï¼Œè¿™æ¡è§„åˆ™å†³å®šäº†æŒæœ‰åŒä¸€ä¸ªé”çš„ä¸¤ä¸ªåŒæ­¥å—åªèƒ½ä¸²è¡Œçš„è¿›å…¥ã€‚ 3.1.5 å…ˆè¡Œå‘ç”ŸåŸåˆ™ ä¹Ÿå°±æ˜¯ happens-before åŸåˆ™ã€‚è¿™ä¸ªåŸåˆ™æ˜¯åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ç«äº‰ã€çº¿ç¨‹æ˜¯å¦å®‰å…¨çš„ä¸»è¦ä¾æ®ã€‚å…ˆè¡Œå‘ç”Ÿæ˜¯ Java å†…å­˜æ¨¡å‹ä¸­å®šä¹‰çš„ä¸¤é¡¹æ“ä½œä¹‹é—´çš„ååºå…³ç³»ã€‚ å¤©ç„¶çš„å…ˆè¡Œå‘ç”Ÿå…³ç³» è§„åˆ™ è§£é‡Š ç¨‹åºæ¬¡åºè§„åˆ™ åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ï¼Œä»£ç æŒ‰ç…§ä¹¦å†™çš„æ§åˆ¶æµé¡ºåºæ‰§è¡Œ ç®¡ç¨‹é”å®šè§„åˆ™ ä¸€ä¸ª unlock æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”çš„ lock æ“ä½œ volatile å˜é‡è§„åˆ™ volatile å˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œ çº¿ç¨‹å¯åŠ¨è§„åˆ™ Thread å¯¹è±¡çš„ start() æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œ çº¿ç¨‹ç»ˆæ­¢è§„åˆ™ çº¿ç¨‹ä¸­æ‰€æœ‰çš„æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºå¯¹æ­¤çº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹(é€šè¿‡ Thread.join() æ–¹æ³•ç»“æŸã€ Thread.isAlive() çš„è¿”å›å€¼æ£€æµ‹) çº¿ç¨‹ä¸­æ–­è§„åˆ™ å¯¹çº¿ç¨‹ interrupt() æ–¹æ³•è°ƒç”¨ä¼˜å…ˆå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿ (é€šè¿‡ Thread.interrupted() æ–¹æ³•æ£€æµ‹) å¯¹è±¡ç»ˆç»“è§„åˆ™ ä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆ(æ„é€ å‡½æ•°æ‰§è¡Œç»“æŸ)å…ˆè¡Œå‘ç”Ÿäºå®ƒçš„ finalize() æ–¹æ³•çš„å¼€å§‹ ä¼ é€’æ€§ å¦‚æœæ“ä½œ A å…ˆäº æ“ä½œ B å‘ç”Ÿï¼Œæ“ä½œ B å…ˆäº æ“ä½œ C å‘ç”Ÿï¼Œé‚£ä¹ˆæ“ä½œ A å…ˆäº æ“ä½œ C 3.2 Java ä¸çº¿ç¨‹3.2.1 çº¿ç¨‹çš„å®ç°ä½¿ç”¨å†…æ ¸çº¿ç¨‹å®ç° ç›´æ¥ç”±æ“ä½œç³»ç»Ÿå†…æ ¸æ”¯æŒçš„çº¿ç¨‹ï¼Œè¿™ç§çº¿ç¨‹ç”±å†…æ ¸å®Œæˆåˆ‡æ¢ã€‚ç¨‹åºä¸€èˆ¬ä¸ä¼šç›´æ¥å»ä½¿ç”¨å†…æ ¸çº¿ç¨‹ï¼Œè€Œæ˜¯å»ä½¿ç”¨å†…æ ¸çº¿ç¨‹çš„ä¸€ç§é«˜çº§æ¥å£ â€”â€” è½»é‡çº§è¿›ç¨‹(LWP)ï¼Œè½»é‡çº§è¿›ç¨‹å°±æ˜¯æˆ‘ä»¬é€šå¸¸æ„ä¹‰ä¸Šæ‰€è®²çš„çº¿ç¨‹ï¼Œæ¯ä¸ªè½»é‡çº§è¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå†…æ ¸çº§çº¿ç¨‹æ”¯æŒã€‚ ä½¿ç”¨ç”¨æˆ·çº¿ç¨‹å®ç° å¹¿ä¹‰ä¸Šæ¥è¯´ï¼Œåªè¦ä¸æ˜¯å†…æ ¸çº¿ç¨‹å°±å¯ä»¥è®¤ä¸ºæ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºè½»é‡çº§è¿›ç¨‹ä¹Ÿå±äºç”¨æˆ·çº¿ç¨‹ã€‚ç‹­ä¹‰ä¸Šè¯´æ˜¯å®Œå…¨å»ºç«‹åœ¨ç”¨æˆ·ç©ºé—´çš„çº¿ç¨‹åº“ä¸Šçš„å¹¶ä¸”å†…æ ¸ç³»ç»Ÿä¸å¯æ„ŸçŸ¥çš„ã€‚ ä½¿ç”¨ç”¨æˆ·çº¿ç¨‹å¤¹åŠ è½»é‡çº§è¿›ç¨‹æ··åˆå®ç° ç›´æ¥çœ‹å›¾ Java çº¿ç¨‹å®ç° å¹³å°ä¸åŒå®ç°æ–¹å¼ä¸åŒï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€æ¡ Java çº¿ç¨‹æ˜ å°„åˆ°ä¸€æ¡è½»é‡çº§è¿›ç¨‹ã€‚ 3.2.2 Java çº¿ç¨‹è°ƒåº¦ååŒå¼çº¿ç¨‹è°ƒåº¦ çº¿ç¨‹æ‰§è¡Œæ—¶é—´ç”±çº¿ç¨‹è‡ªèº«æ§åˆ¶ï¼Œå®ç°ç®€å•ï¼Œåˆ‡æ¢çº¿ç¨‹è‡ªå·±å¯çŸ¥ï¼Œæ‰€ä»¥åŸºæœ¬æ²¡æœ‰çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚åå¤„æ˜¯æ‰§è¡Œæ—¶é—´ä¸å¯æ§ï¼Œå®¹æ˜“é˜»å¡ã€‚ æŠ¢å å¼çº¿ç¨‹è°ƒåº¦ æ¯ä¸ªçº¿ç¨‹ç”±ç³»ç»Ÿæ¥åˆ†é…æ‰§è¡Œæ—¶é—´ã€‚ 3.2.3 çŠ¶æ€è½¬æ¢äº”ç§çŠ¶æ€ï¼š æ–°å»º(new) åˆ›å»ºåå°šæœªå¯åŠ¨çš„çº¿ç¨‹ã€‚ è¿è¡Œ(Runable) Runable åŒ…æ‹¬äº†æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ä¸­çš„ Running å’Œ Readyï¼Œä¹Ÿå°±æ˜¯å‡ºäºæ­¤çŠ¶æ€çš„çº¿ç¨‹æœ‰å¯èƒ½æ­£åœ¨æ‰§è¡Œï¼Œä¹Ÿæœ‰å¯èƒ½æ­£åœ¨ç­‰å¾… CPU ä¸ºä»–åˆ†é…æ—¶é—´ã€‚ æ— é™æœŸç­‰å¾…(Waiting) å‡ºäºè¿™ç§çŠ¶æ€çš„çº¿ç¨‹ä¸ä¼šè¢« CPU åˆ†é…æ—¶é—´ï¼Œå®ƒä»¬è¦ç­‰å…¶ä»–çº¿ç¨‹æ˜¾ç¤ºçš„å”¤é†’ã€‚ ä»¥ä¸‹æ–¹æ³•ä¼šç„¶çº¿ç¨‹è¿›å…¥æ— é™æœŸç­‰å¾…çŠ¶æ€ï¼š1.æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Object.wait() æ–¹æ³•ã€‚2.æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Thread.join() æ–¹æ³•ã€‚3.LookSupport.park() æ–¹æ³•ã€‚ é™æœŸç­‰å¾…(Timed Waiting) å¤„äºè¿™ç§çŠ¶æ€çš„çº¿ç¨‹ä¹Ÿä¸ä¼šåˆ†é…æ—¶é—´ï¼Œä¸è¿‡æ— éœ€ç­‰å¾…é…å…¶ä»–çº¿ç¨‹æ˜¾ç¤ºåœ°å”¤é†’ï¼Œåœ¨ä¸€å®šæ—¶é—´åä»–ä»¬ä¼šç”±ç³»ç»Ÿè‡ªåŠ¨å”¤é†’ã€‚ ä»¥ä¸‹æ–¹æ³•ä¼šè®©çº¿ç¨‹è¿›å…¥é™æœŸç­‰å¾…çŠ¶æ€ï¼š1.Thread.sleep() æ–¹æ³•ã€‚2.è®¾ç½®äº† Timeout å‚æ•°çš„ Object.wait() æ–¹æ³•ã€‚3.è®¾ç½®äº† Timeout å‚æ•°çš„ Thread.join() æ–¹æ³•ã€‚4.LockSupport.parkNanos() æ–¹æ³•ã€‚5.LockSupport.parkUntil() æ–¹æ³•ã€‚ é˜»å¡(Blocked) çº¿ç¨‹è¢«é˜»å¡äº†ï¼Œâ€œé˜»å¡çŠ¶æ€â€å’Œâ€œç­‰å¾…çŠ¶æ€â€çš„åŒºåˆ«æ˜¯ï¼šâ€œé˜»å¡çŠ¶æ€â€åœ¨ç­‰å¾…ç€è·å–ä¸€ä¸ªæ’ä»–é”ï¼Œè¿™ä¸ªæ—¶é—´å°†åœ¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ”¾å¼ƒè¿™ä¸ªé”çš„æ—¶å€™å‘ç”Ÿï¼›è€Œâ€œç­‰å¾…çŠ¶æ€â€åˆ™æ˜¯åœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œæˆ–è€…å”¤é†’åŠ¨ä½œçš„å‘ç”Ÿã€‚åœ¨ç¨‹åºç­‰å¾…è¿›å…¥åŒæ­¥åŒºåŸŸçš„æ—¶å€™ï¼Œçº¿ç¨‹å°†è¿›å…¥è¿™ç§çŠ¶æ€ã€‚ ç»“æŸ(Terminated) å·²ç»ˆæ­¢çº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€ã€‚ 4. çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ– // å¾…å¡« 5. ç±»æ–‡ä»¶ç»“æ„ // å¾…å¡« æœ‰ç‚¹æ‡’äº†ã€‚ã€‚ã€‚å…ˆè´´å‡ ä¸ªç½‘å€å§ã€‚ 1. Officialï¼šThe class File Format2.äº¦å±±: ã€ŠJavaè™šæ‹ŸæœºåŸç†å›¾è§£ã€‹ 1.1ã€classæ–‡ä»¶åŸºæœ¬ç»„ç»‡ç»“æ„ 6. è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶ è™šæ‹ŸæœºæŠŠæè¿°ç±»çš„æ•°æ®ä» Class æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è£…æ¢è§£æå’Œåˆå§‹åŒ–ï¼Œæœ€ç»ˆå½¢æˆå¯ä»¥è¢«è™šæ‹Ÿæœºç›´æ¥ä½¿ç”¨çš„ Java ç±»å‹ã€‚ åœ¨ Java è¯­è¨€ä¸­ï¼Œç±»å‹çš„åŠ è½½ã€è¿æ¥å’Œåˆå§‹åŒ–è¿‡ç¨‹éƒ½æ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸé—´å®Œæˆçš„ã€‚ 6.1 ç±»åŠ è½½æ—¶æœºç±»çš„ç”Ÿå‘½å‘¨æœŸ( 7 ä¸ªé˜¶æ®µ) å…¶ä¸­åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€åˆå§‹åŒ–å’Œå¸è½½è¿™äº”ä¸ªé˜¶æ®µçš„é¡ºåºæ˜¯ç¡®å®šçš„ã€‚è§£æé˜¶æ®µå¯ä»¥åœ¨åˆå§‹åŒ–ä¹‹åå†å¼€å§‹(è¿è¡Œæ—¶ç»‘å®šæˆ–åŠ¨æ€ç»‘å®šæˆ–æ™šæœŸç»‘å®š)ã€‚ ä»¥ä¸‹äº”ç§æƒ…å†µå¿…é¡»å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–(è€ŒåŠ è½½ã€éªŒè¯ã€å‡†å¤‡è‡ªç„¶éœ€è¦åœ¨æ­¤ä¹‹å‰å®Œæˆ)ï¼š é‡åˆ° newã€getstaticã€putstatic æˆ– invokestatic è¿™ 4 æ¡å­—èŠ‚ç æŒ‡ä»¤æ—¶æ²¡åˆå§‹åŒ–è§¦å‘åˆå§‹åŒ–ã€‚ä½¿ç”¨åœºæ™¯ï¼šä½¿ç”¨ new å…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡ã€è¯»å–ä¸€ä¸ªç±»çš„é™æ€å­—æ®µ(è¢« final ä¿®é¥°ã€å·²åœ¨ç¼–è¯‘æœŸæŠŠç»“æœæ”¾å…¥å¸¸é‡æ± çš„é™æ€å­—æ®µé™¤å¤–)ã€è°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•ã€‚ ä½¿ç”¨ java.lang.reflect åŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ã€‚ å½“åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™éœ€å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚ å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€æŒ‡å®šä¸€ä¸ªè¦åŠ è½½çš„ä¸»ç±»(åŒ…å« main() æ–¹æ³•çš„é‚£ä¸ªç±»)ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»ã€‚ å½“ä½¿ç”¨ JDK 1.7 çš„åŠ¨æ€è¯­è¨€æ”¯æŒæ—¶ï¼Œå¦‚æœä¸€ä¸ª java.lang.invoke.MethodHandle å®ä¾‹æœ€åçš„è§£æç»“æœ REF_getStaticã€REF_putStaticã€REF_invokeStatic çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¥æŸ„æ‰€å¯¹åº”çš„ç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ å‰é¢çš„äº”ç§æ–¹å¼æ˜¯å¯¹ä¸€ä¸ªç±»çš„ä¸»åŠ¨å¼•ç”¨ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæ‰€æœ‰å¼•ç”¨ç±»çš„æ–¹æ³•éƒ½ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œä½³ä½œè¢«åŠ¨å¼•ç”¨ã€‚ä¸¾å‡ ä¸ªä¾‹å­~ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public class SuperClass &#123; static &#123; System.out.println(\"SuperClass init!\"); &#125; public static int value = 1127;&#125;public class SubClass extends SuperClass &#123; static &#123; System.out.println(\"SubClass init!\"); &#125;&#125;public class ConstClass &#123; static &#123; System.out.println(\"ConstClass init!\"); &#125; public static final String HELLOWORLD = \"hello world!\"&#125;public class NotInitialization &#123; public static void main(String[] args) &#123; System.out.println(SubClass.value); /** * output : SuperClass init! * * é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å¯¹è±¡ä¸ä¼šå¯¼è‡´å­ç±»çš„åˆå§‹åŒ– * åªæœ‰ç›´æ¥å®šä¹‰è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– */ SuperClass[] sca = new SuperClass[10]; /** * output : * * é€šè¿‡æ•°ç»„å®šä¹‰æ¥å¼•ç”¨ç±»ä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ– * è™šæ‹Ÿæœºåœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºäº†ä¸€ä¸ªæ•°ç»„ç±» */ System.out.println(ConstClass.HELLOWORLD); /** * output : * * å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± å½“ä¸­ï¼Œæœ¬è´¨ä¸Šå¹¶æ²¡æœ‰ç›´æ¥å¼•ç”¨åˆ°å®šä¹‰ç±»å¸¸é‡çš„ç±»ï¼Œ * å› æ­¤ä¸ä¼šè§¦å‘å®šä¹‰å¸¸é‡çš„ç±»çš„åˆå§‹åŒ–ã€‚ * â€œhello worldâ€ åœ¨ç¼–è¯‘æœŸå¸¸é‡ä¼ æ’­ä¼˜åŒ–æ—¶å·²ç»å­˜å‚¨åˆ° NotInitialization å¸¸é‡æ± ä¸­äº†ã€‚ */ &#125;&#125; 6.2 ç±»çš„åŠ è½½è¿‡ç¨‹6.2.1 åŠ è½½ é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ¬¡ç±»çš„äºŒè¿›åˆ¶æµ(ZIP åŒ…ã€ç½‘ç»œã€è¿ç®—ç”Ÿæˆã€JSP ç”Ÿæˆã€æ•°æ®åº“è¯»å–)ã€‚ å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚ åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„ java.lang.Class å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•å»è¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚ æ•°ç»„ç±»çš„ç‰¹æ®Šæ€§ï¼šæ•°ç»„ç±»æœ¬èº«ä¸é€šè¿‡ç±»åŠ è½½å™¨åˆ›å»ºï¼Œå®ƒæ˜¯ç”± Java è™šæ‹Ÿæœºç›´æ¥åˆ›å»ºçš„ã€‚ä½†æ•°ç»„ç±»ä¸ç±»åŠ è½½å™¨ä»ç„¶æœ‰å¾ˆå¯†åˆ‡çš„å…³ç³»ï¼Œå› ä¸ºæ•°ç»„ç±»çš„å…ƒç´ ç±»å‹æœ€ç»ˆæ˜¯è¦é ç±»åŠ è½½å™¨å»åˆ›å»ºçš„ï¼Œæ•°ç»„åˆ›å»ºè¿‡ç¨‹å¦‚ä¸‹ï¼š å¦‚æœæ•°ç»„çš„ç»„ä»¶ç±»å‹æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‚£å°±é€’å½’é‡‡ç”¨ç±»åŠ è½½åŠ è½½ã€‚ å¦‚æœæ•°ç»„çš„ç»„ä»¶ç±»å‹ä¸æ˜¯å¼•ç”¨ç±»å‹ï¼ŒJava è™šæ‹Ÿæœºä¼šæŠŠæ•°ç»„æ ‡è®°ä¸ºå¼•å¯¼ç±»åŠ è½½å™¨å…³è”ã€‚ æ•°ç»„ç±»çš„å¯è§æ€§ä¸ä»–çš„ç»„ä»¶ç±»å‹çš„å¯è§æ€§ä¸€è‡´ï¼Œå¦‚æœç»„ä»¶ç±»å‹ä¸æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‚£æ•°ç»„ç±»çš„å¯è§æ€§å°†é»˜è®¤ä¸º publicã€‚ å†…å­˜ä¸­å®ä¾‹çš„ java.lang.Class å¯¹è±¡å­˜åœ¨æ–¹æ³•åŒºä¸­ã€‚ä½œä¸ºç¨‹åºè®¿é—®æ–¹æ³•åŒºä¸­è¿™äº›ç±»å‹æ•°æ®çš„å¤–éƒ¨æ¥å£ã€‚åŠ è½½é˜¶æ®µä¸è¿æ¥é˜¶æ®µçš„éƒ¨åˆ†å†…å®¹æ˜¯äº¤å‰è¿›è¡Œçš„ï¼Œä½†æ˜¯å¼€å§‹æ—¶é—´ä¿æŒå…ˆåé¡ºåºã€‚ 6.2.2 éªŒè¯ æ˜¯è¿æ¥çš„ç¬¬ä¸€æ­¥ï¼Œç¡®ä¿ Class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ã€‚ æ–‡ä»¶æ ¼å¼éªŒè¯ æ˜¯å¦ä»¥é­”æ•° 0xCAFEBABE å¼€å¤´ ä¸»ã€æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºå¤„ç†èŒƒå›´ä¹‹å†… å¸¸é‡æ± çš„å¸¸é‡æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒå¸¸é‡çš„ç±»å‹ï¼ˆæ£€æŸ¥å¸¸é‡ tag æ ‡å¿—ï¼‰ æŒ‡å‘å¸¸é‡çš„å„ç§ç´¢å¼•å€¼ä¸­æ˜¯å¦æœ‰æŒ‡å‘ä¸å­˜åœ¨çš„å¸¸é‡æˆ–ä¸ç¬¦åˆç±»å‹çš„å¸¸é‡ CONSTANT_Utf8_info å‹çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸ç¬¦åˆ UTF8 ç¼–ç çš„æ•°æ® Class æ–‡ä»¶ä¸­å„ä¸ªéƒ¨åˆ†é›†æ–‡ä»¶æœ¬èº«æ˜¯å¦æœ‰è¢«åˆ é™¤çš„é™„åŠ çš„å…¶ä»–ä¿¡æ¯ â€¦â€¦ åªæœ‰é€šè¿‡è¿™ä¸ªé˜¶æ®µçš„éªŒè¯åï¼Œå­—èŠ‚æµæ‰ä¼šè¿›å…¥å†…å­˜çš„æ–¹æ³•åŒºè¿›è¡Œå­˜å‚¨ï¼Œæ‰€ä»¥åé¢ 3 ä¸ªéªŒè¯é˜¶æ®µå…¨éƒ¨æ˜¯åŸºäºæ–¹æ³•åŒºçš„å­˜å‚¨ç»“æ„è¿›è¡Œçš„ï¼Œä¸å†ç›´æ¥æ“ä½œå­—èŠ‚æµã€‚ å…ƒæ•°æ®éªŒè¯ è¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼ˆé™¤ java.lang.Object ä¹‹å¤–ï¼‰ è¿™ä¸ªç±»çš„çˆ¶ç±»æ˜¯å¦ç»§æ‰¿äº†ä¸å…è®¸è¢«ç»§æ‰¿çš„ç±»ï¼ˆfinal ä¿®é¥°çš„ç±»ï¼‰ å¦‚æœè¿™ä¸ªç±»ä¸æ˜¯æŠ½è±¡ç±»ï¼Œæ˜¯å¦å®ç°äº†å…¶çˆ¶ç±»æˆ–æ¥å£ä¹‹ä¸­è¦æ±‚å®ç°çš„æ‰€æœ‰æ–¹æ³• ç±»ä¸­çš„å­—æ®µã€æ–¹æ³•æ˜¯å¦ä¸çˆ¶ç±»äº§ç”ŸçŸ›ç›¾ï¼ˆè¦†ç›–çˆ¶ç±» final å­—æ®µã€å‡ºç°ä¸ç¬¦åˆè§„èŒƒçš„é‡è½½ï¼‰ è¿™ä¸€é˜¶æ®µä¸»è¦æ˜¯å¯¹ç±»çš„å…ƒæ•°æ®ä¿¡æ¯è¿›è¡Œè¯­ä¹‰æ ¡éªŒï¼Œä¿è¯ä¸å­˜åœ¨ä¸ç¬¦åˆ Java è¯­è¨€è§„èŒƒçš„å…ƒæ•°æ®ä¿¡æ¯ã€‚ å­—èŠ‚ç éªŒè¯ ä¿è¯ä»»æ„æ—¶åˆ»æ“ä½œæ•°æ ˆçš„æ•°æ®ç±»å‹ä¸æŒ‡ä»¤ä»£ç åºåˆ—éƒ½é¥é…åˆå·¥ä½œï¼ˆä¸ä¼šå‡ºç°æŒ‰ç…§ long ç±»å‹è¯»ä¸€ä¸ª int å‹æ•°æ®ï¼‰ ä¿è¯è·³è½¬æŒ‡ä»¤ä¸ä¼šè·³è½¬åˆ°æ–¹æ³•ä½“ä»¥å¤–çš„å­—èŠ‚ç æŒ‡ä»¤ä¸Š ä¿è¯æ–¹æ³•ä½“ä¸­çš„ç±»å‹è½¬æ¢æ˜¯æœ‰æ•ˆçš„ï¼ˆå­ç±»å¯¹è±¡èµ‹å€¼ç»™çˆ¶ç±»æ•°æ®ç±»å‹æ˜¯å®‰å…¨çš„ï¼Œåè¿‡æ¥ä¸åˆæ³•çš„ï¼‰ â€¦â€¦ è¿™æ˜¯æ•´ä¸ªéªŒè¯è¿‡ç¨‹ä¸­æœ€å¤æ‚çš„ä¸€ä¸ªé˜¶æ®µï¼Œä¸»è¦ç›®çš„æ˜¯é€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚è¿™ä¸ªé˜¶æ®µå¯¹ç±»çš„æ–¹æ³•ä½“è¿›è¡Œæ ¡éªŒåˆ†æï¼Œä¿è¯æ ¡éªŒç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºå®‰å…¨çš„äº‹ä»¶ã€‚ ç¬¦å·å¼•ç”¨éªŒè¯ ç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å­—ç¬¦åˆ›æè¿°çš„å…¨é™å®šåæ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„ç±» åœ¨æŒ‡å®šç±»ä¸­æ˜¯å¦å­˜åœ¨ç¬¦æ–¹æ³•çš„å­—æ®µæè¿°ç¬¦ä»¥åŠç®€å•åç§°æ‰€æè¿°çš„æ–¹æ³•å’Œå­—æ®µ ç¬¦å·å¼•ç”¨ä¸­çš„ç±»ã€å­—æ®µã€æ–¹æ³•çš„è®¿é—®æ€§ï¼ˆprivateã€protectedã€publicã€defaultï¼‰æ˜¯å¦å¯è¢«å½“å‰ç±»è®¿é—® â€¦â€¦ æœ€åä¸€ä¸ªé˜¶æ®µçš„æ ¡éªŒå‘ç”Ÿåœ¨è¿…ç–¾å°†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªè½¬åŒ–åŠ¨ä½œå°†åœ¨è¿æ¥çš„ç¬¬ä¸‰é˜¶æ®µâ€”â€”è§£æé˜¶æ®µä¸­å‘ç”Ÿã€‚ç¬¦å·å¼•ç”¨éªŒè¯å¯ä»¥çœ‹åšæ˜¯å¯¹ç±»è‡ªèº«ä»¥å¤–ï¼ˆå¸¸é‡æ± ä¸­çš„å„ç§ç¬¦å·å¼•ç”¨ï¼‰çš„ä¿¡æ¯è¿›è¡ŒåŒ¹é…æ€§æ ¡éªŒï¼Œè¿˜æœ‰ä»¥ä¸ŠæåŠçš„å†…å®¹ã€‚ç¬¦å·å¼•ç”¨çš„ç›®çš„æ˜¯ç¡®ä¿è§£æåŠ¨ä½œèƒ½æ­£å¸¸æ‰§è¡Œï¼Œå¦‚æœæ— æ³•é€šè¿‡ç¬¦å·å¼•ç”¨éªŒè¯å°†æŠ›å‡ºä¸€ä¸ª java.lang.IncompatibleClass.ChangeError å¼‚å¸¸çš„å­ç±»ã€‚å¦‚ java.lang.IllegalAccessErrorã€java.lang.NoSuchFieldErrorã€java.lang.NoSuchMethodError ç­‰ã€‚ 6.2.3 å‡†å¤‡ è¿™ä¸ªé˜¶æ®µæ­£å¼ä¸ºç±»åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼ï¼Œå†…å­˜åœ¨æ–¹æ³•å»ä¸­åˆ†é…(å« static ä¿®é¥°çš„å˜é‡ä¸å«å®ä¾‹å˜é‡)ã€‚ public static int value = 1127;è¿™å¥ä»£ç åœ¨åˆå§‹å€¼è®¾ç½®ä¹‹åä¸º 0ï¼Œå› ä¸ºè¿™æ—¶å€™å°šæœªå¼€å§‹æ‰§è¡Œä»»ä½• Java æ–¹æ³•ã€‚è€ŒæŠŠ value èµ‹å€¼ä¸º 1127 çš„ putstatic æŒ‡ä»¤æ˜¯ç¨‹åºè¢«ç¼–è¯‘åï¼Œå­˜æ”¾äº clinit() æ–¹æ³•ä¸­ï¼Œæ‰€ä»¥åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šå¯¹ value è¿›è¡Œèµ‹å€¼ã€‚ åŸºæœ¬æ•°æ®ç±»å‹çš„é›¶å€¼ æ•°æ®ç±»å‹ é›¶å€¼ æ•°æ®ç±»å‹ é›¶å€¼ int 0 boolean false long 0L float 0.0f short (short) 0 double 0.0d char â€˜\\u0000â€™ reference null byte (byte) 0 ç‰¹æ®Šæƒ…å†µï¼šå¦‚æœç±»å­—æ®µçš„å­—æ®µå±æ€§è¡¨ä¸­å­˜åœ¨ ConstantValue å±æ€§ï¼Œåœ¨å‡†å¤‡é˜¶æ®µè™šæ‹Ÿæœºå°±ä¼šæ ¹æ® ConstantValue çš„è®¾ç½®å°† value èµ‹å€¼ä¸º 1127ã€‚ 6.2.4 è§£æ è¿™ä¸ªé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ ç¬¦å·å¼•ç”¨ç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥ä½¿ä»»ä½•å½¢å¼çš„å­—é¢é‡ã€‚ ç›´æ¥å¼•ç”¨ç›´æ¥å¼•ç”¨å¯ä»¥ä½¿ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚ç›´æ¥å¼•ç”¨å’Œè¿…ç–¾çš„å†…å­˜å¸ƒå±€å®ç°æœ‰å…³ è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹é™å®šç¬¦ 7 ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œï¼Œåˆ†åˆ«å¯¹åº”äºå¸¸é‡æ± çš„ 7 ä¸­å¸¸é‡ç±»å‹ã€‚ 6.2.5 åˆå§‹åŒ– å‰é¢è¿‡ç¨‹éƒ½æ˜¯ä»¥è™šæ‹Ÿæœºä¸»å¯¼ï¼Œè€Œåˆå§‹åŒ–é˜¶æ®µå¼€å§‹æ‰§è¡Œç±»ä¸­çš„ Java ä»£ç ã€‚ 6.3 ç±»åŠ è½½å™¨ é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–æè¿°æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚ 6.3.1 åŒäº²å§”æ´¾æ¨¡å‹ ä» Java è™šæ‹Ÿæœºè§’åº¦è®²ï¼Œåªå­˜åœ¨ä¸¤ç§ç±»åŠ è½½å™¨ï¼šä¸€ç§æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆC++ å®ç°ï¼Œæ˜¯è™šæ‹Ÿæœºçš„ä¸€éƒ¨åˆ†ï¼‰ï¼›å¦ä¸€ç§æ˜¯å…¶ä»–æ‰€æœ‰ç±»çš„åŠ è½½å™¨ï¼ˆJava å®ç°ï¼Œç‹¬ç«‹äºè™šæ‹Ÿæœºå¤–éƒ¨ä¸”å…¨ç»§æ‰¿è‡ª java.lang.ClassLoaderï¼‰ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ lib ä¸‹æˆ–è¢« -Xbootclasspath è·¯å¾„ä¸‹çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½ lib/ext æˆ–è€…è¢« java.ext.dirs ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„ç±» å¼•ç”¨ç¨‹åºç±»åŠ è½½å™¨ClassLoaderè´Ÿè´£ï¼ŒåŠ è½½ç”¨æˆ·è·¯å¾„ä¸Šæ‰€æŒ‡å®šçš„ç±»åº“ã€‚ é™¤é¡¶å±‚å¯åŠ¨ç±»åŠ è½½å™¨ä¹‹å¤–ï¼Œå…¶ä»–éƒ½æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚å·¥ä½œè¿‡ç¨‹ï¼šå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°ä¸€ä¸ªç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±åŠ è½½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ã€‚åªæœ‰çˆ¶ç±»æ— æ³•å®Œæˆæ—¶å­ç±»æ‰ä¼šå°è¯•åŠ è½½ã€‚ 6.3.2 ç ´ååŒäº²å§”æ´¾æ¨¡å‹ keywordï¼šçº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨(Thread Context ClassLoader) æœ€å å‰é¢ä¸¤æ¬¡ç²—ç•¥çš„é˜…è¯»ï¼Œèƒ½ç†è§£å†…å®¹ï¼Œä½†æ˜¯å¾ˆéš¾è®°ä½ç»†èŠ‚ã€‚æ¯æ¯ç¢°åˆ°ä¸ä¼šçš„çŸ¥è¯†ç‚¹å°±ä¸Šç½‘æŸ¥ï¼Œæ‰€ä»¥çŸ¥è¯†ç‚¹å¤ªç¢ç‰‡è„‘å­é‡Œæ²¡æœ‰ä½“ç³»ä¸ä»…æ›´ä¸å®¹æ˜“è®°ä½ï¼Œè€Œä¸”æ›´åŠ å®¹æ˜“æ··ä¹±ã€‚ä½†æ˜¯é€šè¿‡è¿™ç§æ–¹å¼è®°å½•å‘ç°è‡ªå·±æ¸…æ™°äº†å¾ˆå¤šï¼Œå°±ç®—ä»¥åå¿˜è®°ï¼ŒçŸ¥è¯†å†æ¬¡æ¡èµ·çš„æˆæœ¬ä¹Ÿä½äº†å¾ˆå¤šã€‚ è¿™æ¬¡è¿˜æœ‰ä¸€äº›ç« èŠ‚è™½ç„¶é˜…è¯»äº†ï¼Œä½†æ˜¯è¿˜æœªå®Œæˆè®°å½•ã€‚ç­‰è‡ªå·±ç†è§£æ·±åˆ»æœ‰ç©ºé—²äº†å°±å†æ¬¡è®°å½•ä¸‹æ¥ï¼Œè¿™é‡Œçš„å†…å®¹å‡å‡ºè‡ªå‘¨å¿—æ˜è€å¸ˆçš„ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å…¥æ‰‹çº¸è´¨ç‰ˆã€‚ å¤šè°¢é˜…è¯»","tags":[{"name":"Java","slug":"Java","permalink":"http://fitzeng.org/tags/Java/"},{"name":"JVM","slug":"JVM","permalink":"http://fitzeng.org/tags/JVM/"}]},{"title":"é‡æ‹¾è®¡ç®—æœºç½‘ç»œ","date":"2017-08-30T16:00:00.000Z","path":"2017/08/31/reCN/","text":"ä¸»è¦æ˜¯æŠŠåœ¨é‡è¯» ã€Šè®¡ç®—æœºç½‘ç»œã€‹ å’Œ ã€Šæ•°æ®é€šè®¯ä¸ç½‘ç»œã€‹ä¸­è§‰å¾—æœ‰ä»·å€¼çš„ä¸œè¥¿è®°å½•ä¸‹æ¥ã€‚ 1. è®¡ç®—æœºç½‘ç»œåŸºç¡€æ¦‚å¿µ ä¸€äº›äº’ç›¸è¿æ¥çš„ã€è‡ªæ²»çš„è®¡ç®—æœºçš„é›†åˆã€‚ 1.1 ç½‘ç»œåˆ†ç±»ä¸åŒä½œç”¨èŒƒå›´çš„ç½‘ç»œ å¹¿åŸŸç½‘ WAN (Wide Area Network) åŸåŸŸç½‘ MAN (Metropolitan Area Network) å±€åŸŸç½‘ LAN (Local Area Network) ä¸ªäººåŒºåŸŸç½‘ PAN (Personal Area Network) ä¸åŒä½¿ç”¨è€…çš„ç½‘ç»œ å…¬ç”¨ç½‘ (public network) ä¸“ç”¨ç½‘ (private network) ç”¨æ¥æŠŠç”¨æˆ·æ¥å…¥åˆ°å› ç‰¹ç½‘çš„ç½‘ç»œ æ¥å…¥ç½‘ AN (Access Network) 1.2 è®¡ç®—æœºç½‘ç»œçš„æ€§èƒ½æŒ‡æ ‡é€Ÿç‡ (bit/s)å¸¦å®½ ä¿¡å·å…·æœ‰çš„é¢‘å¸¦å®½åº¦ (xxxHZ) åœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œä»æ¥è¡¨ç¤ºé€šè®¯çº¿è·¯æ‰€èƒ½ä¼ é€æ•°æ®çš„èƒ½åŠ›ã€‚å› æ­¤ç½‘ç»œä¸­çš„å¸¦å®½è¡¨ç¤ºåœ¨å•ä½æ—¶é—´å†…ongoing ç½‘ç»œä¸­çš„æŸä¸€ç‚¹åˆ°å¦ä¸€ç‚¹æ‰€èƒ½é€šè¿‡çš„æœ€é«˜æ•°æ®ç‡ã€‚å•ä½æ˜¯æ¯”ç‰¹æ¯ç§’(b/s) ååé‡ å•ä½æ—¶é—´é€šè¿‡æŸä¸ªç½‘ç»œ(æˆ–ä¿¡é“ã€æ¥å£)çš„æ•°æ®é‡ æ—¶å»¶ æ•°æ®ä»ç½‘ç»œçš„ä¸€ç«¯å‘é€åˆ°å¦ä¸€ç«¯æ‰€éœ€çš„æ—¶é—´ æ€»å»¶æ—¶ = å‘é€æ—¶å»¶ + ä¼ æ’­æ—¶å»¶ + å¤„ç†æ—¶å»¶ + æ’é˜Ÿæ—¶å»¶ å‘é€æ—¶å»¶(ä¼ è¾“æ—¶å»¶) å‘é€æ•°æ®å¸§çš„æ—¶é—´ å‘é€æ—¶å»¶ = æ•°æ®å¸§é•¿åº¦(b) / ä¿¡é“å¸¦å®½(b/s) ä¼ æ’­æ—¶å»¶ ç”µç£æ³¢åœ¨ä¿¡é“ä¸­ä¼ æ’­ä¸€å®šè·ç¦»èŠ±è´¹çš„æ—¶é—´ ä¼ æ’­æ—¶å»¶ = ä¿¡é“é•¿åº¦(m) / ç”µç£æ³¢åœ¨ä¿¡é“ä¸Šçš„ä¼ æ’­é€Ÿç‡(m/s) å¤„ç†æ—¶å»¶ ä¸»æœºæˆ–è·¯ç”±å™¨åœ¨æ”¶åˆ°åˆ†ç»„æ—¶è¦èŠ±è´¹ä¸€å®šæ—¶é—´å¤„ç†ã€‚ æ’é˜Ÿæ—¶å»¶ åœ¨è·¯ç”±å™¨ä¸­è¾“å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…çš„æ—¶é—´ æ—¶å»¶å¸¦å®½ç§¯ ä»¥æ¯”ç‰¹ä¸ºå•ä½çš„é“¾è·¯é•¿åº¦(å¯ä»¥ç†è§£ä¸º ä½“ç§¯ = æˆªé¢ * é•¿åº¦) æ—¶å»¶å¸¦å®½ç§¯ = ä¼ æ’­æ—¶å»¶ * å¸¦å®½ å¾€è¿”æ—¶é—´ RTT (Round-Trip Time) ä»å‘é€æ–¹å‘é€æ•°æ®å¼€å§‹åˆ°å‘é€æ–¹æ¥æ”¶åˆ°æ¥è‡ªæ¥æ”¶æ–¹çš„ç¡®è®¤æ€»å…±ç»å†çš„æ—¶é—´ã€‚ åˆ©ç”¨ç‡ä¿¡é“åˆ©ç”¨ç‡ æŸä¿¡é“æœ‰ç™¾åˆ†ä¹‹å‡ çš„æ—¶é—´æ˜¯è¢«åˆ©ç”¨çš„ ç½‘ç»œåˆ©ç”¨ç‡ D0 : ç½‘ç»œç©ºé—²æ—¶çš„æ—¶å»¶ D : å½“å‰ç½‘ç»œçš„æ—¶å»¶ U : åˆ©ç”¨ç‡ D = D0 / (1 - U) 1.3 è®¡ç®—æœºç½‘ç»œçš„ä½“ç³»ç»“æ„ æ¯å±‚çš„å…·ä½“ä»‹ç»åé¢ç« èŠ‚ç»™å‡º 2. ç‰©ç†å±‚","tags":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"http://fitzeng.org/tags/è®¡ç®—æœºç½‘ç»œ/"}]},{"title":"é‡æ‹¾æ“ä½œç³»ç»Ÿ","date":"2017-08-06T16:00:00.000Z","path":"2017/08/07/reOS/","text":"ä¸»è¦æ˜¯æŠŠåœ¨é‡è¯» ã€Šç°ä»£æ“ä½œç³»ç»Ÿã€‹ ä¸­è§‰å¾—æœ‰ä»·å€¼çš„ä¸œè¥¿ï¼Œä»¥ Tips çš„å½¢å¼è®°å½•ä¸‹æ¥ã€‚ä¸å¯èƒ½é¢é¢ä¿±åˆ°ï¼Œä½†æ˜¯å¦‚æœæœ‰ä¸€å®šçš„åŸºç¡€åº”è¯¥æ˜¯ä¼šå›æƒ³èµ·å¾ˆå¤šçŸ¥è¯†çš„ã€‚å…·ä½“è§£é‡Šå°†ä¼šä»¥é“¾æ¥å½¢å¼è¡¥å……ã€‚ 1. è¿›ç¨‹ä¸çº¿ç¨‹1.1 è¿›ç¨‹ ä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒä¼ªå¹¶å‘èƒ½åŠ› è¿è¡Œæ€ : å®é™…å ç”¨ CPU èµ„æº å°±ç»ªæ€ : å¯è¿è¡Œï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰æ—¶é—´ç‰‡è€Œè¢«æš‚åœç­‰å¾… CPU é‡æ–°è°ƒåº¦ é˜»å¡æ€ : å¤–éƒ¨æŸç§äº‹ä»¶å¯¼è‡´ï¼ˆèµ„æºä¸è¶³ï¼‰ä¸å¯è¿è¡Œ CPU åˆ©ç”¨ç‡ = 1 - p ^ n p : IO ç­‰å¾…æ—¶é—´æ¯” n : è¿›ç¨‹æ•° 1.2 çº¿ç¨‹ æ¯ä¸€ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªåœ°å€ç©ºé—´å’Œä¸€ä¸ªæ§åˆ¶çº¿ç¨‹ï¼Œä¸»è¦æ˜¯ä½¿æŸä¸ªè¿›ç¨‹å†…çš„ä»»åŠ¡ä¹‹é—´ä¸è¢«ç›¸äº’é˜»å¡ï¼Œå®ç°ä¸€ç§è¿›ç¨‹å†…å¹¶è¡Œæ“ä½œçš„å‡è±¡ã€‚åˆ›å»ºé”€æ¯æ›´åŠ è½»é‡çº§ã€‚ å…±äº«ä¸€ç»„èµ„æºï¼ŒååŒå®Œæˆä»»åŠ¡ã€‚æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆåŒºï¼ˆå› ä¸ºè¦åŒºåˆ†åŒä¸€è¿›ç¨‹å†…çš„çº¿ç¨‹ï¼ŒCPU è°ƒåº¦è¦è¿›è¡ŒçŠ¶æ€çš„ä¿å­˜ï¼‰ çº¿ç¨‹æ¨¡å‹ç”¨æˆ·ç©ºé—´ä¸­å®ç°çº¿ç¨‹å†…æ ¸ä¸­å®ç°çº¿ç¨‹æ··åˆå®ç°1.3 è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰1.ç«äº‰æ¡ä»¶ ä¸¤ä¸ªæˆ–è€…å¤šä¸ªè¿›ç¨‹è¯»å†™æŸäº›å…±äº«æ•°æ® 2.ä¸´ç•ŒåŒº å°†å…±äº«å†…å­˜çš„è®¿é—®ä»£ç ç§°ä¸ºä¸´ç•ŒåŒºï¼Œç¡®ä¿åœ¨æ¯ä¸ªæ—¶åˆ»ä¸¤ä¸ªè¿›ç¨‹ä¸å¯èƒ½åŒæ—¶å¤„äºä¸´ç•ŒåŒºä¸­ï¼Œè¿™æ ·å¯ä»¥é¿å…ç«äº‰æ¡ä»¶ã€‚æ ¸å¿ƒæ€æƒ³ä¸ºäº’æ–¥ã€‚ å¹¶å‘ç¨‹åºå‡†ç¡®é«˜æ•ˆè¦æ»¡è¶³ä¸€ä¸‹å››ä¸ªæ¡ä»¶ ä»»ä½•ä¸¤ä¸ªè¿›ç¨‹ä¸èƒ½åŒæ—¶å¤„äºå…¶ä¸´ç•ŒåŒº ä¸åº”å¯¹ CPU çš„é€Ÿåº¦å’Œæ•°é‡åšä»»ä½•å‡è®¾ ä¸´ç•ŒåŒºå¤–è¿è¡Œçš„ç¨‹åºä¸å¾—é˜»å¡å…¶ä»–è¿›ç¨‹ ä¸å¾—ä½¿è¿›ç¨‹æ— é™æœŸç­‰å¾…è¿›å…¥ä¸´ç•ŒåŒº 3.å¿™ç­‰å¾…çš„äº’æ–¥ äº’æ–¥å®ç°æ–¹æ¡ˆ å±è”½ä¸­æ–­ æ¯ä¸ªè¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºåç«‹å³å±è”½æ‰€æœ‰ä¸­æ–­ï¼Œè¿™æ · CPU æ— æ³•è¿›è¡Œè¿›ç¨‹åˆ‡æ¢ï¼Œå°±è¦ç¦»å¼€ä¸´ç•ŒåŒºæ˜¯æ‰“å¼€ä¸­æ–­ã€‚ é”å˜é‡ è®¾ç½®ä¸€ä¸ªå…±äº«é”å˜é‡ï¼Œåˆå§‹å€¼ä¸º 0ã€‚å½“ä¸€ä¸ªè¿›ç¨‹æƒ³è¦è¿›å…¥ä¸´ç•ŒåŒºï¼Œå¿…é¡»æ£€æµ‹é”çš„å€¼æ˜¯å¦ä¸º 0ï¼Œæ˜¯åˆ™ç½® 1 è¿›å…¥ä¸´ç•ŒåŒºã€‚ä¸æ˜¯åˆ™ç­‰å¾…å…¶ä»–è¿›ç¨‹é€€å‡ºä¸´ç•ŒåŒºæ—¶é‡Šæ”¾é”ç›´åˆ°è‡ªå·±èƒ½è·å–åˆ°é”å¼€å§‹è¿›å…¥ä¸´ç•ŒåŒºã€‚ é”å˜é‡è¿˜æ˜¯ä¼šäº§ç”Ÿç«äº‰æ¡ä»¶ ä¸¥æ ¼è½®æ¢æ³• ä¸€ç›´å¾ªç¯ç­‰å¾…ç›´åˆ°å‡ºç°å…è®¸è¯¥è¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºçš„æ¡ä»¶æ‰å¼€å§‹è¿è¡Œï¼Œååˆ†æ¶ˆè€— CPU èµ„æºã€‚ é¿å…äº†ç«äº‰æ¡ä»¶ï¼Œä½†æ˜¯ä¸´ç•ŒåŒºå¤–è¿è¡Œçš„ç¨‹åºä¼šå‘ç”Ÿé˜»å¡ ç”¨äºå¿™ç­‰å¾…çš„é”ç§°ä¸ºè‡ªæ—‹é”ã€‚ 123456789101112131415A:while (TRUE) &#123; while (turn != 0); critical_region(); turn = 1; noncritical_region();&#125;B:while (TRUE) &#123; while (turn != 1); critical_region(); turn = 0; noncritical_region();&#125; Peterson è§£æ³• ä¸€ç§äº’æ–¥ç®—æ³• 12345678910111213141516171819#define FALSE 0#define TRUE 1#define N 2int turn;int interested[N];void enter_region(int process) &#123; int other; other = 1 - process; interested[process] = TRUE; turn = process; // å¦‚æœæœ‰å¦ä¸€ä¸ªç¨‹åºè¿›å…¥ä¸´ç•ŒåŒºçš„è¯åˆ™ä¸€ç›´ç©ºå¾ªç¯ while (turn == process &amp;&amp; interested[other] == TRUE);&#125;void leave_region(int process) &#123; interested[process] = FALSE;&#125; 4.ç¡çœ ä¸å”¤é†’ å‰é¢çš„å¼Šç«¯æ˜¯å¿™ç­‰å¾…ä¼šæ¶ˆè€— CPU èµ„æºã€‚å¦‚æœåœ¨ç­‰å¾…è¿›å…¥ä¸´ç•ŒåŒºæ—¶å¯ä»¥æŒ‚èµ·ï¼Œç­‰åˆ°æŸä¸ªä¿¡å·åˆ°è¾¾å†å”¤é†’å°±å¯ä»¥é¿å…è¿™ç§æƒ…å†µäº†ã€‚ ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ åˆ©ç”¨èµ„æºç¼“å†²åŒºå®ç°è¿›ç¨‹é—´çš„åè°ƒ 1234567891011121314151617181920212223242526272829303132#define N 100 int count = 0;void producer(void) &#123; int item; while (TURE) &#123; item = produce_item(); if (count == N) &#123; sleep(); &#125; insert_item(item); count = count + 1; if (count == 1) &#123; wakeup(consumer); &#125; &#125;&#125;void consumer(void) &#123; int item; while (TURE) &#123; if (count == 0) &#123; sleep(); &#125; item = remove_item(); count = count - 1; if (count == N - 1) &#123; wakeup(producer); &#125; consume_item(item); &#125;&#125; 5.ä¿¡å·é‡ å¼•å…¥ä¸€ä¸ªä¿¡å·é‡æ¥ç´¯è®¡å”¤é†’æ¬¡æ•°ï¼Œå¯ä»¥ä¸º 0 æˆ–æ­£æ•° ä½¿ç”¨ down å’Œ up æ“ä½œä»£æ›¿ sleep å’Œ wakeup #define N 100 typedef int semaphore semaphore mutex = 1; // æ§åˆ¶å¯¹ä¸´ç•ŒåŒºçš„è®¿é—® semaphore empty = N; // è®¡æ•°ç¼“å†²åŒºçš„ç©ºæ§½æ•°ç›® semaphore full = 0; // è®¡æ•°ç¼“å†²åŒºçš„æ»¡æ§½æ•°ç›® void producer(void) { int item; while (TRUE) { utem = produce_item(); down(&amp;empty); down(&amp;mutex); insert_item(item); up(&amp;mutex); up(&amp;full); } } void consumer(void) { int item; while (TRUE) { down(&amp;full); down(&amp;mutex); item = remove_item(); up(&amp;mutex); up(&amp;empty); consume_item(item); } } mutex : ç”¨äºäº’æ–¥ï¼Œä¿è¯ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹è¯»å†™ç¼“å†²åŒº full &amp;&amp; empty : å®ç°åŒæ­¥ï¼Œä¿è¯æŸç§æ—¶é—´çš„é¡ºåºå‘ç”Ÿæˆ–è€…ä¸å‘ç”Ÿ 6.äº’æ–¥é‡ ä»…ä»…é€‚ç”¨äºç®¡ç†å…±äº«èµ„æºæˆ–ä¸€å°æ®µä»£ç  7.ç®¡ç¨‹8.æ¶ˆæ¯ä¼ é€’9.å±éšœ1.4 è°ƒåº¦ å½“æœ‰å¤šä¸ªè¿›ç¨‹å¤„äºå°±ç»ªæ€æ—¶å°±é¢ä¸´è°ƒåº¦çš„é€‰æ‹©ã€‚å†…æ ¸ç®¡ç†çº¿ç¨‹æ—¶è°ƒåº¦å¯ä»¥è®¤ä¸ºæ˜¯çº¿ç¨‹çº§åˆ«çš„ã€‚è¿›ç¨‹è¡Œä¸ºæœ‰ è®¡ç®—å¯†é›†å‹ å’Œ I/O å¯†é›†å‹ã€‚è€Œç°åœ¨ç”±äº CPU æ”¹è¿›é€Ÿåº¦åŠ å¿«ï¼Œè¿›ç¨‹è¡Œä¸ºæ›´å€¾å‘äºåè€…ï¼Œæ‰€ä»¥åº”è¯¥å¤šè¿è¡Œè¯¥ç±»è¿›ç¨‹ä¿æŒ CPU çš„åˆ©ç”¨ç‡ã€‚ è°ƒåº¦ç®—æ³• æ‰¹å¤„ç† å…ˆæ¥å…ˆæœåŠ¡ æœ€çŸ­ä½œä¸šä¼˜å…ˆ æœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ äº¤äº’å¼ è½®è½¬è°ƒåº¦ï¼ˆæ¯ä¸ªè¿›ç¨‹ä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œç”¨å®Œå°±è½®è½¬ï¼‰ ä¼˜å…ˆçº§è°ƒåº¦ å¤šçº§é˜Ÿåˆ— æœ€çŸ­è¿›ç¨‹ä¼˜å…ˆ ï¼ˆaT0 + (1 - a)T1ï¼‰ ä¿è¯ä¼˜å…ˆ å½©ç¥¨è°ƒåº¦ å…¬å¹³åˆ†äº«è°ƒåº¦ å®æ—¶ çº¿ç¨‹è°ƒåº¦ å’Œç³»ç»Ÿæ”¯æŒçš„çº¿ç¨‹å®ç°æ–¹å¼æœ‰å…³ï¼ˆç†è§£ : çº¿ç¨‹è¡¨å­˜åœ¨å“ªçš„åŒºåˆ«ï¼‰ ç”¨æˆ·çº§çº¿ç¨‹ : å†…æ ¸å¹¶ä¸çŸ¥é“ï¼Œå†…æ ¸åªæ˜¯é€‰ä¸­è¯¥è¿›ç¨‹ï¼Œè‡³äºè¿›ç¨‹ä¸­è·‘å“ªä¸ªçº¿ç¨‹ç”±ç”¨æˆ·æ€è°ƒåº¦å†³å®šã€‚å†…æ ¸çº§çº¿ç¨‹ : ç›´æ¥è°ƒåº¦æŸä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹ã€‚ä»¥ä¸Šä¸¤ç§æ–¹å¼åœ¨æ€§èƒ½ä¸Šæœ‰ä¸»è¦å·®åˆ« : å‰é¢æåŠ I/O æ“ä½œå…¶å®æ˜¯å¾ˆè€—æ—¶çš„ï¼Œæ‰€ä»¥åœ¨è¿›ç¨‹é—´åˆ‡æ¢æ¯”åœ¨çº¿ç¨‹é—´åˆ‡æ¢æ›´åŠ è€—æ—¶ã€‚å› ä¸ºçº¿ç¨‹è½»é‡ï¼Œè€Œè¿›ç¨‹å®Œæˆåˆ‡æ¢è¦å®Œæ•´çš„å±±ä¸‹æ–‡åˆ‡æ¢ï¼Œä¿®æ”¹å†…å­˜æ˜ åƒã€‚è€Œä¸”åŒä¸€è¿›ç¨‹å†…çš„çº¿ç¨‹ I/O è®¿é—® cache çš„å±€éƒ¨æ€§æ›´é«˜ï¼Œä¸åŒè¿›ç¨‹é—´åˆ‡æ¢çš„æ¸…ç†ç¼“å­˜ï¼Œè¿™ä¹Ÿä¼šæ¶ˆè€—æ—¶é—´ã€‚ 2. å­˜å‚¨ç®¡ç† ä¸»è¦æ€æƒ³å°±æ˜¯å†…å­˜æŠ½è±¡ 2.1 ç©ºé—²å†…å­˜ç®¡ç†ä½¿ç”¨ä½å›¾çš„å­˜å‚¨ç®¡ç†ä½¿ç”¨é“¾è¡¨çš„å­˜å‚¨ç®¡ç†2.2 è™šæ‹Ÿå†…å­˜ ç¨‹åºäº§ç”Ÿçš„åœ°å€ä¸ºè™šæ‹Ÿåœ°å€ï¼Œåœ¨æ²¡æœ‰è™šæ‹Ÿå†…å­˜çš„æ“ä½œç³»ç»Ÿä¸Šï¼Œç›´æ¥å°†åœ°å€è¾“é€åˆ°å†…å­˜æ€»çº¿ä¸Šã€‚è€Œæœ‰è™šæ‹Ÿå†…å­˜çš„æ“ä½œç³»ç»Ÿä¸Šï¼ŒæŠŠè™šæ‹Ÿåœ°å€è¾“é€åˆ° MMUï¼ˆMemory Management Unitï¼‰ï¼Œç”± MMU å°†è™šæ‹Ÿåœ°å€æ˜ å°„ä¸ºä¸ºç‰©ç†åœ°å€ã€‚ åˆ†é¡µè™šæ‹Ÿåœ°å€ç©ºé—´ : é¡µé¢ ç‰©ç†å†…å­˜åœ°å€ : å¶æ¡† 4kå¤§å° è™šæ‹Ÿåœ°å€ = è™šæ‹Ÿé¡µå·(é«˜ä½) + åç§»é‡(ä½ä½) é¡µè¡¨ : æŠŠè™šæ‹Ÿåœ°å€çš„é¡µé¢æ˜ å°„ä¸ºé¡µæ¡†ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é¡µè¡¨ åŠ é€Ÿåˆ†é¡µæ–¹æ³• : è½¬æ¢æ£€æµ‹ç¼“å†²åŒºï¼ˆTLBï¼‰ä¸»è¦æ˜¯ä¼˜å…ˆåœ¨ TLB ä¸­æŸ¥æ‰¾é¡µé¢å·ã€‚ å¤§å†…å­˜é¡µè¡¨ å¤šçº§é¡µè¡¨ å€’æ’é¡µè¡¨ : æ¯ä¸ªé¡µæ¡†ä¸€ä¸ªè¡¨é¡¹ + TLB å¿«è¡¨ 2.3 é¡µé¢ç½®æ¢ç®—æ³• æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•ä¸å¯å®ç°ï¼Œå› ä¸ºæ— æ³•ç¡®å®šæœªæ¥ã€‚ 1.æœ€è¿‘æœªä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•(NRU) è®¾ç½®è®¿é—®ï¼ˆè¯»ã€å†™ï¼‰ä½ Rï¼Œé¡µé¢ä¿®æ”¹ä½ Mã€‚ 2.å…ˆè¿›å…ˆå‡ºé¡µé¢ç½®æ¢ç®—æ³•(FIFO)3.ç¬¬äºŒæ¬¡æœºä¼šé¡µé¢ç½®æ¢ç®—æ³• è®¾ç½®ä¸€ä¸ªæ£€æµ‹æœ€è€é¡µé¢ä½ R 4.æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³• é“¾è¡¨å®ç°é¡µé¢é€‰æ‹© 5.æœ€è¿‘æœ€å°‘ä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•(LRU) åˆ©ç”¨çŸ©é˜µæ¨¡æ‹Ÿ : å¢åŠ è‡ªèº«æƒé‡å‡å°‘å…¶ä»–æƒé‡ï¼Œè¡Œç½® 1ï¼Œåˆ—ç½® 0ã€‚ 6.ç”¨è½¯ä»¶æ¨¡æ‹Ÿ LRU è€åŒ–ç®—æ³• 7.å·¥ä½œé›†é¡µé¢ç½®æ¢ç®—æ³•8.å·¥ä½œé›†æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³• ç®—æ³• æ³¨é‡Š æœ€ä¼˜ç®—æ³• ä¸å¯å®ç°ï¼Œä½†å¯ä½œä¸ºåŸºå‡† NRU(æœ€è¿‘æœªä½¿ç”¨)ç®—æ³• LRU çš„å¾ˆç²—ç³™è¿‘ä¼¼ FIFO(å…ˆè¿›å…ˆå‡º)ç®—æ³• å¯èƒ½æŠ›å¼ƒé‡è¦é¡µé¢ ç¬¬äºŒæ¬¡æœºä¼šç®—æ³• æ¯” FIFO æœ‰å¤§çš„æ”¹å–„ æ—¶é’Ÿç®—æ³• ç°å®çš„ LRU(æœ€è¿‘æœ€å°‘ä½¿ç”¨)ç®—æ³• å¾ˆä¼˜ç§€ï¼Œä½†å¾ˆéš¾å®ç° NFU(æœ€ä¸ç»å¸¸ä½¿ç”¨)ç®—æ³• LRU çš„ç›¸å¯¹ç²—ç•¥çš„è¿‘ä¼¼ è€åŒ–ç®—æ³• éå¸¸è¿‘ä¼¼ LRU çš„æœ‰æ•ˆç®—æ³• å·¥ä½œé›†ç®—æ³• å®ç°èµ·æ¥å¼€é”€å¾ˆå¤§ å·¥ä½œé›†æ—¶é’Ÿç®—æ³• å¥½çš„æœ‰æ•ˆç®—æ³• 2.4 å†…å­˜æ˜ å°„æ–‡ä»¶ è¿›ç¨‹å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼ŒæŠŠæ–‡ä»¶æ˜ å°„åˆ°å…¶è™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¸€éƒ¨åˆ†ã€‚ä¸€èˆ¬å®ç°æ˜¯å¼€å§‹ä¸åŠ è½½ï¼Œåœ¨ç¨‹åºè®¿é—®æ—¶åœ¨æŒ‰é¡µåŠ è½½ã€‚ // Linux å¾…å¡« 2.5 å®ç°åˆ†é¡µå·¥ä½œ è¿›ç¨‹åˆ›å»ºæ—¶ : æ“ä½œç³»ç»Ÿè¦ç¡®å®šç¨‹åºå’Œæ•°æ®åœ¨åˆå§‹æ—¶æœ‰å¤šå¤§ï¼Œå¹¶ä¸ºå®ƒä»¬åˆ›å»ºä¸€ä¸ªé¡µè¡¨ï¼Œæ“ä½œç³»ç»Ÿè¿˜è¦åœ¨å†…å­˜ä¸­ä¸ºé¡µè¡¨åˆ†é…ç©ºé—´å¹¶å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ã€‚ è¿›ç¨‹è¿è¡Œæ—¶ : é¡µè¡¨å¿…é¡»åœ¨å†…å­˜ä¸­(åä¹‹ä¸éœ€è¦)ï¼Œå¹¶ä¸”åœ¨ç£ç›˜äº¤æ¢åŒºä¸­åˆ†é…ç©ºé—´ã€‚ è°ƒåº¦ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œæ—¶ : ä¸ºæ–°è¿›ç¨‹å……å€¼ MMUï¼Œåˆ·æ–° TLBï¼Œæ›´æ¢é¡µè¡¨ã€‚ ç¼ºé¡µä¸­æ–­å‘ç”Ÿæ—¶ : æ“ä½œç³»ç»Ÿå¿…é¡»é€šè¿‡è¯»ç¡¬ä»¶å¯„å­˜å™¨ç¡®å®šæ˜¯å“ªä¸ªè™šæ‹Ÿåœ°å€é€ æˆäº†ç¼ºé¡µä¸­æ–­é€šè¿‡è¯¥ä¿¡æ¯è®¡ç®—éœ€è¦å“ªä¸ªé¡µé¢ï¼Œå®šä½ç£ç›˜ä½ç½®å¹¶æ‰¾åˆ°åˆé€‚çš„é¡µæ¡†æ¥å­˜æ”¾æ–°é¡µé¢ï¼Œå¿…è¦çš„è¯è¦ç½®æ¢è€é¡µé¢ï¼Œç„¶åæŠŠæ‰€éœ€é¡µé¢è¯»å…¥é¡µæ¡†ã€‚æœ€åï¼Œå¤‡ä»½ç¨‹åºè®¡æ•°å™¨ï¼Œæ˜¯ç¨‹åºè®¡æ•°å™¨æŒ‡å‘å¼•èµ·ç¼ºé¡µä¸­æ–­çš„æŒ‡ä»¤ï¼Œå¹¶é‡æ–°æ‰§è¡Œè¯¥æŒ‡ä»¤ã€‚ è¿›ç¨‹é€€å‡ºæ—¶ : é‡Šæ”¾é¡µè¡¨ï¼Œé¡µé¢å’Œé¡µé¢åœ¨ç¡¬ç›˜ä¸Šå çš„ç©ºé—´ã€‚ ç¼ºé¡µä¸­æ–­å¤„ç† ç¡¬ä»¶é™·å…¥å†…æ ¸ï¼Œåœ¨å †æ ˆä¸­ä¿å­˜ç¨‹åºè®¡æ•°å™¨ã€‚å¤§å¤šæ•°æœºå™¨å°†å½“å‰çš„æŒ‡ä»¤çš„å„ç§çŠ¶æ€ä¿¡æ¯ä¿å­˜åœ¨ç‰¹æ®Šçš„ CPU å¯„å­˜å™¨ä¸­ã€‚ å¯åŠ¨ä¸€ä¸ªæ±‡ç¼–ä»£ç ä¾‹ç¨‹ä¿å­˜é€šç”¨å¯„å­˜å™¨å’Œå…¶ä»–æ˜“å¤±ä¿¡æ¯ï¼Œä»¥å…è¢«æ“ä½œç³»ç»Ÿç ´åã€‚è¿™ä¸ªä¾‹ç¨‹å°†æ“ä½œç³»ç»Ÿåšä¸ºä¸€ä¸ªå‡½æ•°æ¥è°ƒç”¨ã€‚ å½“æ“ä½œç³»ç»Ÿå‘ç°ä¸€ä¸ªç¼ºé¡µä¸­æ–­æ—¶ï¼Œå°è¯•å‘ç°éœ€è¦å“ªä¸ªè™šæ‹Ÿé¡µé¢ã€‚é€šå¸¸ä¸€ä¸ªç¡¬ä»¶å¯„å­˜å™¨åŒ…å«äº†è¿™ä¸€ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»æ£€ç´¢ç¨‹åºè®¡æ•°å™¨ï¼Œå–å‡ºè¿™æ¡æŒ‡ä»¤ï¼Œç”¨è½¯ä»¶åˆ†æè¿™æ¡æŒ‡ä»¤ï¼Œçœ‹çœ‹ä»–åœ¨ç¼ºé¡µä¸­æ–­æ—¶æ­£åœ¨åšä»€ä¹ˆã€‚ ä¸€æ—¦çŸ¥é“äº†å‘ç”Ÿç¼ºé¡µä¸­æ–­çš„è™šæ‹Ÿåœ°å€ï¼Œæ“ä½œç³»ç»Ÿæ£€æŸ¥è¿™ä¸ªåœ°å€æ˜¯å¦æœ‰æ•ˆï¼Œå¹¶æ£€æŸ¥å­˜å–ä¸ä¿æŠ¤æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œå‘è¿›ç¨‹å‘å‡ºä¸€ä¸ªä¿¡å·æˆ–æ€æ‰è¯¥è¿›ç¨‹ã€‚å¦‚æœåœ°å€æœ‰æ•ˆä¸”æ²¡æœ‰ä¿æŠ¤é”™è¯¯å‘ç”Ÿï¼Œç³»ç»Ÿåˆ™æ£€æŸ¥æ˜¯å¦æœ‰ç©ºé—²é¡µæ¡†ã€‚å¦‚æœæ²¡æœ‰ç©ºé—²é¡µæ¡†ï¼Œæ‰§è¡Œé¡µé¢ç½®æ¢ç®—æ³•å¯»æ‰¾ä¸€ä¸ªé¡µé¢æ¥æ·˜æ±°ã€‚ å¦‚æœé€‰æ‹©çš„é¡µæ¡†â€œè„â€äº†ï¼Œå®‰æ’è¯¥é¡µé¢å†™å›ç£ç›˜ï¼Œå¹¶å‘ç”Ÿä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ŒæŒ‚èµ·äº§ç”Ÿç¼ºé¡µä¸­æ–­çš„è¿›ç¨‹ï¼Œè®©å…¶ä»–è¿›ç¨‹è¿è¡Œç›´è‡³ç£ç›˜ä¼ è¾“ç»“æŸã€‚æ— è®ºå¦‚ä½•ï¼Œè¯¥é¡µæ¡†è¢«æ ‡è®°ä¸ºå¿™ï¼Œä»¥å…å› ä¸ºå…¶ä»–åŸå› è€Œè¢«å…¶ä»–è¿›ç¨‹å ç”¨ã€‚ ä¸€æ—¦é¡µæ¡†â€œå¹²å‡€â€åï¼ˆæ— è®ºæ˜¯ç«‹åˆ»è¿˜æ˜¯åœ¨å†™å›ç£ç›˜åï¼‰ï¼Œæ“ä½œç³»ç»ŸæŸ¥æ‰¾æ‰€éœ€é¡µé¢åœ¨ç£ç›˜ä¸Šçš„åœ°å€ï¼Œé€šè¿‡ç£ç›˜æ“ä½œå°†å…¶è£…å…¥ã€‚è¯¥é¡µé¢è¢«è£…å…¥åï¼Œäº§ç”Ÿç¼ºé¡µä¸­æ–­çš„è¿›ç¨‹ä»ç„¶è¢«æŒ‚èµ·ï¼Œå¹¶ä¸”å¦‚æœæœ‰å…¶ä»–å¯è¿è¡Œç”¨æˆ·è¿›ç¨‹ï¼Œåˆ™é€‰æ‹©å¦ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹è¿è¡Œã€‚ å½“ç£ç›˜ä¸­æ–­å‘ç”Ÿæ—¶ï¼Œè¡¨æ˜è¯¥é¡µå·²è¢«è£…å…¥ï¼Œé¡µè¡¨å·²ç»æ›´æ–°å¯ä»¥åæ˜ ä»–çš„ä½ç½®ï¼Œé¡µæ¡†ä¹Ÿè¢«æ ‡è®°ä¸ºæ­£å¸¸çŠ¶æ€ã€‚ æ¢å¤å‘ç”Ÿç¼ºé¡µä¸­æ–­æŒ‡ä»¤ä»¥å‰çš„çŠ¶æ€ï¼Œç¨‹åºè®¡æ•°å™¨é‡æ–°å®šå‘è¿™æ¡æŒ‡ä»¤ã€‚ è°ƒåº¦å¼•å‘ç¼ºé¡µä¸­æ–­çš„è¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿè¿”å›è°ƒç”¨ä»–çš„æ±‡ç¼–è¯­è¨€ä¾‹ç¨‹ã€‚ è¯¥ä¾‹ç¨‹æ¢å¤å¯„å­˜å™¨å’Œå…¶ä»–çŠ¶æ€ä¿¡æ¯ï¼Œæ”¾å›åˆ°ç”¨æˆ·ç©ºé—´ç»§ç»­æ‰§è¡Œï¼Œå°±å¥½åƒç¼ºé¡µä¸­æ–­æ²¡æœ‰å‘ç”Ÿè¿‡ä¸€æ ·ã€‚ 2.6 åˆ†æ®µ æ®µæ˜¯é€»è¾‘å®ä½“ï¼Œå¤§å°ä¸å›ºå®šã€‚ 2.7 åˆ†æ®µå’Œåˆ†é¡µç»“åˆ : MULTICS è¿˜æœ‰ Intel Pentuium æœªä»‹ç» 34 ä½çš„ MULTICS è™šæ‹Ÿåœ°å€ æ®µå· é¡µå· é¡µå†…åç§» 18 6 10 æ ¹æ®æ®µå·æ‰¾åˆ°æ®µæè¿°ç¬¦ æ£€æŸ¥è¯¥æ®µçš„é¡µè¡¨æ˜¯å¦å­˜åœ¨å†…å­˜ä¸­ã€‚å¦‚æœåœ¨ï¼Œåˆ™æ‰¾åˆ°ä»–ï¼›å¦‚æœä¸å†ï¼Œåˆ™äº§ç”Ÿä¸€ä¸ªæ®µé”™è¯¯ã€‚å¦‚æœè®¿é—®è¿åäº†æ®µçš„ä¿æŠ¤è¦æ±‚å°±è¦æ±‚å‘å‡ºä¸€ä¸ªè¶Šç•Œé”™è¯¯(é™·é˜±)ã€‚ æ£€æŸ¥æ‰€è¯·æ±‚è™šæ‹Ÿé¡µé¢çš„é¡µè¡¨é¡¹ï¼Œå¦‚æœè¯¥é¡µé¢ä¸å†å†…å­˜ä¸­åˆ™äº§ç”Ÿä¸€ä¸ªç¼ºé¡µä¸­æ–­ï¼Œå¦‚æœåœ¨å†…å­˜å°±ä»é¡µè¡¨ä¸­å–å‡ºè¿™ä¸ªé¡µé¢åœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€ã€‚ æŠŠåç§»é‡åŠ åˆ°é¡µé¢çš„èµ·å§‹åœ°å€ä¸Šï¼Œå¾—åˆ°è¦è®¿é—®çš„å­—åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚ æœ€åè¿›è¡Œè¯»æˆ–å†™æ“ä½œã€‚ 3. æ–‡ä»¶ç³»ç»Ÿ æ–‡ä»¶ç³»ç»Ÿå­˜æ”¾åœ¨ç£ç›˜ä¸Šã€‚å¤šæ•°ç£ç›˜åˆ’åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºä¸­æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿã€‚ç£ç›˜çš„ 0 å·ç›˜æ‰‡åŒºç§°ä¸ºä¸»å¼•å¯¼è®°å½•(Master Boot Record, MBR)ï¼Œç”¨æ¥å¼•å¯¼è®¡ç®—æœºã€‚åœ¨ MBR çš„ç»“å°¾æ˜¯åˆ†åŒºè¡¨ï¼Œè¯¥è¡¨ç»™å‡ºäº†æ¯ä¸ªåˆ†åŒºçš„å…¶å®å’Œç»“æŸåœ°å€ã€‚è¡¨ä¸­çš„ä¸€ä¸ªåˆ†åŒºè¢«æ ‡è®°ä¸ºæ´»åŠ¨åˆ†åŒºã€‚åœ¨è®¡ç®—æœºè¢«å¼•å¯¼æ—¶ï¼ŒBIOS è¯»å…¥å¹¶æ‰§è¡Œ MBRã€‚MBR åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ç¡®å®šæ´»åŠ¨åˆ†åŒºï¼Œè¯»å…¥å®ƒçš„ç¬¬ä¸€ä¸ªå—ï¼Œç§°ä¸ºå¼•å¯¼å—ï¼Œå¹¶æ‰§è¡Œã€‚ æ•´ä¸ªåˆ†åŒº: MBR åˆ†åŒºè¡¨ ç£ç›˜åˆ†åŒº ç£ç›˜åˆ†åŒº ç£ç›˜åˆ†åŒºâ€¦ ç£ç›˜åˆ†åŒº: å¼•å¯¼å— è¶…çº§å— ç©ºé—²ç©ºé—´ç®¡ç† i èŠ‚ç‚¹ æ ¹ç›®å½• æ–‡ä»¶å’Œç›®å½• 3.1 æ–‡ä»¶å®ç°è¿ç»­åˆ†é… æŠŠæ¯ä¸ªæ–‡ä»¶ä½œä¸ºä¸€è¿ä¸²è¿ç»­æ•°æ®å—å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚ é“¾è¡¨åˆ†é… ä¸€ä¸ªæ–‡ä»¶ç”±å‡ ä¸ªç£ç›˜å—ç»„æˆã€‚ åœ¨å†…å­˜ä¸­é‡‡ç”¨è¡¨çš„é“¾è¡¨åˆ†é… æŠŠæ¯ä¸ªç£ç›˜å—çš„æŒ‡é’ˆå­—æ”¾åœ¨å†…å­˜çš„ä¸€ä¸ªè¡¨ä¸­ i èŠ‚ç‚¹ æ¯ä¸ªæ–‡ä»¶èµ‹äºˆä¸€ä¸ªç§°ä¸º i èŠ‚ç‚¹(index-node)çš„æ•°æ®ç»“æ„ï¼Œåˆ—å‡ºæ–‡ä»¶å±æ€§å’Œæ–‡ä»¶å¿«çš„ç£ç›˜åœ°å€ã€‚ 4. è¾“å…¥/è¾“å‡º4.1 I/O ç¡¬ä»¶åŸç†I/O è®¾å¤‡å—è®¾å¤‡ : ä»¥å—ä¸ºå•ä½ä¼ è¾“ï¼Œå¯å¯»å€å­—ç¬¦è®¾å¤‡ : ä»¥å­—ç¬¦ä¸ºå•ä½æ”¶å‘å­—ç¬¦æµï¼Œä¸å¯å¯»å€ è®¾å¤‡æ§åˆ¶å™¨å†…å­˜æ˜ å°„ I/Oç›´æ¥å­˜å‚¨å™¨å­˜å–DMA å·¥ä½œåŸç†: CPU å¯¹ DMA æ§åˆ¶å™¨è¿›è¡Œç¼–ç¨‹ DMA è¯·æ±‚ç£ç›˜ä¼ é€æ•°æ®åˆ°å†…å­˜ ç£ç›˜ä¼ é€æ•°æ®åˆ°å†…å­˜ ç£ç›˜ç»™ DMA æ§åˆ¶å™¨åº”ç­” å®Œæˆä¸­æ–­ 5. æ­»é”5.1 èµ„æº åœ¨è¿›ç¨‹å¯¹è®¾å¤‡ï¼Œæ–‡ä»¶ç­‰å–å¾—äº†æ’ä»–æ€§è®¿é—®æƒé™çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°æ­»é”ã€‚è¿™ç±»éœ€è¦æ’ä»–æ€§ä½¿ç”¨çš„å¯¹è±¡ç§°ä¸ºèµ„æºã€‚ å¯æŠ¢å èµ„æº å¯ä»¥ä»æ‹¥æœ‰å®ƒçš„è¿›ç¨‹ä¸­æŠ¢å è€Œä¸ä¼šäº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ã€‚ï¼ˆå­˜å‚¨å™¨ï¼‰ ä¸å¯æŠ¢å èµ„æº æŒ‡åœ¨ä¸å¼•èµ·ç›¸å…³çš„è®¡ç®—å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œæ— æ³•æŠŠä»–ä»å æœ‰å®ƒçš„è¿›ç¨‹å¤„æŠ¢å è¿‡æ¥ã€‚ï¼ˆ CD åˆ»å½•ï¼‰ èµ„æºä½¿ç”¨æ­¥éª¤: è¯·æ±‚èµ„æº ä½¿ç”¨èµ„æº é‡Šæ”¾èµ„æº 5.2 æ­»é”æ¦‚è¿° å¦‚æœä¸€ä¸ªè¿›ç¨‹é›†åˆä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…åªèƒ½ç”±è¯¥è¿›ç¨‹é›†åˆä¸­çš„å…¶ä»–è¿›ç¨‹æ‰èƒ½å¼•å‘çš„äº‹ä»¶ï¼Œé‚£ä¹ˆï¼Œè¯¥è¿›ç¨‹é›†åˆå°±æ˜¯æ­»é”çš„ã€‚ èµ„æºæ­»é”æ¡ä»¶å‘ç”Ÿèµ„æºæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶: äº’æ–¥æ¡ä»¶ : æ¯ä¸ªèµ„æºè¦ä¹ˆå·²ç»åˆ†é…äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œè¦ä¹ˆå°±æ˜¯å¯ç”¨çš„ã€‚ å æœ‰å’Œç­‰å¾…æ¡ä»¶ : å·²ç»å¾—åˆ°äº†æŸä¸ªèµ„æºçš„è¿›ç¨‹å¯ä»¥å†è¯·æ±‚æ–°çš„èµ„æºã€‚ ä¸å¯æŠ¢å æ¡ä»¶ : å·²ç»åˆ†é…ç»™ä¸€ä¸ªè¿›ç¨‹çš„èµ„æºä¸èƒ½å¼ºåˆ¶æ€§åœ°è¢«æŠ¢å ï¼Œå®ƒåªèƒ½è¢«å æœ‰å®ƒçš„è¿›ç¨‹æ˜¾ç¤ºåœ°é‡Šæ”¾ã€‚ ç¯è·¯ç­‰å¾…æ¡ä»¶ : æ­»é”å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿä¸­ä¸€å®šæœ‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹ç»„æˆçš„ä¸€æ¡ç¯è·¯ï¼Œè¯¥ç¯è·¯ä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…ç€ä¸‹ä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰çš„èµ„æºã€‚ 5.3 æ­»é”æ£€æµ‹ä¸æ­»é”æ¢å¤ æ­»é”æ£€æµ‹ä¸»è¦æ˜¯åˆ¤æ–­å½“å‰ç©ºé—²èµ„æºåœ¨æŸç§åˆç†åˆ†é…ä¸‹æ˜¯å¦èƒ½ä½¿æ‰€æœ‰è¿›ç¨‹éƒ½è¿è¡Œå®Œå¹¶ä¸”æœ€ç»ˆèµ„æºéƒ½èƒ½å¤Ÿé‡Šæ”¾ã€‚ æ¢å¤æ–¹æ³• : åˆ©ç”¨æŠ¢å å¼æ¢å¤ åˆ©ç”¨å›æ»šæ¢å¤ åˆ©ç”¨æ€æ­»è¿›ç¨‹æ¢å¤ 5.4 æ­»é”é¿å…èµ„æºè½¨è¿¹å›¾å®‰å…¨çŠ¶æ€å’Œä¸å®‰å…¨çŠ¶æ€å•ä¸ªèµ„æºçš„é“¶è¡Œå®¶ç®—æ³•å¤šä¸ªèµ„æºçš„é“¶è¡Œå®¶ç®—æ³•5.5 æ­»é”é¢„é˜² æ­»é”é¿å…ä»æœ¬è´¨ä¸Šæ¥è¯´æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºä»–è¦è·å–æœªæ¥çš„ä¿¡æ¯ã€‚ ç ´åäº’æ–¥æ¡ä»¶ å¦‚æœèµ„æºä¸è¢«ä¸€ä¸ªè¿›ç¨‹ç‹¬å æ­»é”ä¸ä¼šå‘ç”Ÿã€‚ï¼ˆå‡è„±æœºæ‰“å°æœºï¼‰ ç ´åå æœ‰å’Œç­‰å¾…æ¡ä»¶ å¼€å§‹æ‰§è¡Œå‰è¯·æ±‚æ‰€æœ‰èµ„æºå°±ä¸ä¼šé€ æˆç­‰å¾…ã€‚å¦ä¸€ç§æ˜¯è¯·æ±‚èµ„æºæ—¶å…ˆé‡Šæ”¾è‡ªå·±æ‰€æŒæœ‰çš„èµ„æºï¼Œå†å°è¯•ä¸€æ¬¡è¯·æ±‚èµ„æºã€‚ ç ´åä¸å¯æŠ¢å æ¡ä»¶ é’ˆå¯¹æŸäº›èµ„æºè¿›è¡Œè™šæ‹ŸåŒ–ï¼Œå®ç°å¯æŠ¢å ã€‚ ç ´åç¯è·¯ç­‰å¾…æ¡ä»¶ ä¿è¯æ¯ä¸ªè¿›ç¨‹åœ¨ä»»ä½•æ—¶åˆ»åªèƒ½å ç”¨ä¸€ä¸ªèµ„æºå¦‚æœè¦è¯·æ±‚å¦å¤–ä¸€ä¸ªèµ„æºå®ƒå¿…é¡»å…ˆé‡Šæ”¾ç¬¬ä¸€ä¸ªèµ„æºã€‚å¦ä¸€ç§æ˜¯å°†æ‰€æœ‰èµ„æºç»Ÿä¸€ç¼–å·ï¼Œè¿›ç¨‹å¯ä»¥åœ¨ä»»ä½•æ—¶åˆ»æå‡ºèµ„æºè¯·æ±‚ï¼Œä½†æ˜¯è¯·æ±‚å¿…é¡»æŒ‰ç…§èµ„æºç¼–å·é¡ºåº(å‡åº)æå‡ºã€‚ 5.6 å…¶ä»–é—®é¢˜ä¸¤é˜¶æ®µåŠ é”é€šè®¯æ­»é”æ´»é”é¥¥é¥¿","tags":[{"name":"C/C++","slug":"C-C","permalink":"http://fitzeng.org/tags/C-C/"},{"name":"OS","slug":"OS","permalink":"http://fitzeng.org/tags/OS/"}]},{"title":"Why Marvel ?","date":"2017-08-02T16:00:00.000Z","path":"2017/08/03/WhyMarvel/","text":"å…ˆç»™è‡ªå·±æŒ–ä¸ªå‘, è®°å½•ä¸€ä¸‹ä» 12 - 17 è¿™äº”å¹´é—´çš„ç‚¹ç‚¹æ»´æ»´.å¾ˆä¹…ä¹‹å‰å°±å¾ˆæƒ³å†™å†™è‡ªå·±å¿ƒä¸­çš„ Marvel. äººæ€»å¾—æœ‰äº›çˆ±å¥½æ˜¯ä¸ç†æƒ³ç›¸å…³çš„, ä¸æ˜¯å—?","tags":[{"name":"Life","slug":"Life","permalink":"http://fitzeng.org/tags/Life/"},{"name":"Marvel","slug":"Marvel","permalink":"http://fitzeng.org/tags/Marvel/"}]},{"title":"é‡æ‹¾æ•°æ®ç»“æ„","date":"2017-08-01T16:00:00.000Z","path":"2017/08/02/reDS/","text":"åœ¨å¤§ä¸‰åˆ°å¤§å››è¿‡æ¸¡æœŸä¸­, ä»å››æœˆåˆ°ä¸ƒæœˆ, ç»å†è¿‡å‡ åœºé¢è¯•, æ‰¾å®ä¹ . (å¦‚æœå…«æœˆä»½æ‹¿åˆ°[çœŸ.offer]çš„è¯æˆ‘ä¹Ÿæƒ³æŠŠè¿™æ®µç»å†è®°å½•ä¸‹æ¥) ç»“æœå¾ˆæ‚²å‰§, è§‰å¾—æ–¹å‘ä¸æ˜¯ä»€ä¹ˆéšœç¢, åŸºç¡€æ¯”è¾ƒé‡, æ‰€ä»¥è¦é‡æ‹¾æ•°æ®ç»“æ„ä¸æ¶‰åŠç®—æ³•å…·ä½“å®ç°, å› ä¸ºæ˜¯é‡æ‹¾, æ‰€ä»¥å…ˆå‰æœ‰ä¸€å®šåŸºç¡€, åªè¦æœ‰ä¸€ç‚¹æç¤ºä¾¿èƒ½å”¤é†’æ— é™å›å¿†. è¿™é‡Œä¸»è¦æ˜¯è®°å½•å„ç§æ•°æ®ç»“æ„çš„ç»“æ„ä½“, è¿™æ˜¯ç»è¿‡é‡é‡æ€ç»´è¿‡ç¨‹å¾—å‡ºçš„ç²¾å, ååˆ†æœ‰ä»·å€¼. è‡³äºå…·ä½“å®ç°å’Œè®²è§£æ—¥åå›ä¼šä»¥é“¾æ¥å½¢å¼æä¾›, è¿™é‡Œåªæä¾›ä¸€ä¸ªæ€ç»´æ ‘, å»ºç«‹ä¸€ä¸ªæ•°æ®æœºæ„çš„æ€ç»´ä½“ç³», åç»­æ›´æ–°æ¬¢è¿å…³æ³¨ GitHub. 1 çº¿æ€§è¡¨1.1 åŠ¨æ€åˆ†é…ç©ºé—´12345typedef struct &#123; ElemType * elem; int length; int listsize;&#125; SqList; 1.2 çº¿æ€§é“¾è¡¨1234typedef struct LNode &#123; ElemType data; struct LNode * next;&#125; LNode, * LinkList; 1.3 é™æ€é“¾è¡¨1234typedef struct &#123; ElemType data; int cur; // æ¸¸æ ‡æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ çš„æ•°ç»„ä¸‹æ ‡&#125; component, SlinkList[MAXSIZE]; 1.4 å¾ªç¯é“¾è¡¨ &amp; åŒå‘é“¾è¡¨12345typedef struct DuLNode&#123; ElemType data; struct DuLNode * prior; struct DuLNode * next;&#125; DuLNode, * DuLinkList; 2 æ ˆå’Œé˜Ÿåˆ—2.1 æ ˆ12345typedef struct &#123; SELemType * base; SElemType * top;##### int stacksize;&#125; SqStack; åº”ç”¨: ä¸»è¦æ˜¯åˆ©ç”¨å…ˆè¿›åå‡ºçš„ç‰¹æ€§ æ•°åˆ¶è½¬æ¢ æ‹¬å·åŒ¹é…æ£€æµ‹ è¡Œç¼–è¾‘ç¨‹åº è¿·å®«éé€’å½’æ±‚è§£ è¡¨è¾¾å¼æ±‚å€¼ Hanoiå¡”é—®é¢˜ 2.2 é˜Ÿåˆ— é“¾é˜Ÿåˆ— 12345678typedef struct QNode &#123; QElemType data; struct QNode * next;&#125; QNode, * QueuePtr;typedef struct &#123; QueuePtr front; QueuePtr rear;&#125; LinkQueue; å¾ªç¯é˜Ÿåˆ— 12345typedef struct &#123; QElemType * base; int front; int rear;&#125; SqQueue; 3 ä¸²3.1 å®šé•¿ä¸²12typedef unsigned char SString[MAXSTRLEN + 1];SString s; 3.2 å˜é•¿ å †åˆ†é…å­˜å‚¨ 1234typedef struct &#123; char * ch; int length;&#125;HString; å—é“¾å­˜å‚¨ 123456789typedef struct Chunk&#123; char ch[CHUNKSIZE]; struct Chunk * next;&#125; Chunk;typedef struct &#123; Chunk * head; Chunk * tail; int curlen;&#125; LString; åº”ç”¨ å­ä¸²å®šä½ (KMP) 4 æ•°ç»„å’Œå¹¿ä¹‰è¡¨4.1 æ•°ç»„é¡ºåºå­˜å‚¨123456typedef struct &#123; ElemType * base; int dim; // æ•°ç»„ç»´æ•° int * bounds; // ç»´ç•ŒåŸºå€ int * constants; // å°è±¡å‡½æ•°å¸¸é‡åŸºå€&#125; Array; 4.2 çŸ©é˜µ è®¨è®ºç¨€ç–çŸ©é˜µçš„å­˜å‚¨ ä¸‰å…ƒé¡ºåºè¡¨ 1234567891011typedef struct &#123; int i; int j; ElemType e;&#125; Triple;typedef struct &#123; Triple data[MAXSIZE + 1]; int mu; // è¡Œ int nu; // åˆ— int tu; // éé›¶ä¸ªæ•°&#125;TSMatrix; è¡Œé€»è¾‘é“¾æ¥ 12345typedef struct &#123; Triple data[MAXSIZE + 1]; int rpos[MAXRC + 1]; // å„è¡Œç¬¬ä¸€ä¸ªéé›¶å…ƒç´ ä½ç½®è¡¨ int mu, nu, tu;&#125; RLSMatrix; åå­—é“¾è¡¨ 123456789101112typedef struct OLNode &#123; int i; int j; ElemType e; struct OLNode * right; // è¯¥éé›¶å…ƒç´ æ‰€åœ¨è¡Œçš„å³é“¾åŸŸ struct OLNode * down; // è¯¥éé›¶å…ƒç´ æ‰€åœ¨åˆ—çš„ä¸‹é“¾åŸŸ&#125; OLNode, * OLink;typedef struct &#123; OLink * rhead; // è¡Œé“¾è¡¨å¤´æŒ‡é’ˆåœ°å€ OLink * chead; // åˆ—é“¾è¡¨å¤´æŒ‡é’ˆåœ°å€ int mu, nu, tu;&#125; CrossLink; 4.3 å¹¿ä¹‰è¡¨ è¡¨ä¸­æœ‰è¡¨ å¤´å°¾é“¾è¡¨å­˜å‚¨ 1234567891011typedef enum &#123; ATOM, LIST &#125; ElemTag; // 0 : åŸå­, 1 : å­è¡¨typedef struct GLNode &#123; ElemTag tag; union &#123; AtomType atom; struct &#123; struct GLNode * hp; // è¡¨å¤´ struct GLNode * tp; // è¡¨å°¾ &#125; ptr; // è¡¨èŠ‚ç‚¹æŒ‡é’ˆåŸŸ &#125;;&#125; * GList; æ‰©å±•çº¿æ€§é“¾è¡¨å­˜å‚¨ 1234567891011typedef enum &#123; ATOM, LIST &#125; ElemTag; // 0 : åŸå­, 1 : å­è¡¨typedef struct GLNode &#123; ElemTag tag; union &#123; AtomType atom; struct &#123; struct GLNode * hp; // è¡¨å¤´ &#125; ptr; // è¡¨èŠ‚ç‚¹æŒ‡é’ˆåŸŸ &#125;; struct GLNode * tp; // è¡¨å°¾, ç›¸å½“äº next.&#125; * GList; 5 æ ‘å’ŒäºŒå‰æ ‘5.1 äºŒå‰æ ‘å­˜å‚¨ç»“æ„ é¡ºåºå­˜å‚¨ç»“æ„ æ•°ç»„, åˆ©ç”¨ä¸‹æ ‡å¯»å€ 1typedef TElemType SqBiTree[MAX_TREE_SIZE]; é“¾å¼å­˜å‚¨ç»“æ„ 12345typedef struct BiTNode &#123; TElemType data; struct BiTNode * lchild; struct BiTNode * rchild;&#125; BiTNode, * BiTree; 5.2 éå†äºŒå‰æ ‘ å…ˆåºéå† æ ¹èŠ‚ç‚¹ -&gt; å·¦å­æ ‘ -&gt; å³å­æ ‘ ä¸­åºéå† å·¦å­æ ‘ -&gt; æ ¹èŠ‚ç‚¹ -&gt; å³å­æ ‘ ååºéå† å·¦å­æ ‘ -&gt; å³å­æ ‘ -&gt; æ ¹èŠ‚ç‚¹ ç®—æ•°è¡¨è¾¾å¼ a + b * (c - d) - e / f å‰ç¼€è¡¨è¾¾å¼-å…ˆåºéå†(é€†æ³¢å…° : - + a * b - cd / ef) ä¸­ç¼€è¡¨è¾¾å¼-ä¸­åºéå†(åŸè¡¨è¾¾å¼ : a + b * (c - d) - e / f) åç¼€è¡¨è¾¾å¼-åç»­éå†(é€†æ³¢å…°å¼ : abcd - * + ef / -) 5.3 çº¿ç´¢äºŒå‰æ ‘ ä¿å­˜æ¯”éå†è¿‡ç¨‹ä¸­çš„èŠ‚ç‚¹ç›¸å…³æ€§ç»“æœ å‰é©±åç»§èŠ‚ç‚¹å’Œå·¦å³å­©å­æŒ‡ç¤º lchild LTag data RTag rchild LTag 0 : lchild åŸŸæŒ‡ç¤ºå·¦å­©å­ 1 : lchild åŸŸæŒ‡ç¤ºå‰é©±èŠ‚ç‚¹ RTag 0 : rchild åŸŸæŒ‡ç¤ºå³å­©å­ 1 : rchild åŸŸæŒ‡ç¤ºåç»§èŠ‚ç‚¹ 12345678typedef enum PointerTag &#123;Link, Thread&#125;; // 0 : æŒ‡é’ˆ 1 : çº¿ç´¢typedef struct BiThrNode &#123; TElemType data; struct BiThrNode * lchild; struct BiThrNode * rchild; PointerTag LTag; PointerTag RTag;&#125; BiThrNode, * BiThrTree; 5.4 æ ‘å’Œæ£®æ— åŒäº²è¡¨ç¤ºæ³• 123456789typedef struct PTNode &#123; TElemType data; int parent;&#125; PTNode;typedef struct &#123; PTNode nodes[MAX_TREE_SIZE]; int r; // æ ¹çš„ä½ç½® int n; // èŠ‚ç‚¹æ•°&#125; PTree; å­©å­è¡¨ç¤ºæ³• 12345678910111213typedef struct CTNode &#123; // å­©å­èŠ‚ç‚¹ struct CTNode * next; int child;&#125; * ChildPtr;typedef struct &#123; TElemType data; ChildPtr firstchild; // å­©å­é“¾è¡¨å¤´æŒ‡é’ˆ&#125; CTBox;typedef struct &#123; CTBox nodes[MAX_TREE_SIZE]; int r; // æ ¹çš„ä½ç½® int n; // èŠ‚ç‚¹æ•°&#125; CTree; å­©å­å…„å¼Ÿè¡¨ç¤ºæ³• 12345typedef struct CSNode &#123; ElemType data; struct CSNode * firstchild; struct CSNode * nextsibling;&#125; CSNode, * CSTree; 5.5 äºŒå‰æ ‘å’Œæ£®æ—äº’æ¢ æ£®æ—è½¬æ¢æˆäºŒå‰æ ‘ å·¦å­©å­å³å…„å¼Ÿ(å·¦å³æ˜¯å¯¹äºŒå‰æ ‘è€Œè¨€, å­©å­å…„å¼Ÿæ˜¯å¯¹æ£®æ—è€Œè¨€, ä¸‹é¢åŒç†) äºŒå‰æ ‘è½¬æ¢æˆæ£®æ— å·¦å­©å­è½¬æ¢æˆå­©å­, å³å­©å­è½¬æ¢æˆå…„å¼Ÿ 5.6 æ ‘å’Œæ£®æ—éå† å…ˆåºéå†æ£®æ— ç¬¬ä¸€æ£µæ ‘çš„æ ¹ å…ˆåºéå†ç¬¬ä¸€æ£µæ ‘ä¸­æ ¹èŠ‚ç‚¹çš„å­æ ‘æ£®æ— å…ˆåºéå†é™¤ç¬¬ä¸€æ£µæ ‘å‰©ä½™çš„æ ‘æ„æˆçš„æ£®æ— ä¸­åºéå†æ£®æ— ä¸­åºéå†ç¬¬ä¸€æ£µæ ‘ä¸­æ ¹èŠ‚ç‚¹çš„å­æ ‘æ£®æ— ç¬¬ä¸€æ£µæ ‘çš„æ ¹ ä¸­åºéå†é™¤ç¬¬ä¸€æ£µæ ‘å‰©ä½™çš„æ ‘æ„æˆçš„æ£®æ— 7 å›¾7.1 å›¾çš„å­˜å‚¨ç»“æ„ æ•°ç»„è¡¨ç¤ºæ³• 123456789101112typedef enum &#123;DG, DN, UDG, UDN&#125; GraphKind; // &#123;æœ‰å‘å›¾, æœ‰å‘ç½‘, æ— å‘å›¾, æ— å‘ç½‘&#125;typedef struct ArcCell &#123; VRType adj; // é¡¶ç‚¹ç›¸å…³ç±»å‹. æ— æƒå›¾ : 1/0 è¡¨ç¤ºç›¸é‚»ä¸å¦ å¸¦æƒå›¾ : æƒå€¼ä¿¡æ¯ InfoType * info; // è¯¥å¼§ç›¸å…³çš„æŒ‡é’ˆ&#125; ArcCell, AdjMatrix[MAX_VERTEX_NUM][MAX_VERTEX_NUM];typedef struct &#123; VertexType vexs[MAX_VERTEX_NUM]; // é¡¶ç‚¹å‘é‡ AdjMatrix arcs; // é‚»æ¥çŸ©é˜µ int vexnum; // é¡¶ç‚¹æ•° int arcnum; // å¼§æ•° GraphKind kind; // å›¾çš„ç§ç±»æ ‡å¿—&#125; MGraph; é‚»æ¥è¡¨ è¡¨èŠ‚ç‚¹ adjvex nextarc info å¤´ç»“ç‚¹ data firstarc 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748typedef struct ArcNode &#123; int adjvex; // è¯¥å¼§æ‰€æŒ‡å‘é¡¶ç‚¹ä½ç½® struct ArcNode * nextarc; // æŒ‡å‘ä¸‹ä¸€æ¡å¼§çš„æŒ‡é’ˆ InfoType * info; // è¯¥å¼§ç›¸å…³ä¿¡æ¯çš„æŒ‡é’ˆ&#125; ArcNode;typedef struct VNode &#123; VertexType data; // é¡¶ç‚¹ä¿¡æ¯ ArcNode * firstarc; // æŒ‡å‘ç¬¬ä¸€æ¡ä¾é™„è¯¥é¡¶ç‚¹çš„å¼§çš„æŒ‡é’ˆ&#125; VNode, AdjList[MAX_VERTEX_NUM];typedef struct &#123; AdjList vertices; int vexnum; // é¡¶ç‚¹æ•° int arcnum; // å¼§æ•° int kind; // ç§ç±»æ ‡è®°&#125; ALGraph;``` - åå­—é“¾è¡¨ &gt; å¼§èŠ‚ç‚¹&gt; &gt; | tailvex | headvex | hlink | tlink | info |&gt; |---------|---------|-------|-------|------|&gt; &gt; é¡¶ç‚¹èŠ‚ç‚¹&gt; &gt; | data | firstin | firstout |&gt; |------|---------|----------|&gt; ```Ctypedef struct ArcBox &#123; int tailvex; // è¯¥å¼§çš„å°¾é¡¶ç‚¹ä½ç½® int headvex; // è¯¥å¼§çš„å¤´é¡¶ç‚¹ä½ç½® struct ArcBox * hlink; // å¼§å¤´ç›¸åŒçš„å¼§çš„é“¾åŸŸ struct ArcBox * tlink; // å¼§å°¾ç›¸åŒçš„å¼§çš„é“¾åŸŸ InfoType * info; // è¯¥å¼§ç›¸å…³ä¿¡æ¯æŒ‡é’ˆ&#125; ArcBox;typedef struct VexNode &#123; VertexType data; ArcBox * firstin; // æŒ‡å‘è¯¥èŠ‚ç‚¹ç¬¬ä¸€æ¡å…¥å¼§ ArcBox * firstout; // æŒ‡å‘è¯¥èŠ‚ç‚¹ç¬¬ä¸€æ¡å‡ºå¼§&#125; VexNode;typedef struct &#123; VexNode xlist[MAX_VERTEX_NUM]; // è¡¨å¤´å‘é‡ int vexnum; // æœ‰å‘å›¾çš„å½“å‰é¡¶ç‚¹æ•° int arcnum; // æœ‰å‘å›¾çš„å½“å‰å¼§æ•°&#125; OLGraph; é‚»æ¥å¤šé‡è¡¨ æ¯ä¸€æ¡è¾¹ç”¨ä¸€ä¸ªèŠ‚ç‚¹è¡¨ç¤º mark ivex ilink jvex jlink info æ¯ä¸ªé¡¶ç‚¹ç”¨ä¸€ä¸ªèŠ‚ç‚¹è¡¨ç¤º data firstedge 123456789101112131415161718typedef enum &#123;unvisited, visited&#125; VisitIf;typedef struct EBox &#123; VisitIf mark; // è®¿é—®æ ‡è®° int ivex; // ä¾é™„é¡¶ç‚¹ä½ç½® int jvex; // ä¾é™„é¡¶ç‚¹ä½ç½® struct EBox * ilink; // ä¾é™„é¡¶ç‚¹çš„ä¸‹ä¸€è¾¹ struct EBox * jlink; // ä¾é™„é¡¶ç‚¹çš„ä¸‹ä¸€è¾¹ InfoType * info; // è¯¥è¾¹çš„ä¿¡æ¯æŒ‡é’ˆ&#125; EBox;typedef struct VexBox &#123; VertexType data; EBox * firstedge; // æŒ‡å‘ç¬¬ä¸€æ¡ä¾é™„è¯¥é¡¶ç‚¹çš„è¾¹&#125; VexBox;typedef struct &#123; VexBox adjmulist[MAX_VERTEX_NUM]; int vexnum; // æ— å‘å›¾çš„é¡¶ç‚¹æ•° int edgenum; // æ— å‘å›¾çš„è¾¹æ•°&#125; AMLGraph 7.2 å›¾çš„éå† æ·±åº¦ä¼˜å…ˆæœç´¢ ä»¥è¿·å®«ä¸ºä¾‹å­(é¢è¯•ä¸­è¢«é—®åˆ°, å°è±¡æ¯”è¾ƒæ·±åˆ»). æ·±åº¦ä¼˜å…ˆå°±æ˜¯ä¸€æ¡è·¯èµ°åˆ°é»‘, æ‰€ä»¥è¿”å›çš„ç¬¬ä¸€æ¡è·¯å¾„ä¸ä¿è¯æ˜¯æœ€ä¼˜è§£. 123456789101112131415161718192021222324Boolean visited[MAX]; // è®¿é—®æ ‡å¿—æ•°ç»„Status (* VisiteFunc) (int v); // å‡½æ•°å˜é‡ void DFSTraverse(Graph G, Status (* Visit)(int v)) &#123; // æ·±åº¦ä¼˜å…ˆéå† VisitFunc = Visit; // ä½¿ç”¨å…¨å±€å˜é‡ VisitFunc, ä½¿ DFS ä¸å¿…è®¾ç½®å‡½æ•°æŒ‡é’ˆå‚æ•° for (v = 0; v &lt; G.vexnum; ++v) &#123; visited[v] = FALSE; // è®¿é—®æ•°ç»„æ ‡å¿—åˆå§‹åŒ– &#125; for (v = 0; v &lt; G.vexnum; ++v) &#123; if (!visited[v]) &#123; DFS(G, v); // å¯¹æœªè®¿é—®çš„é¡¶ç‚¹è°ƒç”¨ DFS &#125; &#125;&#125; void DFS(Graph G, int v) &#123; // ä»ç¬¬ v ä¸ªé¡¶ç‚¹å‡ºå‘é€’å½’çš„æ·±åº¦ä¼˜å…ˆéå†å›¾ G. visited[v] = TRUE; VisitFunc(v); // è®¿é—®ç¬¬ v ä¸ªé¡¶ç‚¹ for (w = FirstAdjVex(G, v); w &gt;= 0; w = NextAdjVex(G, v, w)) &#123; if (!visited[w]) &#123; DFS(G, w); // å¯¹ v çš„å°šæœªè®¿é—®çš„é‚»æ¥é¡¶ç‚¹ w é€’å½’è°ƒç”¨ DFS. &#125; &#125;&#125; å¹¿åº¦ä¼˜å…ˆæœç´¢ æœ‰ç‚¹å±‚åºéå†çš„æ„æ€, åœ¨éå†å®Œæ‰€æœ‰æƒ…å†µä¸‹(å¯ä»¥è¿›è¡Œç®—æ³•ä¼˜åŒ–, å¯¹æœ‰äº›æƒ…å†µè¿›è¡Œèˆå¼ƒ)å¯ä»¥å¾—å‡ºæœ€ä¼˜è§£. 123456789101112131415161718192021222324void BFSTraverse(Graph G, Status (* Visit) (int v)) &#123; for (v= 0; v &lt; G.vexnum; ++v) &#123; visited[v] = FALSE; &#125; InitQueue(Q); for (v = 0; v &lt; G.vexnum; ++v) &#123; if (!visited[v]) &#123; visited[v] = TRUE; Visit(v); EnQueue(Q, v); while (!QueueEmpty(Q)) &#123; DeQueue(Q, u); for (w = FirstAdjVex(G, u); w &gt;= 0; w = NextAdjVex(G, u, w)) &#123; // w ä¸º u å°šæœªè®¿é—®çš„é‚»æ¥é¡¶ç‚¹ if (!visited[w]) &#123; visited[w] = TRUE; Visit(w); EnQueue(Q, w); &#125; // if &#125; // for &#125; // while &#125; // if &#125; // for&#125; // BFSTraverse // ä»¥ä¸‹å¾…å¡« 7.3 å›¾çš„è¿é€šæ€§é—®é¢˜ æ— å‘å›¾çš„è¿é€šåˆ†é‡å’Œç”Ÿæˆæ ‘ æœ‰å‘å›¾çš„å¼ºè¿é€šåˆ†é‡ 7.4 æœ€å°ç”Ÿæˆæ ‘ Prim ç®—æ³• O(n2) ä»¥ç‚¹ä¸ºä¸»: ä¸»è¦æ˜¯åˆ†ä¸ºä¸¤ä¸ªé›†åˆ, ä¸€ä¸ªæ˜¯å·²åŠ å…¥çš„èŠ‚ç‚¹, å¦ä¸€ä¸ªæ˜¯æœªåŠ å…¥èŠ‚ç‚¹. åœ¨æœªåŠ å…¥çš„èŠ‚ç‚¹é›†åˆä¸­æ‰¾åˆ°ä¸€ä¸ªç¦»å·²åŠ å…¥é›†åˆæœ€è¿‘çš„èŠ‚ç‚¹åŠ å…¥. ç›´è‡³æ‰€æœ‰èŠ‚ç‚¹è¢«åŠ å…¥. Kruskal ç®—æ³• O(eloge) ä»¥è¾¹ä¸ºä¸»: åˆå§‹æ¡ä»¶æ˜¯æŠŠå›¾çš„æ‰€æœ‰è¾¹å»é™¤å˜æˆ V ä¸ªè¿é€šå›¾. ç„¶åæ¯æ¬¡æ‰¾ä¸€æ¡ä»£ä»·æœ€å°çš„è¾¹åŠ å…¥, ç¡®ä¿æ¯åŠ å…¥ä¸€æ¡è¾¹è¿é€šå›¾ä¸ªæ•°éƒ½å‡å°‘ä¸€ä¸ª(ä¹Ÿå°±æ˜¯ç¡®ä¿æ— ç¯è·¯)ã€‚ç›´è‡³æˆä¸€ä¸ªè¿é€šå›¾æ—¶å°±æ˜¯æœ€å°ç”Ÿæˆæ ‘. 7.5 æœ€çŸ­è·¯å¾„ Dijkstra ç®—æ³• O(n3) ä¸»è¦æ˜¯ç»´æŠ¤ä¸€ä¸ªè¡¨å’Œä¸€ä¸ªå·²åŠ å…¥è·¯å¾„é›†åˆ, è¡¨è®°å½•ä»åŸç‚¹åˆ°æ¯ä¸€ä¸ªç‚¹çš„å½“å‰æœ€å°æƒå€¼. å¦‚æœå·²åŠ å…¥è·¯å¾„é›†åˆä¸­çš„ç‚¹é€šè¿‡æŸæ¡è·¯å¾„å¯¹æœªåŠ å…¥é›†åˆä¸­çš„ç‚¹çš„æœ€å°æƒå€¼æœ‰å½±å“åˆ™æ›´æ–°è¯¥èŠ‚ç‚¹æƒå€¼. æœ€ååœ¨æ¯æ¬¡æ›´æ–°å®Œæˆååˆ¤æ–­ç›®å‰æœªåŠ å…¥é›†åˆä¸­çš„æœ€å°æƒå€¼èŠ‚ç‚¹åŠ å…¥é›†åˆ, å†å¯¹è¯¥èŠ‚ç‚¹çš„è¾¹æ‰€è¾¾çš„èŠ‚ç‚¹åšå¦‚ä¸Šåˆ¤æ–­. æœ€ç»ˆå¯ä»¥æ±‚å‡ºèµ·ç‚¹åˆ°æ¯ä¸€ä¸ªç‚¹çš„æ‰€æœ‰æœ€çŸ­è·¯å¾„. Floyd ç®—æ³• O(n3) ä¸»è¦æ˜¯åˆ¤æ–­ç»è¿‡è¯¥ç‚¹åˆ°è¾¾çš„ä¸´æ—¶ç›®ç‚¹çš„æƒå€¼å’Œè¯¥ç‚¹ç›®å‰æƒå€¼(å¯ä»¥ä¸è€ƒè™‘æ˜¯å¦å·²ç»ç»è¿‡, ä½†æ˜¯å¾ªç¯åªä¼šæ‰«ä¸€éæ‰€ä»¥æ²¡æœ‰ä»€ä¹ˆå½±å“)çš„å¤§å°æ¥åˆ¤æ–­æ˜¯å¦æ›´æ–°æƒå€¼. å…³é”®è·¯å¾„å’Œæ‹“æ‰‘æ’åº (KeyWord : æ¾å¼›) 8 åŠ¨æ€å­˜å‚¨ç®¡ç†æŸ¥æ‰¾","tags":[{"name":"Algo","slug":"Algo","permalink":"http://fitzeng.org/tags/Algo/"},{"name":"Math","slug":"Math","permalink":"http://fitzeng.org/tags/Math/"},{"name":"C/C++","slug":"C-C","permalink":"http://fitzeng.org/tags/C-C/"},{"name":"DataStruct","slug":"DataStruct","permalink":"http://fitzeng.org/tags/DataStruct/"}]},{"title":"Android å•å…ƒæµ‹è¯•å·¥å…· Robolectric ä¸­æ–‡æ–‡æ¡£","date":"2017-07-30T16:00:00.000Z","path":"2017/07/31/robolectric/","text":"ä¸ºä»€ä¹ˆè¦ç¿»è¯‘æ–‡æ¡£? ç”±äºåœ¨å¤§ä¸‰æš‘å‡æ—¶é—´ç®—æ˜¯æ¯”è¾ƒå……è£•çš„, ç„¶ååŠ ä¸Šè‡ªå·±è‹±è¯­æ¯”è¾ƒæ¸£, åˆå¯¹ gitbook æœ‰å…´è¶£, æ‰€ä»¥å°±æƒ³ç¿»è¯‘ä¸€äº›æ–‡æ¡£. å¹³æ—¶ä¹Ÿæ˜¯ä¸€ç›´çœ‹åˆ«äººçš„å¹²è´§, æ‰€ä»¥ä¹Ÿæƒ³è‡ªå·±åšç‚¹è´¡çŒ®, å¸Œæœ›èƒ½å¸®åŠ©è‹±è¯­æ˜¯çŸ­æ¿çš„éƒ¨åˆ†äºº. ä¸ºä»€ä¹ˆæ˜¯ Robolectric? å…¶å®åŸå› å¾ˆç®€å•, å°±æ˜¯æˆ‘ä¹‹å‰å†™è¿‡ä¸€ç¯‡ Android å•å…ƒæµ‹è¯•å’Œ Robolectric æºç è§£æ çš„æ–‡ç« , ç›´æ¥çœ‹çš„äºŒæ‰‹èµ„æ–™, æ„Ÿè§‰è¿™ç§å­¦ä¹ æ–¹å¼å¤ªè¢«åŠ¨äº†, è¦è‡ªå·±å°è¯•å»å•ƒç¬¬ä¸€æ‰‹èµ„æ–™. è€Œæ­£å¥½ç½‘ä¸Šæ²¡æœ‰å¯¹åº”çš„ä¸­æ–‡æ–‡æ¡£åŠ ä¸Šå†…å®¹å°‘, ä¸€ä¸ªäººå¯ä»¥å®Œæˆ, å†åŠ ä¸Šå‰é¢çš„ç¬¬ä¸€ç‚¹å°±ç›´æ¥å¼€å§‹è¡ŒåŠ¨äº†. é˜…è¯»å»ºè®® æˆ‘è‡ªçŸ¥è‡ªå·±æ°´å¹³å¾ˆæ¸£, æ‰€ä»¥ä¸€äº›å®åœ¨æƒ³ä¸é€šçš„ç›´æ¥ç»™å‡ºäº†åŸæ–‡å¯¹åº”çš„è‹±æ–‡æ–‡æ¡£ä¾›å¤§å®¶å‚è€ƒ, å¦‚æœä½ å·²ç»æ˜¯æœ‰äº† 4/6 çº§çš„æ°´å¹³, æ¨èä½ ç›´æ¥çœ‹è‹±æ–‡æ–‡æ¡£, è¿™ä»½å¯ä»¥ä½œå‚è€ƒ. å½“ç„¶å¦‚æœå¯ä»¥çš„è¯, æ¬¢è¿å¤§å®¶ç•™è¨€æå‡ºä¿®æ”¹æ„è§. å¯¹äºç¿»è¯‘éš¾ç†è§£, æœ‰æ­§ä¹‰, æœ‰é”™è¯¯çš„åœ°æ–¹æ¬¢è¿å¤§å®¶æŒ‡å‡ºæ¥. æˆ‘åœ¨æ­¤å…ˆè¡¨ç¤ºæ„Ÿè°¢. é¡¹ç›® Robolectric Robolectric-cn GitHub GitBook å…³äºæˆ‘ ç›®å‰æ˜¯ä¸€ä¸ª Android å¼€å‘è€…, å³å°†æ¯•ä¸šé¢ä¸´å°±ä¸š, å¸Œæœ›åœ¨æ¯•ä¸šå‰åšä¸€äº›è‡ªå·±å–œæ¬¢çš„äº‹æƒ…. åŒæ—¶ä¹Ÿå¸Œæœ›èƒ½è´¡çŒ®è‡ªå·±çš„ä¸€ä»½åŠ›, å’Œå¤§å®¶æ¢è®¨å­¦ä¹ . Blog GitHub","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"},{"name":"Android Unit Test","slug":"Android-Unit-Test","permalink":"http://fitzeng.org/tags/Android-Unit-Test/"}]},{"title":"JavaTips","date":"2017-07-25T03:27:00.000Z","path":"2017/07/25/JavaTips/","text":"è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯ä¸ªäººåœ¨äºŒæ¬¡å­¦ä¹  Java è¿‡ç¨‹ä¸­, å¯¹ Java çš„ä¸€äº›å¸¸è§ç‰¹æ€§è¯¯è§£çš„åˆ†æ. ä¸»è¦æ˜¯ä»¥æµ‹è¯•ä»£ç åŠ æµ‹è¯•ç»“æœçš„å½¢å¼æ¥è®°å½•. è¿™é‡Œåªåšæ”¶é›†æ•´ç†å’Œç®€å•åˆ†æ, è¯¦æƒ…è¯·è§å‚è€ƒé“¾æ¥, æ”¯æŒåŸä½œè€…. ç›®å½• åŸºæœ¬ç±»å‹ == å’Œ equals String, StringBuffer å’Œ StringBuilder Array ArrayList LinkedList Exception Collction åŸºæœ¬æ¦‚å¿µ ç±»å˜é‡å’Œå±€éƒ¨å˜é‡ åŸºæœ¬ç±»å‹== å’Œ equals123456789101112TestCode:Integer a = 100;Integer b = 100;System.out.println(a == b);Integer c = 1000;Integer d = 1000;System.out.println(c == d);Output:truefalse å…¶ä¸­ == ç»“æœä¸ä¸€è‡´æ˜¯å› ä¸º Integer ç±»å¯¹åœ¨ -128 åˆ° 127 ä¹‹é—´çš„æ•°å€¼è¿›è¡Œäº†ç¼“å­˜. 1234567TestCode:Integer e = new Integer(100);Integer f = new Integer(100);System.out.println(e == f);Output:false Integer a = 100;æ¶‰åŠåˆ°è‡ªåŠ¨è£…ç®±é—®é¢˜, åç¼–è¯‘ä¹‹åå°±æ˜¯ Integer a = Integer.valueOf(100);.è€ŒInteger e = new Integer(100); åç¼–è¯‘ä¸æ”¹å˜. æ‰€ä»¥åœ¨ a å’Œ e è¿™ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨çš„å †åŒºåŸŸä¸€ä¸ªæ˜¯é€šè¿‡valueOf()è·å¾—, å¦ä¸€ä¸ªæ˜¯é€šè¿‡newè·å¾—. æ¯«æ— ç–‘é—® new å‡ºæ¥çš„è‚¯å®šä¸ä¼šæ˜¯åŒä¸€å—åŒºåŸŸ. è€Œ valueOf() 123456&gt; public static Integer valueOf(int i) &#123;&gt; if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)&gt; return IntegerCache.cache[i + (-IntegerCache.low)];&gt; return new Integer(i);&gt; &#125;&gt; è¿™é‡Œå°±è§£é‡Šäº†å‰é¢çš„Integer ç±»å¯¹åœ¨ -128 åˆ° 127 ä¹‹é—´çš„æ•°å€¼è¿›è¡Œäº†ç¼“å­˜. è¯¦æƒ…è§æºç . 123456789101112TestCode:String s1 = \"1234\";String s2 = \"1234\";System.out.println(s1 == s2);String s3 = new String(\"1234\");String s4 = new String(\"1234\");System.out.println(s3 == s4);Output:truefalse è¿™ä¸ªæ¯”è¾ƒç®€å•, å°±æ˜¯åœ¨ JVM ä¸­å­˜åœ¨å¸¸é‡æ± . è¿˜æœ‰è¦æ³¨æ„çš„æ˜¯ä¸¤ç§åˆå§‹åŒ–æ–¹å¼çš„ä¸åŒæ‰é€ æˆäº†è¿™ä¸ªå·®å¼‚. ä¸‹é¢åˆ†æ equals ,è¯¦æƒ…è§å‚è€ƒ.è¿™é‡Œåªæå‡ ç‚¹æ˜“æ··æ·†çš„åœ°æ–¹. equals æ˜¯å±äºç±»æ–¹æ³•, è€Œä¸”æ˜¯ Object ç±»çš„. è€Œ Object ç±»çš„å®ç°å°±æ˜¯åˆ¤æ–­å¼•ç”¨æ˜¯å¦ç›¸ç­‰. è€Œå¯¹äºæŸä¸ªç±»æ¥è¯´åˆ¤æ–­ç›¸ç­‰ä¸€èˆ¬æ˜¯åˆ¤æ–­é‡Œé¢çš„æŸäº›æˆå‘˜å˜é‡æ˜¯å¦ç›¸ç­‰. æ‰€ä»¥å°±è¦é‡å†™çˆ¶ç±»æ–¹æ³•.è¿™é‡Œè¦åŒºåˆ†é‡å†™å’Œé‡è½½. 12345&gt; é‡å†™:&gt; public boolean equals(Object obj) &#123;&#125;&gt; é‡è½½:&gt; public boolean equals(MyObject myObj) &#123;&#125;&gt; æ‰€ä»¥è¦æƒ³å®ç°è‡ªå·±æƒ³è¦çš„ equals æ–¹æ³•åº”è¯¥æ˜¯é‡å†™. å…¶å®è¿™é‡Œé¢çš„ä¸»è¦å†…å®¹å°±æ˜¯äº†è§£äº†è‡ªåŠ¨æ‹†è£…ç®±å’Œ JVM å†…åˆ†é…å°±ä¸éš¾äº†. ç¬¬ä¸€ç±»ï¼šæ•´å‹ byte Byte | short Short | int Integer | long Long ç¬¬äºŒç±»ï¼šæµ®ç‚¹å‹ float Float | double Double ç¬¬ä¸‰ç±»ï¼šé€»è¾‘å‹ boolean Boolean ç¬¬å››ç±»ï¼šå­—ç¬¦å‹ char Character åœ¨æ”¯æŒ equals ç‰¹æ€§çš„æ—¶å€™, å¾€å¾€è¿˜è¦æ”¯æŒ hashCode å‚è€ƒ: è®©äººç–‘æƒ‘çš„Javaä»£ç  Javaå­—ç¬¦ä¸²é‚£äº›äº‹å„¿ è¯´è¯´Javaé‡Œçš„equalsï¼ˆä¸Šï¼‰ Javaè‡ªåŠ¨è£…ç®±/æ‹†ç®± è¯´è¯´Javaé‡Œçš„equalsï¼ˆä¸­ï¼‰ String, StringBuffer å’Œ StringBuilder String final ç±». String s=â€sssâ€; ä¼šåœ¨é™æ€å¸¸é‡æ± ä¸­æŸ¥æ‰¾ String s = new String(â€œsssâ€); ç›´æ¥åœ¨å †ä¸­å¼€è¾Ÿå†…å­˜ ä½¿ç”¨åœºåˆ: åœ¨å­—ç¬¦ä¸²ä¸ç»å¸¸å˜åŒ–çš„åœºæ™¯ä¸­å¯ä»¥ä½¿ç”¨ String ç±», å¦‚: å¸¸é‡çš„å£°æ˜, å°‘é‡çš„å˜é‡è¿ç®—ç­‰ StringBuffer çº¿ç¨‹å®‰å…¨, å¯è‡ªèº«ä¿®æ”¹ å¿…é¡»é€šè¿‡æ„é€ å‡½æ•°åˆå§‹åŒ– ä½¿ç”¨åœºåˆ: åœ¨é¢‘ç¹è¿›è¡Œå­—ç¬¦ä¸²çš„è¿ç®—(æ‹¼æ¥, æ›¿æ¢, åˆ é™¤ç­‰), å¹¶ä¸”è¿è¡Œåœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸­, åˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨ StringBuffer, ä¾‹å¦‚ XML è§£æ, HTTP å‚æ•°è§£æå’Œå°è£…ç­‰ StringBuilder çº¿ç¨‹ä¸å®‰å…¨, æ“ä½œæœ€å¿« ä½¿ç”¨åœºåˆ: å’Œ StringBuffer ç±»ä¼¼çš„ä¸è¦æ±‚çº¿ç¨‹å®‰å…¨åœºæ™¯, æ•ˆç‡æ¯” StringBuffer é«˜ Array æ˜¯ä¸€ä¸ªåœ¨ JVM ä¸­çš„ç‰¹æ®Šå¯¹è±¡, å¯ä»¥ä½¿ç”¨åå°„æŸ¥çœ‹ æ‹·è´æ—¶æ³¨æ„æ·±æ‹·è´è¿˜æ˜¯æµ…æ‹·è´ ArrayList é¦–å…ˆè¦çŸ¥é“çš„æ˜¯è¿™æ˜¯ä¸€ä¸ª Array æ‰€ä»¥åœ¨è¿›è¡Œä¿®æ”¹æ“ä½œæ—¶ååˆ†ä¸æ–¹ä¾¿çš„. ç‰¹åˆ«æ˜¯å¢åŠ æˆ–è€…åˆ é™¤å…ƒç´ , æ‰©å¤§å­˜å‚¨ç­‰æ–¹å¼ç›¸æ¯”é“¾è¡¨ç»“æ„æ¥è¯´éº»çƒ¦å¤ªå¤š.çŸ¥é“è¿™ä¸ªä¸ºå‡ºå‘ç‚¹, å¯¹äºæºç å®ç°çš„ç†è§£å°±ç†æ‰€å½“ç„¶äº†.åº”è¯¥äº†è§£çš„å‡ ä¸ªç‚¹ åœ¨ ArrayList ä¸­ä»æœ‰å…ƒç´ å¼€å§‹å°±ä¼šåˆ†é… 10 çš„å¯¹è±¡å¤§å°å®¹é‡. æ¥ä¸‹æ¥ä»¥ currentSize * 1.5 çš„å¤§å°æ‰©å®¹. å¯¹äºä¿®æ”¹ç©ºé—´æ˜¯ä»¥ System.arraycopy() å½¢å¼ä¿®æ”¹çš„. ä¸ºäº†æé«˜æ•ˆç‡é‡‡ç”¨çš„æ˜¯ native æ–¹æ³•. 123&gt; public static native void arraycopy(Object src, &gt; int srcPos, Object dest, int destPos, int length);&gt; è¯¦æƒ…æºç åˆ†æè§å‚è€ƒ. å‚è€ƒ: ArrayListåˆæ¢ å†æ¢ArrayListï¼ˆArrayListçš„æ‰©å®¹ï¼‰ ä¸‰é¡¾ArrayList LinkedList å®ç°æ–¹å¼æ˜¯åŒå‘é“¾è¡¨ Exception å°½å¯èƒ½çš„å‡å°tryå— ä¿è¯æ‰€æœ‰èµ„æºéƒ½è¢«æ­£ç¡®é‡Šæ”¾, å……åˆ†è¿ç”¨finallyå…³é”®è¯ catchè¯­å¥åº”å½“å°½é‡æŒ‡å®šå…·ä½“çš„å¼‚å¸¸ç±»å‹, è€Œä¸åº”è¯¥æŒ‡å®šæ¶µç›–èŒƒå›´å¤ªå¹¿çš„ Exception ç±». ä¸è¦ä¸€ä¸ªExceptionè¯•å›¾å¤„ç†æ‰€æœ‰å¯èƒ½å‡ºç°çš„å¼‚å¸¸ æ—¢ç„¶æ•è·äº†å¼‚å¸¸, å°±è¦å¯¹å®ƒè¿›è¡Œé€‚å½“çš„å¤„ç† åœ¨å¼‚å¸¸å¤„ç†æ¨¡å—ä¸­æä¾›é€‚é‡çš„é”™è¯¯åŸå› ä¿¡æ¯, ç»„ç»‡é”™è¯¯ä¿¡æ¯ä½¿å…¶æ˜“äºç†è§£å’Œé˜…è¯» ä¸è¦åœ¨ finally å—ä¸­å¤„ç†è¿”å›å€¼ ä¸è¦åœ¨æ„é€ å‡½æ•°ä¸­æŠ›å‡ºå¼‚å¸¸ å‚è€ƒ: æ ‘ä¸Šæœˆ Collction List åˆ—è¡¨(å¯é‡å¤) ArrayList (æ•°ç»„) LinkedList (é“¾è¡¨) Map æ˜ å°„(key-value) HashMap extends AbstractMap implements Map table æ•°ç»„ + Enter èŠ‚ç‚¹ é»˜è®¤åˆå§‹å®¹é‡(16) é»˜è®¤åŠ è½½å› å­(0.75) æŸ¥æ‰¾é‡‡ç”¨ static int indexFor(int h, int length) { return h &amp; (length-1); } æé«˜æ•ˆç‡, è€Œä¸æ˜¯å–æ¨¡. TreeMap extends AbstractMap implements NavigableMap interface NavigableMap extends SortedMap interface SortedMap extends Map çº¢é»‘æ ‘ + Enter èŠ‚ç‚¹ Set é›†åˆ(ä¸èƒ½é‡å¤) HashSet extends AbstractSet implements Set å†…éƒ¨åŸºäº HashMap å®ç° TreeSet extends AbstractSet implements NavigableSet interface NavigableSet extends SortedSet interface SortedSet extends Set åŸºäº TreeMap å®ç° åŸºæœ¬æ¦‚å¿µç±»å˜é‡å’Œå±€éƒ¨å˜é‡1234public static void main(String[] args) &#123; int a; System.out.println(a);&#125; ç±»å˜é‡ï¼šå‡†å¤‡é˜¶æ®µã€åˆå§‹åŒ–é˜¶æ®µéƒ½å¯èµ‹å€¼ã€‚å±€éƒ¨å˜é‡ï¼šå‡†å¤‡é˜¶æ®µä¸èƒ½æ£€æµ‹ï¼Œåˆå§‹åŒ–é˜¶æ®µæœªåˆå§‹åŒ–ä¸èƒ½ä½¿ç”¨ã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://fitzeng.org/tags/Java/"},{"name":"Tips","slug":"Tips","permalink":"http://fitzeng.org/tags/Tips/"}]},{"title":"leetcode ç®—æ³•é›†é”¦","date":"2017-07-17T03:27:00.000Z","path":"2017/07/17/AlgoAndMath/","text":"leetcode ç®—æ³•é›†é”¦ ä¸»è¦æ˜¯ç‰›å®¢ç½‘ä¸Š leetcode çš„ç®—æ³•é¢˜å®è·µ. åœ¨ Blog åŒ…å«è‡ªå·±çš„è§£æ³•å’Œå¯¹åˆ«äººä¼˜ç§€è§£æ³•çš„åˆ†æ. åºå· è€ƒç‚¹ é¢˜ç›® C/C++ Java 01 æ ‘ Minimum Depth of Binary Tree NULL é¢˜è§£ 02 æ ˆ evaluate-reverse-polish-notation NULL é¢˜è§£ 02 : evaluate-reverse-polish-notation Evaluate the value of an arithmetic expression in Reverse Polish Notation.Valid operators are+,-,*,/. Each operand may be an integer or another expression. Some examples: [â€œ2â€, â€œ1â€, â€œ+â€, â€œ3â€, â€œâ€œ] -&gt; ((2 + 1) 3) -&gt; 9 [â€œ4â€, â€œ13â€, â€œ5â€, â€œ/â€œ, â€œ+â€] -&gt; (4 + (13 / 5)) -&gt; 6 æˆ‘çš„è§£æ³• 123456789101112131415161718192021222324252627282930313233343536373839404142import java.util.Stack;public class Solution &#123; public int evalRPN(String[] tokens) &#123; Stack&lt;String&gt; s = new Stack&lt;&gt;(); int op1 = 0; int op2 = 0; for (int i = 0; i &lt; tokens.length; i++) &#123; switch (tokens[i]) &#123; case \"+\": &#123; op1 = Integer.parseInt(s.pop()); op2 = Integer.parseInt(s.pop()); s.push(String.valueOf(op2 + op1)); break; &#125; case \"-\": &#123; op1 = Integer.parseInt(s.pop()); op2 = Integer.parseInt(s.pop()); s.push(String.valueOf(op2 - op1)); break; &#125; case \"*\": &#123; op1 = Integer.parseInt(s.pop()); op2 = Integer.parseInt(s.pop()); s.push(String.valueOf(op2 * op1)); break; &#125; case \"/\": &#123; op1 = Integer.parseInt(s.pop()); op2 = Integer.parseInt(s.pop()); s.push(String.valueOf(op2 / op1)); break; &#125; default: &#123; s.push(tokens[i]); break; &#125; &#125; &#125; return Integer.parseInt(s.pop()); &#125;&#125; å…¶ä»–è§£æ³• 12345678910111213141516171819202122232425262728293031import java.util.Stack;public class Solution &#123; public int evalRPN(String[] tokens) &#123; Stack&lt;Integer&gt; stack = new Stack&lt;Integer&gt;(); for(int i = 0;i&lt;tokens.length;i++)&#123; try&#123; int num = Integer.parseInt(tokens[i]); stack.add(num); &#125;catch (Exception e) &#123; int b = stack.pop(); int a = stack.pop(); stack.add(get(a, b, tokens[i])); &#125; &#125; return stack.pop(); &#125; private int get(int a,int b,String operator)&#123; switch (operator) &#123; case \"+\": return a+b; case \"-\": return a-b; case \"*\": return a*b; case \"/\": return a/b; default: return 0; &#125; &#125;&#125; 01 : Minimum Depth of Binary Tree Given a binary tree, find its minimum depth.The minimum depth is the number of nodes along the shortest path from the root node down to the nearest leaf node. æˆ‘çš„è§£æ³• 123456789101112131415æ·±åº¦ä¼˜å…ˆéå†æ‰€æœ‰èŠ‚ç‚¹, ç›´è‡³å¶å­èŠ‚ç‚¹åè¿”å›é•¿åº¦. æ¯æ¬¡å–å½“å‰èŠ‚ç‚¹å·¦å³å­èŠ‚ç‚¹çš„ [æœ€å°å€¼+1] ä¸ºè¯¥èŠ‚ç‚¹çš„æœ€å°æ·±åº¦. public class Solution &#123; public int run(TreeNode root) &#123; if (root == null) &#123; return 0; &#125; int length1 = run(root.left); int length2 = run(root.right); if (length1 == 0 || length2 == 0) &#123; return length1 + length2 + 1; &#125; return Math.min(length1, length2) + 1; &#125;&#125; å…¶ä»–æ€è·¯ 1234567891011121314151617181920212223242526class Solution &#123;public: typedef TreeNode* tree; int run(TreeNode *root) &#123; //é‡‡ç”¨å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œæˆ–è€…å±‚åºéå†ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå¶èŠ‚ç‚¹çš„æ·±åº¦å³æ˜¯æœ€æµ…ã€‚ if(! root) return 0; queue&lt;tree&gt; qu; tree last,now; int level,size; last = now = root; level = 1;qu.push(root); while(qu.size())&#123; now = qu.front(); qu.pop(); size = qu.size(); if(now-&gt;left)qu.push(now-&gt;left); if(now-&gt;right)qu.push(now-&gt;right); if(qu.size()-size == 0)break; if(last == now)&#123; level++; if(qu.size())last = qu.back(); &#125; &#125; return level; &#125;&#125;;","tags":[{"name":"Algo","slug":"Algo","permalink":"http://fitzeng.org/tags/Algo/"},{"name":"Math","slug":"Math","permalink":"http://fitzeng.org/tags/Math/"},{"name":"Java","slug":"Java","permalink":"http://fitzeng.org/tags/Java/"},{"name":"C/C++","slug":"C-C","permalink":"http://fitzeng.org/tags/C-C/"}]},{"title":"Android Blog Collection","date":"2017-07-08T03:27:00.000Z","path":"2017/07/08/AndroidBlogCollection/","text":"this repo aims to collect some high quality basic knowledge Android Blog. Just like source code analysis or something. è¿™ä¸ªä»“åº“è‡´åŠ›äºæ”¶é›†æˆ‘åœ¨å­¦ä¹  Android å¼€å‘è¿‡ç¨‹æ‰€é‡åˆ°çš„é«˜è´¨é‡çš„åŸºç¡€çŸ¥è¯†æ–‡ç« . ç±»ä¼¼äºæºç åˆ†æä¹‹ç±»çš„, å¯ä»¥å¸®å¤§å®¶åŠ æ·±å¯¹åŸºç¡€åŸç†çš„ç†è§£. 0. Start&gt; å‰è¨€ ç°åœ¨ç½‘ç»œä¸Šæœ‰å¤ªå¤šçš„çŸ¥è¯†å¯ä¾›å­¦ä¹ , ä½†æ˜¯ä½œä¸ºä¸€ä¸ªè‡ªå­¦è€…, æ˜¯å¥½äº‹ä¹Ÿæ˜¯åäº‹, å¥½äº‹æŒ‡ä¸ç”¨æ‹…å¿ƒæ²¡èµ„æº, åäº‹æ˜¯æŒ‡å¯¹å­¦ä¹ æ•ˆç‡,ç†è§£ç¨‹åº¦å’ŒçŸ¥è¯†ä½“ç³»æ­å»ºéƒ½ä¸å¤ªå¥½.ç½‘ä¸Šçš„æ–‡ç« ä¸å…¨æ˜¯é«˜è´¨é‡çš„, è€Œä¸”å¾ˆå¤šéƒ½æ˜¯é‡å¤çš„ç¢ç‰‡åŒ–çŸ¥è¯†,å¤§å®¶å†™çš„éƒ½å·®ä¸å¤š.æ‰€ä»¥ä¸ºäº†è‡ªå·±çš„ç³»ç»Ÿå­¦ä¹ , å»ºè®®ä¹°ä¹¦, ç¢°åˆ°å“ªä¸ªæ¨¡å—ä¸æ‡‚å†æ‰¾å¤§ç‰›çš„ Blog åŠ æ·±ç†è§£. æ‰€ä»¥å¯ä»¥çœ‹åˆ°æˆ‘æ¨èçš„åŸºæœ¬éƒ½æ˜¯æˆä¸€ä¸ªå°ä½“ç³»çš„ç³»åˆ—æ–‡ç« , å¯ä»¥å¸®åŠ©æˆ‘ä»¬å½¢æˆä¸€ä¸ªå¥½çš„â€å­¦ä¹ æ€ç»´æ ‘â€. è€Œä¸æ˜¯ä¸€å¤§å †â€æ•£å¶â€. è€Œå…¶ä»–æ–‡ç« ä¸»è¦æ˜¯ä½œä¸ºè‡ªå·±åŠ æ·±ç†è§£, å¯¹æŸä¸ªçŸ¥è¯†ç‚¹æ·±å…¥å­¦ä¹ çš„å‚è€ƒ. é¦–å…ˆå¯ä»¥è‚¯å®šåƒæˆ‘è¿™ç§åˆšåˆšå…¥é—¨çš„åœ¨å†™æ–‡ç« çš„é«˜åº¦å’Œè§†é‡éƒ½ä¸å¦‚å¤§ç‰›. è€Œå¯¹äºåŸºç¡€çš„çŸ¥è¯†,ç‰¹åˆ«æ˜¯æ¶‰åŠæºç è§£æ, åªè¦ä»¥ä¸€ä»½èµ„æ–™ä¸ºä¸»å°±å¯ä»¥äº†. æœ€å¤šåŠ ä¸€ä¸¤ä»½åšå‚è€ƒ. æ‰€ä»¥, åŸºæœ¬è¿™ç§ç±»å‹çš„æ–‡ç« , æˆ‘ä¼šæ”¶è—æ•´ç†åœ¨è¿™ç¯‡æ–‡ç« é‡Œå¹¶ä¸”æ°¸ä¹…æ›´æ–°. åŒæ—¶è‡ªå·±ä¹Ÿä¼šåˆ©ç”¨è¯¾ä½™æ—¶é—´æŠŠè‡ªå·±çš„å®è·µé¡¹ç›®ä»¥ä¸€ä¸ªå…¥é—¨çš„å­¦ä¹ è€…çš„è§†è§’è§£æ, ç›¸ä¿¡è¿™æ ·å¯¹åˆå­¦çš„å¼€å‘è€…æ˜¯æ¯”è¾ƒå‹å¥½çš„.å¦‚æœä½ å’Œæˆ‘ä¹Ÿä¸€æ ·å¤„åœ¨è¿™ä¸ªé˜¶æ®µ, æ¬¢è¿å…³æ³¨è¿™ç¯‡æ–‡ç« . è¿™é‡Œæ°¸ä¹…æ›´æ–°è¿™ç±»åŸºç¡€çŸ¥è¯†è§£è¯». GitHub å’Œ Blog æ°¸ä¹…æ›´æ–°ç»ƒä¹ é¡¹ç›®. å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©æ¬¢è¿ Star ^_^; &gt; æ›´æ–° v3 : æ•¬è¯·æœŸå¾…â€¦ v2 : æ·»åŠ  JVM è®¾è®¡æ¨¡å¼ å¸¸ç”¨æ¡†æ¶ è®¡ç®—æœºåŸºç¡€ å››å¤§æ¨¡å—ä¼˜è´¨ Blog æ”¶é›† v1 : ä»¥ Android View åŸºç¡€çŸ¥è¯†ä¸ºä¸»çš„ Blog æ”¶é›†. 1. UI&gt; View çš„ç»˜åˆ¶æºç è§£æ è¿™é‡Œæ¨èçš„æ˜¯Carson_Hoçš„ä¸€ç³»åˆ—æºç åˆ†ææ•™ç¨‹, ä¸»è¦æ˜¯ä» View å’Œ ViewGroup çš„æµ‹é‡, å¸ƒå±€å’Œç»˜åˆ¶è¿‡ç¨‹è¿›è¡Œè¯¦ç»†åˆ†æ, å¾ˆå¤šå›¾ç¤ºååˆ†æ¸…æ™°æ˜“æ‡‚, å¯¹äºåˆå­¦è€…å’Œè¿›é˜¶è€…éƒ½æ˜¯å¾ˆä¸é”™çš„å­¦ä¹ èµ„æ–™. å¦‚æœæœ‰æ‰¾åˆ°å…¶ä»–çš„å¥½çš„æ•™ç¨‹æˆ‘è¿˜ä¼šç»§ç»­åŠ ä¸Š. è‡ªå®šä¹‰ViewåŸºç¡€ - æœ€æ˜“æ‡‚çš„è‡ªå®šä¹‰ViewåŸç†ç³»åˆ—(1) è‡ªå®šä¹‰View Measureè¿‡ç¨‹ - æœ€æ˜“æ‡‚çš„è‡ªå®šä¹‰ViewåŸç†ç³»åˆ—(2) è‡ªå®šä¹‰View Layoutè¿‡ç¨‹ - æœ€æ˜“æ‡‚çš„è‡ªå®šä¹‰ViewåŸç†ç³»åˆ—(3) è‡ªå®šä¹‰View Drawè¿‡ç¨‹- æœ€æ˜“æ‡‚çš„è‡ªå®šä¹‰ViewåŸç†ç³»åˆ—(4) å‰é¢ç»™äº† View çš„ç»˜åˆ¶æœ€ä¸»è¦çš„ä¸‰ä¸ªè¿‡ç¨‹è¿›è¡Œäº†è¯¦ç»†åˆ†æçš„ Blog, åœ¨å‰é¢çš„é˜…è¯»åŸºç¡€ä¸Š,ä¸‹é¢ç»™å‡ºéƒ­éœ–å¤§ç¥çš„ View çš„å·¥ä½œåŸç†ç³»åˆ—æ–‡ç« . ç›¸ä¿¡åœ¨è¯»å®Œä»¥ä¸‹å››ç¯‡æ–‡ç« ä¹‹åä½ ä¼šå¯¹ View æœ‰ä¸€ä¸ªé‡æ–°è®¤è¯†çš„. Android LayoutInflateråŸç†åˆ†æï¼Œå¸¦ä½ ä¸€æ­¥æ­¥æ·±å…¥äº†è§£View(ä¸€) Androidè§†å›¾ç»˜åˆ¶æµç¨‹å®Œå…¨è§£æï¼Œå¸¦ä½ ä¸€æ­¥æ­¥æ·±å…¥äº†è§£View(äºŒ) Androidè§†å›¾çŠ¶æ€åŠé‡ç»˜æµç¨‹åˆ†æï¼Œå¸¦ä½ ä¸€æ­¥æ­¥æ·±å…¥äº†è§£View(ä¸‰) Androidè‡ªå®šä¹‰Viewçš„å®ç°æ–¹æ³•ï¼Œå¸¦ä½ ä¸€æ­¥æ­¥æ·±å…¥äº†è§£View(å››) ä¸‹é¢ä»‹ç»æ‰”ç‰©çº¿çš„HenCoderï¼šç»™é«˜çº§ Android å·¥ç¨‹å¸ˆçš„è¿›é˜¶æ‰‹å†Œ, åŒ…å«äº†è§†é¢‘è®²è§£. ç›®å‰æŒç»­æ›´æ–°, åœ¨å­¦ä¹ å®Œå‰é¢çš„ Blog å¹¶è¿›è¡Œäº†éƒ¨åˆ†å®è·µ Demo åæŠŠè¿™å½“åšå¤ä¹ æé«˜æŒºä¸é”™çš„, åŒæ—¶æˆ‘ä¹Ÿä¼šä¸€ç›´å…³æ³¨å¹¶æ›´æ–°. HenCoder Android å¼€å‘è¿›é˜¶: è‡ªå®šä¹‰ View 1-1 ç»˜åˆ¶åŸºç¡€ &gt; View ç›¸å…³ç±»è§£æ è¿™ä¸ªä¸»è¦æ˜¯ä»‹ç»ä¸€äº›å¯¹è‡ªå®šä¹‰ View è¿‡ç¨‹ä¸­éœ€è¦ä»”ç»†äº†è§£çš„ä¸€äº›ç±»çš„ä½¿ç”¨. Pathç±»çš„æœ€å…¨é¢è¯¦è§£ - è‡ªå®šä¹‰Viewåº”ç”¨ç³»åˆ— Canvasç±»çš„æœ€å…¨é¢è¯¦è§£ - è‡ªå®šä¹‰Viewåº”ç”¨ç³»åˆ— &gt; XML ä½¿ç”¨ç¤ºä¾‹ è¿™é‡Œæ¨èKeeganå°é’¢çš„Androidæ ·å¼çš„å¼€å‘ç›¸å…³æ•™ç¨‹, é€šè¿‡ååˆ†ç®€æ´çš„å°ä¾‹å­å¸®ä½ å¿«é€Ÿå®ç°å¯¹ XML çš„äº†è§£å’Œä½¿ç”¨. Androidæ ·å¼çš„å¼€å‘:shapeç¯‡ Androidæ ·å¼çš„å¼€å‘:selectorç¯‡ Androidæ ·å¼çš„å¼€å‘:layer-listç¯‡ Androidæ ·å¼çš„å¼€å‘:drawableæ±‡æ€»ç¯‡ Androidæ ·å¼çš„å¼€å‘:View Animationç¯‡ Androidæ ·å¼çš„å¼€å‘:Property Animationç¯‡ Androidæ ·å¼çš„å¼€å‘:Styleç¯‡ &gt; åŠ¨ç”» Android åŠ¨ç”»ä»‹ç», æ„Ÿè°¢é˜¿ç¥¥JOKER åˆ†äº«. AndroidåŠ¨ç”»è§£æ é‡ç‚¹!!!è¿™é‡Œè¿˜æ˜¯æ¨èéƒ­éœ–å¤§ç¥çš„æ–‡ç« . ç„¶ååé¢è¡¥å……ä¸€ç¯‡åçŸ¥è¯†ç‚¹å¼çš„æ–‡ç« ä¾›å¤ä¹ . Androidå±æ€§åŠ¨ç”»å®Œå…¨è§£æ(ä¸Š)ï¼Œåˆè¯†å±æ€§åŠ¨ç”»çš„åŸºæœ¬ç”¨æ³• Androidå±æ€§åŠ¨ç”»å®Œå…¨è§£æ(ä¸­)ï¼ŒValueAnimatorå’ŒObjectAnimatorçš„é«˜çº§ç”¨æ³• Androidå±æ€§åŠ¨ç”»å®Œå…¨è§£æ(ä¸‹)ï¼ŒInterpolatorå’ŒViewPropertyAnimatorçš„ç”¨æ³• è¡¥å……å‚è€ƒ:AndroidåŠ¨ç”»ï¼Œä¸€ç¯‡å°±å¤Ÿ, æ„Ÿè°¢Shaunç™½ä¸€è¾°çš„åˆ†äº«. &gt; äº‹ä»¶åˆ†å‘ äº‹ä»¶åˆ†å‘æ˜¯ä¸€ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹, åœ¨é¢è¯•ä¸­ä¹Ÿæœ‰å¾ˆå¤§å‡ ç‡è¢«é—®åˆ°.åœ¨å¼€å‘ä¸­ç»å¸¸ä¼šé‡åˆ°, åªæœ‰å½»åº•ç†è§£å¥½äº†åœ¨å†™ä»£ç æ—¶å€™æ‰èƒ½æ€è·¯æ¸…æ™°.å¸Œæœ›ä»¥ä¸‹æ–‡ç« èƒ½å¸®åŠ©ä½ æˆ‘å¼„æ¸…äº‹ä»¶åˆ†å‘æœºåˆ¶. Androidäº‹ä»¶åˆ†å‘æœºåˆ¶è¯¦è§£ï¼šå²ä¸Šæœ€å…¨é¢ã€æœ€æ˜“æ‡‚ &gt; è‡ªæˆä½“ç³»çš„ View æ•™ç¨‹ è¿™é‡Œä¸»è¦æ˜¯æ¨èä¸€äº›å…¶ä»–ä¼˜ç§€æ–‡ç« ä½œä¸ºå‚è€ƒé˜…è¯», åŒæ ·ä¹Ÿæ˜¯è‡ªæˆä½“ç³»çš„. GcsSloop : å®‰å“è‡ªå®šä¹‰Viewæ•™ç¨‹ç›®å½• 2. Java API è¿™é‡Œä¸»è¦æ˜¯å¯¹ Java API ä¸­çš„ä¸€äº›é‡è¦çš„æºç è§£æè¿›è¡Œæ”¶é›†. åŒæ—¶ä¹Ÿæ˜¯é¢è¯•é‡ç‚¹, å¸Œæœ›èƒ½åŠ æ·±å¯¹ Java çš„è®¤è¯†. åšåˆ°çœŸçš„ç†è§£åº•å±‚å®ç°è€Œä¸æ˜¯åªä¼šä½¿ç”¨. ç”±äº Java é¢å¤ªå¹¿, æ‰€ä»¥åœ¨è¿™é‡Œä¸»è¦æ˜¯ä»¥çŸ¥è¯†ç‚¹çš„å½¢å¼è¦†ç›–åŸºæœ¬æ¦‚å¿µ. è¿™é‡Œæ¨è æ ‘ä¸Šæœˆ çš„æ•™ç¨‹. ä» Blog ä»‹ç»çœ‹æ¥è§¦ Java æœ‰ä¸€æ®µæ—¶é—´, æ‰€ä»¥åˆ†æä¼šæ¯”è¾ƒæ·±å…¥ä¸”æ­£ç¡®. æ›´ä¸»è¦çš„æ˜¯, ä»–æŠŠ Java ç±»æ–‡ç« åŸºæœ¬éƒ½ä¸²èµ·æ¥äº†, å…±æœ‰ 38 ç¯‡å¯ä¾›å­¦ä¹ . æ–‡ç« å¤ªå¤šå°±ä¸ä¸€ä¸€è´´é“¾æ¥äº†â€¦ æƒ³å­¦Java, å€¼å¾—ä¸€é˜… 3. æµ…æJVM å½“ç„¶è¿™å—çŸ¥è¯†ä¼šæ¨èä¸€æœ¬ä¹¦, æ˜¯ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ï¼Œ è€Œç½‘ä¸Šçš„é‚£äº›åˆ†æå¤§å¤šæ•°éƒ½æ˜¯åŸºäºè¿™æœ¬ä¹¦çš„ã€‚è¿™é‡Œä¼šæ”¶é›†ä¸€äº›è¾ƒå¥½çš„è®²è§£å…±åœ¨çº¿é˜…è¯»ã€‚ 4. æ·±å…¥ç†è§£è®¾è®¡æ¨¡å¼ è¿™å—ä¹Ÿæœ‰ä¸€æœ¬ä¹¦ã€ŠAndroid æºç è®¾è®¡æ¨¡å¼è§£æä¸å®æˆ˜ã€‹æ¨è. Java çš„ 23 ç§è®¾è®¡æ¨¡å¼å…¨è§£æ LoveLionï¼šå²ä¸Šæœ€å…¨è®¾è®¡æ¨¡å¼å¯¼å­¦ç›®å½•ï¼ˆå®Œæ•´ç‰ˆï¼‰ 5. Android å¸¸ç”¨æ¡†æ¶åˆ†æ6. Android - ä»æ–‡ä»¶åˆ°é¡¹ç›®çš„æœ€åä¸€ç±³ ä¸»è¦æ˜¯æä¾›å¼€å‘è¿‡ç¨‹ä¸­çš„éä»£ç æŠ€æœ¯æ€§é—®é¢˜çš„çŸ¥è¯†ä»‹ç»å’Œè§£å†³æ–¹æ¡ˆã€‚ Android é¡¹ç›®ç¼–è¯‘è¿‡ç¨‹ Android ä½¿ç”¨android-support-multidexè§£å†³Dexè¶…å‡ºæ–¹æ³•æ•°çš„é™åˆ¶é—®é¢˜,è®©ä½ çš„åº”ç”¨ä¸å†çˆ†æ£š 7. è®¡ç®—æœºåŸºç¡€&gt; æ•°æ®åº“å¦‚æœæœ‰äººé—®ä½ æ•°æ®åº“çš„åŸç†ï¼Œå«ä»–çœ‹è¿™ç¯‡æ–‡ç«  &gt; ç½‘ç»œ&gt; æ“ä½œç³»ç»Ÿ","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"},{"name":"Collection","slug":"Collection","permalink":"http://fitzeng.org/tags/Collection/"}]},{"title":"Common Sense","date":"2017-07-05T02:00:00.000Z","path":"2017/07/05/tips/","text":"this aticle aims to collect some common sense when you meet during dev.è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•æˆ‘åœ¨ Android å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›æ¦‚å¿µé—®é¢˜, åœ¨è¿™é‡Œæä¾›ç®€å•å¿«é€Ÿçš„ä½¿ç”¨è§„èŒƒ. å¼€æºé¡¹ç›®è®¸å¯è¯ çœ‹æ‡‚UMLç±»å›¾ å¼€æºé¡¹ç›®è®¸å¯è¯MITã€GPLv2å’ŒApacheå æ®äº†å‰ä¸‰ä½ã€‚choosealicense.comä¸ºè®¸å¯è¯çš„é€‰æ‹©ç»™å‡ºäº†å»ºè®®. MITæ˜¯ä¸€ä¸ªå‡ ä¹å¯ä»¥â€œä¸ºæ‰€æ¬²ä¸ºâ€çš„è®¸å¯è¯ï¼Œå¦‚æœä½ å¸Œæœ›ç®€å•ã€å®½æ¾ï¼Œå®ƒæ˜¯ä½ çš„ä¸äºŒé€‰æ‹©. å¦‚æœä½ å…³å¿ƒè½¯ä»¶çš„ä¸“åˆ©é—®é¢˜ï¼Œä½†åŒæ ·å¸Œæœ›å®½æ¾ï¼Œå¯ä»¥é€‰æ‹©Apache. å¦‚æœä½ å¸Œæœ›ä»£ç ä½¿ç”¨è€…åŒæ ·èƒ½æŠŠä»–ä»¬çš„è´¡çŒ®åˆ†äº«å‡ºæ¥ï¼Œé‚£å°±é€‰æ‹©GPL. å‚è€ƒ: æ›¹çŸ¥æ¸Š : GitHubå‘å¸ƒå¼€æºè®¸å¯è¯ä½¿ç”¨æƒ…å†µ çœ‹æ‡‚UMLç±»å›¾ æ³›åŒ–å…³ç³» (Aç»§æ‰¿è‡ªB) eg: å®ç°å…³ç³» (ç»§æ‰¿æŠ½è±¡ç±») èšåˆå…³ç³»( A èšåˆåˆ° B ä¸Šæˆ–è€… B ç”± A ç»„æˆ) èšåˆå…³ç³»ç”¨äºè¡¨ç¤ºå®ä½“å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œè¡¨ç¤ºæ•´ä½“ç”±éƒ¨åˆ†æ„æˆçš„è¯­ä¹‰ï¼›ä¾‹å¦‚ä¸€ä¸ªéƒ¨é—¨ç”±å¤šä¸ªå‘˜å·¥ç»„æˆï¼› ä¸ç»„åˆå…³ç³»ä¸åŒçš„æ˜¯ï¼Œæ•´ä½“å’Œéƒ¨åˆ†ä¸æ˜¯å¼ºä¾èµ–çš„ï¼Œå³ä½¿æ•´ä½“ä¸å­˜åœ¨äº†ï¼Œéƒ¨åˆ†ä»ç„¶å­˜åœ¨ï¼›ä¾‹å¦‚ï¼Œ éƒ¨é—¨æ’¤é”€äº†ï¼Œäººå‘˜ä¸ä¼šæ¶ˆå¤±ï¼Œä»–ä»¬ä¾ç„¶å­˜åœ¨ï¼› ç»„åˆå…³ç³»( A ç»„æˆ B æˆ–è€… B ç”± A ç»„æˆ) ä¸èšåˆå…³ç³»ä¸€æ ·ï¼Œç»„åˆå…³ç³»åŒæ ·è¡¨ç¤ºæ•´ä½“ç”±éƒ¨åˆ†æ„æˆçš„è¯­ä¹‰ï¼›æ¯”å¦‚å…¬å¸ç”±å¤šä¸ªéƒ¨é—¨ç»„æˆï¼› ä½†ç»„åˆå…³ç³»æ˜¯ä¸€ç§å¼ºä¾èµ–çš„ç‰¹æ®Šèšåˆå…³ç³»ï¼Œå¦‚æœæ•´ä½“ä¸å­˜åœ¨äº†ï¼Œåˆ™éƒ¨åˆ†ä¹Ÿä¸å­˜åœ¨äº†ï¼›ä¾‹å¦‚ï¼Œ å…¬å¸ä¸å­˜åœ¨äº†ï¼Œéƒ¨é—¨ä¹Ÿå°†ä¸å­˜åœ¨äº†ï¼› å…³è”å…³ç³» å®ƒæè¿°ä¸åŒç±»çš„å¯¹è±¡ä¹‹é—´çš„ç»“æ„å…³ç³»ï¼›å®ƒæ˜¯ä¸€ç§é™æ€å…³ç³»ï¼Œ é€šå¸¸ä¸è¿è¡ŒçŠ¶æ€æ— å…³ï¼Œä¸€èˆ¬ç”±å¸¸è¯†ç­‰å› ç´ å†³å®šçš„ï¼›å®ƒä¸€èˆ¬ç”¨æ¥å®šä¹‰å¯¹è±¡ä¹‹é—´é™æ€çš„ã€å¤©ç„¶çš„ç»“æ„ï¼› æ‰€ä»¥ï¼Œå…³è”å…³ç³»æ˜¯ä¸€ç§â€œå¼ºå…³è”â€çš„å…³ç³»ï¼› æ¯”å¦‚ï¼Œä¹˜è½¦äººå’Œè½¦ç¥¨ä¹‹é—´å°±æ˜¯ä¸€ç§å…³è”å…³ç³»ï¼›å­¦ç”Ÿå’Œå­¦æ ¡å°±æ˜¯ä¸€ç§å…³è”å…³ç³»ï¼› å…³è”å…³ç³»é»˜è®¤ä¸å¼ºè°ƒæ–¹å‘ï¼Œè¡¨ç¤ºå¯¹è±¡é—´ç›¸äº’çŸ¥é“ï¼›å¦‚æœç‰¹åˆ«å¼ºè°ƒæ–¹å‘ï¼Œå¦‚ä¸‹å›¾ï¼Œè¡¨ç¤ºAçŸ¥é“Bï¼Œä½† Bä¸çŸ¥é“Aï¼› åœ¨æœ€ç»ˆä»£ç ä¸­ï¼Œå…³è”å¯¹è±¡é€šå¸¸æ˜¯ä»¥æˆå‘˜å˜é‡çš„å½¢å¼å®ç°çš„ï¼› ä¾èµ–å…³ç³» ( A ä¾èµ–äº B ) ä»–æè¿°ä¸€ä¸ªå¯¹è±¡åœ¨è¿è¡ŒæœŸé—´ä¼šç”¨åˆ°å¦ä¸€ä¸ªå¯¹è±¡çš„å…³ç³»ï¼› ä¸å…³è”å…³ç³»ä¸åŒçš„æ˜¯ï¼Œå®ƒæ˜¯ä¸€ç§ä¸´æ—¶æ€§çš„å…³ç³»ï¼Œé€šå¸¸åœ¨è¿è¡ŒæœŸé—´äº§ç”Ÿï¼Œå¹¶ä¸”éšç€è¿è¡Œæ—¶çš„å˜åŒ–ï¼› ä¾èµ–å…³ç³»ä¹Ÿå¯èƒ½å‘ç”Ÿå˜åŒ–ï¼› æ˜¾ç„¶ï¼Œä¾èµ–ä¹Ÿæœ‰æ–¹å‘ï¼ŒåŒå‘ä¾èµ–æ˜¯ä¸€ç§éå¸¸ç³Ÿç³•çš„ç»“æ„ï¼Œæˆ‘ä»¬æ€»æ˜¯åº”è¯¥ä¿æŒå•å‘ä¾èµ–ï¼Œæœç»åŒå‘ä¾èµ–çš„äº§ç”Ÿï¼› åœ¨æœ€ç»ˆä»£ç ä¸­ï¼Œä¾èµ–å…³ç³»ä½“ç°ä¸ºç±»æ„é€ æ–¹æ³•åŠç±»æ–¹æ³•çš„ä¼ å…¥å‚æ•°ï¼Œç®­å¤´çš„æŒ‡å‘ä¸ºè°ƒç”¨å…³ç³»ï¼›ä¾èµ–å…³ç³»é™¤äº†ä¸´æ—¶çŸ¥é“å¯¹æ–¹å¤–ï¼Œè¿˜æ˜¯â€œä½¿ç”¨â€å¯¹æ–¹çš„æ–¹æ³•å’Œå±æ€§ï¼› å®ä¾‹ è½¦çš„ç±»å›¾ç»“æ„ä¸º&lt;&gt;ï¼Œè¡¨ç¤ºè½¦æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼› å®ƒæœ‰ä¸¤ä¸ªç»§æ‰¿ç±»ï¼šå°æ±½è½¦å’Œè‡ªè¡Œè½¦ï¼›å®ƒä»¬ä¹‹é—´çš„å…³ç³»ä¸ºå®ç°å…³ç³»ï¼Œä½¿ç”¨å¸¦ç©ºå¿ƒç®­å¤´çš„è™šçº¿è¡¨ç¤ºï¼› å°æ±½è½¦ä¸ºä¸SUVä¹‹é—´ä¹Ÿæ˜¯ç»§æ‰¿å…³ç³»ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»ä¸ºæ³›åŒ–å…³ç³»ï¼Œä½¿ç”¨å¸¦ç©ºå¿ƒç®­å¤´çš„å®çº¿è¡¨ç¤ºï¼› å°æ±½è½¦ä¸å‘åŠ¨æœºä¹‹é—´æ˜¯ç»„åˆå…³ç³»ï¼Œä½¿ç”¨å¸¦å®å¿ƒç®­å¤´çš„å®çº¿è¡¨ç¤ºï¼› å­¦ç”Ÿä¸ç­çº§ä¹‹é—´æ˜¯èšåˆå…³ç³»ï¼Œä½¿ç”¨å¸¦ç©ºå¿ƒç®­å¤´çš„å®çº¿è¡¨ç¤ºï¼› å­¦ç”Ÿä¸èº«ä»½è¯ä¹‹é—´ä¸ºå…³è”å…³ç³»ï¼Œä½¿ç”¨ä¸€æ ¹å®çº¿è¡¨ç¤ºï¼› å­¦ç”Ÿä¸Šå­¦éœ€è¦ç”¨åˆ°è‡ªè¡Œè½¦ï¼Œä¸è‡ªè¡Œè½¦æ˜¯ä¸€ç§ä¾èµ–å…³ç³»ï¼Œä½¿ç”¨å¸¦ç®­å¤´çš„è™šçº¿è¡¨ç¤ºï¼› æ³¨: â€œçœ‹æ‡‚UMLç±»å›¾â€ å†…å®¹å…¨éƒ¨å–æè‡ªè¯¥ç½‘é¡µ. åœ¨æ­¤åšå‡ºæ„Ÿè°¢, å‡ºäºå­¦ä¹ æ€»ç»“ç›®çš„ç‰¹æ„æŠŠå†…å®¹æ¬è‡³æ­¤å¤„, å¦‚æœ‰ä¾µæƒç«‹å³åˆ é™¤. å‚è€ƒ: congestion : UMLç±»å›¾å…³ç³»ï¼ˆæ³›åŒ– ã€ç»§æ‰¿ã€å®ç°ã€ä¾èµ–ã€å…³è”ã€èšåˆã€ç»„åˆï¼‰","tags":[{"name":"Tips","slug":"Tips","permalink":"http://fitzeng.org/tags/Tips/"}]},{"title":"BMPå‹ç¼©æˆJPEGè¿‡ç¨‹å®ç°ä¸åˆ†æ","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/BMP2JPEG/","text":"GitHub å‰è¨€ç”±äºæœ€è¿‘åšäº†å›¾åƒç›¸å…³çš„å­¦ä¹ ï¼Œæ‰€ä»¥æƒ³å†æ·±å…¥ç‚¹ï¼Œä½†æ˜¯è‡ªå·±çš„çŸ¥è¯†æœ‰é™ï¼Œç›®å‰åªèƒ½æŠŠè‡ªå·±æ‰€å­¦çš„é€šè¿‡è¿™ä¸ªå°å°çš„å®éªŒæ¥åŠ æ·±ç†è§£ã€‚å‚è€ƒå¤§ç‰›çš„ Blog åŠ ä¸Šè‡ªå·±äº²æ‰‹å®è·µï¼Œå†™äº†è¿™ç¯‡æ–‡ç« ã€‚ä»¥åè¿˜ä¼šç»§ç»­æ·»åŠ å›¾åƒå¤„ç†çš„ç›¸å…³çŸ¥è¯†ã€‚ BMPä»‹ç» BMPæ–‡ä»¶å¤´æ–‡ä»¶å¤´ä¸»è¦æ˜¯åŒ…å«ä¸€ä¸ªæ–‡ä»¶çš„IDä¿¡æ¯ï¼Œæ‰€ä»¥BMPçš„æ–‡ä»¶å¤´è‡ªç„¶ä¹Ÿæ˜¯è¯´æ˜è‡ªå·±çš„æ–‡ä»¶æ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ç­‰ä¿¡æ¯ï¼Œä¸€èˆ¬æ˜¯14ä½è¡¨ç¤ºã€‚æ„ä¹‰å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä½å›¾ä¿¡æ¯å¤´ä¿¡æ¯å¤´ä¸»è¦æ˜¯å¯¹å›¾ç‰‡ç‰¹å¾çš„æè¿°ï¼Œæ¯”å¦‚è¯´å®½é«˜ï¼Œåƒç´ ï¼Œå‹ç¼©æ–¹å¼ç­‰ï¼Œä¸€èˆ¬æ˜¯40ä½ã€‚ä¸»è¦ä»‹ç»å¦‚ä¸‹è¡¨ï¼š è°ƒè‰²æ¿è°ƒè‰²æ¿æ˜¯å¯é€‰çš„ï¼Œä½¿ç”¨ç´¢å¼•æ¥è¡¨ç¤ºå›¾åƒï¼Œè°ƒè‰²æ¿å°±æ˜¯ç´¢å¼•ä¸å…¶å¯¹åº”çš„é¢œè‰²çš„æ˜ å°„è¡¨ï¼Œè¿™æ¬¡å®éªŒé€‰ç”¨çš„æ˜¯24bitçš„å›¾ç‰‡ã€‚ ä½å›¾æ•°æ®è¿™é‡Œå°±æ˜¯å­˜å‚¨å›¾ç‰‡çš„å†…å®¹äº†ã€‚ JPEGä»‹ç»JPEGæ˜¯æœ‰æŸå‹ç¼©ç¼–ç ä¸‹çš„ä¸€ç§å›¾ç‰‡æ ¼å¼ï¼Œç›®å‰å‹ç¼©æ•ˆæœå¥½ï¼Œåº”ç”¨å¹¿æ³›ã€‚å…¶åŸç†ä¸»è¦æ˜¯å°†ä¼ ç»Ÿçš„RGBæ¨¡å¼ä¸‹çš„å›¾ç‰‡è½¬åŒ–æˆYCbCræ ¼å¼ã€‚å› ä¸ºäººçœ¼çš„ç»“æ„é—®é¢˜å¯¹äº®åº¦æ›´åŠ æ•æ„Ÿï¼Œæ‰€ä»¥å¯ä»¥å°†äº®åº¦å’Œè‰²åº¦åˆ†ç¦»å¼€æ¥ï¼Œå¯¹è‰²åº¦å¯è¿›è¡Œè¾ƒå¤§çš„èˆå¼ƒä»è€Œè¿›è¡Œè¾ƒå¤§ç¨‹åº¦çš„å‹ç¼©è€Œå¯¹è§†è§‰ä¸é€ æˆå¤ªå¤§å½±å“ã€‚æ—¢ç„¶æ˜¯å‹ç¼©è€Œæˆçš„æ ¼å¼ï¼Œé‚£å¿…ç„¶æœ‰è§£å‹ç¼©è¿‡ç¨‹ï¼Œè€Œè§£å‹ç¼©æ‰€ä»¥ä¾èµ–çš„é‡åŒ–è¡¨å’Œå“ˆå¤«æ›¼è¡¨è‡ªç„¶è¦è®°å½•ä¸‹æ¥ã€‚æ‰€ä»¥å’ŒBMPå¯¹æ¯”è‡ªç„¶è€Œç„¶å¤´ç»“æ„å‡ºæ¥äº†ï¼Œè€Œä¸”è¦æ¯”BMPå¤æ‚ã€‚ä¸‹é¢åªç»™å‡ºéƒ¨åˆ†ä¿¡æ¯ï¼š BMP è¯»å– æ„å»ºBMPçš„æ–‡ä»¶å¤´å’Œå¤´ä¿¡æ¯ç»“æ„ä½“ 12345678910111213141516171819202122//BMP æ–‡ä»¶æ ¼å¼ã€æ–‡ä»¶å¤´å’Œå¤´éƒ¨ä¿¡æ¯ã€‘typedef struct &#123; unsigned short bfType; unsigned int bfSize; unsigned short bfReserved1; unsigned short bfReserved2; unsigned int bfOffBits;&#125; BITMAPFILEHEADER;typedef struct &#123; unsigned int biSize; int biWidth; int biHeight; unsigned short biPlanes; unsigned short biBitCount; unsigned int biCompression; unsigned int biSizeImage; int biXPelsPerMeter; int biYPelsPerMeter; unsigned int biClrUsed; unsigned int biClrImportant;&#125; BITMAPINFOHEADER; å›¾ç‰‡æ ¡éªŒ 1234567891011121314151617181920212223242526272829303132//æ‰“å¼€æ–‡ä»¶FILE* fp = fopen(fileName, \"rb\");if(fp==0) &#123; return false;&#125;BITMAPFILEHEADER fileHeader;BITMAPINFOHEADER infoHeader;// è¯»å–å¤´éƒ¨ 14å­—èŠ‚if(1 != fread(&amp;fileHeader, sizeof(fileHeader), 1, fp)) &#123; return false;&#125;// åˆ¤æ–­æ˜¯ä¸æ˜¯BMç±»å‹if(fileHeader.bfType!=0x4D42) &#123; return false;&#125;// è¯»å–å¤´éƒ¨ä¿¡æ¯ 40å­—èŠ‚if(1 != fread(&amp;infoHeader, sizeof(infoHeader), 1, fp)) &#123; return false;&#125;// åˆ¤æ–­æ˜¯ä¸æ˜¯24ä½ç±»å‹ã€‚ä¹Ÿå°±æ˜¯RGBçš„å­˜å‚¨æ ¼å¼if(infoHeader.biBitCount != 24 || infoHeader.biCompression != 0) &#123; return false;&#125;int width = infoHeader.biWidth;int height = infoHeader.biHeight &lt; 0 ? (-infoHeader.biHeight) : infoHeader.biHeight;// åˆ¤æ–­äºŒè¿›åˆ¶çš„æœ€åä¸‰ä½æ˜¯ä¸æ˜¯000ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­æ˜¯ä¸æ˜¯8çš„å€æ•°if((width&amp;7) != 0 || (height&amp;7) != 0) &#123; return false;&#125; å›¾ç‰‡å†…å®¹è¯»å– 123456789101112131415161718192021222324252627// RGBä¸‰ä¸ªåˆ†é‡int bmpSize = width*height*3;unsigned char* buffer = new unsigned char[bmpSize];if(buffer == 0) &#123; return false;&#125;// å°†æ–‡ä»¶æŒ‡é’ˆç§»åˆ°æ•°æ®åŒºåŸŸfseek(fp, fileHeader.bfOffBits, SEEK_SET);if(infoHeader.biHeight &gt; 0) &#123; for(int i = 0; i &lt; height; i++) &#123; // è¯»å–ç¬¬iè¡Œ,æ¯æ­¤è¯» 3ï¼ˆsizeï¼‰ * width ï¼ˆcountï¼‰å¤§å° if(width != fread(buffer + (height - 1 - i) * width * 3, 3, width, fp)) &#123; delete[] buffer; buffer = 0; return false; &#125; &#125;&#125; else &#123; if(width*height != fread(buffer, 3, width*height, fp)) &#123; delete[] buffer; buffer = 0; return false; &#125;&#125; å­˜å‚¨ä¿¡æ¯ 1234567// è·å–å®½é«˜å’Œå¤§å°m_rgbBuffer = buffer;m_width = width;m_height = height;fclose(fp);fp=0; JPEG å†™å…¥åœ¨å‰æœŸJPEGå†™å…¥æ˜¯ï¼Œè¦è¿›è¡Œä¸€ç³»åˆ—å‡†å¤‡å·¥ä½œï¼Œæ ¹æ®JPEGå®˜æ–¹æä¾›çš„æ ‡å‡†é‡åŒ–è¡¨å’Œå“ˆå¤«æ›¼è¡¨è¿›è¡Œè‡ªå·±çš„æ“ä½œå¾—åˆ°è‡ªå·±æ»¡æ„çš„å‹ç¼©ç¼–ç ã€‚ æ•°å€¼è¡¨ï¼š ç›´æµåˆ†é‡è¡¨ï¼š äº¤æµåˆ†é‡è¡¨ï¼š ä¸‹é¢ç»™å‡ºå…·ä½“ä»£ç ï¼š äº®åº¦é‡åŒ–è¡¨ 1234567891011// äº®åº¦é‡åŒ–è¡¨const unsigned char Luminance_Quantization_Table[64] = &#123; 16, 11, 10, 16, 24, 40, 51, 61, 12, 12, 14, 19, 26, 58, 60, 55, 14, 13, 16, 24, 40, 57, 69, 56, 14, 17, 22, 29, 51, 87, 80, 62, 18, 22, 37, 56, 68, 109, 103, 77, 24, 35, 55, 64, 81, 104, 113, 92, 49, 64, 78, 87, 103, 121, 120, 101, 72, 92, 95, 98, 112, 100, 103, 99&#125;; è‰²åº¦é‡åŒ–è¡¨ 1234567891011// è‰²åº¦é‡åŒ–è¡¨const unsigned char Chrominance_Quantization_Table[64] = &#123; 17, 18, 24, 47, 99, 99, 99, 99, 18, 21, 26, 66, 99, 99, 99, 99, 24, 26, 56, 99, 99, 99, 99, 99, 47, 66, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99&#125;; æ ‡å‡†ç›´æµåˆ†é‡è‰²åº¦äº®åº¦å“ˆå¤«æ›¼è¡¨ 12345const char Standard_DC_Luminance_NRCodes[] = &#123; 0, 0, 7, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0 &#125;;const unsigned char Standard_DC_Luminance_Values[] = &#123; 4, 5, 3, 2, 6, 1, 0, 7, 8, 9, 10, 11 &#125;;const char Standard_DC_Chrominance_NRCodes[] = &#123; 0, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0 &#125;;const unsigned char Standard_DC_Chrominance_Values[] = &#123; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11 &#125;; æ ‡å‡†äº¤æµåˆ†é‡è‰²åº¦äº®åº¦å“ˆå¤«æ›¼è¡¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051const char Standard_AC_Luminance_NRCodes[] = &#123; 0, 2, 1, 3, 3, 2, 4, 3, 5, 5, 4, 4, 0, 0, 1, 0x7d &#125;;const unsigned char Standard_AC_Luminance_Values[] = &#123; 0x01, 0x02, 0x03, 0x00, 0x04, 0x11, 0x05, 0x12, 0x21, 0x31, 0x41, 0x06, 0x13, 0x51, 0x61, 0x07, 0x22, 0x71, 0x14, 0x32, 0x81, 0x91, 0xa1, 0x08, 0x23, 0x42, 0xb1, 0xc1, 0x15, 0x52, 0xd1, 0xf0, 0x24, 0x33, 0x62, 0x72, 0x82, 0x09, 0x0a, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x25, 0x26, 0x27, 0x28, 0x29, 0x2a, 0x34, 0x35, 0x36, 0x37, 0x38, 0x39, 0x3a, 0x43, 0x44, 0x45, 0x46, 0x47, 0x48, 0x49, 0x4a, 0x53, 0x54, 0x55, 0x56, 0x57, 0x58, 0x59, 0x5a, 0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69, 0x6a, 0x73, 0x74, 0x75, 0x76, 0x77, 0x78, 0x79, 0x7a, 0x83, 0x84, 0x85, 0x86, 0x87, 0x88, 0x89, 0x8a, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97, 0x98, 0x99, 0x9a, 0xa2, 0xa3, 0xa4, 0xa5, 0xa6, 0xa7, 0xa8, 0xa9, 0xaa, 0xb2, 0xb3, 0xb4, 0xb5, 0xb6, 0xb7, 0xb8, 0xb9, 0xba, 0xc2, 0xc3, 0xc4, 0xc5, 0xc6, 0xc7, 0xc8, 0xc9, 0xca, 0xd2, 0xd3, 0xd4, 0xd5, 0xd6, 0xd7, 0xd8, 0xd9, 0xda, 0xe1, 0xe2, 0xe3, 0xe4, 0xe5, 0xe6, 0xe7, 0xe8, 0xe9, 0xea, 0xf1, 0xf2, 0xf3, 0xf4, 0xf5, 0xf6, 0xf7, 0xf8, 0xf9, 0xfa&#125;;const char Standard_AC_Chrominance_NRCodes[] = &#123; 0, 2, 1, 2, 4, 4, 3, 4, 7, 5, 4, 4, 0, 1, 2, 0x77 &#125;;const unsigned char Standard_AC_Chrominance_Values[] = &#123; 0x00, 0x01, 0x02, 0x03, 0x11, 0x04, 0x05, 0x21, 0x31, 0x06, 0x12, 0x41, 0x51, 0x07, 0x61, 0x71, 0x13, 0x22, 0x32, 0x81, 0x08, 0x14, 0x42, 0x91, 0xa1, 0xb1, 0xc1, 0x09, 0x23, 0x33, 0x52, 0xf0, 0x15, 0x62, 0x72, 0xd1, 0x0a, 0x16, 0x24, 0x34, 0xe1, 0x25, 0xf1, 0x17, 0x18, 0x19, 0x1a, 0x26, 0x27, 0x28, 0x29, 0x2a, 0x35, 0x36, 0x37, 0x38, 0x39, 0x3a, 0x43, 0x44, 0x45, 0x46, 0x47, 0x48, 0x49, 0x4a, 0x53, 0x54, 0x55, 0x56, 0x57, 0x58, 0x59, 0x5a, 0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69, 0x6a, 0x73, 0x74, 0x75, 0x76, 0x77, 0x78, 0x79, 0x7a, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87, 0x88, 0x89, 0x8a, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97, 0x98, 0x99, 0x9a, 0xa2, 0xa3, 0xa4, 0xa5, 0xa6, 0xa7, 0xa8, 0xa9, 0xaa, 0xb2, 0xb3, 0xb4, 0xb5, 0xb6, 0xb7, 0xb8, 0xb9, 0xba, 0xc2, 0xc3, 0xc4, 0xc5, 0xc6, 0xc7, 0xc8, 0xc9, 0xca, 0xd2, 0xd3, 0xd4, 0xd5, 0xd6, 0xd7, 0xd8, 0xd9, 0xda, 0xe2, 0xe3, 0xe4, 0xe5, 0xe6, 0xe7, 0xe8, 0xe9, 0xea, 0xf2, 0xf3, 0xf4, 0xf5, 0xf6, 0xf7, 0xf8, 0xf9, 0xfa&#125;; è®¡ç®—å“ˆå¤«æ›¼ç¼–ç  123456789101112131415void JpegEncoder::_computeHuffmanTable(const char* nr_codes, const unsigned char* std_table, BitString* huffman_table) &#123; unsigned char pos_in_table = 0; unsigned short code_value = 0; for(int k = 1; k &lt;= 16; k++) &#123; for(int j = 1; j &lt;= nr_codes[k-1]; j++) &#123; huffman_table[std_table[pos_in_table]].value = code_value; huffman_table[std_table[pos_in_table]].length = k; pos_in_table++; code_value++; &#125; code_value &lt;&lt;= 1; &#125;&#125; åˆå§‹åŒ–é‡åŒ–è¡¨æ ¹æ®ä¼ å…¥çš„å‚æ•°è°ƒæ•´é‡åŒ–ç¨‹åº¦ï¼Œå› ä¸ºè¿™ä¸ªé‡åŒ–è¿‡ç¨‹æ˜¯æœ‰æŸçš„ã€‚æ‰€ä»¥å…¶ç»“æœå¯¹å›¾åƒè´¨é‡æœ‰è¾ƒå¤§å½±å“ã€‚ 123456789101112131415161718192021222324252627282930// åˆå§‹åŒ–é‡åŒ–è¡¨void JpegEncoder::_initQualityTables(int quality_scale) &#123; if(quality_scale &lt;= 0) &#123; quality_scale = 1; &#125; if(quality_scale &gt;= 100) &#123; quality_scale = 99; &#125; for(int i = 0; i &lt; 64; i++) &#123; int temp = ((int)(Luminance_Quantization_Table[i] * quality_scale + 50) / 100); if (temp &lt;= 0) &#123; temp = 1; &#125; if (temp &gt; 0xFF) &#123; temp = 0xFF; &#125; m_YTable[ZigZag[i]] = (unsigned char)temp; temp = ((int)(Chrominance_Quantization_Table[i] * quality_scale + 50) / 100); if (temp&lt;=0) &#123; temp = 1; &#125; if (temp&gt;0xFF) &#123; temp = 0xFF; &#125; m_CbCrTable[ZigZag[i]] = (unsigned char)temp; &#125;&#125; å†™æ–‡ä»¶å¤´åˆ°è¿™é‡Œæ–‡ä»¶å¤´åŸºæœ¬å·²ç»ç¡®å®šï¼Œå¯ä»¥å†™å…¥JPEGæ–‡ä»¶äº†ã€‚ RGB è½¬åŒ–æˆ YCbCræ¯è¯»å–ä¸€ä¸ª 8*8 çš„æ–¹å—åŒºåŸŸï¼Œå°±è¿›è¡Œé¢œè‰²ç©ºé—´è½¬åŒ–ã€‚è½¬æ¢å¼å’Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223Y= 0.299*R + 0.587*G + 0.114*BC_b= -0.168*R â€“ 0.331*G + 0.449*BC_r= 0.5*R â€“ 0.419*G â€“ 0.018*B void JpegEncoder::_convertColorSpace(int xPos, int yPos, char* yData, char* cbData, char* crData) &#123; for (int y = 0; y &lt; 8; y++) &#123; // è·³è¡Œ unsigned char* p = m_rgbBuffer + (y + yPos) * m_width * 3 + xPos * 3; for (int x = 0; x &lt; 8; x++) &#123; unsigned char B = *p++; unsigned char G = *p++; unsigned char R = *p++; yData[y * 8 + x] = (char)(0.299f * R + 0.587f * G + 0.114f * B - 128); // yData[y * 8 + x] = 0; cbData[y * 8 + x] = (char)(-0.1687f * R - 0.3313f * G + 0.5f * B ); // cbData[y * 8 + x] = 0; crData[y * 8 + x] = (char)(0.5f * R - 0.4187f * G - 0.0813f * B); // crData[y * 8 + x] = 0; &#125; &#125;&#125; DCTå˜æ¢å’Œé‡åŒ–DCTå˜æ¢å¼å’Œé‡åŒ–ä»£ç ï¼š 12345678910111213141516171819202122232425// DCTå˜åŒ– + é‡åŒ–ï¼ˆæœªä¼˜åŒ–ï¼‰void JpegEncoder::_forward_DCT(const char* channel_data, short* fdc_data) &#123; const float PI = 3.1415926f; for(int v = 0; v &lt; 8; v++) &#123; for(int u = 0; u &lt; 8; u++) &#123; float alpha_u = (u==0) ? 1 / sqrt(8.0f) : 0.5f; float alpha_v = (v==0) ? 1 / sqrt(8.0f) : 0.5f; float temp = 0.f; for(int x = 0; x &lt; 8; x++) &#123; for(int y = 0; y &lt; 8; y++) &#123; float data = channel_data[y * 8 + x]; data *= cos((2 * x + 1) * u * PI / 16.0f); data *= cos((2 * y + 1) * v * PI / 16.0f); temp += data; &#125; &#125; temp *= alpha_u * alpha_v / m_YTable[ZigZag[v * 8 + u]]; fdc_data[ZigZag[v*8+u]] = (short) ((short)(temp + 16384.5) - 16384); &#125; &#125;&#125; å“ˆå¤«æ›¼ç¼–ç  ç›´æµåˆ†é‡å·®åˆ†ç¼–ç  123456789101112 // encode DCint dcDiff = (int)(DU[0] - prevDC);prevDC = DU[0];if (dcDiff == 0) &#123; outputBitString[index++] = HTDC[0];&#125; else &#123; BitString bs = _getBitCode(dcDiff); outputBitString[index++] = HTDC[bs.length]; outputBitString[index++] = bs;&#125; äº¤æµåˆ†é‡æ¸¸é•¿ç¼–ç  123456789101112131415161718192021222324252627 // encode ACsint endPos=63; //end0pos = first element in reverse order != 0while((endPos &gt; 0) &amp;&amp; (DU[endPos] == 0)) &#123; endPos--;&#125;for(int i = 1; i &lt;= endPos; ) &#123; int startPos = i; while((DU[i] == 0) &amp;&amp; (i &lt;= endPos)) &#123; i++; &#125; int zeroCounts = i - startPos; if (zeroCounts &gt;= 16) &#123; for (int j = 1; j &lt;= zeroCounts / 16; j++) &#123; outputBitString[index++] = SIXTEEN_ZEROS; &#125; zeroCounts = zeroCounts % 16; &#125; BitString bs = _getBitCode(DU[i]); outputBitString[index++] = HTAC[(zeroCounts &lt;&lt; 4) | bs.length]; outputBitString[index++] = bs; i++;&#125; å¯¹ä¸‰ä¸ªé€šé“è¿›è¡Œä»¥ä¸ŠåŒæ ·çš„æ“ä½œã€‚ï¼ˆDCTå˜åŒ–-å“ˆå¤«æ›¼ç¼–ç -å†™å…¥ï¼‰ 1234567891011121314151617181920BitString outputBitString[128];int bitStringCounts;// Yé€šé“å‹ç¼©_forward_DCT(yData, yQuant);_doHuffmanEncoding(yQuant, prev_DC_Y, m_Y_DC_Huffman_Table, m_Y_AC_Huffman_Table, outputBitString, bitStringCounts);_write_bitstring_(outputBitString, bitStringCounts, newByte, newBytePos, fp);// Cbé€šé“å‹ç¼©_forward_DCT(cbData, cbQuant);_doHuffmanEncoding(cbQuant, prev_DC_Cb, m_CbCr_DC_Huffman_Table, m_CbCr_AC_Huffman_Table, outputBitString, bitStringCounts);_write_bitstring_(outputBitString, bitStringCounts, newByte, newBytePos, fp);// Cré€šé“å‹ç¼©_forward_DCT(crData, crQuant);_doHuffmanEncoding(crQuant, prev_DC_Cr, m_CbCr_DC_Huffman_Table, m_CbCr_AC_Huffman_Table, outputBitString, bitStringCounts);_write_bitstring_(outputBitString, bitStringCounts, newByte, newBytePos, fp); æ•´ä¸ªæµç¨‹å°±æ˜¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å®éªŒç»“æœæµ‹è¯•å›¾ç‰‡ pic1.bmp 16è¿›åˆ¶ æµ‹è¯•ä»£ç  12345678910111213const char* inputFileName = \"pic1.bmp\";JpegEncoder encoder;// è¯»å–BMPæ ¼å¼çš„æ–‡ä»¶if(!encoder.readFromBMP(inputFileName)) &#123; return 1;&#125;// å°†BMPæ ¼å¼çš„æ–‡ä»¶æŒ‰ç…§JPEGæ ‡å‡†å‹ç¼©æˆJPEGæ–‡ä»¶if(!encoder.encodeToJPG(\"out.jpeg\", 50)) &#123; printf(\"jpg\\n\"); return 1;&#125; è¯»å–çš„BMPæ–‡ä»¶ä¿¡æ¯ï¼Œå¤§å°å’Œå°ºå¯¸éƒ½ç¬¦åˆåŸå›¾ æµ‹è¯•ç»“æœ out.jpeg åå…­è¿›åˆ¶ï¼Œå¯ä»¥å’Œæ ‡å‡†æ ¼å¼æ¯”è¾ƒç¡®å®æ˜¯é€šè¿‡BMPè½¬æˆäº†JPEGæ ¼å¼ å¯ä»¥çœ‹åˆ°ï¼Œå‹ç¼©æ•ˆæœè¿˜æ˜¯æ¯”è¾ƒæ¯”è¾ƒæ˜æ˜¾çš„ï¼Œä½†æ˜¯ç¼–ç æ€§èƒ½ä¸æ˜¯æœ€å¥½çš„ï¼Œæ²¡æœ‰å¯¹æ•°æ®å‰æœŸè¿›è¡Œä¼˜åŒ–ï¼Œæ•ˆç‡åªæ˜¯ä¸­è§„ä¸­çŸ©ã€‚ä¸‹é¢ä»‹ç»å¯¹æµç¨‹å’Œç»“æœçš„æµ‹è¯•åˆ†æè¿‡ç¨‹æµç¨‹ï¼š åˆ†æä¸ºä»€ä¹ˆè½¬æ¢æˆYCbCråŸŸå¯¹è‰²åŸŸçš„å‹ç¼©ä¼šè®©äººæ¥å—ï¼šä»RGBåˆ°YCbCrçš„è½¬æ¢å…¬å¼æˆ‘ä»¬å¯ä»¥åˆ†æå‡ºYæ‰€å æ¯”é‡è¾ƒé«˜ï¼Œè¯´æ˜åº”è¯¥å­˜å‚¨çš„ç»†èŠ‚ç›¸å¯¹è¾ƒå¤šï¼Œå’Œäººçœ¼å¯¹äº®åº¦æ›´åŠ æ•æ„Ÿç¬¦åˆã€‚é‚£ä¹ˆäº‹å®æ˜¯å¦å¦‚æ­¤ï¼Ÿ ä»å·¦åˆ°å³ä¾æ¬¡æ˜¯ Yï¼ˆ72.8kï¼‰ï¼ŒCbï¼ˆ37.4kï¼‰ï¼ŒCrï¼ˆ33.9kï¼‰åˆ†é‡ï¼Œä»å…‰æ„Ÿä¸Šè¯´ï¼Œæ˜æ˜¾æ˜¯Yçš„ç°åº¦å›¾åƒç»™å‡ºäº†ç»†èŠ‚ï¼Œå…¶å®ƒä¸¤ä¸ªåˆ†é‡åªæ˜¯ç»™å‡ºè‰²å½©ï¼Œæ²¡æœ‰ç»†èŠ‚ã€‚æ¥ç€ä»å¤§å°åˆ†æä¹Ÿå’Œæˆ‘ä»¬çš„é¢„æµ‹ç¬¦åˆï¼Œå¤§æ¦‚æ¯”ä¾‹æ˜¯ 2ï¼š1ï¼š1ï¼Œè¯´æ˜å­˜å‚¨çš„ç»†èŠ‚è¶Šå¤šæ‰€éœ€çš„ç©ºé—´è‡ªç„¶è¶Šå¤§ã€‚æ¥ä¸‹æ¥å¯¹BMPåŸå§‹é€šé“RGBåŠ æ‰°åŠ¨å’ŒYCbCråŠ ç›¸åŒçš„æ‰°åŠ¨ï¼Œå¯¹å›¾åƒçš„å½±å“åˆä¼šæ€æ ·ï¼Ÿ ä»å·¦åˆ°å³ä¸€æ¬¡æ˜¯åœ¨RGBé€šé“å’ŒYCbCré€šé“åŠ å¹²æ‰°ã€‚å¯ä»¥çœ‹åˆ°RGBæ”¶å¹²æ‰°çš„ç¨‹åº¦æ›´å¤§ï¼ŒåŸå› ä¸å¤§å¥½ç”¨æ•°å­¦åˆ†æï¼Œæˆ‘è§‰å¾—å¾ˆå¯èƒ½æ˜¯RGBé€šé“å¯¹å¹²æ‰°æ˜¯æ²¡æœ‰å‡å¼±ç›´æ¥è¿›å…¥é€šé“è½¬æ¢ï¼Œè€ŒYCrCbåˆ™æ˜¯åœ¨è‰²åº¦é€šé“è¿›è¡Œå‹ç¼©äº†ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¯¹å¹²æ‰°çš„èˆå¼ƒï¼Œæ‰€ä»¥æ•ˆæœæ¯”è¾ƒå¥½ã€‚ ä¸‹é¢åˆ†æä¸ºä»€ä¹ˆé‡åŒ–çŸ©é˜µå¯¹ç»“æœä¼šæœ‰å¾ˆå¤§å½±å“ï¼Œå¯ä»¥åšä¸€ä¸ªå®éªŒï¼Œæ”¹å˜ç”Ÿæˆé‡åŒ–çŸ©é˜µçš„ç®—æ³•ï¼Œçœ‹çœ‹ç»“æœå¦‚ä½•ã€‚ è¿™ä¸¤å¼ çš„é‡åŒ–ç¨‹åº¦ä¸åŒï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°çš„æ˜¯ä»–ä»¬éƒ½æœ‰æˆ–å¤šæˆ–å°‘çš„å‘ˆè‰²å—æ˜¾ç¤ºè¿¹è±¡ï¼Œæ‰€ä»¥åº”è¯¥å­˜å‚¨çš„ç©ºé—´åº”è¯¥æ˜¯å¾ˆå°çš„ã€‚ç»“æœä¹Ÿç¡®å®å¦‚æ­¤ï¼Œå›åˆ°é—®é¢˜ï¼Œæˆ‘ä»¬çš„é‡åŒ–çŸ©é˜µæ²¡æœ‰ä¼˜åŒ–ï¼Œé€ æˆæ•°å€¼è¿‡å¤§ï¼Œåœ¨é‡åŒ–è¿‡ç¨‹ä¸­ï¼Œå¯¼è‡´è¿‡å¤šæ•°ä¸º0ï¼Œä¹Ÿå°±æ˜¯é‚£äº›é«˜é¢‘åˆ†é‡ï¼Œè€Œé«˜é¢‘æ­£æ˜¯ç»†èŠ‚çš„ä½“ç°ï¼Œå¤±å»é«˜é¢‘è‡ªç„¶å°±å¤±å»äº†ç»†èŠ‚ã€‚æ‰€ä»¥é‡åŒ–çŸ©é˜µçš„å–å€¼ç›´æ¥å…³ç³»åˆ°äº†ç”Ÿæˆå›¾åƒçš„å“è´¨ã€‚ ä»¥ä¸Šæ˜¯æˆ‘å¯¹BMPè½¬æ¢æˆJPEGçš„è¿‡ç¨‹åˆ†æï¼ŒåŒæ—¶ä¹Ÿè¾…ä»¥ä»£ç åŠ ä»¥å®ç°å’Œæµ‹è¯•ã€‚å¯¹äºJPEGçš„è§£ç è¿‡ç¨‹é‚£å°±æ˜¯è¿‡ç¨‹çš„é€†è¿‡ç¨‹äº†ï¼Œä½†æ˜¯ç”±äºç¼–ç æ˜¯æœ‰æŸçš„ï¼Œè€Œä¸”ç¼–ç è¡¨é‡åŒ–è¡¨éƒ½æ˜¯æœ‰è½¬å‹æŸå¤±çš„ï¼Œæ‰€ä»¥è§£ç ä¹‹åçš„å›¾åƒä¹Ÿä¼šæœ‰éƒ¨åˆ†æŸå¤±ã€‚ç€å‘¢ä¸ªè¿‡ç¨‹å’Œè¯»å–è§£ç BMPä¸€æ ·ã€‚å…ˆè¯»å–æ–‡ä»¶å¤´ï¼Œæ¥ä¸‹æ¥åˆå§‹åŒ–è¡¨ï¼Œå†å°±æ˜¯ç›´æ¥è¯»å–æ•°æ®æ ¹æ®è¡¨è§£ç å‡ºYCbCrçš„å€¼ï¼Œåé‡åŒ–ä¹‹åé€šè¿‡DCTé€†å˜æ¢è¿˜åŸã€‚ å…¶ä¸­çš„æºç æ˜¯thecodewayæä¾›çš„ï¼Œæ¬¢è¿å¤§å®¶å»ä»–çš„ Blog çœ‹çœ‹ä»–çš„å›¾åƒåˆ†ææ–‡ç« ï¼Œæˆ‘åªæ˜¯å¯¹ä»–çš„ä»£ç åŠ ä»¥è‡ªå·±çš„ç†è§£ã€‚ æœ€åï¼šå¦‚æœ‰ä¸è¶³ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œå…±åŒè¿›æ­¥ã€‚ å¤šè°¢é˜…è¯» å‚è€ƒèµ„æ–™[1] è¶³è¿¹ : https://www.cnblogs.com/Matrix_Yao/archive/2009/12/02/1615295.html [2] lakeone : https://www.cnblogs.com/lakeone/p/3596996.html [3] thecodeway : https://thecodeway.com/blog/?p=522 [4] SoC Design Lab http://twins.ee.nctu.edu.tw/courses/soclab_04/lab_hw_pdf/proj1_jpeg_introduction.pdf","tags":[{"name":"Algo","slug":"Algo","permalink":"http://fitzeng.org/tags/Algo/"},{"name":"Math","slug":"Math","permalink":"http://fitzeng.org/tags/Math/"},{"name":"C/C++","slug":"C-C","permalink":"http://fitzeng.org/tags/C-C/"},{"name":"å›¾åƒå¤„ç†","slug":"å›¾åƒå¤„ç†","permalink":"http://fitzeng.org/tags/å›¾åƒå¤„ç†/"}]},{"title":"Android å•å…ƒæµ‹è¯•å’Œ Robolectric æºç è§£æ","date":"2017-05-13T16:00:00.000Z","path":"2017/05/14/Android å•å…ƒæµ‹è¯•å’Œ Robolectric æºç è§£æ/","text":"å‰è¨€ä½œä¸ºä¸€ä¸ª Android å¼€å‘çš„ç¨‹åºå‘˜ï¼Œæœ€ç—›è‹¦çš„äº‹æƒ…å…¶å®è«è¿‡äºæµ‹è¯•äº†ï¼Œé¾Ÿé€Ÿçš„æ¨¡æ‹Ÿå™¨å’Œéº»çƒ¦çš„æ‰‹æœºï¼ŒåŸºæœ¬ä¸Šæ¯æµ‹è¯•ä¸€æ¬¡éƒ½è¦æµªè´¹ 1-2 min å»åŠ è½½ç¨‹åºã€‚è€Œæœ‰äº† Robolectric è¿™äº›å°±å¯ä»¥é¿å…äº†ã€‚è‡³äº Robolectric çš„ä»‹ç»æ¨èå¤§å®¶çœ‹çœ‹å®˜ç½‘ ï¼ˆå…¶ä¸­çš„ç”¨æˆ·æŒ‡å¯¼æ˜¯å¾ˆå¥½çš„å­¦ä¹ èµ„æ–™ï¼‰ã€‚æˆ‘ä»¬ç”¨ä»–çš„å¾ˆå¤§ä¸€ä¸ªåŸå› æ˜¯ä»–ä¸éœ€è¦å†å»æŠŠç¨‹åºåŠ è½½åˆ° Android æ‰‹æœºæˆ–è€…æ¨¡æ‹Ÿå™¨ä¸­è¿è¡Œï¼Œä»–æœ‰è‡ªå·±çš„å®ç°ï¼Œèƒ½å¤Ÿè°ƒç”¨ Android ä¸­çš„å¾ˆå¤šåº“ï¼Œä¸‹é¢çš„æºç åˆ†æä¼šæåŠã€‚å¯æ˜¯ Android Studio å¯¹ Robolectric ä¸æ˜¯å¾ˆå‹å¥½ï¼Œè€Œä¸”åœ¨ Google çš„å®˜æ–¹æ•™ç¨‹ä¸­çš„æµ‹è¯•å·¥å…·ä¹Ÿä¸æ˜¯è¿™ä¸ªã€‚ã€‚ã€‚åŒæ—¶ Robolectric å¯¹äº Android Studio çš„æ•™ç¨‹ä»‹ç»ä¼¼ä¹è¿˜æ˜¯åœç•™åœ¨ 1.x é˜¶æ®µï¼Œä½†æ˜¯åœ¨ 2.x ä¸­çš„ä½¿ç”¨ç•¥æœ‰ä¸åŒã€‚ è®²äº†è¿™ä¹ˆå¤šï¼Œæ‰€ä»¥ Robolectric å’Œ Junit 4 æœ‰ä»€ä¹ˆä¸åŒï¼Ÿä¸éƒ½æ˜¯æµ‹è¯•å—ï¼Ÿæˆ‘çš„ç†è§£æ˜¯ Junit 4 ä¸ Robolectric çš„å…³ç³»å’Œ Java ä¸ Android çš„å…³ç³»å·®ä¸å¤šã€‚æ¯•ç«Ÿ Robolectric æ˜¯ä¸ªç¬¬ä¸‰æ–¹çš„æµ‹è¯•åº“ï¼Œå…¶ä¸­å¾ˆå¤šè¿˜æ˜¯è¦ç”¨åˆ° Junit çš„ã€‚ å¥½äº†ï¼ŒåŸºæœ¬çš„ä»‹ç»å®Œæˆäº†ï¼Œä¸‹é¢å¼€å§‹ä½¿ç”¨ï¼Œä½†æ˜¯ä½¿ç”¨ä¸æ˜¯æˆ‘ä»¬è¿™æ¬¡çš„é‡ç‚¹ï¼Œé‡ç‚¹æ˜¯æºç åˆ†æã€‚ä½†æ˜¯æºç åˆ†æä¹Ÿæ˜¯å»ºç«‹åœ¨çŸ¥é“ä½¿ç”¨çš„åŸºç¡€ä¸Šï¼Œå¦‚æœä½ ä¹‹å‰æ²¡æœ‰ä½¿ç”¨è¿‡ï¼Œæ¨èä½ çœ‹å®˜æ–¹çš„ user guideã€‚æˆ–è€…è¿™ä¸¤ç¯‡ Blogã€‚ Androidå•å…ƒæµ‹è¯•æ¡†æ¶Robolectric3.0ä»‹ç»(ä¸€) Androidå•å…ƒæµ‹è¯•æ¡†æ¶Robolectric3.0ä»‹ç»(äºŒ) å‡†å¤‡å…¶å®å‰é¢ Blog çš„ä»‹ç»å¯èƒ½ä¼šæœ‰ç‚¹åå·®ï¼Œç°åœ¨çš„ Android Studio 2.3.1 åœ¨å»ºç«‹å·¥ç¨‹æ—¶é™¤äº†è‡ªå·±çš„æºç åŒ…ï¼Œè¿˜æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯ test å’Œ androidTestã€‚ç»è¿‡æˆ‘çš„å°è¯•ï¼Œ test åŒ…ä¸‹çš„æµ‹è¯•æ–‡ä»¶å¯ä»¥ç›´æ¥æµ‹è¯•ï¼Œè€Œ androidTestä¸‹é¢çš„è¿˜æ˜¯è¦ android è¿è¡Œç¯å¢ƒçš„ã€‚ä¸ªäººæ›´å€¾å‘äºä¸€ä¸ªç”¨åšå•å…ƒæµ‹è¯•ä¸€ä¸ªç”¨äºé›†æˆæµ‹è¯•è¿™ç§ç†è§£ã€‚æ‰€ä»¥åœ¨å¯¼å…¥ä¾èµ–åŒ…æ—¶è¦æ³¨æ„äº†ã€‚ 121. testCompile \"org.robolectric:robolectric:3.3.2\"2. androidTestCompile \"org.robolectric:robolectric:3.3.2\" ç¬¬ä¸€ç§å¯¹åº”çš„æµ‹è¯•æ–‡ä»¶è¦æ”¾åœ¨ test åŒ…ä¸‹ï¼Œè€Œç¬¬äºŒç§å°±æ˜¯æ”¾åœ¨ androidTest åŒ…ä¸‹ï¼Œå¦‚æœæé”™ï¼Œä½ çš„ Robolectric ä¸­çš„æµ‹è¯•æ–¹æ³•æ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚ 123456789101112dependencies &#123; compile fileTree(include: ['*.jar'], dir: 'libs') androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.2', &#123; exclude group: 'com.android.support', module: 'support-annotations' &#125;) compile 'com.android.support:appcompat-v7:24.2.1' compile 'com.android.support.constraint:constraint-layout:1.0.2' testCompile 'junit:junit:4.12' testCompile 'org.robolectric:robolectric:3.3.2' sourceCompatibility = 1.8 targetCompatibility = 1.8&#125; è‡³äºè¿è¡Œçš„è¯ï¼Œå¤§å®¶å¯ä»¥ç›´æ¥å³é”®æ–‡ä»¶ï¼Œtitle bar ç‚¹å‡»è¿è¡Œæˆ–è€…åœ¨ cmd è¿è¡Œéƒ½è¡Œã€‚ä½†æ˜¯æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œä¸€å®šè¦é…ç½®æ–‡ä»¶çš„ working directoryï¼Œä¸ç„¶æ‰¾ä¸åˆ° manifest.xml ç­‰æ–‡ä»¶ã€‚ æµ‹è¯•å†™ä¸€ä¸ªå¦‚ä¸‹å¸ƒå±€ 12345678910111213141516171819202122232425&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;ScrollView xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:tools=\"http://schemas.android.com/tools\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" tools:context=\"org.fitzeng.robolectrictest.MainActivity\"&gt; &lt;LinearLayout android:orientation=\"vertical\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\"&gt; &lt;EditText android:id=\"@+id/et\" android:text=\"@string/app_name\" android:maxLines=\"1\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" /&gt; &lt;Button android:id=\"@+id/btn_et\" android:text=\"EditText Test\" android:textAllCaps=\"false\" android:textAppearance=\"?android:attr/textAppearanceLarge\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" /&gt; &lt;/LinearLayout&gt;&lt;/ScrollView&gt; 1234567891011121314151617181920212223242526272829303132public class MainActivity extends AppCompatActivity implements View.OnClickListener&#123; private EditText editText; private Button btnEt; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); initViews(); &#125; private void initViews() &#123; editText = (EditText) findViewById(R.id.et); btnEt = (Button) findViewById(R.id.btn_et); btnEt.setOnClickListener(this); &#125; @Override public void onClick(View v) &#123; switch (v.getId()) &#123; case R.id.btn_et: &#123; btnEt.setText(editText.getText().toString()); break; &#125; default: break; &#125; &#125;&#125; å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå°±æ˜¯æµ‹è¯•ä¸€ä¸‹ç‚¹å‡»äº‹ä»¶ï¼Œçœ‹çœ‹ç‚¹å‡»ä¹‹åæ˜¯å¦èƒ½è·å– EditText ä¸­çš„æ–‡æœ¬å†…å®¹ã€‚ ä¸‹é¢å¼€å§‹å†™æµ‹è¯•ä»£ç ï¼Œæ³¨æ„ä¹‹å‰å¦‚æœé…ç½®çš„æ˜¯ testCompile çš„è¯ä¸€å®šè¦æŠŠæµ‹è¯•æ–‡ä»¶å»ºåœ¨ test åŒ…ä¸‹ï¼Œä¸ç„¶æ— æ³•å¯¼å…¥ Robolectric ã€‚ 1234567891011121314151617181920212223242526272829@RunWith(RobolectricTestRunner.class)@Config(constants = BuildConfig.class, sdk = 24)public class MainActivityTest &#123; private Button btnEt; private EditText editText; @Before public void setUp() &#123; // get mainActivity obj MainActivity mainActivity = Robolectric.setupActivity(MainActivity.class); // get button btnEt = (Button) mainActivity.findViewById(R.id.btn_et); // get edittext editText = (EditText) mainActivity.findViewById(R.id.et); &#125; @Test public void testMainActivity() &#123; // simulate click event btnEt.performClick(); // get button content String expectedContent = btnEt.getText().toString(); // get edittext content String actualContent = editText.getText().toString(); // compare expectedContent and actualContent Assert.assertEquals(expectedContent, actualContent); &#125;&#125; ä¸Šé¢çš„ä»£ç æˆ‘éƒ½åŠ äº†æ³¨é‡Šï¼ŒåŸºæœ¬è¿‡ç¨‹å¾ˆæ¸…æ¥šäº†ï¼Œè¿™é‡Œç‚¹å‡»äº‹ä»¶æ˜¯åªè¦ç‚¹å‡»ï¼Œæˆ‘ä»¬å°±æŠŠ EditText ä¸­çš„æ–‡æœ¬æ›¿æ¢ Button çš„æ–‡æœ¬ã€‚æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼šå¯ä»¥çœ‹åˆ°èŠ±çš„ 27s å®Œæˆäº†ç‚¹å‡»æµ‹è¯•ï¼Œå¾ˆæ–¹ä¾¿ã€‚å¤§å®¶å¯ä»¥è¯•è¯•æµ‹è¯•å¤±è´¥ä¼šæ˜¯ä»€ä¹ˆæƒ…å†µã€‚ è¿™é‡Œå¹¶æ²¡æœ‰å¼€å¯æ¨¡æ‹Ÿå™¨ï¼Œä½†æ˜¯å´å®Œæˆäº†æ•´ä¸ªç‚¹å‡»äº‹ä»¶å¹¶è¿›è¡Œäº†æ£€æµ‹ã€‚äº‹ä»¶è™½å°ï¼Œä½†æ˜¯æ„ä¹‰å¾ˆå¤§ã€‚æ„å‘³ç€æˆ‘ä»¬ä¸éœ€è¦å¼€å¯æ¨¡æ‹Ÿå™¨ä¹Ÿå¯ä»¥å¯¹ Android ç¨‹åºè¿›è¡Œæµ‹è¯•äº†ã€‚ æºç åˆ†æåœ¨å¼€å§‹è¿™ä¸ªæµç¨‹çš„åˆ†æä¹‹å‰ï¼Œå¦‚æœä½ ä¹‹å‰å¯¹ Junit æ²¡æœ‰ä»»ä½•äº†è§£ï¼Œå¯ä»¥çœ‹çœ‹ Junit çš„åˆ†æï¼Œè¿™é‡Œä»¿ç…§ Junit å¯¹ Robolectric è¿›è¡Œç±»æ¯”åˆ†æã€‚å¯ä»¥æ‰¾åˆ° Junit çš„ main å…¥å£ä¸‹é¢ä¸€æ­¥ä¸€æ­¥åˆ†æå°±å¥½äº†ã€‚ ä½†æ˜¯ Robolectric ä»£ç é‡å®åœ¨å¤ªå¤§ï¼Œå»é‡Œé¢æ‰¾ä¸œè¥¿å®åœ¨å¤ªéš¾ï¼Œä½†æ˜¯å‡­å€Ÿç¨‹åºå‘˜çš„ç›´è§‰ï¼Œç›¸ä¿¡å¤§å®¶æœ€å…ˆæ‰¾åˆ°çš„æœ‰ä»·å€¼çš„æ–‡ä»¶å¯èƒ½æ˜¯ä¸‹é¢å‡ ä¸ªï¼šå…¶ä¸­çœ‹åˆ°æµ‹è¯•ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸æ˜¯çœ¼å‰ä¸€äº®ï¼Ÿè¿˜æœ‰ Robolectric ç±»é‡Œé¢çš„å‡½æ•°ï¼ŒåŒ…å«äº† Fragmentï¼Œ AttributeSetï¼Œ Activityï¼Œ Serviceï¼Œ IntentServiceï¼Œ ContentProvider ç­‰ç­‰ç†Ÿæ‚‰çš„å†…å®¹ã€‚å¯ä»¥è‚¯å®šï¼Œè¿™é‡Œå°±æ˜¯â€œå®‡å®™ä¸­å¿ƒâ€ã€‚ä¸Šé¢çš„æµ‹è¯•ä»£ç å…¶å®ä¹ŸéªŒè¯äº†è¿™ä¸ªè§‚ç‚¹ã€‚å†çœ‹çœ‹ RobolectricTestRunner è¿™ä¸ªç±»ï¼Œè¿˜æ˜¯å’Œ Junit 4 æœ‰ä¸€è…¿çš„ã€‚é‡Œé¢çš„æ–¹æ³•æ— éå°±æ˜¯åšä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œï¼Œæ³¨é‡Šè¯´çš„å¾ˆæ˜ç¡®äº†ï¼Œå°±æ˜¯æä¾›ä¸€ä¸ªæ¨¡æ‹Ÿçš„ Android è¿è¡Œæ—¶ç¯å¢ƒï¼ˆå’Œå‰é¢è¯´çš„åŠ è½½ manifestæ–‡ä»¶æœ‰å…³ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥åœ¨æ²¡æœ‰æ¨¡æ‹Ÿå™¨çš„æƒ…å†µä¸‹è¿›è¡Œä¸€äº›æ¨¡æ‹Ÿç‚¹å‡»æµ‹è¯•çš„åŸå› ã€‚ 123456789/** * Installs a &#123;@link SandboxClassLoader&#125; and &#123;@link ResourceTable&#125; in order to * provide a simulation of the Android runtime environment. */// public class RobolectricTestRunner extends SandboxTestRunner// public class SandboxTestRunner extends BlockJUnit4ClassRunner// public class BlockJUnit4ClassRunner extends ParentRunner&lt;FrameworkMethod&gt;// public abstract class ParentRunner&lt;T&gt; extends Runner implements Filterable,Sortable// public abstract class Runner implements Describable è¿™æ ·æ²¡æœ‰å®ä¾‹åªçœ‹æºç æœ‰ç‚¹ä¸çŸ¥é“å¾€å“ªä¸ªæ–¹å‘è§£æï¼Œæ‰€ä»¥æˆ‘ä»¬å¼€å§‹ä»æºç è§’åº¦çœ‹çœ‹å‰é¢æµ‹è¯•è¿‡ç¨‹æ€ä¹ˆæ‰§è¡Œçš„æ¥åŠ æ·±ç†è§£ã€‚ æœ€å¼€å§‹æ˜¯è°ƒç”¨äº† Robolectric.setupActivity(Class) é‚£ä¹ˆæˆ‘ä»¬å°±ä»è¿™é‡Œå…¥æ‰‹ã€‚ step 1 : Robolectric.setupActivity(Class)123public static &lt;T extends Activity&gt; T setupActivity(Class&lt;T&gt; activityClass) &#123; return buildActivity(activityClass).setup().get();&#125; é¦–å…ˆæ˜¯è·å– Activity å¯¹è±¡ï¼Œæ­£å¥½ setUpActivity(Class) æ˜¯è¿”å›ä¸€ä¸ª Activity å¯¹è±¡çš„ã€‚é‚£ä¹ˆæ˜¯å¦‚ä½•è·å–åˆ°çš„å‘¢ï¼Ÿé‚£å°±è¦çœ‹æºç å…·ä½“å®ç°äº†ã€‚å¤§æ¦‚è¿‡ç¨‹æ˜¯å»ºç«‹ä¸€ä¸ª Activity ç„¶å setup ä¸€ä¸‹å†è·å–å¯¹è±¡ã€‚ step 2.1 : Robolectric.buildActivity(Class)123public static &lt;T extends Activity&gt; ActivityController&lt;T&gt; buildActivity(Class&lt;T&gt; activityClass) &#123; return buildActivity(activityClass, null);&#125; step 2.2 : Robolectric.buildActivity(Class, Intent)123public static &lt;T extends Activity&gt; ActivityController&lt;T&gt; buildActivity(Class&lt;T&gt; activityClass, Intent intent) &#123; return ActivityController.of(getShadowsAdapter(), ReflectionHelpers.callConstructor(activityClass), intent);&#125; åˆ°è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°åˆ©ç”¨è¿™ä¸ªç±»åå’Œ Intent ï¼ˆnullï¼‰ï¼Œé‡‡ç”¨åå°„æœºåˆ¶å¯ä»¥è·å–è¿™ä¸ªç±»çš„å¯¹è±¡ã€‚æœ‰å…´è¶£çš„è¿˜å¯ä»¥æ·±ç©¶ä¸‹å»ã€‚ step 3.1 : Robolectric.buildActivity(activityClass).setup()12345678910111213141516171819202122/*** Calls the same lifecycle methods on the Activity called by Android the first time the Activity is created.** @return Activity controller instance.*/public ActivityController&lt;T&gt; setup() &#123; return create().start().postCreate(null).resume().visible();&#125;/** * Calls the same lifecycle methods on the Activity called by Android when an Activity is restored from previously saved state. * * @param savedInstanceState Saved instance state. * @return Activity controller instance. */public ActivityController&lt;T&gt; setup(Bundle savedInstanceState) &#123; return create(savedInstanceState) .start() .restoreInstanceState(savedInstanceState) .postCreate(savedInstanceState) .resume() .visible();&#125; å‰é¢çš„ä¸¤ä¸ªå‡½æ•°çš„æ³¨é‡Šå¾ˆæ¸…æ¥šï¼Œç¬¬ä¸€ä¸ªæ˜¯ Activity ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶è°ƒç”¨ï¼Œç¬¬äºŒä¸ªæ˜¯ Activity ä¹‹å‰è¢«è°ƒç”¨è¿‡å¹¶ä¸”åœ¨ Bundle å¯¹è±¡ä¸­ä¿å­˜äº†å®ä¾‹çŠ¶æ€ï¼Œå¯ä»¥å°† Bundle ä¸­çš„æ•°æ®ä½œä¸ºå‚æ•°ç›´æ¥è°ƒç”¨å‡½æ•°åŠ è½½ã€‚è¿”å›çš„æ˜¯ä¸€ä¸ª Activity æ§åˆ¶å™¨å®ä¾‹ã€‚ step 3.2 : setup() -&gt; create().start().postCreate(null).resume().visible()1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556ActivityController.create()public ActivityController&lt;T&gt; create() &#123; return create(null);&#125;public ActivityController&lt;T&gt; create(final Bundle bundle) &#123; shadowMainLooper.runPaused(new Runnable() &#123; @Override public void run() &#123; ReflectionHelpers.callInstanceMethod(Activity.class, component, \"performCreate\", from(Bundle.class, bundle)); &#125; &#125;); return this;&#125;ActivityController.start()public ActivityController&lt;T&gt; start() &#123; invokeWhilePaused(\"performStart\"); return this;&#125;ActivityController.postCreate(Bundle)public ActivityController&lt;T&gt; postCreate(Bundle bundle) &#123; invokeWhilePaused(\"onPostCreate\", from(Bundle.class, bundle)); return this;&#125;ActivityController.resume()public ActivityController&lt;T&gt; resume() &#123; invokeWhilePaused(\"performResume\"); return this;&#125;ActivityController.visible()public ActivityController&lt;T&gt; visible() &#123; shadowMainLooper.runPaused(new Runnable() &#123; @Override public void run() &#123; ReflectionHelpers.setField(component, \"mDecor\", component.getWindow().getDecorView()); ReflectionHelpers.callInstanceMethod(component, \"makeVisible\"); &#125; &#125;); ViewRootImpl root = component.getWindow().getDecorView().getViewRootImpl(); if (root != null) &#123; // If a test pause thread before creating an activity, root will be null as runPaused is waiting // Related to issue #1582 Display display = Shadow.newInstanceOf(Display.class); Rect frame = new Rect(); display.getRectSize(frame); Rect insets = new Rect(0, 0, 0, 0); final RuntimeAdapter runtimeAdapter = RuntimeAdapterFactory.getInstance(); runtimeAdapter.callViewRootImplDispatchResized( root, frame, insets, insets, insets, insets, insets, true, null); &#125; return this;&#125; è¿™é‡Œçœ‹èµ·æ¥ä»£ç é‡æœ‰ç‚¹å¤šï¼Œä½†æ˜¯å¤§æ¦‚æ„æ€åº”è¯¥å°±æ˜¯ä¸º Activity æä¾›ä¸€ä¸ª Android è¿è¡Œç¯å¢ƒçš„ä¿éšœã€‚ä» Window ï¼Œ DecorView ä¹‹ç±»çš„å°±å¯ä»¥ç¡®è®¤æˆ‘ä»¬çš„æƒ³æ³•ã€‚å¦‚æœä¸ç†Ÿæ‚‰çš„è¯å¯ä»¥å†å»äº†è§£ Android çš„ç•Œé¢ç»˜åˆ¶è¿‡ç¨‹ï¼Œè¿™é‡Œç›®å‰çŸ¥é“è¿™å±‚æ„æ€å°±å¯ä»¥äº†ã€‚ step 4 : Robolectric.buildActivity(activityClass).setup().get()123public T get() &#123; return component;&#125; ã€‚ã€‚ã€‚æˆ‘çœ‹åˆ°è¿™é‡Œé¦–å…ˆçš„æ„Ÿè§‰æ˜¯ä¸€è„¸æ‡µé€¼ï¼Œæ€ä¹ˆè¿™ä¹ˆç®€å•ï¼Œæˆ‘ä»¬çš„é¢„æœŸæ˜¯è¿”å›ä¸€ä¸ª Activity å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä»æ„æ€æ¥çœ‹å¯ä»¥ç†è§£ï¼Œä½†æ˜¯è¿™ä¸ª component æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿä¸‹é¢å°±æ¥æ…¢æ…¢åˆ†æã€‚ 1234567891011121314151617181920212223242526public abstract class ComponentController&lt;C extends ComponentController&lt;C, T&gt;, T&gt; &#123; protected final C myself; protected T component; protected final ShadowLooperAdapter shadowMainLooper; protected Intent intent; protected boolean attached; @SuppressWarnings(\"unchecked\") public ComponentController(ShadowsAdapter shadowsAdapter, T component, Intent intent) &#123; this(shadowsAdapter, component); this.intent = intent; &#125; @SuppressWarnings(\"unchecked\") public ComponentController(ShadowsAdapter shadowsAdapter, T component) &#123; myself = (C) this; this.component = component; shadowMainLooper = shadowsAdapter.getMainLooper(); &#125; public T get() &#123; return component; &#125;&#125; çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤çš„æ˜¯ component æ˜¯æ¥è‡ª ComponentController() æ„é€ å‡½æ•°æ¥è¿›è¡Œåˆå§‹åŒ–çš„ï¼Œè¿™æ˜¯ä½ ä¼šå‘ç¥¥ä¸€ä¸ªå¾ˆç†Ÿæ‚‰çš„å‚æ•° ShadowsAdapter ï¼Œçœ‹çœ‹è¿™ä¸ªç±»ã€‚çœ‹å®Œä¹‹åä½ ä¼šå‘ç°è¿™å…¶å®æ˜¯ä¸€ä¸ªæ¥å£ã€‚è¿™æ—¶ä½ è¦æ€è€ƒçš„æ˜¯ï¼Œè¿™äº›å‚æ•°æ€ä¹ˆæ¥çš„ï¼Œä¸å¯èƒ½å‡­ç©ºäº§ç”Ÿï¼Œè‚¯å®šæ˜¯åœ¨ä½ çš„ç±»ç”Ÿæˆ Activity ç»„ä»¶è¿‡ç¨‹ä¸­æ„é€ çš„ã€‚çœ‹çœ‹ step 2.2 ä¸­çš„å‡½æ•°ä½ ä¼šå‘ç°ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯ getShadowsAdapter()ï¼Œç¬¬äºŒä¸ªæ˜¯ ReflectionHelpers.callConstructor(activityClass)ï¼Œ æ˜¯ä¸æ˜¯å‘ç°äº†ç‚¹ä»€ä¹ˆï¼Œå°±æ˜¯ä»è¿™é‡Œå¼€å§‹ï¼ŒåŸ‹ä¸‹äº†ç§å­ã€‚åŒæ—¶ step 3.2 ä¸­æœ‰component ï¼Œå‘ç°ä»–å°±æ˜¯æŠ½è±¡ç±» ComponentController ä¸­çš„å˜é‡ï¼Œè€Œä¸”æ˜¯ protected çš„ã€‚é‚£ä¹ˆç°åœ¨å”¯ä¸€çš„çŒœæƒ³å°±æ˜¯ ActivityController ç»§æ‰¿è‡ª ComponentController ï¼Œä»ç±»çš„å‘½åæ¥è¯´æ˜¯å¾ˆåˆç†çš„ã€‚é‚£ä¹ˆæºç æ˜¯è¿™æ ·çš„å—ï¼Ÿ 12// public class ActivityController&lt;T extends Activity&gt; extends org.robolectric.util.ActivityController&lt;T&gt; // abstract public class ActivityController&lt;T extends Activity&gt; extends ComponentController&lt;org.robolectric.android.controller.ActivityController&lt;T&gt;, T&gt; çœ‹åˆ°è¿™è¯´æ˜æˆ‘ä»¬çš„æƒ³æ³•å®Œå…¨æ­£ç¡®ï¼æ€»ç®—å¼„æ¸…æ¥š component çš„èº«ä»½ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸çŸ¥é“ä»–æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Ÿæˆ‘ä»¬çš„é¢„æµ‹æ˜¯å’Œ Activity è¦æœ‰å…³è”ï¼Œç›®å‰çš„åˆ†æè¿˜çœ‹ä¸å‡ºæ¥ï¼Œè€Œä¸”è¿™é‡Œçš„ step 3.2 ä¸­çš„ component ç›´æ¥ä½œä¸ºå‚æ•°ä¼ é€’äº†ï¼Œè¯´æ˜åœ¨ä¹‹å‰å°±å·²ç»è¢«åˆå§‹åŒ–äº†ï¼Œä¹Ÿå°±æ˜¯æ„é€ å‡½æ•° ComponentController(ShadowsAdapter shadowsAdapter, T component) å·²ç»è¢«è°ƒç”¨äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬è¿˜æ˜¯è¦å›åˆ° step 2.2 ä¸­çš„ ActivityController.of(getShadowsAdapter(), ReflectionHelpers.callConstructor(activityClass), intent) å› ä¸ºé‚£æ˜¯ Activity çš„æ¶ˆå¤±å’Œ component å‡ºç°çš„ä¸´ç•Œç‚¹ã€‚å¼€å§‹çœ‹çœ‹ of å‡½æ•°ã€‚ 123456789public static &lt;T extends Activity&gt; ActivityController&lt;T&gt; of(ShadowsAdapter shadowsAdapter, T activity, Intent intent) &#123; return new ActivityController&lt;&gt;(shadowsAdapter, activity, intent).attach();&#125;private ActivityController(ShadowsAdapter shadowsAdapter, T activity, Intent intent) &#123; super(shadowsAdapter, activity, intent); this.shadowsAdapter = shadowsAdapter; shadowReference = shadowsAdapter.getShadowActivityAdapter(this.component);&#125; è¿™æ—¶çœ‹åˆ° activity ä¼ ç»™äº†superï¼Œåº”è¯¥æœ‰ç‚¹è­¦è§‰ï¼Œå‰é¢ä¸æ˜¯éªŒè¯äº† ActivityController ç»§æ‰¿è‡ª ComponentController å—ï¼Ÿè€Œ component åˆæ˜¯åœ¨ ComponentController ä¸­çš„ï¼Œéš¾é“ã€‚ã€‚ã€‚ æ¥ç€ super 123456789101112protected ActivityController(ShadowsAdapter shadowsAdapter, T activity, Intent intent) &#123; super(shadowsAdapter, activity, intent);&#125;public ComponentController(ShadowsAdapter shadowsAdapter, T component, Intent intent) &#123; this(shadowsAdapter, component); this.intent = intent;&#125;public ComponentController(ShadowsAdapter shadowsAdapter, T component) &#123; myself = (C) this; this.component = component; shadowMainLooper = shadowsAdapter.getMainLooper();&#125; è´¹äº†è¿™ä¹ˆä¸€å¤§åœˆæœ€ç»ˆè¿˜æ˜¯æ‰¾åˆ°äº†ï¼Œå°±æ˜¯å’Œä¹‹å‰çš„çŒœæƒ³ä¸€è‡´ã€‚å°±æ˜¯ Activity ç»è¿‡ä¸€ç³»åˆ—çš„æ“ä½œ (è¿™é‡Œæ“ä½œæ˜¯æŒ‡ ReflectionHelpers.callConstructor(activityClass), intent) ) æœ€ç»ˆç›´æ¥ä¼ é€’ç»™ component ã€‚ æ‰€ä»¥è·å– Activity å¯¹è±¡çš„åˆ†æå°±å‘Šä¸€æ®µè½äº†ã€‚è‡³äºæ„å»ºç»†èŠ‚ï¼Œæ€ä¹ˆåœ¨ JVM ä¸­ç»˜åˆ¶ View çš„æˆ‘ä¹Ÿä¸æ€ä¹ˆæ¸…æ¥šï¼Œè¦æƒ³äº†è§£å¯ä»¥å¯¹ step 3.1 ä¸­çš„å‡½æ•°è¿›ä¸€æ­¥æ·±ç©¶ã€‚æˆ‘å¤§æ¦‚å¯ä»¥ç¡®å®šåº”è¯¥æ˜¯åœ¨é‚£ä¸ªè¿‡ç¨‹ä¸­å®Œæˆçš„ã€‚ è¿‡ç¨‹æ€»ç»“çœ‹å›¾ æ¨¡æ‹Ÿç‚¹å‡» -&gt; performClick()æ¥ä¸‹æ¥å°±æ˜¯æ ¹æ®è·å–çš„ Activity æ¥è·å–å¸ƒå±€ä¸­çš„æ§ä»¶è¿›è¡Œæµ‹è¯•ã€‚ è¿™é‡Œåˆ†æçš„æ˜¯ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼š 12345678910111213141516171819202122/** * Call this view's OnClickListener, if it is defined. Performs all normal * actions associated with clicking: reporting accessibility event, playing * a sound, etc. * * @return True there was an assigned OnClickListener that was called, false * otherwise is returned. */public boolean performClick() &#123; final boolean result; final ListenerInfo li = mListenerInfo; if (li != null &amp;&amp; li.mOnClickListener != null) &#123; playSoundEffect(SoundEffectConstants.CLICK); li.mOnClickListener.onClick(this); result = true; &#125; else &#123; result = false; &#125; sendAccessibilityEvent(AccessibilityEvent.TYPE_VIEW_CLICKED); return result;&#125; ä½ ä¼šå‘ç°è¿™é‡Œçš„ performClick() ä¸­å…¶å®æ˜¯è°ƒç”¨äº† onClick() çš„ã€‚ä¸‹é¢å°±æ˜¯è¦éªŒè¯ç¡®å®šä¼šæ‰§è¡Œè¿™ä¸ªç‚¹å‡»äº‹ä»¶ã€‚é¦–å…ˆ li != null è¿™ä¸ªæ¡ä»¶æ˜¯æ€ä¹ˆæˆç«‹çš„ï¼Ÿ 12345678static class ListenerInfo &#123; /** * Listener used to dispatch focus change events. * This field should be made private, so it is hidden from the SDK. * &#123;@hide&#125; */ ......&#125; é€šè¿‡ä¸Šè¿°ä»£ç ä½ ä¼šå‘ç°è¿™æ˜¯ä¸€ä¸ª View çš„é™æ€å†…éƒ¨ç±»ã€‚æ‰€ä»¥å…¶å® mListenerInfo åº”è¯¥æ˜¯ç±»ä¸­çš„ä¸€ä¸ªå˜é‡ã€‚é‚£ä¹ˆè¿™ä¸ªå˜é‡æ˜¯åœ¨ä½•æ—¶è¢«åˆå§‹åŒ–çš„å‘¢ï¼Ÿ 123456789ListenerInfo mListenerInfo;ListenerInfo getListenerInfo() &#123; if (mListenerInfo != null) &#123; return mListenerInfo; &#125; mListenerInfo = new ListenerInfo(); return mListenerInfo;&#125; ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾å¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œå‰é¢åº”è¯¥æ˜¯è°ƒç”¨äº† getListenerInfo() å‡½æ•°ã€‚è€Œå¯¹äºä¸€ä¸ª Button çš„ listenerInfo å‡­ç›´è§‰å¯ä»¥çŒœæµ‹ä¸‹å¾ˆå¤§å¯èƒ½æ˜¯ setOnClickListener() ä¸­è°ƒç”¨çš„ã€‚å› ä¸ºè®¾ç½®ç‚¹å‡»ç›‘å¬åº”è¯¥æ˜¯è¦è·å–ç›‘å¬ä¿¡æ¯çš„å§ã€‚ã€‚ã€‚å†å°±æ˜¯å‰é¢é™¤äº†å¯¹ Button è®¾ç½®äº†ç‚¹å‡»äº‹ä»¶å°±æ²¡åšå…¶ä»–æ“ä½œäº†ï¼Œè€Œä¸”å¦‚æœäº‹ä»¶å¾—åˆ°è§¦å‘çš„è¯æ„å‘³ç€ mListenerInfo ä¸€å®šæ˜¯è¢«åˆå§‹åŒ–äº†çš„ã€‚ç§ç§çŒœæµ‹éƒ½æŒ‡å‘ setOnClickListener() ï¼Œé‚£å°±çœ‹çœ‹æºç å§ã€‚ 1234567891011121314/** * Register a callback to be invoked when this view is clicked. If this view is not * clickable, it becomes clickable. * * @param l The callback that will run * * @see #setClickable(boolean) */public void setOnClickListener(@Nullable OnClickListener l) &#123; if (!isClickable()) &#123; setClickable(true); &#125; getListenerInfo().mOnClickListener = l;&#125; ç¡®å®æ˜¯å¦‚æ­¤ï¼Œå¦‚æœä½ æ²¡æœ‰è¿›è¡Œå‰é¢çš„çŒœæµ‹çš„è¯ï¼Œå¯ä»¥ç›´æ¥æœè¿™ä¸ªå‡½æ•°çœ‹çœ‹åœ¨å“ªäº›åœ°æ–¹è°ƒç”¨äº†ï¼Œè¿™æ—¶ä½ ä¼šå‘ç°ä¸€ä¸ªå…±åŒç‚¹ï¼šæ‰€æœ‰å’Œè§†å›¾ç›‘å¬æœ‰å…³çš„å‡½æ•°éƒ½æœ‰è°ƒç”¨ getListenerInfo() ã€‚è‡³äºä¸ºä»€ä¹ˆè¿™æ ·ï¼Ÿå¾ˆç®€å•ï¼Œå› ä¸ºä»–ä»¬éƒ½æ˜¯ Listener ï¼Œè‡ªç„¶éœ€è¦ ListenerInfo æ¥ç¡®å®šè‡ªå·±æ˜¯ä»€ä¹ˆç›‘å¬ï¼Œå¹¶ä¸”é€šè¿‡ ListenerInfo è¿›è¡Œç®¡ç†ï¼Œåªè¦ ListenerInfo ä¸­çš„æŸä¸ªå˜é‡æ˜¯ null å°±æ„å‘³ç€è¿™ä¸ª Listener æ˜¯æœªæ³¨å†Œçš„ã€‚è¿™ç‚¹å¯ä»¥ä» li.mOnClickListener != null è¿™ä¸ªæ¡ä»¶éªŒè¯ï¼Œä¹Ÿå°±æ˜¯å‰é¢ç‚¹å‡»äº‹ä»¶çš„è§¦å‘æ¡ä»¶ã€‚ 1234567891011121314151617public void setOnScrollChangeListener(OnScrollChangeListener l) &#123; getListenerInfo().mOnScrollChangeListener = l;&#125;public void setOnFocusChangeListener(OnFocusChangeListener l) &#123; getListenerInfo().mOnFocusChangeListener = l;&#125;public void addOnLayoutChangeListener(OnLayoutChangeListener listener) &#123; ListenerInfo li = getListenerInfo(); if (li.mOnLayoutChangeListeners == null) &#123; li.mOnLayoutChangeListeners = new ArrayList&lt;OnLayoutChangeListener&gt;(); &#125; if (!li.mOnLayoutChangeListeners.contains(listener)) &#123; li.mOnLayoutChangeListeners.add(listener); &#125;&#125; å¥½äº†ï¼Œç‚¹å‡»äº‹ä»¶å°±åˆ†æåˆ°è¿™ï¼Œæ€»ç»“ä¸€ä¸‹ï¼šæœ€å¼€å§‹å°±æ˜¯è®¾ç½®ç›‘å¬ï¼Œè®¾ç½®ç›‘å¬è¿‡ç¨‹ä¸­ä¼šåœ¨ View ä¸­å°†ç‚¹å‡»äº‹ä»¶ç”¨ ListenerInfo è®°å½•ã€‚åœ¨æ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶ä¸­è°ƒç”¨ performClick() ï¼Œä¸‹é¢å°±æ˜¯å¯¹äº‹ä»¶æ˜¯å¦æ³¨å†Œæ¥ç¡®å®šæ˜¯å¦è§¦å‘ç‚¹å‡»äº‹ä»¶ã€‚ ä¹‹åå°±æ˜¯è‡ªå·±å†™é€»è¾‘äº†ï¼Œå¯¹ä½ çš„é¢„æœŸå’Œæ¨¡æ‹Ÿè·‘å‡ºæ¥çš„ç»“æœæ˜¯å¦ä¸€è‡´è¿›è¡Œæµ‹è¯•ã€‚è¿™é‡Œå°±æ˜¯ Junit å†…å®¹äº†ã€‚ æ€»ç»“é€šè¿‡è¿™æ¬¡æºç åˆ†æï¼Œå‘ç°åªè¦ç»†å¿ƒï¼Œå¾ˆå¤šå¤§ç‰›çš„ä»£ç æ…¢æ…¢è¯»ä¹Ÿæ˜¯å¯ä»¥è¯»æ‡‚çš„ã€‚è™½ç„¶ä»£ç é‡å¤ªå¤§ä¸å¯èƒ½ä¸€è¡Œä¸è½åœ°é˜…è¯»ï¼Œä½†æ˜¯ä»ä¸€ä¸ªå°ä¾‹å­å‡ºå‘ï¼Œæ…¢æ…¢åˆ†æå°±å¯ä»¥å¾—å‡ºä½ è‡ªå·±ç†è§£ï¼Œå…¶å®ä»£ç çš„é€»è¾‘å°±æ˜¯å¸¸äººçš„é€»è¾‘ï¼Œå…¶ä¸­å€¼å¾—å­¦ä¹ çš„æ°æ°æ˜¯è¿™ç§å¸¸äººé€»è¾‘ä¹‹é—´çš„åè°ƒå’Œå¯¹ä»£ç æ•´ä¸ªçš„å®è§‚æŠŠæ§ã€‚ è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å†™å…³äºæºç åˆ†æçš„æ–‡ç« ï¼Œå…¶ä¸­è‚¯å®šæœ‰å¾ˆå¤šä¸è¶³ï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ­£ã€‚è¿˜æœ‰æ¨èä¸‹æˆ‘çš„ä¸ªäºº Blog æœ€åæ„Ÿè°¢é˜…è¯»","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"},{"name":"Android Unit Test","slug":"Android-Unit-Test","permalink":"http://fitzeng.org/tags/Android-Unit-Test/"}]},{"title":"å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-4","date":"2017-04-14T06:00:00.000Z","path":"2017/04/14/ZZChatApp4/","text":"GitHub å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-4å‡†å¤‡åšå¥½ã€ZZChatApp3ã€‘ä¸­çš„å†…å®¹å¹¶ä¸”ä¸‹è½½äº†å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-1ä¸­çš„èµ„æ–™å°±å¯ä»¥å¼€å§‹ä¸‹é¢çš„äº†ç¯å¢ƒè‡ªå·±å°è¯•æ˜¯å¦èƒ½é…å¥½ï¼Œä¸‹é¢åªæ˜¯ç»™å‡ºä¸€äº›æç¤ºå’Œå»ºè®®ã€‚Xampp + Java EE å®ç°ç›®æ ‡è¿™é‡Œå·²ç»å®ç°åŸºæœ¬çš„é€šè®¯äº†ã€‚ç”±äºæœ€è¿‘ç‰¹åˆ«å¿™ï¼Œæ‰€ä»¥æ‰“ç®—å†™ä¸¤ç¯‡çš„ç½‘ç»œç¼–ç¨‹æ€»ç»“æˆä¸€ç¯‡ï¼Œç»†èŠ‚åº”è¯¥éƒ½ä¼šæåˆ°ï¼Œåªæ˜¯ä¸ä¼šå¤ªè¯¦ç»†ã€‚å¸Œæœ›å¤§å®¶å¤šåˆ©ç”¨èº«è¾¹çš„ç½‘ç»œèµ„æºã€‚åŸºæœ¬åœ¨ç½‘ä¸Šéƒ½æœ‰ç°æˆçš„ç­”æ¡ˆã€‚ å®ç°è¿‡ç¨‹ è¿™å°±æ˜¯å¤§ä½“çš„æ–¹å‘ï¼Œæ‰€ä»¥ç›®å‰ç›®æ ‡å¾ˆç®€å•ï¼Œä¸ºäº†ä¸æ‰“æ–­ä»¥åçš„ç¼–ç æ€è·¯ï¼Œå‰æœŸå·¥ä½œè¦åšå¥½ã€‚ ç¯å¢ƒé…ç½® ä¸‹è½½Xampp å¼€å¯ Apache å’Œ mySql, åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ 127.0.0.1: çœ‹çœ‹æœ‰ Xampp ç•Œé¢å°±æˆåŠŸï¼Œç‚¹å‡» admin å‡ºç°æ•°æ®åº“å°±è¯´æ˜æ•°æ®åº“å¯ä»¥è®¿é—®äº†ã€‚ è‡³äº Java EE è‡ªèº«æ˜¯ä¸æºå¸¦ WindowBuilder ä¹Ÿå°±æ˜¯ä½ æ— æ³•ä½¿ç”¨ JFrame çš„å›¾å½¢ç•Œé¢è¿›è¡Œè®¾è®¡ã€‚æ€ä¹ˆå®‰è£…åŠ¨æ‰‹æœæœå°±çŸ¥é“äº†ã€‚ä¹‹åå°±åªè¦æ·»åŠ è®¿é—®æ•°æ®åº“çš„ä¸€ä¸ªåº“åˆ°å·¥ç¨‹é‡Œé¢ã€‚åœ¨èµ„æ–™4å·²ç»ç»™å‡ºï¼Œå¯¼å…¥ buildpath å°±å¯ä»¥äº†ã€‚ æ•°æ®åº“åˆ›å»º è¿™é‡Œåªæ˜¯æ•ˆæœå›¾ï¼Œæ•°æ®åº“çš„å†…å®¹æˆ‘ä»¬é€šè¿‡ä»£ç æ¥åˆ›å»ºï¼Œå¯ä»¥ä¿è¯æ¯ä¸€æ¬¡çš„æµ‹è¯•ç¯å¢ƒä¸€æ ·ã€‚ é€šè®¯åè®®è¿™ä¸€éƒ¨åˆ†çš„ç›®çš„æ˜¯æ•°æ®è§£æè¦ç”¨åˆ°çš„ã€‚å¯ä»¥è¿™æ ·æƒ³ï¼Œæˆ‘å‘é€ä¸€ä¸ªç™»å½•æ¶ˆæ¯å’ŒèŠå¤©æ¶ˆæ¯æœåŠ¡å™¨èƒ½åŒºåˆ†å—ï¼Ÿå¦‚æœèƒ½å¤ŸåŒºåˆ†ï¼Œé‚£æ˜¯æ€ä¹ˆåŒºåˆ†çš„ï¼Ÿè¿™å°±æ˜¯è®¾è®¡é€šè®¯åè®®çš„æœ€åŸå§‹åŸå› ã€‚å…¶å®å¦‚æœå­¦è¿‡ç½‘ç»œé€šè®¯å°±çŸ¥é“ï¼ŒTCP/IPåè®®æœ‰ä¸ªå¤´ï¼Œè¿™ä¸ªå¤´å°±å­˜åœ¨è¿™æŸäº›ä¿¡æ¯ï¼Œä»£è¡¨ç€è‡ªå·±èº«ä»½ï¼Œä¹‹åçš„ä¿¡æ¯å°±æŒ‰è¿™èº«ä»½çš„åè®®å»è§£æã€‚è¿™é‡Œå°±ç”¨ä¸€ä¸ªå¾ˆç®€å•çš„ [Action]:[info, info, â€¦ , info] æ¥ä½œä¸ºå¯¹è±¡ä¼ è¾“ã€‚[Action]å°±æ˜¯ä¸€ä¸ªå¤´ï¼Œåé¢è¿ç€æ¶ˆæ¯ï¼Œè‡³äºæ¶ˆæ¯å¦‚ä½•è§£æï¼Œå°±è¦çœ‹ä½ è‡ªå·±åè®®çš„å…·ä½“çº¦å®šäº†ã€‚è¿™é‡Œæˆ‘æä¾›ä¸€ä¸ªå¾ˆç®€é™‹çš„åœ¨èµ„æº4ä¸­ï¼Œä¹Ÿå°±æ˜¯ Version labç‰ˆ æ‰€éµå®ˆçš„åè®®ã€‚ æœåŠ¡ç«¯è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ socket æ¥ç¼–å†™ã€‚å¦‚æœä¹‹å‰ä½ æ²¡æœ‰æ¥è§¦è¿‡è¿™æ–¹é¢ï¼Œå¯èƒ½ç°åœ¨æƒ³çŸ¥é“æ‰‹æœºæ€ä¹ˆå’Œç”µè„‘é€šè®¯ï¼Ÿåˆ«æ€¥ï¼Œå…ˆçœ‹çœ‹è¿™ä¸ªä¾‹å­åœ¨ç”µè„‘ä¸Šæ€ä¹ˆè®¿é—®è‡ªå·±å†™çš„æœåŠ¡å™¨ã€‚ æ¼”ç¤ºå¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„ç•Œé¢æ¥å¼€å¯æœåŠ¡ï¼Œå¦‚æœä½ æ˜¯æµ‹è¯•,å¯ä»¥å…ˆä¸ç¼–å†™ç•Œé¢ï¼Œç›´æ¥è¿è¡Œå°±å¼€å¯æœåŠ¡ serverListener.start(); ä¹‹ååœ¨cmd telnet ä¸­é€šè¿‡ 127.0.0.1 è¿™ä¸ª IP è®¿é—®ç«¯å£ 27777 ã€‚å¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡º â€œhahaâ€ï¼Œ å¦‚æœä½ çš„ç”µè„‘æ²¡æœ‰ telnet å¯ä»¥å¼€å¯æˆ–è€…ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è®¿é—® 127.0.0.1:27777. æ•ˆæœä¸€æ ·ã€‚è¿™æ˜¯å°±ä»£è¡¨æœ‰ä¸€ä¸ªå’ŒæœåŠ¡å™¨å»ºç«‹çš„è¿æ¥ã€‚ ä»è¿™é‡Œå¯ä»¥çŒœæƒ³ï¼Œæ‰‹æœºå¦‚æœè¿æ¥çš„æ˜¯ç”µè„‘çš„æ— çº¿ï¼Œä¹Ÿå°±æ˜¯å¤„äºåŒä¸€ä¸ªå±€åŸŸç½‘å†…çš„è¯ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥è®¿é—®åˆ°æµè§ˆå™¨ã€‚å¯ä»¥è¯•è¯•ï¼Œæ‰‹æœºè¿æ¥ç”µè„‘æ— çº¿ï¼Œé‚£ä¹ˆé€šè¿‡ä»€ä¹ˆè®¿é—®ç«¯å£å‘¢ï¼Ÿ 127.0.0.1ï¼Ÿä»”ç»†æ€è€ƒå°±çŸ¥é“åº”è¯¥æ˜¯è¡Œä¸é€šçš„ï¼Œæ‰‹æœºå’Œç”µè„‘å»ºç«‹çš„è¿æ¥èµ°çš„æ˜¯å“ªæ¡çº¿è·¯å‘¢ï¼Ÿæˆ‘ä»¬è¿çš„æ˜¯æ— çº¿ï¼Œæ‰€ä»¥é€šè¿‡æ— çº¿é€‚é…å™¨å’Œç”µè„‘å»ºç«‹è¿æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è®¿é—®ç”µè„‘ä¸Šçš„ç«¯å£è‚¯å®šæ˜¯è¦ç»è¿‡è¿™ä¸ªé€‚é…å™¨çš„ã€‚æ‰€ä»¥æ‰¾åˆ°æ— çº¿ç½‘ç»œé€‚é…å™¨çš„ IPv4, å°±å¯ä»¥ é€šè¿‡ IPv4:27777 è®¿é—®äº†ã€‚ ä¸‹é¢è§£é‡Šä¸€ä¸‹ä»£ç ã€‚ 1234567891011121314151617public class ServerListener extends Thread&#123; private ServerSocket serverSocket; @Override public void run() &#123; try &#123; serverSocket = new ServerSocket(27777, 27); while (true) &#123; Socket socket = serverSocket.accept(); System.out.println(\"haha\"); ChatSocket chatSocket = new ChatSocket(socket); chatSocket.start(); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ã€‚åªè¦ä¸å‘ç”Ÿå¼‚å¸¸å’Œæ‰‹åŠ¨å…³é—­ï¼Œè¿™æ®µä»£ç æ˜¯ä¼šä¸€ç›´è¿è¡Œä¸‹å»çš„ã€‚å…¶ä¸­ 1Socket socket = serverSocket.accept(); è¿™ä¸€è¡Œæ˜¯å…³é”®ï¼Œä»£è¡¨çš„æ˜¯æ²¡æœ‰ socket æ¥å…¥çš„è¯ï¼Œç¨‹åºä¼šä¸€ç›´é˜»å¡åœ¨è¿™å¥ä»£ç å¤„ï¼Œä¸€æ—¦æœ‰ socket æ¥å…¥ï¼Œåˆ™è¿”å›ä¸€ä¸ª socket ï¼Œç”±äºä¸€ä¸ªæœåŠ¡å™¨å¿…ç„¶æ˜¯æœ‰å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ç»™æ¯ä¸ª socket è¿æ¥éƒ½åˆ†é…ä¸€ä¸ªçº¿ç¨‹å¹¶ä¸”å¼€å¯çº¿ç¨‹ï¼Œæ¥ç€å¾ªç¯è¿›å…¥é˜»å¡ï¼Œç›´åˆ°æœ‰ä¸‹ä¸€ä¸ªè¿æ¥å»ºç«‹ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ã€‚è¿™å°±æ˜¯è¿™æ®µä»£ç çš„è¿è¡ŒçŠ¶æ€ã€‚ ç°åœ¨å‡è®¾æœ‰çº¿ç¨‹å·²ç»å¼€å¯äº†ã€‚æ€ä¹ˆæ¥æ”¶æ•°æ®ï¼Ÿ socket æ˜¯ä»¥æµçš„å½¢å¼ä¼ è¾“æ•°æ®ã€‚æ‰€ä»¥åªè¦è·å–æµï¼Œå†å°†è¿™ä¸ªæµè¿›è¡Œç›¸å…³æ“ä½œå°±è¡Œäº†ã€‚ä¸‹é¢è§£é‡Šä¸€ä¸‹æˆ‘ä»¬çš„ä¸»è¦ä»£ç ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public class ChatSocket extends Thread&#123; private Socket socket; private String message = null; private BufferedReader bufferedReader; private BufferedWriter bufferedWriter; public ChatSocket(Socket s) &#123; this.socket = s; try &#123; this.bufferedReader = new BufferedReader(new InputStreamReader(s.getInputStream(), \"UTF-8\")); this.bufferedWriter = new BufferedWriter(new OutputStreamWriter(s.getOutputStream(), \"UTF-8\")); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; @Override public void run() &#123; try &#123; String line = null; while ((line = bufferedReader.readLine()) != null) &#123; if (!line.equals(\"-1\")) &#123; message += line; &#125; else &#123; delMessage(message); line = null; message = null; &#125; &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; MainWindow.getMainWindow().setShowMsg(this.username + \" login out !\"); MainWindow.getMainWindow().removeOfflineUsers(this.username); ChatManager.getChatManager().remove(socketMsg); bufferedWriter.close(); bufferedReader.close(); socket.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; é¦–å…ˆå®šä¹‰ä¸€ä¸ª BufferedReader å’Œ BufferedWriter ï¼Œä½œç”¨æ˜¯æ¥å—å®¢æˆ·ç«¯çš„æ•°æ®å’Œå‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚å¾ˆå¥½è®°ï¼ŒReader å¯¹äºè‡ªå·±æ¥è¯´å°±æ˜¯è¯»å–åˆ«å¤„çš„æ•°æ®ï¼ŒWriter æ˜¯å‘ç›®æ ‡å¯¹è±¡å†™æ•°æ®ã€‚æ‰€ä»¥ BufferedReader æ˜¯æ¥å—å®¢æˆ·ç«¯çš„æ•°æ®ï¼ŒBufferedWriter æ˜¯å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚ é‚£ä¹ˆå¦‚ä½•è·å–å‘¢ï¼Ÿ åœ¨æ„é€ å‡½æ•°ä¸­å¯ä»¥çœ‹åˆ°è¿™ä¸¤å¥ 12this.bufferedReader = new BufferedReader(new InputStreamReader(s.getInputStream(), \"UTF-8\"));this.bufferedWriter = new BufferedWriter(new OutputStreamWriter(s.getOutputStream(), \"UTF-8\")); å¯ä»¥ä¸€èµ·å†™ä¹Ÿå¯ä»¥åˆ†å¼€ã€‚å¦‚ä¸‹ï¼š 123456// ä» socket è·å–è¾“å…¥æµInputStream inputStream = s.getInputStream();// å°†ä½æµé€šè¿‡ â€œUTF-8â€ çš„æ ¼å¼è¯»å–ä¸ºå­—ç¬¦æµInputStreamReader inputStreamReader = new InputStreamReader(inputStream, \"UTF-8\");// å°†å­—ç¬¦æµæ”¾å…¥ Bufferã€‚æ–¹ä¾¿ä½¿ç”¨BufferedReader bufferedReader = new BufferedReader(inputStreamReader); å¤šæƒ³æƒ³æ•´ä¸ªæ•°æ®çš„ä¼ è¾“è¿‡ç¨‹å°±å¾ˆæ˜æœ—äº†ã€‚æœ‰ç‚¹åƒ OSI çš„é‚£ä¸ªä¸ƒå±‚æ¨¡å‹ï¼Œä¸€å±‚ä¸€å±‚å°è£…ä¸è§£å°è£…ã€‚ ä¸Šé¢åªæ˜¯è·å–åˆ°äº†æµï¼Œå¹¶æ²¡æœ‰è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œã€‚å¼€å§‹ä¸‹é¢ä»‹ç»è¯»å–æµä¸­çš„æ•°æ®ã€‚ 12345678910String line = null;while ((line = bufferedReader.readLine()) != null) &#123; if (!line.equals(\"-1\")) &#123; message += line; &#125; else &#123; delMessage(message); line = null; message = null; &#125;&#125; çœ‹ç€æœ‰ç‚¹ä¹±ã€‚ã€‚å†çœ‹ä¸€ä¸‹ä¸‹é¢çš„å§ã€‚ 1234567891011121314public void sendMsg(String msg) &#123; try &#123; while (socket == null) ; if (bufferedWriter != null) &#123; System.out.println(\"send :\" + msg); bufferedWriter.write(msg + \"\\n\"); bufferedWriter.flush(); bufferedWriter.write(\"-1\\n\"); bufferedWriter.flush(); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;&#125; å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°ï¼Œå‘é€æ¶ˆæ¯ä¹‹ååé¢ä¼šåŠ ä¸€ä¸ª â€œ-1â€ ä½œä¸ºæ¶ˆæ¯çš„ç»ˆæ­¢ç¬¦ï¼Œä¹Ÿå°±æ˜¯æ¥æ¥æ”¶æ–¹åœ¨æ¥æ”¶åˆ° -1 æ—¶ï¼Œè¯´æ˜å‰é¢çš„æ•°æ®æ˜¯ä½œä¸ºä¸€æ•´ä¸ªä¿¡æ¯çš„ï¼Œå°†æ•°æ®ä¼ å‡ºè¿›è¡Œå¤„ç†ã€‚æ¥ç€æ¸…ç©ºç»§ç»­æ¥æ”¶æ¥ä¸‹æ¥çš„æ¶ˆæ¯ï¼Œå¾ªç¯å¾€å¤ã€‚å¯ä»¥çœ‹åˆ° bufferedReader è¿™ä¸ªæµåªè¦ä¸å…³é—­ï¼Œè¿™ä¸ªä¼šæ°¸è¿œå¾ªç¯ä¸‹å»ã€‚ å¥½äº†æ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶éƒ½åŸºæœ¬ç®—æ˜¯å¤„ç†å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ•°æ®å¤„ç†ï¼Œæ•°æ®å¤„ç†å¿…ç„¶æ˜¯è¦ä¾èµ–åè®®çš„ã€‚æ‰€ä»¥ä¾èµ–åè®®è‡ªå·±å®ç°å¦‚ä¸‹çš„å‡½æ•°ã€‚ 123456789101112131415161718192021222324public void delMessage(String msg) &#123; if (msg != null) &#123; String action = getAction(msg); switch(action) &#123; case \"LOGIN\": &#123; dealLogin(msg); break; &#125; case \"REGISTER\": &#123; dealRegister(msg); break; &#125; case \"DRESSUP\": &#123; dealDressUp(msg); break; &#125; case \"GETDRESSUP\": &#123; dealGetDressUp(msg); break; &#125; case \"PROFILE\": &#123; dealProfile(msg); break; &#125; case \"GETPROFILE\": &#123; dealGetProfile(msg); break; &#125; case \"GETFRIENDLIST\": &#123; dealGetFriendList(msg); break; &#125; case \"GETGROUPLIST\": &#123; dealGetGroupList(msg); break; &#125; case \"GETFRIENDPROFILE\": &#123; dealGetFriendProfile(msg); break; &#125; case \"STATE\": &#123; dealState(msg); break; &#125; case \"CHATMSG\": &#123; dealChatMsg(msg); break; &#125; case \"USERLIST\": &#123; dealUserList(msg); break; &#125; case \"ADDFRIEND\": &#123; dealAddFriend(msg); break; &#125; case \"GROUPMEMBERLIST\": &#123; dealGroupMemberList(msg); break; &#125; case \"ADDGROUP\": &#123; dealAddGroup(msg); break; &#125; case \"GETALLGROUPLIST\": &#123; dealGetAllGroupList(msg); break;&#125; default : dealError(); break; &#125; &#125;&#125; æœåŠ¡ç«¯çš„çº¿ç¨‹æ˜¯éšè¿æ¥æ•°çš„å¢åŠ è€Œå¢åŠ ï¼Œæ‰€ä»¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ç®¡ç†çš„ç±»ï¼ˆChatManagerï¼‰å°±æœ‰å¿…è¦äº†ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥è½»æ¾çš„å¯¹æ¶ˆæ¯è¿›è¡Œè·¨è¿›ç¨‹è½¬å‘ï¼ˆèŠå¤©ï¼‰ã€‚ 1234567891011121314151617181920212223242526272829303132333435public class ChatManager &#123; private ChatManager()&#123;&#125;; List&lt;SocketMsg&gt; socketList = new ArrayList&lt;&gt;(); private static final ChatManager chatManager = new ChatManager(); public static ChatManager getChatManager() &#123; return chatManager; &#125; public void add(SocketMsg cs) &#123; socketList.add(cs); &#125; public void remove(SocketMsg cs) &#123; socketList.remove(cs); &#125; &#125;public class SocketMsg &#123; private ChatSocket chatSocket; private String username; public SocketMsg(ChatSocket chatSocket, String username) &#123; this.chatSocket = chatSocket; this.username = username; &#125; public String getUsername() &#123; return username; &#125; public void setUsername(String username) &#123; this.username = username; &#125; public ChatSocket getChatSocket() &#123; return chatSocket; &#125; public void setChatSocket(ChatSocket chatSocket) &#123; this.chatSocket = chatSocket; &#125;&#125; å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚ æœåŠ¡ç«¯åŸºæœ¬å°±è®²åˆ°è¿™é‡Œã€‚ç»†å¿ƒçš„äººä¼šå‘ç°æˆ‘ä»¬çš„æ¥æ”¶æ¶ˆæ¯å’Œå‘é€æ¶ˆæ¯æ˜¯ä¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­çš„ï¼Œç¨å¾®æ€è€ƒæ€è€ƒå¯¹å®¢æˆ·ç«¯çš„ä»£ç ç¼–å†™æœ‰å¥½å¤„ã€‚ å®¢æˆ·ç«¯åœ¨ä¸è€ƒè™‘ä¿¡æ¯å¤„ç†çš„æƒ…å†µä¸‹å®¢æˆ·ç«¯ä»¿ç…§æœåŠ¡ç«¯å¾ˆå®¹æ˜“å†™å‡ºæ¥å—å‘é€æµçš„ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758server/ServerManager.javapublic class ServerManager extends Thread &#123; private static final String IP = \"192.168.191.1\"; private Socket socket; private String message = null; private BufferedReader bufferedReader; private BufferedWriter bufferedWriter; public static ServerManager getServerManager() &#123; return serverManager; &#125; private ServerManager() &#123; &#125; public void run() &#123; try &#123; socket = new Socket(IP, 27777); bufferedReader = new BufferedReader(new InputStreamReader(socket.getInputStream(), \"UTF-8\")); bufferedWriter = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream(), \"UTF-8\")); String m = null; String line; while ((line = bufferedReader.readLine()) != null) &#123; if (!line.equals(\"-1\")) &#123; m += line; &#125; else &#123; Log.d(\"TAG\", \"receive : \" + m); if (ParaseData.getAction(m).equals(\"GETCHATMSG\")) &#123; receiveChatMsg.delChatMsg(m); &#125; else &#123; message = m; &#125; m = null; &#125; &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; bufferedWriter.close(); bufferedReader.close(); socket.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; public void sendMessage(Context context, String msg) &#123; try &#123; while (socket == null) ; if (bufferedWriter != null) &#123; bufferedWriter.write(msg + \"\\n\"); bufferedWriter.flush(); bufferedWriter.write(\"-1\\n\"); bufferedWriter.flush(); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; ä»£ç æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼ŸåŸºæœ¬å’ŒæœåŠ¡ç«¯æ²¡ä»€ä¹ˆå˜åŒ–ï¼Œå› ä¸ºæ¯•ç«Ÿè¿™æ˜¯è¦å’ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„ã€‚ å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ä»å“ªé‡Œå¼€å¯è¿™ä¸ªçº¿ç¨‹å‘¢ï¼Ÿæˆ‘æ˜¯åœ¨è¿™é‡Œï¼š 12345678AtyLoginOrRegister.javapublic class AtyLoginOrRegister extends AppCompatActivity implements View.OnClickListener &#123; private ServerManager serverManager = ServerManager.getServerManager(); private void initViews() &#123; serverManager.start(); &#125;&#125; ä¸‹é¢å°±æ˜¯è¿›è¡Œæ•°æ®ä¼ è¾“å¤„ç†äº†ï¼Œæˆ‘ä¸¾ä¸¤ä¸ªä¾‹å­ã€‚ æ•°æ®ä¼ è¾“ ç™»å½• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556public class AtyLoginOrRegister extends AppCompatActivity implements View.OnClickListener &#123; private void initViews() &#123; btnLogin.setOnClickListener(this); btnRegister.setOnClickListener(this); serverManager.start(); &#125; @Override public void onClick(View v) &#123; switch (v.getId()) &#123; case R.id.btn_login: &#123; String username = etLoginUsername.getText().toString(); String password = etLoginPassword.getText().toString(); if (login(username, password)) &#123; serverManager.setUsername(username); Intent intent = new Intent(this, AtyMain.class); startActivity(intent); finish(); &#125; else &#123; etLoginUsername.setText(\"\"); etLoginPassword.setText(\"\"); &#125; break; &#125; case R.id.btn_register: &#123; Intent intent = new Intent(this, AtyMain.class); startActivity(intent); finish(); break; &#125; default: break; &#125; &#125; private boolean login(String username, String password) &#123; // check username and password whether legal if (username == null || username.length() &gt; 10 || password.length() &gt; 20) &#123; return false; &#125; // send msg to servers String msg = \"[LOGIN]:[\" + username + \", \" + password + \"]\"; serverManager.sendMessage(this, msg); // get msg from servers return String ack = serverManager.getMessage(); // deal msg if (ack == null) &#123; return false; &#125; serverManager.setMessage(null); String p = \"\\\\[ACKLOGIN\\\\]:\\\\[(.*)\\\\]\"; Pattern pattern = Pattern.compile(p); Matcher matcher = pattern.matcher(ack); return matcher.find() &amp;&amp; matcher.group(1).equals(\"1\"); &#125;&#125; æ—¢ç„¶æ˜¯ç™»å½•ï¼Œé‚£ä¹ˆäº‹ä»¶æ˜¯å‘ç”Ÿåœ¨æŒ‰é’®çš„ç‚¹å‡»ä¹‹åã€‚ä¸‹é¢æˆ‘ä»¬æ¥ç†ä¸€ä¸‹ç™»å½•è¿‡ç¨‹ï¼š ç‚¹å‡»ç™»å½•æŒ‰é’®-&gt;è·å–ç™»å½•ä¿¡æ¯-&gt;å°è£…ä¿¡æ¯ä¼ è¾“-&gt;æœåŠ¡ç«¯æ¥æ”¶-&gt;è§£æä¿¡æ¯-&gt;ä»æœåŠ¡å™¨è·å–ä¿¡æ¯è¿›è¡Œç™»å½•éªŒè¯-&gt;è¿”å›éªŒè¯ç»“æœ-&gt;å®¢æˆ·ç«¯è·å–æ•°æ®-&gt;è§£æä¿¡æ¯-&gt;è¿›è¡Œç™»å½•çŠ¶æ€è°ƒæ•´ è¿™å°±æ˜¯ä¸€æ•´ä¸ªæµç¨‹ã€‚ä¸‹é¢å°±å…·ä½“ä»‹ç»ã€‚ ç‚¹å‡»ç™»å½•æŒ‰é’® 1234case R.id.btn_login: &#123; String username = etLoginUsername.getText().toString(); String password = etLoginPassword.getText().toString();&#125; è·å–ç™»å½•ä¿¡æ¯ 12String username = etLoginUsername.getText().toString();String password = etLoginPassword.getText().toString(); å°è£…ä¿¡æ¯ä¼ è¾“ 12345if (username == null || username.length() &gt; 10 || password.length() &gt; 20) &#123; return false;&#125;String msg = \"[LOGIN]:[\" + username + \", \" + password + \"]\";serverManager.sendMessage(this, msg); æœåŠ¡ç«¯æ¥æ”¶ 1234567891011String line = null;while ((line = bufferedReader.readLine()) != null) &#123; if (!line.equals(\"-1\")) &#123; message += line; &#125; else &#123; delMessage(message); System.out.println(\"receive : \" + message); line = null; message = null; &#125;&#125; è§£æä¿¡æ¯ 123456789String iusername = null;String iPassword = null;String p = \"\\\\[LOGIN\\\\]:\\\\[(.*), (.*)\\\\]\";Pattern pattern = Pattern.compile(p);Matcher matcher = pattern.matcher(msg);if (matcher.find()) &#123; iusername = matcher.group(1); iPassword = matcher.group(2);&#125; ä»æœåŠ¡å™¨è·å–ä¿¡æ¯è¿›è¡Œç™»å½•éªŒè¯ &amp;&amp; è¿”å›éªŒè¯ç»“æœ 1234567891011121314151617String sql = \"SELECT password FROM USERS WHERE username = '\" + iusername + \"';\";try &#123; Statement statement = connection.createStatement(); ResultSet resultSet = statement.executeQuery(sql); if (resultSet.next() &amp;&amp; iPassword.equals(resultSet.getString(1)) ) &#123; sendMsg(\"[ACKLOGIN]:[1]\"); this.username = iusername; MainWindow.getMainWindow().setShowMsg(this.username + \" login in!\"); MainWindow.getMainWindow().addOnlineUsers(this.username); socketMsg = new SocketMsg(this, this.username); ChatManager.getChatManager().add(socketMsg); return ; &#125;&#125; catch (SQLException e) &#123; e.printStackTrace();&#125;sendMsg(\"[ACKLOGIN]:[0]\"); å®¢æˆ·ç«¯è·å–æ•°æ® 1String ack = serverManager.getMessage(); è§£æä¿¡æ¯ 12345678if (ack == null) &#123; return false;&#125;serverManager.setMessage(null);String p = \"\\\\[ACKLOGIN\\\\]:\\\\[(.*)\\\\]\";Pattern pattern = Pattern.compile(p);Matcher matcher = pattern.matcher(ack);return matcher.find() &amp;&amp; matcher.group(1).equals(\"1\"); è¿›è¡Œç™»å½•çŠ¶æ€è°ƒæ•´ 123456789if (login(username, password)) &#123; serverManager.setUsername(username); Intent intent = new Intent(this, AtyMain.class); startActivity(intent); finish();&#125; else &#123; etLoginUsername.setText(\"\"); etLoginPassword.setText(\"\");&#125; å‘é€ä¿¡æ¯ æµç¨‹ä¸€æ ·åªæ˜¯å¤„ç†æ¶ˆæ¯çš„æ—¶å€™å¤æ‚ä¸€ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬åªä¸ºèŠå¤©è®¾ç½®ä¸€ä¸ªåè®®ã€‚æ‰€ä»¥è¦æé«˜ä¿¡æ¯çš„åŒºåˆ†åº¦è€Œå¯¹æ•°æ®è¿›è¡Œçš„ç¹å¤æ“ä½œæ˜¯å¿…é¡»çš„ã€‚ å‘é€ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041btnSend.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; String content = myMsg.getText().toString(); if (!content.isEmpty()) &#123; ChatMsg msg = new ChatMsg(); msg.setContent(content); msg.setUsername(ServerManager.getServerManager().getUsername()); msg.setIconID(ServerManager.getServerManager().getIconID()); msg.setMyInfo(true); msg.setChatObj(chatObj); msg.setGroup(group.equals(\"0\") ? chatObj : \" \"); if (sendToChatObj(msg.getContent())) &#123; ChatMsg.chatMsgList.add(msg); chatMsgList.add(msg); myMsg.setText(\"\"); &#125; else &#123; Toast.makeText(AtyChatRoom.this, \"send failed\", Toast.LENGTH_SHORT).show(); &#125; &#125; &#125;&#125;);private boolean sendToChatObj(String content) &#123; String msg = \"[CHATMSG]:[\" + chatObj + \", \" + content + \", \" + ServerManager.getServerManager().getIconID() +\", Text]\"; ServerManager serverManager = ServerManager.getServerManager(); serverManager.sendMessage(this, msg); try &#123; Thread.sleep(300); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; String ack = serverManager.getMessage(); if (ack == null) &#123; return false; &#125; String p = \"\\\\[ACKCHATMSG\\\\]:\\\\[(.*)\\\\]\"; Pattern pattern = Pattern.compile(p); Matcher matcher = pattern.matcher(ack); return matcher.find() &amp;&amp; matcher.group(1).equals(\"1\");&#125; æ¥æ”¶ï¼š ç”±äºæ—¥åæ‰©å±•å¯èƒ½ä¸åªæ˜¯æ–‡æœ¬ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨å¯¹èŠå¤©ä¿¡æ¯çš„å¤„ç†ä¸Šæˆ‘ä»¬ç›´æ¥å†å»ºä¸€ä¸ªç±»ã€‚ 1234567891011121314151617181920212223242526272829303132class ReceiveChatMsg &#123; void delChatMsg(String msg) &#123; String sendName = null; String content = null; String avatarID = null; String fileType = null; String group = null; ServerManager.getServerManager().setMessage(null); String p = \"\\\\[GETCHATMSG\\\\]:\\\\[(.*), (.*), (.*), (.*), (.*)\\\\]\"; Pattern pattern = Pattern.compile(p); Matcher matcher = pattern.matcher(msg); if (matcher.find()) &#123; sendName = matcher.group(1); content = matcher.group(2); avatarID = matcher.group(3); fileType = matcher.group(4); group = matcher.group(5); ChatMsg chatMsg = new ChatMsg(); chatMsg.setMyInfo(false); chatMsg.setContent(content); chatMsg.setChatObj(sendName); chatMsg.setUsername(ServerManager.getServerManager().getUsername()); chatMsg.setGroup(group); chatMsg.setIconID(Integer.parseInt(avatarID)); AtyChatRoom.chatMsgList.add(chatMsg); ChatMsg.chatMsgList.add(chatMsg); &#125; &#125;&#125; ç»†èŠ‚å°±ä¸å¤šè¯´äº†ï¼Œæ³¨æ„åŒºåˆ†åŒä¸€ä¸ªå¯¹è±¡å‘ä¿¡æ¯ç»™ä½ æ˜¯é€šè¿‡ç¾¤è¿˜æ˜¯ç§äººã€‚ è¿˜æœ‰å°±æ˜¯å½“èŠå¤©çª—å£å…³é—­ååœ¨å†æ¬¡æ‰“å¼€èŠå¤©ä¿¡æ¯æ€ä¹ˆåŠ è½½ï¼Ÿå¤§å®¶è‡ªå·±æƒ³æƒ³ã€‚ä¸åŒå¯ä»¥çœ‹ä»£ç æˆ–è€…ç•™è¨€ã€‚ ä¸‹é¢çœ‹ä¸‹æœåŠ¡å™¨çš„æ•°æ®è½¬å‘ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152private void dealChatMsg(String msg) &#123; String chatObj = null; String content = null; String avatarID = null; String msgType = null; String p = \"\\\\[CHATMSG\\\\]:\\\\[(.*), (.*), (.*), (.*)\\\\]\"; Pattern pattern = Pattern.compile(p); Matcher matcher = pattern.matcher(msg); if (matcher.find()) &#123; chatObj = matcher.group(1); content = matcher.group(2); avatarID = matcher.group(3); msgType = matcher.group(4); &#125; else &#123; return; &#125; String out = null; String sqlGroup = \"SELECT * FROM GROUPS WHERE groupName = '\" + chatObj+ \"';\"; try &#123; Statement statement = connection.createStatement(); ResultSet resultSet = statement.executeQuery(sqlGroup); // gruop chat if (resultSet.next()) &#123; // find all group members to send msg String sql = \"SELECT groupMemberName FROM GROUPINFO WHERE groupName = '\" + chatObj + \"';\"; resultSet = statement.executeQuery(sql); while (resultSet.next()) &#123; // if user is online , then send. for (SocketMsg SocketMsg : ChatManager.getChatManager().socketList) &#123; if (SocketMsg.getUsername().equals(resultSet.getString(1)) &amp;&amp; !SocketMsg.getUsername().equals(username)) &#123; out = \"[GETCHATMSG]:[\" + username + \", \" + content + \", \" + avatarID + \", Text, \" + chatObj + \"]\"; SocketMsg.getChatSocket().sendMsg(out); &#125; &#125; &#125; // private chat &#125; else &#123; for (SocketMsg socketManager : ChatManager.getChatManager().socketList) &#123; if (socketManager.getUsername().equals(chatObj)) &#123; out = \"[GETCHATMSG]:[\" + username + \", \" + content + \", \" + avatarID + \", Text, ]\"; socketManager.getChatSocket().sendMsg(out); &#125; &#125; &#125; out = \"[ACKCHATMSG]:[1]\"; sendMsg(out); &#125; catch (SQLException e) &#123; out = \"[ACKCHATMSG]:[0]\"; sendMsg(out); e.printStackTrace(); &#125;&#125; å…¶å®é€»è¾‘ä¸æ˜¯å¾ˆå¤æ‚ï¼Œæ…¢æ…¢çœ‹å¾ˆå®¹æ˜“æ‡‚çš„ã€‚å…¶ä»–çš„å®ç°è‡ªå·±æ…¢æ…¢æ‘¸ç´¢å¯ä»¥å®ç°ã€‚ä¸æƒ³å†æ‹–é•¿ç¯‡å¹…äº†ï¼Œçœ‹ä»£ç å¯èƒ½æ¯”æˆ‘è®²çš„æ•ˆç‡æ›´é«˜ï¼Œç†è§£æ›´åŠ æ·±åˆ»ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¯èƒ½ä½ ä¼šé‡åˆ°ä¸€ä¸ªå° Bug å¡äº†ä¸€å¤©ï¼Œä½†æ˜¯æ¯ä¸ªäººéƒ½æ˜¯è¿™ä¹ˆæˆé•¿è¿‡æ¥çš„ï¼Œä¸€èµ·åŠ æ²¹! åˆ°è¿™é‡Œç›®å‰çš„å°±ç®—å®Œäº†ï¼Œè¿™ä¸ªç³»åˆ— Blog å¯èƒ½ä¸ä¼šæ›´æ–°äº†ã€‚ä½†æ˜¯ GitHub ä¸Šä¼šå¯¹ä»£ç ç»§ç»­æ›´æ–°çš„ã€‚æ­¤å¤–è¿™ä¸ª Lab ç‰ˆè¿˜æœ‰å¾ˆå¤š Bug æ¬¢è¿å¤§å®¶æå»ºè®®ï¼Œå¾ˆå¸Œæœ›å’Œå¤§å®¶ä¸€èµ·äº¤æµå­¦ä¹ ã€‚ å¤šè°¢é˜…è¯»ã€‚","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"},{"name":"ZZChat","slug":"ZZChat","permalink":"http://fitzeng.org/tags/ZZChat/"}]},{"title":"å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-3","date":"2017-04-14T05:00:00.000Z","path":"2017/04/14/ZZChatApp3/","text":"GitHub å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-3å‡†å¤‡åšå¥½ã€ZZChatApp2ã€‘ä¸­çš„å†…å®¹å¹¶ä¸”ä¸‹è½½äº†å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-1ä¸­çš„èµ„æ–™å°±å¯ä»¥å¼€å§‹ä¸‹é¢çš„äº† å®ç°ç›®æ ‡çœ‹æ¼”ç¤ºæ•ˆæœå°±çŸ¥é“ï¼Œè¿™æ¬¡ä¸»è¦çš„ä»»åŠ¡æ˜¯å®ç°ä¸¤ä¸ªç•Œé¢ï¼Œä¸€ä¸ªæ˜¯ Dressup é€‰å›¾ç‰‡çš„ï¼Œå¦ä¸€ä¸ªæ˜¯èŠå¤©ç•Œé¢ã€‚å¦‚æœä½ å¯¹ RecyclerView æœ‰ä¸€å®šè®¤è¯†äº†ï¼Œå¯ä»¥è‡ªå·±è‡ªè¡Œç¼–å†™ Dressup ç•Œé¢ã€‚æˆ‘ä»¬çš„èŠå¤©ä¿¡æ¯ä½¿ç”¨çš„æ˜¯ listview ï¼Œå°è¯•å°½å¯èƒ½å¤šçš„æ§ä»¶ã€‚å¥½æ¶ˆæ¯æ˜¯è¿™æ¬¡ lab ä¹‹ååŸºæœ¬çš„ç•Œé¢å·¥ä½œå°±å®Œæˆäº†ï¼Œä¸‹æ¬¡ lab æˆ‘ä»¬å¼€å§‹è¿›è¡Œç½‘ç»œç¼–ç¨‹ã€‚ å®ç°è¿‡ç¨‹ Profile ç•Œé¢å°±ä¸è®²äº†ï¼Œè‡ªå·±å‚ç…§æºç æˆ–è€…è‡ªå·±å†™ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿å°±ç›´æ¥æŠŠ username ä½œä¸º id å’Œ nickname ä¸»è¦æ˜¯ä¸ºäº†åæœŸæ•°æ®åº“çš„å»ºç«‹ä¸å¤ªéº»çƒ¦ï¼Œæ¯•ç«Ÿæ˜¯ä¸ªå°ç»ƒä¹ ã€‚æ•°æ®å¤„ç†ä¸æ˜¯æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹ï¼Œé‡ç‚¹æ˜¯æ•´ä¸ªå¼€å‘æµç¨‹ã€‚ Dressupå®ç° æˆ‘çš„ä¹ æƒ¯æ˜¯å…ˆå†™ç•Œé¢ 123456789101112131415161718192021aty_dress_up.xml&lt;LinearLayout &gt; &lt;org.fitzeng.zzchat.view.TitleBar android:id=\"@+id/tb_dress_up\" &gt; &lt;/org.fitzeng.zzchat.view.TitleBar&gt; &lt;TextView android:text=\"Choose an avatar\" /&gt; &lt;android.support.v7.widget.RecyclerView android:id=\"@+id/rv_avatar\" &gt; &lt;/android.support.v7.widget.RecyclerView&gt; &lt;TextView android:text=\"Choose a background\" /&gt; &lt;android.support.v7.widget.RecyclerView android:id=\"@+id/rv_background\" &gt; &lt;/android.support.v7.widget.RecyclerView&gt; &lt;Button android:id=\"@+id/btn_save\" /&gt;&lt;/LinearLayout&gt; å¸ƒå±€å¾ˆç®€å•ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å»ºä¸€ä¸ªAtyå»åŠ è½½å¸ƒå±€ã€‚å¸ƒå±€å¥½äº†ï¼Œè¿™æ˜¯åº”è¯¥æ˜¯åŠ è½½èµ„æºï¼Œè€ŒåŠ è½½èµ„æºåˆä¸å¾—ä¸ç”¨åˆ°æˆ‘ä»¬çš„é€‚é…å™¨ã€‚æ‰€ä»¥å…ˆå†™é€‚é…å™¨ã€‚ ä¸‹é¢ä»¥åŠ è½½ Avatar ä¸ºä¾‹ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859adapter/AdapterAvatar.javapublic class AdapterAvatar extends RecyclerView.Adapter&lt;AdapterAvatar.BaseViewHoder&gt;&#123; private List&lt;ImageMsg&gt; imageViews; private Context context; private LayoutInflater inflater; private static int selectedImageAvatar = 0; private List&lt;RelativeLayout&gt; imageContainer = new ArrayList&lt;&gt;(); private Drawable bgImageDrawable; @RequiresApi(api = Build.VERSION_CODES.LOLLIPOP) public AdapterAvatar(Context context, List&lt;ImageMsg&gt; imageViews) &#123; this.context = context; this.imageViews = imageViews; this.inflater = LayoutInflater.from(context); selectedImageAvatar = 0; bgImageDrawable = context.getResources().getDrawable(R.drawable.bgimage, null); &#125; @Override public BaseViewHoder onCreateViewHolder(ViewGroup parent, int viewType) &#123; View view = inflater.inflate(R.layout.choose_image, parent, false); return new BaseViewHoder(view); &#125; @Override public void onBindViewHolder(final BaseViewHoder holder, final int position) &#123; holder.imageView.setImageResource(imageViews.get(position).getImageID()); imageContainer.get(selectedImageAvatar).setBackground(bgImageDrawable); holder.imageView.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; if (position != selectedImageAvatar) &#123; imageContainer.get(position).setBackground(bgImageDrawable); imageContainer.get(selectedImageAvatar).setBackgroundColor(0); selectedImageAvatar = position; &#125; &#125; &#125;); &#125; @Override public int getItemCount() &#123; return imageViews == null ? 0 : imageViews.size(); &#125; class BaseViewHoder extends RecyclerView.ViewHolder &#123; ImageView imageView; BaseViewHoder(View itemView) &#123; super(itemView); imageView = (ImageView) itemView.findViewById(R.id.image); RelativeLayout layout = (RelativeLayout) itemView.findViewById(R.id.imageContainer); imageContainer.add(layout); &#125; &#125;&#125; ä»£ç å¾ˆç®€æ´ï¼Œéƒ½æ˜¯å¥—è·¯ã€‚å”¯ä¸€æ³¨æ„çš„ä¸€ç‚¹æ˜¯ç‚¹å‡»çš„é€»è¾‘å¤„ç†ã€‚è¿˜æœ‰å°±æ˜¯æŠŠå›¾ç‰‡èµ„æºï¼ˆutil/ImageManagerï¼‰ç”¨ä¸€ä¸ªç±»å°è£…ä¸€ä¸‹ï¼Œå’Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ˆutil/ImageMsgï¼‰ç”¨æ¥å­˜å‚¨åŠ è½½æ•°æ®çš„ä¿¡æ¯ã€‚ç”¨èµ·æ¥å°±æ¯”è¾ƒæ–¹ä¾¿äº†ã€‚é€‚é…å™¨å¥½äº†ï¼Œä¸‹é¢åˆ©ç”¨é€‚é…å™¨æŠŠæ•°æ®åŠ è½½è¿› RecyclerView ã€‚æ€è·¯è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ã€‚ å…·ä½“å®ç°çœ‹ä»£ç å§ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142@RequiresApi(api = Build.VERSION_CODES.LOLLIPOP)private void initViews() &#123; titleBar = (TitleBar) findViewById(R.id.tb_dress_up); rvAvatar = (RecyclerView) findViewById(R.id.rv_avatar); rvBackground = (RecyclerView) findViewById(R.id.rv_background); btnSave = (Button) findViewById(R.id.btn_save); addAvatarView(); titleBar.setTitleBarClickListetner(new TitleBar.titleBarClickListener() &#123; @Override public void leftButtonClick() &#123; finish(); &#125; @Override public void rightButtonClick() &#123; &#125; &#125;); btnSave.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; Toast.makeText(AtyDressUp.this, \"saved\", Toast.LENGTH_SHORT).show(); finish(); &#125; &#125;);&#125;private void addAvatarView() &#123; List&lt;ImageMsg&gt; imageMsgs = new ArrayList&lt;&gt;(); for (int anImagesAvatar : ImageManager.imagesAvatar) &#123; ImageMsg imagemsg = new ImageMsg(); imagemsg.setImageID(anImagesAvatar); imageMsgs.add(imagemsg); &#125; AdapterAvatar avatarAdapter = new AdapterAvatar(this, imageMsgs); LinearLayoutManager layoutManager = new LinearLayoutManager(this, LinearLayoutManager.HORIZONTAL, false); rvAvatar.setLayoutManager(layoutManager); rvAvatar.setAdapter(avatarAdapter);&#125; ä¹‹ååŠ è½½ Background çš„ä»£ç è‡ªå·±å†™å§,è¿™ä¸€éƒ¨åˆ†å°±ç®—å®Œæˆäº†ï¼Œä¸æ‡‚çš„å¯ä»¥å‚ç…§æºç ã€‚ èŠå¤©ç•Œé¢çœ‹è¿‡ç¬¬ä¸€è¡Œä»£ç çš„åº”è¯¥æœ‰ç‚¹äº†è§£ï¼Œå¤§å®¶å¯ä»¥å…ˆä¸Šç½‘æœæœå…¶ä»–èµ„æºã€‚ ä¸»è¦é—®é¢˜æ˜¯æ€ä¹ˆè®©æ¶ˆæ¯è‡ªé€‚åº”æ°”æ³¡ã€‚æœ‰ä¸€ç§å›¾ç‰‡æ—¶.9.pngæ ¼å¼ï¼Œè‡³äºå¦‚ä½•åˆ¶ä½œï¼Œå¾ˆç®€å•ã€‚é€‰ä¸­å›¾ç‰‡å³é”®ï¼Œåœ¨æœ€ä¸‹é¢çš„é€‰é¡¹ä¸­æœ‰ä¸€ä¸ªCreate 9-Patch fileâ€¦ç‚¹å‡»ä¹‹åå°±ä¼šå¼¹å‡ºç•Œé¢ï¼Œè‡ªå·±æŠŠè¦ç¼©æ”¾çš„åŒºåŸŸé›†ä¸­åœ¨é»‘çº¿çš„äº¤æ±‡åŒºåŸŸã€‚ èŠå¤©ç•Œé¢å¸ƒå±€å¦‚ä¸‹ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªBugï¼Œä¸‹é¢ä¼šé™ˆè¿°ã€‚ 1234567891011121314151617181920&lt;LinearLayout &gt; &lt;org.fitzeng.zzchat.view.TitleBar android:id=\"@+id/tb_chat_room\" &gt; &lt;/org.fitzeng.zzchat.view.TitleBar&gt; &lt;ScrollView &gt; &lt;LinearLayout &gt; &lt;ListView android:id=\"@+id/lv_chat_room\" &gt; &lt;/ListView&gt; &lt;LinearLayout &gt; &lt;Button android:text=\"emoji\" /&gt; &lt;Button android:text=\"draw\" /&gt; &lt;Button android:text=\"file\" /&gt; &lt;Button android:text=\"call\" /&gt; &lt;/LinearLayout&gt; &lt;LinearLayout&gt; &lt;EditText android:id=\"@+id/myMsg\"/&gt; &lt;Button android:id=\"@+id/btnSend\"/&gt; &lt;/LinearLayout&gt; &lt;/LinearLayout&gt; &lt;/ScrollView&gt;&lt;/LinearLayout&gt; æ¥ä¸‹æ¥å°±æ˜¯æ¶ˆæ¯ç•Œé¢çš„è®¾è®¡ï¼Œä¹Ÿå°±æ˜¯é€‚é…å™¨åŠ è½½çš„å¸ƒå±€ã€‚ä¸€ä¸ªå¤´åƒï¼Œä¸€ä¸ª username ä¸€ä¸ªå†…å®¹ã€‚OKã€‚ä½†æ˜¯è¦åŒºåˆ†æ˜¯è‡ªå·±å‘é€çš„æ¶ˆæ¯è¿˜æ˜¯åˆ«äººå‘é€çš„æ¶ˆæ¯ã€‚æ‰€ä»¥æœ‰ä¸¤ä¸ªå¸ƒå±€ã€‚ è¿™æ—¶æˆ‘ä»¬è¦å»ºç«‹ä¸€ä¸ªèŠå¤©ä¿¡æ¯çš„Msg 12345private boolean myInfo;private int iconID;private String username;private String content;private String chatObj; æ•°æ®ä»€ä¹ˆçš„éƒ½è´®å¤‡å¥½äº†ï¼Œä¸‹é¢è¿›è¡Œæ˜¯é€‚é…å™¨çš„ç¼–å†™ã€‚ç”±äº ListView æ²¡æœ‰å®ç° ViewHolder æ‰€ä»¥è¦è‡ªå·±å®ç°ã€‚ä¸»è¦æ˜¯ä¸ºäº†è§†å›¾ç¼“å­˜ï¼Œå‡å°è§†å›¾åŠ è½½æ—¶çš„èµ„æºæ¶ˆè€—ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859adaptar/AdapterChatMsg.javapublic class AdapterChatMsg extends ArrayAdapter&lt;ChatMsg&gt; &#123; private LayoutInflater inflater; private List&lt;ChatMsg&gt; chatMsgs; public AdapterChatMsg(@NonNull Context context, @LayoutRes int resource, List&lt;ChatMsg&gt; chatMsgs) &#123; super(context, resource); this.inflater = LayoutInflater.from(context); this.chatMsgs = chatMsgs; &#125; @Override public int getCount() &#123; return chatMsgs.size(); &#125; @Nullable @Override public ChatMsg getItem(int position) &#123; return chatMsgs.get(position); &#125; @NonNull @Override public View getView(int position, @Nullable View convertView, @NonNull ViewGroup parent) &#123; ChatMsg msg = getItem(position); View view; ViewHolder viewHolder; if (convertView == null) &#123; assert msg != null; if (msg.isMyInfo()) &#123; view = inflater.inflate(R.layout.chat_me, parent, false); &#125; else &#123; view = inflater.inflate(R.layout.chat_other, parent, false); &#125; viewHolder = new ViewHolder(); viewHolder.icon = (ImageView) view.findViewById(R.id.icon); viewHolder.username = (TextView) view.findViewById(R.id.username); viewHolder.content = (TextView) view.findViewById(R.id.content); view.setTag(viewHolder); &#125; else &#123; view = convertView; viewHolder = (ViewHolder) view.getTag(); &#125; viewHolder.icon.setImageResource(chatMsgs.get(position).getIconID()); viewHolder.username.setText(chatMsgs.get(position).getUsername()); viewHolder.content.setText(chatMsgs.get(position).getContent()); return view; &#125; private class ViewHolder &#123; ImageView icon; TextView username; TextView content; &#125;&#125; å…¶ä¸­é€šè¿‡ 12345if (msg.isMyInfo()) &#123; view = inflater.inflate(R.layout.chat_me, parent, false);&#125; else &#123; view = inflater.inflate(R.layout.chat_other, parent, false);&#125; æ¥åŠ è½½èŠå¤©å·¦å³è§†å›¾ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667AtyChatRoom.javapublic class AtyChatRoom extends AppCompatActivity&#123; private TitleBar titleBar; private ListView listView; private EditText myMsg; private Button btnSend; private List&lt;ChatMsg&gt; chatMsgList; private AdapterChatMsg adapterChatMsgList; private String chatObj; @Override protected void onCreate(@Nullable Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); getSupportActionBar().hide();// getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN); setContentView(R.layout.aty_chat_room); getWindow().setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE | WindowManager.LayoutParams.SOFT_INPUT_STATE_HIDDEN);// AndroidBug5497Workaround.assistActivity(this); initViews(); &#125; private void initViews() &#123; titleBar = (TitleBar) findViewById(R.id.tb_chat_room); listView = (ListView) findViewById(R.id.lv_chat_room); myMsg = (EditText) findViewById(R.id.myMsg); btnSend = (Button) findViewById(R.id.btnSend); chatMsgList = new ArrayList&lt;&gt;(); chatObj = getIntent().getStringExtra(\"username\"); titleBar.setTitleText(chatObj); adapterChatMsgList = new AdapterChatMsg(AtyChatRoom.this, R.layout.chat_other, chatMsgList); listView.setAdapter(adapterChatMsgList); btnSend.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; String content = myMsg.getText().toString(); if (!content.isEmpty()) &#123; ChatMsg msg = new ChatMsg(); msg.setContent(content); msg.setUsername(\"hello\"); msg.setIconID(R.drawable.avasterwe); msg.setMyInfo(true); msg.setChatObj(chatObj); chatMsgList.add(msg); myMsg.setText(\"\"); &#125; &#125; &#125;); titleBar.setTitleBarClickListetner(new TitleBar.titleBarClickListener() &#123; @Override public void leftButtonClick() &#123; finish(); &#125; @Override public void rightButtonClick() &#123; &#125; &#125;); &#125;&#125; è¿™æ¬¡æˆ‘æŠŠæ•´ä¸ªAtyéƒ½è´´å‡ºæ¥äº†ï¼Œä¸»è¦æ˜¯ä¸ºäº†è¯´æ˜ä¸€ä¸ªBugã€‚ç‚¹å‡»è¾“å…¥æ¡†è½¯é”®ç›˜å¼¹å‡ºæ—¶ TitleBar ä¼šè¢«é¡¶ä¸Šå»ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨onCreateå‡½æ•°ä¸­ï¼ŒåŠ  SOFT_INPUT_ADJUST_RESIZE ï¼Œä½†æ˜¯åœ¨å…¨å±ä¸‹åŒæ—¶è®¾ç½® SOFT_INPUT_ADJUST_RESIZE è¿™ä¸ªå±æ€§ï¼ŒTitleBar åˆä¼šè¢«é¡¶ä¸Šå»ã€‚æ‰€ä»¥ï¼Œåœ¨ Stack Overflow æœ‰å¤§ç¥ç»™å‡ºäº†è§£å†³æ–¹æ¡ˆã€‚å°±æ˜¯ util å¤šå‡ºçš„é‚£ä¸ª AndroidBug5497Workaround.java æ–‡ä»¶ã€‚è®²é“ç†åœ¨ setContentView() ä¹‹åæ·»åŠ ä¸€å¥ AndroidBug5497Workaround.assistActivity(this); å°±å¯ä»¥è§£å†³ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ä½†æ˜¯ã€‚ã€‚ã€‚å¯èƒ½æ˜¯æˆ‘çš„æ‰‹æœºå¤ªæ¸£ï¼Œè¿˜æ˜¯æ²¡èƒ½å®ç°æ•ˆæœã€‚æ®è¯´è¿™ä¸ªæ˜¯é€‚åˆå¸‚é¢ä¸Šå¤§éƒ¨åˆ†æ‰‹æœºçš„ã€‚ã€‚ã€‚å¸Œæœ›åœ¨ä½ çš„æ‰‹æœºä¸Šèƒ½è¡Œï¼Œæ‰€ä»¥æˆ‘å°±ä¿ç•™äº†è¿™äº›æ–‡ä»¶ã€‚ä¸ºäº†å–èˆï¼Œæˆ‘åªèƒ½ä¸å®ç°å…¨å±äº†ã€‚ã€‚ã€‚æ—¥åæ‰¾åˆ°å¥½çš„è§£å†³æ–¹æ¡ˆä¼šåœ¨githubæ›´æ–°ã€‚ ç›®å‰å¥½åƒã€‚ã€‚å®Œäº†ã€‚ã€‚ã€‚ã€‚çœ‹ç€å°‘ï¼Œå…¶å®é‡Œé¢çš„æœ‰äº›ä¸œè¥¿æ˜¯å€¼å¾—æ·±ç©¶çš„ã€‚è‡³äºå¦‚ä½•å®ç° Moments å’Œ Contacts æ»‘åŠ¨çš„ç•™ç»™å¤§å®¶è‡ªå·±æ¢ç´¢äº†ã€‚ æ„Ÿè°¢å¤§å®¶çš„è€å¿ƒé˜…è¯»å’Œæ”¯æŒï¼Œå†ä¸‹æ¬¡å¼€å§‹ä¹‹å‰ï¼Œå¸Œæœ›ä½ å·²ç»æ­å»ºå¥½äº†æœ¬åœ°æœåŠ¡å™¨ã€‚","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"},{"name":"ZZChat","slug":"ZZChat","permalink":"http://fitzeng.org/tags/ZZChat/"}]},{"title":"å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-2","date":"2017-04-14T04:00:00.000Z","path":"2017/04/14/ZZChatApp2/","text":"GitHub å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-2å‡†å¤‡åšå¥½ã€ZZChatApp1ã€‘ä¸­çš„å†…å®¹å¹¶ä¸”ä¸‹è½½äº†å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-1ä¸­çš„èµ„æ–™å°±å¯ä»¥å¼€å§‹ä¸‹é¢çš„äº† å®ç°ç›®æ ‡å‰é¢åªæ˜¯å®ç°ä¸€ä¸ªåŸºæœ¬çš„æ¡†æ¶ï¼Œè¿™æ¬¡æˆ‘ä»¬è¦å¾€ä¸»ç•Œé¢é‡Œé¢æ·»åŠ å†…å®¹ï¼Œä»£ç è¾ƒå¤šï¼Œæœ€å¥½è‡ªå·±çœ‹è¿™ç¯‡æ–‡ç« æ—¶ä¹Ÿå‚è€ƒæˆ‘æä¾›çš„ç¬¬äºŒé˜¶æ®µæºç ã€‚ä¸»è¦ç»ƒä¹ çš„æ˜¯è‡ªå®šä¹‰æ§ä»¶ å®ç°è¿‡ç¨‹ è¿™æ¬¡çš„æ–‡ä»¶æ¯”ä¸Šæ¬¡å¤šäº†ï¼Œæ‰€ä»¥æ–‡ä»¶ç®¡ç†å’Œæ§ä»¶IDçš„å‘½åä¸èƒ½å¤ªéšæ„ï¼Œè¿™æ˜¯è¦æ³¨æ„çš„ä¸€ç‚¹ã€‚ä»£ç éš¾åº¦ä¸é«˜ï¼Œåªè¦å‘½åå¥½äº†ï¼Œä¸å†™æ³¨é‡Šå…¶å®ä¹Ÿèƒ½çœ‹æ‡‚çš„ã€‚ TitleBaråœ¨å¼€å§‹å†™ä¸‰ä¸ªé¡µé¢å’Œä¸€ä¸ªä¾§æ»‘è§†å›¾ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåšä¸ªè‡ªå®šä¹‰æ§ä»¶ã€‚å…¶å®è¿™æ­¤å®éªŒæ€»å…±ç”¨åˆ°äº†ä¸¤ä¸ªï¼Œæˆ‘åœ¨è¿™åªå™è¿°å¤æ‚çš„é‚£ä¸ªï¼Œå‰©ä¸‹çš„å¯ä»¥å‚è€ƒæºç è‡ªå·±å®ç°ã€‚åœ¨å­¦ä¹ ä¹‹å‰æ¨èè§‚çœ‹æ…•è¯¾ï¼Œæ—¶é—´ä¸æ˜¯å¾ˆé•¿ï¼Œä½†æ˜¯å¯¹ç†æ¸…æ€è·¯è§†é¢‘è®²è§£æ›´ç›´æ¥ã€‚ è®¾è®¡å±æ€§ å…¶å®å°±æ˜¯ä¸¤ä¸ªbuttonåŠ ä¸€ä¸ªtextViewã€‚å±æ€§è®¾è®¡å¦‚ä¸‹ 123456789101112131415161718values/atts.xml&lt;declare-styleable name=\"TitleBar\"&gt; &lt;attr name=\"titleText\" format=\"string\" /&gt; &lt;attr name=\"titleTextSize\" format=\"dimension\" /&gt; &lt;attr name=\"titleTextColor\" format=\"color\" /&gt; &lt;attr name=\"titleBackground\" format=\"reference|color\" /&gt; &lt;attr name=\"leftText\" format=\"string\" /&gt; &lt;attr name=\"leftTextSize\" format=\"dimension\" /&gt; &lt;attr name=\"leftTextColor\" format=\"color\" /&gt; &lt;attr name=\"leftBackground\" format=\"reference|color\" /&gt; &lt;attr name=\"rightText\" format=\"string\" /&gt; &lt;attr name=\"rightTextSize\" format=\"dimension\" /&gt; &lt;attr name=\"rightTextColor\" format=\"color\" /&gt; &lt;attr name=\"rightBackground\" format=\"reference|color\" /&gt;&lt;/declare-styleable&gt; ç»‘å®šå±æ€§ å¯ä»¥æ ¹æ®å‰é¢è®¾è®¡çš„å±æ€§æ¥åˆ¤æ–­éœ€è¦å“ªäº›å˜é‡ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091private Button btnLeft;private Button btnRight;private TextView tvTitle;private String leftText;private float leftTextSize;private int leftTextColor;private Drawable leftBackground;private String rightText;private float rightTextSize;private int rightTextColor;private Drawable rightBackground;private String titleText;private float titleTextSize;private int titleTextColor;private Drawable titleBackground;/** * @param attrs this is titlebar's attribute set for binding with widgets */private void findAttrs(AttributeSet attrs) &#123; TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.TitleBar); leftText = typedArray.getString(R.styleable.TitleBar_leftText); leftTextSize = typedArray.getDimension(R.styleable.TitleBar_leftTextSize, 24); leftTextColor = typedArray.getColor(R.styleable.TitleBar_leftTextColor, 0); leftBackground = typedArray.getDrawable(R.styleable.TitleBar_leftBackground); titleText = typedArray.getString(R.styleable.TitleBar_titleText); titleTextSize = typedArray.getDimension(R.styleable.TitleBar_titleTextSize, 24); titleTextColor = typedArray.getColor(R.styleable.TitleBar_titleTextColor, 0); titleBackground = typedArray.getDrawable(R.styleable.TitleBar_titleBackground); rightText = typedArray.getString(R.styleable.TitleBar_rightText); rightTextSize = typedArray.getDimension(R.styleable.TitleBar_rightTextSize, 24); rightTextColor = typedArray.getColor(R.styleable.TitleBar_rightTextColor, 0); rightBackground = typedArray.getDrawable(R.styleable.TitleBar_rightBackground); typedArray.recycle();&#125;/** * Init titlebar's widgets */private void initViews() &#123; btnLeft = new Button(context); btnRight = new Button(context); tvTitle = new TextView(context); btnLeft.setText(leftText); btnLeft.setTextSize(leftTextSize); btnLeft.setTextColor(leftTextColor); btnLeft.setBackground(leftBackground); btnRight.setText(rightText); btnRight.setTextSize(rightTextSize); btnRight.setTextColor(rightTextColor); btnRight.setBackground(rightBackground); tvTitle.setText(titleText); tvTitle.setTextSize(titleTextSize); tvTitle.setTextColor(titleTextColor); tvTitle.setBackground(titleBackground); tvTitle.setGravity(Gravity.CENTER); setBackgroundColor(0xFF01AAFF);&#125;/** * Setting titlebar's layout */private void setTitleBarLayoutParams() &#123; btnLeft.setAllCaps(false); btnRight.setAllCaps(false); LayoutParams btnLeftLayoutParams = new LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT); btnLeftLayoutParams.addRule(RelativeLayout.ALIGN_PARENT_LEFT, TRUE); addView(btnLeft, btnLeftLayoutParams); LayoutParams btnRightLayoutParams = new LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT); btnRightLayoutParams.addRule(RelativeLayout.ALIGN_PARENT_RIGHT, TRUE); addView(btnRight, btnRightLayoutParams); LayoutParams titleLayoutParams = new LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.MATCH_PARENT); titleLayoutParams.addRule(RelativeLayout.CENTER_IN_PARENT, TRUE); addView(tvTitle, titleLayoutParams);&#125; å…¶å®ä»ä½¿ç”¨è§’åº¦æ¥è¯´ï¼Œå¯ä»¥ç†å‡ºä¸€æ¡æˆ‘ä»¬ä¸ºä»€ä¹ˆè¿™ä¹ˆåšçš„çº¿ã€‚å› ä¸ºåœ¨ XML ä¸­æˆ‘ä»¬ä½¿ç”¨ä¸€èˆ¬éƒ½æ˜¯ android : layout_width = â€œmatch_parentâ€å¾ˆæ˜æ˜¾ layout_width å¯ä»¥çœ‹åšä¸€ä¸ª Key ï¼Œè€Œ match_parent æ˜¯ä¸€ä¸ª Value.æ‰€ä»¥ findAttrs(AttributeSet attrs) å°±æ˜¯æŠŠä¹‹å‰è®¾è®¡å±æ€§æ˜¯æ‰€èƒ½è¯†åˆ«çš„ Key çš„å€¼å–å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯ â€œXXXâ€ ä¸­çš„ XXX æ•°æ®ï¼Œä½†æ˜¯ä»…ä»…å–å‡ºæ•°æ®å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œæœ€ç»ˆè¿˜æ˜¯è¦æŠŠæ•°æ®èµ‹å€¼åˆ°æ§ä»¶ä¸Šå»ï¼Œæ•°æ®æ‰èƒ½æ˜¾ç¤ºæˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚æ‰€ä»¥ initViews() ä¾¿æ˜¯åšè¿™ä»¶äº‹çš„ã€‚æ¥ä¸‹æ¥çš„ setTitleBarLayoutParams() åªæ˜¯å¯¹é‡Œé¢æ§ä»¶çš„å±æ€§çš„ä¸€ä¸ªçº¦æŸã€‚ å¯¹äº Key-Value çš„ç†è§£ï¼Œå…¶å®å¯ä»¥è¿™æ ·çœ‹ï¼Œå¦‚æœå£°æ˜äº†ä¸€ä¸ª app:no_name=â€12â€ åœ¨ xml ä¸­ï¼Œè€Œå®é™…ä½ å¹¶æ²¡æœ‰å£°æ˜è¿™ä¸ªå±æ€§åœ¨ atts.xml ä¸­ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨çŸ¥é“çš„æ˜¯æ‰¾ä¸åˆ° Key ï¼Œè€Œä¸æ˜¯åˆ¤å®š Value çš„å¯¹é”™ã€‚æ‰€ä»¥å¯¹äºå±æ€§æ–‡ä»¶ atts.xml å°±è‡ªç„¶è€Œç„¶æœ‰äº†å­˜åœ¨çš„æ„ä¹‰ã€‚æˆ‘ç†è§£ä¸ºå°±æ˜¯è§„èŒƒä½œç”¨ï¼Œè€Œä¹‹åçš„å€¼ä¼ é€’ç»™ TextView æˆ–è€…å…¶ä»–å·²æœ‰æ§ä»¶ï¼Œå°±æ˜¯ä¹‹åçš„ç»‘å®šå±æ€§å€¼çš„æ“ä½œå°±é¡ºç†æˆç« äº†ã€‚ æ–‡ç¬”ä¸å¥½ï¼Œä¸çŸ¥é“è®²æ¸…äº†æ²¡ã€‚ã€‚ã€‚å¤§å®¶è¿˜æ˜¯å¥½å¥½çœ‹çœ‹å‰é¢æ¨èçš„è§†é¢‘å’Œè‡ªå·±å†™ä¸€ä¸ªå°æ§ä»¶å®ç°ä¸€ä¸‹åŠ æ·±ç†è§£ã€‚ ç›®å‰è¿™ä¸ªæ§ä»¶åªæ˜¯é™æ€çš„ï¼Œä¸èƒ½å“åº”ç‚¹å‡»äº‹ä»¶ã€‚å¯ä»¥å‚è€ƒä¹‹å‰çš„ Button æ€ä¹ˆå®ç°çš„ã€‚ä¸€èˆ¬ Button.setOnClickListener()æ‰€ä»¥å¯ä»¥åœ¨æ§ä»¶ä¸­åŠ ä¸€ä¸ª setTitleBarClickListetner() æ–¹æ³•ã€‚æ¥ä¸‹æ¥å°±æ˜¯æœ‰ç‚¹éš¾åº¦çš„äº†ã€‚Button è‡ªå·±çš„ç‚¹å‡»äº‹ä»¶å“åº”å…¶å®æ˜¯ç”±è‡ªå·±åœ¨ onClick() æ–¹æ³•ä¸­å®ç°è‡ªå·±çš„é€»è¾‘çš„ã€‚ æ‰€ä»¥æ­¤æ—¶è‡ªå®šä¹‰æ§ä»¶å°±è¦å¯¹å¤–æä¾›ä¸€ä¸ªæ¥å£ï¼Œè®©å®ç°è€…è‡ªå·±å®šä¹‰è‡ªå·±çš„ç‚¹å‡»äº‹ä»¶ã€‚è®²åˆ°è¿™ä¼°è®¡å·®ä¸å¤šäº†ï¼Œçœ‹çœ‹ä»£ç å°±ç†è§£äº†ã€‚ 12345678910111213141516171819202122232425262728293031323334view/TitleBar.javaprivate titleBarClickListener listener;/** * implement click events */public interface titleBarClickListener &#123; // è¿™ä¸¤ä¸ªæ–¹æ³•ç›¸å½“äº Button çš„ onCLick() void leftButtonClick(); void rightButtonClick();&#125;// ç±»ä¼¼äº Button çš„setOnClickListener();public void setTitleBarClickListetner(titleBarClickListener listetner) &#123; this.listener = listetner;&#125;// å†…éƒ¨è®¾ç½®æŒ‰é’®ç‚¹å‡»ç›‘å¬private void setButtonClickListener() &#123; btnLeft.setOnClickListener(new OnClickListener() &#123; @Override public void onClick(View v) &#123; listener.leftButtonClick(); &#125; &#125;); btnRight.setOnClickListener(new OnClickListener() &#123; @Override public void onClick(View v) &#123; listener.rightButtonClick(); &#125; &#125;);&#125; ä¸‹é¢å‰©ä¸‹çš„ä¸€ä¸ª PicAndTextBtn å¤§å®¶å¯ä»¥è‡ªå·±å®ç°ï¼Œå°±æ˜¯ä½œä¸ºå·¦ä¾§æ»‘åŠ¨è§†å›¾ä¸­çš„å°æ§ä»¶ï¼Œä¸€ä¸ª ImageView å’Œ TextViewç»„æˆçš„ã€‚ ä¾§æ»‘ç•Œé¢å¦‚æœå‰é¢éƒ½å†™å¥½äº†ä¸‹é¢å°±ä½¿ç”¨ä¸Šé¢çš„æ§ä»¶æ¥å†™æ»‘åŠ¨ç•Œé¢ï¼Œå¸ƒå±€å¾ˆç®€å•ã€‚ 12345678910111213141516171819202122232425262728&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt; &lt;RelativeLayout&gt; &lt;LinearLayout&gt; &lt;LinearLayout&gt; &lt;ImageView/&gt; Avatar &lt;TextView/&gt; Username &lt;/LinearLayout&gt; &lt;TextView/&gt; Sign &lt;/LinearLayout&gt; &lt;/RelativeLayout&gt; &lt;LinearLayout&gt; &lt;org.fitzeng.zzchat.view.PicAndTextBtn&gt;Dress Up&lt;/org.fitzeng.zzchat.view.PicAndTextBtn&gt; &lt;org.fitzeng.zzchat.view.PicAndTextBtn&gt;Profile&lt;/org.fitzeng.zzchat.view.PicAndTextBtn&gt; &lt;/LinearLayout&gt; &lt;LinearLayout&gt; &lt;org.fitzeng.zzchat.view.PicAndTextBtn&gt;setting&lt;/org.fitzeng.zzchat.view.PicAndTextBtn&gt; &lt;org.fitzeng.zzchat.view.PicAndTextBtn&gt;night&lt;/org.fitzeng.zzchat.view.PicAndTextBtn&gt; &lt;/LinearLayout&gt;&lt;/LinearLayout&gt; æ¥ä¸‹æ¥å°±æ˜¯å®ç°å…¶é€»è¾‘äº†ï¼Œè¿™æ¬¡ä¸»è¦å®ç°ä»¥ä¸‹settingï¼Œdressupå’Œprofileä¸‹æ¬¡å®éªŒå®ç°ã€‚å®ç°æ§ä»¶çš„ç‚¹å‡»ï¼Œè™½ç„¶è¿™ä¸ªç‚¹å‡»äº‹ä»¶æ˜¯ä½ ä»¬è‡ªå·±å†™çš„ï¼Œä¸ºäº†åé¢çš„å®éªŒä¸€è‡´ï¼Œæ¨èå‘½åæœ€å¥½å’Œæˆ‘ä¸€è‡´ã€‚ã€‚ã€‚è™½ç„¶æˆ‘çš„å‘½åä¹Ÿå¾ˆçƒ‚ã€‚ã€‚ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647view/LayoutSlide.javaprivate void initViews() &#123; this.addView(LayoutInflater.from(context).inflate(R.layout.layout_slide, null)); dressUp = (PicAndTextBtn) findViewById(R.id.patb_dressup); profile = (PicAndTextBtn) findViewById(R.id.patb_profile); setting = (PicAndTextBtn) findViewById(R.id.patb_setting); night = (PicAndTextBtn) findViewById(R.id.patb_night); dressUp.setOnClickListener(new PicAndTextBtn.picAndTextBtnClickListener() &#123; @Override public void onClick(View view) &#123; Intent intent = new Intent(context, AtyDressUp.class); context.startActivity(intent); &#125; &#125;); profile.setOnClickListener(new PicAndTextBtn.picAndTextBtnClickListener() &#123; @Override public void onClick(View view) &#123; Intent intent = new Intent(context, AtyProfile.class); context.startActivity(intent); &#125; &#125;); setting.setOnClickListener(new PicAndTextBtn.picAndTextBtnClickListener() &#123; @Override public void onClick(View view) &#123; Intent intent = new Intent(context, AtySetting.class); context.startActivity(intent); &#125; &#125;); night.setOnClickListener(new PicAndTextBtn.picAndTextBtnClickListener() &#123; @Override public void onClick(View view) &#123; if (nightMode) &#123; findViewById(R.id.layout_slide).setBackgroundColor(0xff878787); nightMode = false; &#125; else &#123; findViewById(R.id.layout_slide).setBackgroundColor(0xffe9e9e9); nightMode = true; &#125; &#125; &#125;);&#125; setting ç•Œé¢çš„å¸ƒå±€å°±ä¸è´´ä»£ç äº†ï¼Œå¾ˆç®€å•ã€‚åªåˆ†æ java ä»£ç ï¼Œå…¶å®ç›®å‰ä¹Ÿå¾ˆæ°´ï¼Œä¹Ÿå°±å®ç°äº†ä¸€ä¸ª Guide View æ˜¯å¦æ’­æ”¾çš„åŠŸèƒ½ã€‚ä½†æ˜¯åœ¨ä¹‹å‰çš„ Welcome é¡µé¢ä¸­è¿˜è¦åšä¸€ç‚¹å°å°çš„ä¿®æ”¹ã€‚å¤§å®¶å¯ä»¥è¯•éªŒä¸è¯¥ä¼šæ€ä¹ˆæ ·ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768AtySetting.javaprivate void initViews() &#123; titleBar = (TitleBar) findViewById(R.id.tb_setting); guide = (ImageView) findViewById(R.id.iv_setting_guide); password = (ImageView) findViewById(R.id.iv_setting_password); offline = (ImageView) findViewById(R.id.iv_setting_offline); guideMode = getSharedPreferences(\"zzchat\", MODE_PRIVATE).getBoolean(\"guide\", true); guide.setImageResource(guideMode ? R.drawable.btnselected : R.drawable.btnunselected); password.setImageResource(passwordMode ? R.drawable.btnselected : R.drawable.btnunselected); offline.setImageResource(offlineMode ? R.drawable.btnselected : R.drawable.btnunselected); guide.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; if (guideMode) &#123; guide.setImageResource(R.drawable.btnunselected); guideMode = false; &#125; else &#123; guide.setImageResource(R.drawable.btnselected); guideMode = true; &#125; &#125; &#125;); password.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; if (passwordMode) &#123; password.setImageResource(R.drawable.btnunselected); passwordMode = false; &#125; else &#123; password.setImageResource(R.drawable.btnselected); passwordMode = true; &#125; &#125; &#125;); offline.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; if (offlineMode) &#123; offline.setImageResource(R.drawable.btnunselected); offlineMode = false; &#125; else &#123; offline.setImageResource(R.drawable.btnselected); offlineMode = true; &#125; &#125; &#125;); titleBar.setTitleBarClickListetner(new TitleBar.titleBarClickListener() &#123; @Override public void leftButtonClick() &#123; SharedPreferences sharedPreferences = getSharedPreferences(\"zzchat\", MODE_PRIVATE); SharedPreferences.Editor editor = sharedPreferences.edit(); editor.putBoolean(\"guide\", guideMode); editor.apply(); finish(); &#125; @Override public void rightButtonClick() &#123; &#125; &#125;);&#125; night åŠŸèƒ½ä¹ŸåŸºæœ¬æ²¡æœ‰å®ç°ï¼Œç•™ç»™å¤§å®¶å®Œå–„äº†ã€‚ã€‚ã€‚ chatsä¸‹é¢å¼€å§‹ Chat é¡µé¢çš„è®¾è®¡ã€‚åŒç†åé¢çš„ Contact å’Œ Moment ä¹Ÿæ˜¯å’Œè¿™ä¸ªç±»ä¼¼ï¼Œå¤§å®¶å‚è€ƒæºç å¯ä»¥æŠŠä»£ç å†™äº†ï¼Œå½“åšç»ƒä¹ ã€‚æœ‰äº›å‘è‡ªå·±ä¸è¸©ä¸çŸ¥é“å¤šæ·±ã€‚ æŠŠ titleBar å¼•è¿›æ¥æ˜¯å¾ˆç®€å•çš„ã€‚ç›´æ¥åœ¨ä¸»ç•Œé¢ä¸­åŠ å°±æ˜¯äº†ã€‚ å®ç° Chats è¿™ä¸ªåˆ—è¡¨åŠŸèƒ½æˆ‘ä»¬ä½¿ç”¨æ›´åŠ æ˜“ç”¨çš„ RecyclerView ä¸‹æ¬¡å®éªŒå®ç°çš„èŠå¤©ç•Œé¢æˆ‘ä»¬å¯ä»¥è¯•è¯• ListViewã€‚å¥½äº†ï¼Œéƒ½å†³å®šå¥½äº†å°±å¼€å§‹å†™ä»£ç å§ã€‚ å’Œå‰é¢ä¸€æ ·ï¼Œä¸€ä¸ª RecyclerView æ€ä¹ˆåŠ è½½æ•°æ®ï¼Ÿç­”æ¡ˆå°±æ˜¯é€šè¿‡ Adapter ï¼Œé—®é¢˜åˆæ¥äº†ï¼Œé‚£ä¹ˆåŠ è½½çš„æ€æ ·çš„æ•°æ®å‘¢ï¼Ÿæ‰€ä»¥ç°åœ¨ç›®çš„å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯è®¾è®¡æ•°æ® Item å¸ƒå±€æ˜¯ä¸€ä¸ªå¤´åƒï¼Œä¸€ä¸ªUsername, ä¸€ä¸ªç­¾å 123456789item_user.xml&lt;LinearLayout&gt; &lt;ImageView android:id=\"@+id/iv_item_avatar\" /&gt; &lt;LinearLayout&gt; &lt;TextView android:id=\"@+id/tv_item_username\" /&gt; &lt;TextView android:id=\"@+id/tv_item_sign\" /&gt; &lt;/LinearLayout&gt;&lt;/LinearLayout&gt; æœ‰äº†å¸ƒå±€ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è‡ªå·±æ„é€ é€‚é…å™¨åŠ è½½å¸ƒå±€ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950adapter/AdapterUserItem.javapublic class AdapterUserItem extends RecyclerView.Adapter&lt;AdapterUserItem.BaseViewHolder&gt; &#123; private Context context; private List&lt;UserItemMsg&gt; userItemMsgList; public AdapterUserItem(Context context, List&lt;UserItemMsg&gt; userItemMsgList) &#123; this.context = context; this.userItemMsgList = userItemMsgList; &#125; @Override public BaseViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123; return new BaseViewHolder(LayoutInflater.from(context).inflate(R.layout.item_user, parent, false)); &#125; @Override public void onBindViewHolder(BaseViewHolder holder, int position) &#123; holder.ivAvatar.setImageResource(userItemMsgList.get(position).getIconID()); holder.tvUsername.setText(userItemMsgList.get(position).getUsername()); holder.tvSign.setText(userItemMsgList.get(position).getSign()); &#125; @Override public int getItemCount() &#123; return (userItemMsgList == null ? 0 : userItemMsgList.size()); &#125; class BaseViewHolder extends RecyclerView.ViewHolder&#123; private ImageView ivAvatar; private TextView tvUsername; private TextView tvSign; BaseViewHolder(View itemView) &#123; super(itemView); ivAvatar = (ImageView) itemView.findViewById(R.id.iv_item_avatar); tvUsername = (TextView) itemView.findViewById(R.id.tv_item_username); tvSign = (TextView) itemView.findViewById(R.id.tv_item_sign); itemView.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; Toast.makeText(context, tvUsername.getText().toString(), Toast.LENGTH_SHORT).show(); &#125; &#125;); &#125; &#125;&#125; æˆ‘æŠŠä»£ç å…¨è´´ä¸Šæ¥äº†ï¼Œå…¶å®è¿™ç®—æ˜¯ä¸€ä¸ªç»å¸¸ç”¨çš„æ¨¡æ¿äº†å§ã€‚RecyclerView å†…éƒ¨è‡ªå·±å®ç°äº† ViewHolder ç±»ï¼Œæ‰€ä»¥è¯´ä½¿ç”¨æ–¹ä¾¿ã€‚ ä¸‹é¢å°±æ˜¯æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„ recyclerView ä»£ç å®ç°ï¼Œå¯ä»¥æ³¨æ„æ³¨æ„ setLayoutManager() å‡½æ•°ã€‚ 1234567891011private void initViews() &#123; context = getContext(); recyclerView = (RecyclerView) rootView.findViewById(R.id.chatsRecycleView); loadData(); adapterUserItem = new AdapterUserItem(context, userItemMsgList); recyclerView.setLayoutManager(new LinearLayoutManager(context)); recyclerView.setAdapter(adapterUserItem);&#125; æ€•ç¯‡å¹…è¿‡å¤šï¼Œç»†çš„çŸ¥è¯†ç‚¹ä¸ä¼šå¤ªé™ˆè¿°ï¼Œä¸»è¦æ˜¯å¯¹æ•´ä¸ªä¸€ä¸ª App å®ç°è¿‡ç¨‹ä¸­æ€è€ƒçš„ä¸€ä¸ªä»‹ç»ï¼Œä¸ä¼šè§‰å¾—è‡ªå·±æ— ä»ä¸‹æ‰‹ã€‚ ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚å¥½åƒç¯‡å¹…æœ‰ç‚¹é•¿äº†ï¼Œè¿˜æ²¡æœ‰æ¶‰åŠæœåŠ¡ç«¯å°±è¿™ä¹ˆå¤šäº†ã€‚ã€‚ã€‚å‰©ä¸‹çš„æ•ˆæœå¤§å®¶å¯ä»¥æŒ‰åŠ¨å›¾æ˜¾ç¤ºçš„è‡ªå·±å®ç°ï¼Œæ–¹æ³•å…¶å®å…¨æ¦‚æ‹¬äº†ã€‚ æœ€åè¯´ä¸‹ TabHost çš„ä¸€ç‚¹ä¸œè¥¿ 1234567891011121314151617181920tabLayout.addOnTabSelectedListener(new TabLayout.OnTabSelectedListener() &#123; @Override public void onTabSelected(TabLayout.Tab tab) &#123; tabList.get(tab.getPosition()).setIcon(ImageManager.imageID[tab.getPosition() + 3]); tabLayout.setTabTextColors( ContextCompat.getColor(AtyMain.this, R.color.colorBlack), ContextCompat.getColor(AtyMain.this, R.color.colorBlue) ); &#125; @Override public void onTabUnselected(TabLayout.Tab tab) &#123; tabList.get(tab.getPosition()).setIcon(ImageManager.imageID[tab.getPosition()]); &#125; @Override public void onTabReselected(TabLayout.Tab tab) &#123; &#125;&#125;); ä¸ºä»€ä¹ˆè¦æŠŠä¸‹é¢çš„ä»£ç æ”¾åœ¨ç›‘å¬ä¸­æ‰§è¡Œï¼Œè€Œä¸æ˜¯åœ¨å¤–é¢ã€‚å¤§å®¶å¯ä»¥åšåšå®éªŒï¼Œç‚¹å‡»Tabå’Œæ»‘åŠ¨ViewPagerå°±èƒ½å‘ç°å¼‚åŒã€‚ 1234tabLayout.setTabTextColors( ContextCompat.getColor(AtyMain.this, R.color.colorBlack), ContextCompat.getColor(AtyMain.this, R.color.colorBlue)); è¿˜æœ‰å‰é¢é—ç•™çš„ç™»å½•ç•Œé¢ Tab ä¸Šé¢çš„å­—æ¯æ˜¯å¤§å†™ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿå¤§å®¶å¯ä»¥è‡ªå·±æŸ¥èµ„æ–™ï¼Œå†çœ‹çœ‹æˆ‘æä¾›çš„æºç ã€‚è¿™æ¬¡å°±è¿™æ ·ï¼Œä¸‹æ¬¡å®ç°å‰©ä¸‹çš„ DressUpï¼ŒProfile å’ŒèŠå¤©ç•Œé¢ã€‚å†ä¸‹æ¬¡å°±æ˜¯ç½‘ç»œç¼–ç¨‹å•¦ï¼","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"},{"name":"ZZChat","slug":"ZZChat","permalink":"http://fitzeng.org/tags/ZZChat/"}]},{"title":"å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-1","date":"2017-04-14T03:00:00.000Z","path":"2017/04/14/ZZChatApp1/","text":"GitHub å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-1å‡†å¤‡ AndroidStudio æ¨¡æ‹Ÿå™¨ èµ„æ–™ å¯†ç : jme4å¤§å®¶å°†å›¾ç‰‡å¤åˆ¶åˆ°drawableä¾›æ¥ä¸‹æ¥çš„ä½¿ç”¨ï¼Œéƒ¨åˆ†å›¾ç‰‡æºäºç½‘ç»œï¼Œä¸åšå•†ä¸šç”¨é€”åº”è¯¥ä¸ç®—ä¾µæƒå§ã€‚å¦‚æœæœ‰ï¼Œæˆ‘ä¼šåˆ é™¤èµ„æºçš„ã€‚ å®ç°ç›®æ ‡æŒ‰ç…§æœ€å…ˆå¼€å§‹çš„è®¡åˆ’ï¼Œæˆ‘ä»¬åªå®ç°ä¸€ä¸ªé™æ€çš„ZZChatç•Œé¢ï¼Œè€ƒéªŒçš„å°±æ˜¯Androidæ§ä»¶çš„åŸºæœ¬çŸ¥è¯†ã€‚å¦‚æœç¢°åˆ°æ²¡è§åˆ°è¿‡çš„æ§ä»¶å¯ä»¥å»Googleçœ‹å¼€å‘æ–‡æ¡£ã€‚ å®ç°è¿‡ç¨‹ åœ¨çœ‹åˆ°å®ç°çš„è®¾è®¡ä¸‹ï¼Œæˆ‘ä»¬æœ€å…ˆæƒ³åˆ°çš„æ˜¯æœ‰å››çš„Activityï¼ˆæ¬¢è¿ç•Œé¢ï¼Œå¼•å¯¼é¡µï¼Œç™»å½•æ³¨å†Œï¼Œä¸»ç•Œé¢ï¼‰ï¼ŒåŒæ—¶å¯¹åº”å››ä¸ªå¸ƒå±€ ä¿®æ”¹Manifest12345678910111213141516171819AndroidManifest.xml&lt;application android:allowBackup=\"true\" android:icon=\"@drawable/icon\" android:label=\"@string/app_name\" android:supportsRtl=\"true\" android:theme=\"@style/AppTheme\"&gt; &lt;activity android:name=\".aty.AtyWelcome\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"android.intent.action.MAIN\" /&gt; &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;activity android:name=\".aty.AtyGuide\" /&gt; &lt;activity android:name=\".aty.AtyLoginOrRegister\" /&gt; &lt;activity android:name=\".aty.AtyMain\" /&gt;&lt;/application&gt; æ¬¢è¿ç•Œé¢ å…¨å± 1234onCreate()getSupportActionBar().hide();getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN); å¼•å¯¼ç•Œé¢åªåœ¨é¦–æ¬¡å¼€å¯æ—¶æ˜¾ç¤º 123456789101112131415161718192021222324252627282930313233AtyWelcome.javaprivate void initLoad() &#123; SharedPreferences sharedPreferences = getSharedPreferences(\"zzchat\", MODE_PRIVATE); boolean welcome = sharedPreferences.getBoolean(\"welcome\", true); if (!welcome) &#123; handler.sendEmptyMessageDelayed(GO_HOME, DELAY); &#125; else &#123; handler.sendEmptyMessageDelayed(GO_GUIDE, DELAY); SharedPreferences.Editor editor = sharedPreferences.edit(); editor.putBoolean(\"welcome\", false); editor.apply(); &#125;&#125;Handler handler = new Handler() &#123; @Override public void handleMessage(Message msg) &#123; switch (msg.what) &#123; case GO_GUIDE: &#123; goGuide(); break; &#125; case GO_HOME: &#123; goHome(); break; &#125; default: break; &#125; &#125;&#125;; å¼•å¯¼é¡µå¼•å¯¼é¡µæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªViewPagerå®ç°ï¼Œå¦‚æœä¹‹å‰ä¸ç†Ÿæ‚‰çš„å¯ä»¥çœ‹æˆ‘çš„å¦ä¸€ä¸ªåˆ©ç”¨ViewPageråšçš„è½®æ’­å›¾ã€‚ å¸ƒå±€ ç›¸ä¿¡çœ‹äº†å‰é¢åŠ¨å›¾çš„æ•ˆæœå¯¹å¸ƒå±€å®ç°åº”è¯¥æ˜¯æœ‰åº•äº† 123456789101112131415161718192021222324252627282930313233343536373839404142434445aty_guide.xml&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt; &lt;android.support.v4.view.ViewPager android:id=\"@+id/vp_guide\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt; &lt;/android.support.v4.view.ViewPager&gt; &lt;LinearLayout android:orientation=\"horizontal\" android:layout_centerHorizontal=\"true\" android:layout_alignParentBottom=\"true\" android:layout_marginBottom=\"20dp\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\"&gt; &lt;ImageView android:id=\"@+id/iv_indicator_dot1\" android:src=\"@drawable/selected\" android:layout_marginLeft=\"10dp\" android:layout_marginRight=\"10dp\" android:layout_width=\"10dp\" android:layout_height=\"10dp\" /&gt; &lt;ImageView android:id=\"@+id/iv_indicator_dot2\" android:src=\"@drawable/unselected\" android:layout_marginLeft=\"10dp\" android:layout_marginRight=\"10dp\" android:layout_width=\"10dp\" android:layout_height=\"10dp\" /&gt; &lt;ImageView android:id=\"@+id/iv_indicator_dot3\" android:src=\"@drawable/unselected\" android:layout_marginLeft=\"10dp\" android:layout_marginRight=\"10dp\" android:layout_width=\"10dp\" android:layout_height=\"10dp\" /&gt; &lt;/LinearLayout&gt;&lt;/RelativeLayout&gt; é€‚é…å¸ƒå±€ åˆ°è¿™äº†ï¼Œå¦‚ä½•å®ç°ViewPageråŠ è½½å¸ƒå±€å°±æ˜¯æˆ‘ä»¬ç°åœ¨åº”è¯¥æƒ³çš„äº‹äº†ã€‚ç›®å‰å¯ä»¥æœ€å…ˆæƒ³åˆ°å’Œåšåˆ°çš„æ˜¯å®ç°ä¸‰ä¸ªåŠ è½½çš„å¸ƒå±€ï¼Œä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬åªä½¿ç”¨ä¸€ä¸ªImageViewæ¥å®ç°ï¼ŒåŒç†å…¶ä»–ä¸‰ä¸ªé¡µé¢ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œç¬¬ä¸‰ä¸ªå¤šåŠ ä¸€ä¸ªEnterå…¥å£è¿›å…¥ä¸»é¡µã€‚ 1234567891011guide_page1.xml&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt; &lt;ImageView android:src=\"@drawable/shot2\" android:scaleType=\"centerCrop\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" /&gt;&lt;/RelativeLayout&gt; é€‚é…å™¨ ç°åœ¨çš„æƒ…å†µæ˜¯æœ‰äº†å¸ƒå±€å’Œèµ„æºé¡µé¢ï¼Œæ€ä¹ˆæŠŠèµ„æºé¡µé¢åŠ è½½è¿›å¸ƒå±€ï¼Œè¿™æ—¶å°±è¦ç”¨åˆ°Adapteräº†ï¼Œä¹Ÿå°±æ˜¯é€‚é…å™¨ã€‚æ–°å»ºä¸€ä¸ªadapterèµ„æºåŒ…æ–°å»ºä¸€ä¸ªAdapterGuideViewPagerç±»ç»§æ‰¿PagerAdapter 123456789101112131415161718192021222324252627282930313233adapter/AdapterGuideViewPager.javapublic class public class AdapterGuideViewPager extends PagerAdapter&#123; private Context context; private List&lt;View&gt; viewList; public AdapterGuideViewPager(Context context, List&lt;View&gt; viewList) &#123; this.context = context; this.viewList = viewList; &#125; @Override public int getCount() &#123; return viewList.size(); &#125; @Override public boolean isViewFromObject(View view, Object object) &#123; return (view == object); &#125; @Override public void destroyItem(ViewGroup container, int position, Object object) &#123; container.removeView(viewList.get(position)); &#125; @Override public Object instantiateItem(ViewGroup container, int position) &#123; container.addView(viewList.get(position)); return viewList.get(position); &#125;&#125; ä¸€å®šè¦æ³¨æ„getCount()å’ŒisViewFromObject()å‡½æ•°çš„å®ç°ã€‚ æœ‰äº†é€‚é…å™¨ï¼Œåªè¦ç»™adapteræ·»åŠ ä¹‹å‰çš„guideè§†å›¾ä½œä¸ºèµ„æºï¼Œå†ç»™viewPagerè®¾ç½®èµ„æºé€‚é…å™¨ã€‚åŸºæœ¬æ•ˆæœå°±å®ç°äº†ã€‚ 12345678910111213141516171819202122232425262728293031AtyGuide.javaprivate void initViews() &#123; // load view final LayoutInflater inflater = LayoutInflater.from(this); viewList = new ArrayList&lt;&gt;(); viewList.add(inflater.inflate(R.layout.guide_page1, null)); viewList.add(inflater.inflate(R.layout.guide_page2, null)); viewList.add(inflater.inflate(R.layout.guide_page3, null)); // bind Id with imageView for (int i = 0; i &lt; indicatorDotIds.length; i++) &#123; imageViews[i] = (ImageView) findViewById(indicatorDotIds[i]); &#125; adapterGuideViewPager = new AdapterGuideViewPager(this, viewList); viewPager = (ViewPager) findViewById(R.id.vp_guide); viewPager.setAdapter(adapterGuideViewPager); viewPager.addOnPageChangeListener(this); btnToMain = (Button) (viewList.get(2)).findViewById(R.id.btn_to_main); btnToMain.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; Intent intent = new Intent(AtyGuide.this, AtyLoginOrRegister.class); startActivity(intent); &#125; &#125;);&#125; æŒ‡ç¤ºå™¨å®ç° å½“å‰é¡µé¢æ˜¯ç¬¬å‡ é¡µï¼Œè¦ç»™ç”¨æˆ·ä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„æç¤ºï¼Œå¯ä»¥åˆ©ç”¨ä¸¤ä¸ªä¸åŒé¢œè‰²çš„å°åœ†ç‚¹ã€‚ä½†æ˜¯è¦æƒ³çŸ¥é“ç§»åŠ¨çš„æ”¹å˜å°±è¦å®ç°ç›‘å¬äº‹ä»¶ å®ç°onPageSelected()æ–¹æ³•å°±å¯ä»¥äº†ã€‚ 1234567891011AtyGuide.javapublic void onPageSelected(int position) &#123; for (int i = 0; i &lt; indicatorDotIds.length; i++) &#123; if (i != position) &#123; imageViews[i].setImageResource(R.drawable.unselected); &#125; else &#123; imageViews[i].setImageResource(R.drawable.selected); &#125; &#125;&#125; ç™»å½•æ³¨å†Œ ç•Œé¢ è¿™é‡Œå¯ä»¥è‡ªå·±è®¾è®¡ï¼Œæˆ‘ä½¿ç”¨TabHostå®ç°ï¼Œå­¦ä¹ ä½¿ç”¨ä¸åŒæ§ä»¶ï¼Œä¸è¿‡å¸ƒå±€å€¼å¾—ä¸»é¡µçš„æ˜¯IDçš„è®¾ç½®ï¼Œè‡ªå·±å¯ä»¥è¯•è¯•å¦‚æœä¸è¿™æ ·ä¼šå‡ºç°ä»€ä¹ˆæ•ˆæœã€‚ 12345678910111213141516&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:background=\"@drawable/shot1\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt; &lt;TabHost android:id=\"@+id/tabHost\"&gt; &lt;TabWidget android:id=\"@android:id/tabs\"&gt; &lt;/TabWidget&gt; &lt;FrameLayout android:id=\"@android:id/tabcontent\"&gt; &lt;LinearLayout&gt; Login Layout &lt;/LinearLayout&gt; &lt;LinearLayout&gt; Register Layout &lt;/LinearLayout&gt; &lt;/FrameLayout&gt; &lt;/TabHost&gt;&lt;/RelativeLayout&gt; è·³è½¬ ç›®å‰è¿˜æ²¡è¿›è¡Œæ•°æ®å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è·³è½¬è¿›å…¥ç•Œé¢ 123456789101112131415161718192021222324252627282930313233343536373839private void initViews() &#123; tabHost = (TabHost) findViewById(R.id.tabHost); btnLogin = (Button) findViewById(R.id.btn_login); etLoginUsername = (EditText) findViewById(R.id.et_login_username); etLoginPassword = (EditText) findViewById(R.id.et_login_password); btnRegister = (Button) findViewById(R.id.btn_register); etRegisterUsername = (EditText) findViewById(R.id.et_register_username); etRegisterPassword = (EditText) findViewById(R.id.et_register_password); etInsurePassword = (EditText) findViewById(R.id.et_insure_password); tabHost.setup(); tabHost.addTab(tabHost.newTabSpec(\"Login\").setIndicator(\"Login\").setContent(R.id.layout_login)); tabHost.addTab(tabHost.newTabSpec(\"Register\").setIndicator(\"Register\").setContent(R.id.layout_register)); btnLogin.setOnClickListener(this); btnRegister.setOnClickListener(this);&#125;@Overridepublic void onClick(View v) &#123; switch (v.getId()) &#123; case R.id.btn_login: &#123; Intent intent = new Intent(this, AtyMain.class); startActivity(intent); finish(); break; &#125; case R.id.btn_register: &#123; Intent intent = new Intent(this, AtyMain.class); startActivity(intent); finish(); break; &#125; default: break; &#125;&#125; æ·»åŠ ä¾èµ–åº“ å¦‚æœä½ é‡åˆ°ä¸Šé¢çš„bugï¼Œè¯´æ˜åˆ°ç°åœ¨æˆ‘ä»¬çš„TabHostæ˜¯æ— æ³•å·¥ä½œçš„ï¼Œå› ä¸ºç¼ºå°‘ä¸€ä¸ªä¾èµ–åº“ã€‚compile â€˜com.android.support:design:2x.x.xâ€™ æ·»åŠ æ–¹å¼æ˜¯åœ¨File-&gt;Project Structure åœ¨å¼¹å‡ºçš„çª—å£ä¸­é€‰æ‹©app,ä¹‹åæ“ä½œçœ‹å›¾æ­¤æ—¶éœ€è¦é‡æ–°Gradle, è¿™æ—¶å¯èƒ½ä¸€ä¸ªé”™è¯¯åœ¨build.gradleã€‚æŒ‰Alt + Enter, é€‰æ‹©å¿½ç•¥å°±å¥½ã€‚ 12345678910dependencies &#123; compile fileTree(include: ['*.jar'], dir: 'libs') androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.2', &#123; exclude group: 'com.android.support', module: 'support-annotations' &#125;) compile 'com.android.support:appcompat-v7:25.3.1' compile 'com.android.support.constraint:constraint-layout:1.0.1' testCompile 'junit:junit:4.12' compile 'com.android.support:design:26.0.0-alpha1'&#125; ä¸»ç•Œé¢ä¹‹å‰çš„é¡µé¢åŸºæœ¬å®ç°ï¼Œé‚£ä¹ˆä¸»ç•Œé¢å¦‚ä½•å®ç°ï¼Œå‚è€ƒQQï¼Œä¸ºäº†é¿å…æ§ä»¶ä¸Šçš„ä½¿ç”¨éš¾åº¦ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨googleæä¾›çš„DrawerLayoutå†™ä»£ç ä¹‹å‰å…ˆç†æ¸…æ€è·¯ï¼Œè¿™ä¸ªä¸»ç•Œé¢æ˜æ˜¾æ˜¯åŒ…å«ä¸‰ä¸ªé¡µé¢åŠ ä¸€ä¸ªä¾§æ¢é¡µé¢ï¼Œä¹Ÿå°±æ˜¯å››ä¸ªã€‚æ–°å»ºä¸€ä¸ªviewèµ„æºæ–‡ä»¶ï¼Œåˆ›å»ºå››ä¸ªè§†å›¾ç±»æ¥ç€æ–°å»ºå››ä¸ªå¸ƒå±€ä¾›ç±»åŠ è½½ å¸ƒå±€ è¿™ä¸ªå¸ƒå±€æœ‰è¦ä¸»é¡µçš„åœ°æ–¹ä¾§æ»‘è§†å›¾è¦è®¾ç½®android:layout_gravity=â€startâ€ å±æ€§ã€‚DrawerLayoutæœ€å¥½ä¸ºæ ¹å®¹å™¨æ¨èå¦‚ä¸‹å¸ƒå±€æœ€å¤–å±‚å°±æ˜¯DrawerLayoutï¼Œä¸­é—´åªæœ‰ä¸€ä¸ªä¸»å†…å®¹å’Œä¸€ä¸ªä¾§æ»‘å¸ƒå±€ã€‚ä½ è¦æ·»åŠ çš„å†…å®¹å…¨éƒ¨åœ¨ä¸»å†…å®¹ä¸­å®ç°ã€‚ è¿™é‡Œé‡‡ç”¨ViewPager + TabLayout æ¥å®ç°ï¼Œä¸ç†Ÿæ‚‰çš„ç‚¹è¿™é‡Œ 123456789101112aty_main.xml&lt;android.support.v4.widget.DrawerLayout &gt; &lt;LinearLayout &gt; &lt;android.support.v4.view.ViewPager &gt; &lt;/android.support.v4.view.ViewPager&gt; &lt;android.support.design.widget.TabLayout &gt; &lt;/android.support.design.widget.TabLayout&gt; &lt;/LinearLayout&gt; &lt;org.fitzeng.zzchat.view.SlideLayout android:layout_gravity=\"start\"&gt;ä¾§æ¢è§†å›¾&lt;/org.fitzeng.zzchat.view.SlideLayout&gt;&lt;/android.support.v4.widget.DrawerLayout&gt; åŠ è½½é¡µé¢ ä»¥Chatsä¸ºä¾‹ 123456&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:background=\"#09868f\" android:orientation=\"vertical\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt;&lt;/LinearLayout&gt; 1234567891011public class LayoutChats extends Fragment &#123; private View rootView; @Nullable @Override public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) &#123; rootView = inflater.inflate(R.layout.layout_chats, container, false); return rootView; &#125;&#125; ååˆ†ç®€å•ï¼Œçœ‹ä»£ç å°±èƒ½æ‡‚ ä¹‹å‰å·²ç»ä½¿ç”¨äº†ä¾§æ»‘è§†å›¾ï¼Œæ¥ä¸‹æ¥çš„ä¸‰ä¸ªè§†å›¾åˆ†åˆ«å¯¹åº”åŠ è½½è¿›äº†ä¸‰ä¸ªç±»ã€‚å¦‚ä½•å°†è¿™äº›è§†å›¾åŠ è½½è¿›ä¸»ç•Œé¢ï¼Œå‰é¢å·²ç»è¯´è¿‡å¦‚ä½•åŠ è½½ç»viewPageräº†ï¼Œè¿™é‡Œä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å®ç°ä¸€ä¸ªé€‚é…å™¨ã€‚ é€‚é…å™¨ å’Œå‰é¢ä¸ä¸€æ ·çš„æ˜¯å‰é¢ç›´æ¥inflateä¸€ä¸ªå¸ƒå±€è¿›èµ„æºåˆ—è¡¨ï¼Œè€Œè¿™é‡Œæ˜¯æŠŠå¸ƒå±€åŠ è½½è¿›ç±»ä¸­äº†ã€‚æ‰€ä»¥å®ç°æ–¹å¼ç¨å¾®æœ‰ç‚¹ä¸ä¸€æ ·, è¿™æ ·å¯¹å¸ƒå±€çš„å†…å®¹æ§åˆ¶æ€§ä¸ªäººè®¤ä¸ºè¾ƒå¥½,å› ä¸ºå¸ƒå±€ä¸­çš„å­æ§ä»¶é€»è¾‘å¯ä»¥åœ¨å„è‡ªçš„ç±»ä¸­å®ç°ã€‚çœ‹ä»£ç å°±æ‡‚äº†ã€‚ 123456789101112131415161718192021222324adapter/AdapterMainViewPager.javapublic class AdapterMainViewPager extends FragmentPagerAdapter &#123; private List&lt;Fragment&gt; fragmentList = new ArrayList&lt;&gt;(); public AdapterMainViewPager(FragmentManager fragmentManager) &#123; super(fragmentManager); &#125; public void addFragment(Fragment fragment) &#123; fragmentList.add(fragment); &#125; @Override public Fragment getItem(int position) &#123; return fragmentList.get(position); &#125; @Override public int getCount() &#123; return fragmentList.size(); &#125;&#125; 123456789101112131415161718192021222324private void initViews() &#123; drawable = (DrawerLayout) findViewById(R.id.dl_main); viewPager = (ViewPager) findViewById(R.id.vp_main); tabLayout = (TabLayout) findViewById(R.id.tl_main); tabList = new ArrayList&lt;&gt;(); AdapterMainViewPager adapter = new AdapterMainViewPager(getSupportFragmentManager()); adapter.addFragment(new LayoutChats()); adapter.addFragment(new LayoutContacts()); adapter.addFragment(new LayoutMoments()); viewPager.setAdapter(adapter); tabLayout.setupWithViewPager(viewPager); tabList.add(tabLayout.getTabAt(0)); tabList.add(tabLayout.getTabAt(1)); tabList.add(tabLayout.getTabAt(2)); tabList.get(0).setIcon(R.drawable.icon).setText(\"Chats\"); tabList.get(1).setIcon(R.drawable.icon).setText(\"Contacts\"); tabList.get(2).setIcon(R.drawable.icon).setText(\"Moments\");&#125; ä»£ç æ¯”è¾ƒç®€æ´ï¼Œä¸çŸ¥é“æ„æ€çš„å¯ä»¥æŒ‰ctrlç‚¹å‡»ç±»åæˆ–æ–¹æ³•åçœ‹æºç æ³¨é‡Šã€‚ åˆ°è¿™é‡ŒåŸºæœ¬çš„æ•ˆæœå®ç°äº†ï¼Œä¸æ¸…æ¥šäº†å¯ä»¥å‚è€ƒé˜¶æ®µæ€§æºç ã€‚","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"},{"name":"ZZChat","slug":"ZZChat","permalink":"http://fitzeng.org/tags/ZZChat/"}]},{"title":"å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-0","date":"2017-04-14T02:00:00.000Z","path":"2017/04/14/ZZChatApp0/","text":"GitHub å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-0 å®ç°æ•ˆæœ åŸå› ç”±äºåœ¨é—´é—´æ–­æ–­çš„å­¦Androidï¼Œæ‰€ä»¥å­¦çš„çŸ¥è¯†æ¯”è¾ƒæ‚ï¼Œæƒ³åšä¸ªå°é¡¹ç›®æ¥å¤ä¹ å¤ä¹ ã€‚æ‰€ä»¥ä¹‹å‰åœ¨è¯¾ååå¤©å·¦å³çš„æ—¶é—´å®Œæˆäº†ä¸€ä¸ªåˆšåˆšå…·å¤‡èŠå¤©åŠŸèƒ½çš„Appï¼Œç”±äºè¿™å‡ å¤©æ‹¼å‘½çš„æœå¯»èµ„æ–™ï¼Œå‘ç°ç½‘ä¸Šå¹¶æ²¡æœ‰ä¸€ä¸ªå®Œæ•´çš„å¼€å‘è¿‡ç¨‹çš„æ–‡ç« ã€‚å¹³æ—¶ä¹Ÿå°±æ˜¯çœ‹çœ‹å¤§ç‰›ä»¬çš„åšå®¢å­¦ä¹ ï¼Œç°åœ¨è§‰å¾—ä¹Ÿè¦å¤šå’Œå¤§å®¶åˆ†äº«è‡ªå·±å­¦åˆ°çš„çŸ¥è¯†ï¼Œå…±åŒè¿›æ­¥ã€‚å¯èƒ½ä½ åœ¨è¿™å­¦ä¸åˆ°æŠ€æœ¯æ·±åº¦çš„ä¸œè¥¿ï¼Œä½†æ˜¯è¯´ä¸å®šå¯ä»¥æ‰©å±•ä½ çš„æŠ€æœ¯å¹¿åº¦ã€‚ ç›®æ ‡äººç¾¤æ¨èç»™æ­£å¤„äºAndroidè¿›é˜¶çš„äººç¾¤ï¼Œæƒ³å†™ä¸€ä¸ªAppå´ä¸çŸ¥é“å¦‚ä½•å¼€å§‹ã€‚å¸Œæœ›æˆ‘çš„è¿™äº›æ–‡å­—å¯¹ä½ èƒ½æœ‰å¸®åŠ©ã€‚æœ€å°‘åŸºæœ¬è¿‡äº†ä¸€éã€Šç¬¬ä¸€è¡Œä»£ç ã€‹ï¼Œè¯»è¿‡ã€ŠAndroidç¾¤è‹±ä¼ ã€‹å°±æ›´å¥½äº†ã€‚ç”±äºæˆ‘æ˜¯ä»¥ä¸€ä¸ªé‡åˆ°é—®é¢˜è§£å†³é—®é¢˜çš„è§†è§’æ¥å†™çš„ï¼Œæ‰€ä»¥åŸºæœ¬ä¼šè®©ä½ çš„å¼€å‘è¿‡ç¨‹æ€è·¯æ¸…æ™°ï¼ŒçŸ¥é“è¿™ä¹ˆåšçš„ç›®çš„å’Œå¥½å¤„ã€‚åŒæ—¶è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¼€å§‹å®Œå…¨ä¸çŸ¥é“æ€ä¹ˆå†™åˆ°å®ç°åŸºæœ¬åŠŸèƒ½çš„å¿ƒè·¯å†ç¨‹æè¿°ã€‚æ‰€ä»¥åº”è¯¥ä¼šæœ‰ç‚¹ä»·å€¼å§ã€‚å½“ç„¶æ¶‰åŠçš„ä¸œè¥¿ç¡®å®æœ‰ç‚¹å¤šï¼Œæ‰€ä»¥ä¸å¯èƒ½ä¸€ä¸€å™è¿°ï¼Œæ¬¢è¿å¤§å®¶ç•™è¨€è®¨è®ºã€‚ çŸ¥è¯†æ•°æ®åº“ç›¸å…³çŸ¥è¯†ï¼ˆåŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ï¼‰Javaï¼ˆJavaå¯è§†åŒ–ç•Œé¢ç¼–ç¨‹ï¼ŒSocketç½‘ç»œé€šä¿¡ï¼‰Android è½¯ä»¶Android: Android Studioæœ¬åœ°æœåŠ¡å™¨æ­å»ºï¼š XAMPPï¼ˆApache + MySQLï¼‰æœåŠ¡å™¨ç•Œé¢ï¼šEclipse JavaEE å®ç°æ€è·¯åœ¨ç”µè„‘ä¸Šåˆ©ç”¨Apache + MySQLæ­å»ºä¸€ä¸ªä¾›æœåŠ¡ç«¯è®¿é—®çš„æ•°æ®åº“ï¼Œæœ‰äº†æ•°æ®åº“ï¼Œå°±è¦å†™ä¸€ä¸ªæœåŠ¡ç«¯åœ¨ç”µè„‘ä¸Šè¿è¡Œï¼Œè¯»å†™æ•°æ®åº“æ•°æ®ã€‚å¼€å¯ä¸€ä¸ªçº¿ç¨‹ä¸€ç›´æ£€æµ‹æ˜¯å¦æœ‰å®¢æˆ·å‘é€è¿æ¥è¯·æ±‚ï¼Œæœ‰çš„è¯acceptï¼Œå¹¶ä¸”ç»™è¿™ä¸ªè¿æ¥çš„ç”¨æˆ·å¼€ä¸€ä¸ªå•ç‹¬çº¿ç¨‹ä¾›å®¢æˆ·ç«¯è¿›è¡Œé€šè®¯ã€‚è€Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚ç»™æœåŠ¡å™¨ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯è¦æœ‰ä¸€ä¸ªActionæ¥æ¿€æ´»å‘é€è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ç‚¹å‡»æ»‘åŠ¨ç­‰äº‹ä»¶ã€‚ä½†æ˜¯åŒæ—¶åˆè¦æ¥å—æ¥è‡ªæœåŠ¡ç«¯çš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿å®¢æˆ·ç«¯çš„Actionæ“ä½œå’Œä¸æœåŠ¡ç«¯é€šè®¯åˆ†åˆ«ç”¨ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹ç®¡ç†ã€‚ä¸çŸ¥é“æˆ‘è®²æ²¡è®²è¯·ï¼Œä¸‹é¢ç”¨å›¾æ¥æè¿°ä¸€ä¸‹ã€‚ å®ç°ç¨‹åº¦ç”±äºå­¦ä¸šè¾ƒå¿™ï¼Œåšå®¢åªä¼šæ›´æ–°åˆ°ç›®å‰ç¨‹åº¦ï¼Œæ¥ä¸‹çš„è¿‡ç¨‹å¤§å®¶å¯ä»¥å®šåˆ¶å±äºä½ è‡ªå·±çš„èŠå¤©è½¯ä»¶ã€‚é€»è¾‘æ¡†æ¶å®Œæˆåº¦ï¼š60%ç•Œé¢è®¾è®¡å®Œæˆåº¦ï¼š40%å·²å®ç°ï¼šæœåŠ¡ç«¯ï¼Œé€šè®¯åè®®ï¼Œç™»å½•ï¼ŒèŠå¤©ã€‚æ¥ä¸‹æ¥çš„åŠŸèƒ½åŸºæœ¬å¯ä»¥æ ¹æ®ä¸Šé¢çš„åŠŸèƒ½å®ç°ã€‚ å»ºè®®1 ä½¿ç”¨çœŸæœºè°ƒè¯•2 åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä¸€å®šä¼šé‡åˆ°å„ç§é—®é¢˜ Log + æ–­ç‚¹ -&gt; StackOverflow åŸºæœ¬å¯ä»¥è§£å†³åˆå­¦è€…99%çš„é—®é¢˜ã€‚ å¼€å§‹å­¦ä¹ å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-1å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-2å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-3å®ç°ä¸€ä¸ªç±»ä¼¼QQçš„ç¤¾äº¤èŠå¤©å·¥å…·-4 æœ€åè¿™ä¸ªAppæˆ‘ä¼šç»§ç»­åœ¨GitHubå®Œå–„ï¼ŒBlogæ˜¯å¦æ›´çœ‹è¯¾ä½™æ—¶é—´ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨ã€‚","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"},{"name":"ZZChat","slug":"ZZChat","permalink":"http://fitzeng.org/tags/ZZChat/"}]},{"title":"å®ç°ä¸€ä¸ªè¡¨æƒ…é”®ç›˜æ§ä»¶","date":"2017-04-07T05:00:00.000Z","path":"2017/04/07/EmojiKeyboard/","text":"GitHub ä»»åŠ¡ç›®çš„ å­¦ä¹ androidæ§ä»¶çš„å°è£…ï¼ŒviewPagerçš„ä½¿ç”¨ï¼Œä»¥åŠSpannableStringå¯¹æ–‡å­—åŠ å›¾ç‰‡çš„å¤„ç† ä»»åŠ¡æè¿° èƒ½è¿›è¡Œè¡¨æƒ…çš„è¾“å…¥ï¼Œåˆ é™¤ è¡¨æƒ…å¤§äºä¸€é¡µï¼Œä¸”å¯ä»¥ç¿»é¡µ è¡¨æƒ…é”®ç›˜å’Œè¾“å…¥æ³•é”®ç›˜çš„å¼¹å‡ºé€»è¾‘è¦æ­£ç¡® ç»“æœæ¼”ç¤º å®ç°è¿‡ç¨‹ ä¸€å¼€å§‹ï¼Œå…¶å®ä¹Ÿä¸çŸ¥é“ä»å“ªé‡Œä¸‹æ‰‹ï¼Œå¼€å§‹åœ¨ç½‘ä¸Šæµè§ˆäº†ä¸€äº›åšå®¢ï¼Œå¤§æ¦‚æœ‰äº†è§£å†³çš„æ€è·¯ï¼Œä¸‹é¢å°±ä»æˆ‘ä¸ªäººçš„è§£å†³æ€è·¯å‡ºå‘å®ç°ä¸€ä¸ªä¸€ä¸ªå°åŠŸèƒ½ã€‚ step 1: è®¾è®¡æ€»ä½“å¸ƒå±€ é‡‡ç”¨LinearLayoutåŸºæœ¬ä¸Šæ˜¯ä¸Š(textView)ä¸­(func Bar)ä¸‹(keyboard)çš„è®¾è®¡ï¼Œä¸ºäº†æ–¹ä¾¿æ§åˆ¶ï¼Œkeyboardçš„å¸ƒå±€é‡‡ç”¨è‡ªå®šä¹‰ï¼Œå¸ƒå±€ä»£ç å¦‚ä¸‹ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;org.fitzeng.emojikeyboard.simpleemojikeyboard.SimpleEmojiEditLayout android:id=\"@+id/etSimpleEmojiEdit\" android:hint=\"@string/typeing_something_here\" android:maxLines=\"30\" android:textSize=\"24sp\" android:gravity=\"top\" android:background=\"@null\" android:layout_margin=\"8dp\" android:layout_weight=\"1\" android:layout_width=\"match_parent\" android:layout_height=\"0dp\" /&gt;&lt;RelativeLayout android:background=\"@color/colorPrimary\" android:layout_width=\"match_parent\" android:layout_height=\"50dp\"&gt; &lt;ImageView android:id=\"@+id/touchIcon\" android:src=\"@mipmap/ic_launcher\" android:layout_centerInParent=\"true\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:contentDescription=\"@string/an_icon_button\" /&gt; &lt;ImageView android:id=\"@+id/btnDelete\" android:src=\"@drawable/icon_delete_normal\" android:layout_alignParentRight=\"true\" android:layout_centerVertical=\"true\" android:layout_width=\"wrap_content\" android:layout_height=\"@dimen/dp40\" android:contentDescription=\"@string/delete\" /&gt;&lt;/RelativeLayout&gt;&lt;org.fitzeng.emojikeyboard.simpleemojikeyboard.SimpleEmojiKeyboardLayout android:id=\"@+id/simpleEmojiKeyboardLayout\" android:visibility=\"gone\" android:layout_width=\"match_parent\" android:layout_height=\"0dp\"&gt;&lt;/org.fitzeng.emojikeyboard.simpleemojikeyboard.SimpleEmojiKeyboardLayout&gt; step 2ï¼šå¤§æ¦‚å®ç°å¸ƒå±€æ§ä»¶ è®¾è®¡å¥½æ§ä»¶ï¼Œå°±è¿›è¡Œå®ç°ï¼Œé€šè¿‡å¯¹func Barçš„è®¾è®¡ï¼Œå®ç°é”®ç›˜çš„æ”¶ç¼©åŠŸèƒ½ã€‚ 1234567891011121314151617181920212223242526272829303132// Click icon to make keyboard hide or appeartouchIcon.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; if (simpleEmojiKeyboardLayout.getVisibility() == View.GONE) &#123; simpleEmojiKeyboardLayout.setVisibility(View.VISIBLE); simpleEmojiKeyboardLayout.slipUp(); &#125; else &#123; simpleEmojiKeyboardLayout.setVisibility(View.GONE); &#125; &#125;&#125;);// Make keyboard appear when click to editsimpleEmojiEditLayout.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; if (simpleEmojiKeyboardLayout.getVisibility() == View.GONE) &#123; simpleEmojiKeyboardLayout.slipUp(); simpleEmojiKeyboardLayout.setVisibility(View.VISIBLE); &#125; &#125;&#125;);/** * keyboard slip out */public void slipUp() &#123; LinearLayout.LayoutParams layoutParams = (LinearLayout.LayoutParams) this.getLayoutParams(); layoutParams.height = (int) (getMeasuredWidth() * 0.7); this.setLayoutParams(layoutParams);&#125; step 3: å°è£…è¡¨æƒ…åŠ å…¥keyboard å°†emojiå°è£…æˆä¸€ä¸ªå¯¹è±¡ 1234567891011121314151617181920212223242526public class Smile &#123; private int resId; private String info; public Smile(int resId, String info) &#123; this.resId = resId; this.info = info; &#125; public int getResId() &#123; return resId; &#125; public void setResId(int resId) &#123; this.resId = resId; &#125; public String getInfo() &#123; return info; &#125; public void setInfo(String info) &#123; this.info = info; &#125;&#125; ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼ŒæŠŠè¡¨æƒ…èµ„æºéƒ½æ·»åŠ è¿›ä¸€ä¸ªManagerç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113public class EmojiManager &#123; private static List&lt;Smile&gt; smileList; private static Context context; public EmojiManager(Context context) &#123; this.context = context; &#125; public static List&lt;Smile&gt; getSmileList() &#123; if(smileList==null)&#123; smileList=new ArrayList&lt;&gt;(); smileList.add(new Smile(R.drawable.emotion_1001,\"[e]1001[/e]\")); smileList.add(new Smile(R.drawable.emotion_1002,\"[e]1002[/e]\")); smileList.add(new Smile(R.drawable.emotion_1003,\"[e]1003[/e]\")); smileList.add(new Smile(R.drawable.emotion_1004,\"[e]1004[/e]\")); smileList.add(new Smile(R.drawable.emotion_1005,\"[e]1005[/e]\")); smileList.add(new Smile(R.drawable.emotion_1006,\"[e]1006[/e]\")); smileList.add(new Smile(R.drawable.emotion_1007,\"[e]1007[/e]\")); smileList.add(new Smile(R.drawable.emotion_1008,\"[e]1008[/e]\")); smileList.add(new Smile(R.drawable.emotion_1009,\"[e]1009[/e]\")); smileList.add(new Smile(R.drawable.emotion_1010,\"[e]1010[/e]\")); smileList.add(new Smile(R.drawable.emotion_1011,\"[e]1011[/e]\")); smileList.add(new Smile(R.drawable.emotion_1012,\"[e]1012[/e]\")); smileList.add(new Smile(R.drawable.emotion_1013,\"[e]1013[/e]\")); smileList.add(new Smile(R.drawable.emotion_1014,\"[e]1014[/e]\")); smileList.add(new Smile(R.drawable.emotion_1015,\"[e]1015[/e]\")); smileList.add(new Smile(R.drawable.emotion_1016,\"[e]1016[/e]\")); smileList.add(new Smile(R.drawable.emotion_1017,\"[e]1017[/e]\")); smileList.add(new Smile(R.drawable.emotion_1018,\"[e]1018[/e]\")); smileList.add(new Smile(R.drawable.emotion_1019,\"[e]1019[/e]\")); smileList.add(new Smile(R.drawable.emotion_1020,\"[e]1020[/e]\")); smileList.add(new Smile(R.drawable.emotion_1021,\"[e]1021[/e]\")); smileList.add(new Smile(R.drawable.emotion_1022,\"[e]1022[/e]\")); smileList.add(new Smile(R.drawable.emotion_1023,\"[e]1023[/e]\")); smileList.add(new Smile(R.drawable.emotion_1024,\"[e]1024[/e]\")); smileList.add(new Smile(R.drawable.emotion_1025,\"[e]1025[/e]\")); smileList.add(new Smile(R.drawable.emotion_1026,\"[e]1026[/e]\")); smileList.add(new Smile(R.drawable.emotion_1027,\"[e]1027[/e]\")); smileList.add(new Smile(R.drawable.emotion_1028,\"[e]1028[/e]\")); smileList.add(new Smile(R.drawable.emotion_1029,\"[e]1029[/e]\")); smileList.add(new Smile(R.drawable.emotion_1030,\"[e]1030[/e]\")); smileList.add(new Smile(R.drawable.emotion_1031,\"[e]1031[/e]\")); smileList.add(new Smile(R.drawable.emotion_1032,\"[e]1032[/e]\")); smileList.add(new Smile(R.drawable.emotion_1033,\"[e]1033[/e]\")); smileList.add(new Smile(R.drawable.emotion_1034,\"[e]1034[/e]\")); smileList.add(new Smile(R.drawable.emotion_1035,\"[e]1035[/e]\")); smileList.add(new Smile(R.drawable.emotion_1036,\"[e]1036[/e]\")); smileList.add(new Smile(R.drawable.emotion_1037,\"[e]1037[/e]\")); smileList.add(new Smile(R.drawable.emotion_1038,\"[e]1038[/e]\")); smileList.add(new Smile(R.drawable.emotion_1039,\"[e]1039[/e]\")); smileList.add(new Smile(R.drawable.emotion_1040,\"[e]1040[/e]\")); smileList.add(new Smile(R.drawable.emotion_1041,\"[e]1041[/e]\")); smileList.add(new Smile(R.drawable.emotion_1042,\"[e]1042[/e]\")); smileList.add(new Smile(R.drawable.emotion_1043,\"[e]1043[/e]\")); smileList.add(new Smile(R.drawable.emotion_1044,\"[e]1044[/e]\")); smileList.add(new Smile(R.drawable.emotion_1045,\"[e]1045[/e]\")); smileList.add(new Smile(R.drawable.emotion_1046,\"[e]1046[/e]\")); smileList.add(new Smile(R.drawable.emotion_1047,\"[e]1047[/e]\")); smileList.add(new Smile(R.drawable.emotion_1048,\"[e]1048[/e]\")); smileList.add(new Smile(R.drawable.emotion_1049,\"[e]1049[/e]\")); smileList.add(new Smile(R.drawable.emotion_1050,\"[e]1050[/e]\")); smileList.add(new Smile(R.drawable.emotion_1051,\"[e]1051[/e]\")); smileList.add(new Smile(R.drawable.emotion_1052,\"[e]1052[/e]\")); smileList.add(new Smile(R.drawable.emotion_1053,\"[e]1053[/e]\")); smileList.add(new Smile(R.drawable.emotion_1054,\"[e]1054[/e]\")); smileList.add(new Smile(R.drawable.emotion_1055,\"[e]1055[/e]\")); smileList.add(new Smile(R.drawable.emotion_1056,\"[e]1056[/e]\")); smileList.add(new Smile(R.drawable.emotion_1057,\"[e]1057[/e]\")); smileList.add(new Smile(R.drawable.emotion_1058,\"[e]1058[/e]\")); smileList.add(new Smile(R.drawable.emotion_1059,\"[e]1059[/e]\")); smileList.add(new Smile(R.drawable.emotion_1060,\"[e]1060[/e]\")); smileList.add(new Smile(R.drawable.emotion_1061,\"[e]1061[/e]\")); smileList.add(new Smile(R.drawable.emotion_1062,\"[e]1062[/e]\")); smileList.add(new Smile(R.drawable.emotion_1063,\"[e]1063[/e]\")); smileList.add(new Smile(R.drawable.emotion_1064,\"[e]1064[/e]\")); smileList.add(new Smile(R.drawable.emotion_1065,\"[e]1065[/e]\")); smileList.add(new Smile(R.drawable.emotion_1066,\"[e]1066[/e]\")); smileList.add(new Smile(R.drawable.emotion_1067,\"[e]1067[/e]\")); smileList.add(new Smile(R.drawable.emotion_1068,\"[e]1068[/e]\")); smileList.add(new Smile(R.drawable.emotion_1069,\"[e]1069[/e]\")); smileList.add(new Smile(R.drawable.emotion_1070,\"[e]1070[/e]\")); smileList.add(new Smile(R.drawable.emotion_1071,\"[e]1071[/e]\")); smileList.add(new Smile(R.drawable.emotion_1072,\"[e]1072[/e]\")); smileList.add(new Smile(R.drawable.emotion_1073,\"[e]1073[/e]\")); smileList.add(new Smile(R.drawable.emotion_1074,\"[e]1074[/e]\")); smileList.add(new Smile(R.drawable.emotion_1075,\"[e]1075[/e]\")); smileList.add(new Smile(R.drawable.emotion_1076,\"[e]1076[/e]\")); smileList.add(new Smile(R.drawable.emotion_1077,\"[e]1077[/e]\")); smileList.add(new Smile(R.drawable.emotion_1078,\"[e]1078[/e]\")); smileList.add(new Smile(R.drawable.emotion_1079,\"[e]1079[/e]\")); smileList.add(new Smile(R.drawable.emotion_1080,\"[e]1080[/e]\")); smileList.add(new Smile(R.drawable.emotion_1081,\"[e]1081[/e]\")); smileList.add(new Smile(R.drawable.emotion_1082,\"[e]1082[/e]\")); smileList.add(new Smile(R.drawable.emotion_1083,\"[e]1083[/e]\")); smileList.add(new Smile(R.drawable.emotion_1084,\"[e]1084[/e]\")); smileList.add(new Smile(R.drawable.emotion_1085,\"[e]1085[/e]\")); smileList.add(new Smile(R.drawable.emotion_1086,\"[e]1086[/e]\")); smileList.add(new Smile(R.drawable.emotion_1087,\"[e]1087[/e]\")); smileList.add(new Smile(R.drawable.emotion_1088,\"[e]1088[/e]\")); smileList.add(new Smile(R.drawable.emotion_1089,\"[e]1089[/e]\")); smileList.add(new Smile(R.drawable.emotion_1090,\"[e]1090[/e]\")); smileList.add(new Smile(R.drawable.emotion_1091,\"[e]1091[/e]\")); smileList.add(new Smile(R.drawable.emotion_1092,\"[e]1092[/e]\")); smileList.add(new Smile(R.drawable.emotion_1093,\"[e]1093[/e]\")); smileList.add(new Smile(R.drawable.emotion_1094,\"[e]1094[/e]\")); smileList.add(new Smile(R.drawable.emotion_1095,\"[e]1095[/e]\")); &#125; return smileList; &#125;&#125; è¡¨æƒ…èµ„æºåŸºæœ¬å‡†å¤‡å¥½ï¼Œç°åœ¨è¦å®ç°çš„åŠŸèƒ½æ˜¯æŠŠè¡¨æƒ…æ·»åŠ è¿›keyboardã€‚å¯ä»¥é€šè¿‡GridViewæ·»åŠ èµ„æºã€‚ ä½†æ˜¯åœ¨æ·»åŠ èµ„æºæ—¶ï¼Œéœ€è¦å€ŸåŠ©é€‚é…å™¨ï¼Œæ‰€ä»¥è¿˜è¦è‡ªå·±æ„é€ ä¸€ä¸ªè¡¨æƒ…çš„é€‚é…å™¨ï¼ŒåŸºæœ¬å®ç°æ˜¯å°†ä¸€ä¸ªimageView(è¡¨æƒ…)æ·»åŠ è¿›LinearLayoutä½œä¸ºä¸€ä¸ªå¸ƒå±€å…ƒç´ ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940public class EmojiAdapter extends BaseAdapter &#123; private static List&lt;Smile&gt; smileList; private static Context context; public EmojiAdapter(Context context, List&lt;Smile&gt; list) &#123; EmojiAdapter.context = context; smileList = list; &#125; @Override public View getView(int position, View convertView, ViewGroup parent) &#123; ImageView imageView = new ImageView(context); imageView.setImageResource(smileList.get(position).getResId()); LinearLayout layout = new LinearLayout(context); layout.setGravity(Gravity.CENTER); layout.addView(imageView, dp2px(28), dp2px(28 + 20)); return layout; &#125; private static int dp2px(float dpValue) &#123; final float scale = context.getResources().getDisplayMetrics().density; return (int) (dpValue * scale + 0.5f); &#125; @Override public int getCount() &#123; return smileList.size(); &#125; @Override public Object getItem(int position) &#123; return smileList.get(position); &#125; @Override public long getItemId(int position) &#123; return smileList.get(position).getResId(); &#125;&#125; æ„é€ å¥½äº†èµ„æºé€‚é…å™¨å°±å¯ä»¥å¾€GridViewä¸­åŠ è½½èµ„æºäº†ï¼Œå†æŠŠGridViewæ·»åŠ è¿›é”®ç›˜è¿™ä¸ªè§†å›¾ 1234567891011private void addEmojiToKeyBoard() &#123; gridView.setNumColumns(8); gridView.setId(R.id.gridView); EmojiAdapter adapter = new EmojiAdapter(getContext(), EmojiManager.getSmileList()); gridView.setAdapter(adapter);&#125;private void init() &#123; addEmojiToKeyBoard(); this.addView(gridView, LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT);&#125; step 4ï¼šå®ç°ç¼–è¾‘ç›¸å…³åŠŸèƒ½æ¨¡å— ç°åœ¨åŸºæœ¬UIå·²ç»å®ç°ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®ç°å¯¹emojiçš„ç‚¹å‡»äº‹ä»¶ç›‘å¬ï¼Œä»è€Œå®ç°åœ¨EditTextä¸­æ˜¾ç¤ºè¡¨æƒ…å…ƒç´  è¡¨æƒ…çš„æ·»åŠ ï¼Œåœ¨ä¸»Activityå®ç°ç›‘å¬ å‚è€ƒ: åœ¨EditTextä¸­æ·»åŠ QQè¡¨æƒ… android EditTextè·å–å…‰æ ‡ä½ç½®å¹¶æ’å…¥å­—ç¬¦åˆ é™¤å­—ç¬¦ 1234567891011121314151617181920212223// Called by click an emojigridView.setOnItemClickListener(new AdapterView.OnItemClickListener() &#123; @Override public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) &#123; // Calc lineHeight for ensure icon size int lineHeight = simpleEmojiEditLayout.getLineHeight(); // Create a bitmap Bitmap bitmap = BitmapFactory.decodeResource(getResources(), (int) id); // Set width and height bitmap = Bitmap.createScaledBitmap(bitmap, lineHeight - 10, lineHeight - 10, true); // ImageSpan imageSpan = new ImageSpan(SimpleEmojiKeyboardActivity.this, bitmap); SpannableString spannableString = new SpannableString(\"e\"); spannableString.setSpan(imageSpan, 0, 1, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); // Get texts from textView content = simpleEmojiEditLayout.getText(); // Get cursor location location = simpleEmojiEditLayout.getSelectionStart(); // Insert text content.insert(location, spannableString); &#125;&#125;); æ¥ä¸‹æ¥å®ç°func Barçš„deleteåŠŸèƒ½ 123456789101112btndelete.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; content = simpleEmojiEditLayout.getText(); location = simpleEmojiEditLayout.getSelectionStart(); if (location != 0) &#123; content.delete(location - 1, location); &#125; else &#123; Toast.makeText(SimpleEmojiKeyboardActivity.this, \"Nothing to delete\", Toast.LENGTH_SHORT).show(); &#125; &#125;&#125;); åˆ°è¿™ä¸€ä¸ªç®€å•çš„è¡¨æƒ…é”®ç›˜å°±å®ç°äº†ï¼Œå…¶ä¸­è¿˜æœ‰å¾ˆå¤šå°bugéœ€è¦ä¼˜åŒ–ï¼Œæœ€åæŠŠæ–‡ä»¶ååˆ—å‡ºæ¥ç†Ÿæ‚‰ä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚ emoji Smile EmojiManager EmojiAdapter SimpleEmojiKeyboard SimpleEmojiEditLayout SimpleEmojiKeyboardLayout SimpleEmojiKeyboardActivity æ¨èé˜…è¯»ï¼š Android è½¯é”®ç›˜å’Œemojiè¡¨æƒ…åˆ‡æ¢æ–¹æ¡ˆï¼Œå’Œå¾®ä¿¡å‡ ä¹ä¸€æ ·çš„ä½“éªŒ The handler for the keyboard and panel layout conflict in Android æœ‰æœºä¼šè¦å†™ä¸€ä¸ªæ›´åŠ å®Œå–„çš„^_^ Tips: ä½œä¸ºä¸€ä¸ªAndroidå°ç™½ï¼Œè‡ªç„¶æœ‰å¾ˆå¤šä¸çŸ¥é“ä¸ç†è§£çš„åœ°æ–¹ã€‚å¦‚æœæ–‡ä¸­æœ‰é”™æˆ–è€…æœ‰å“ªäº›å€¼å¾—æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§å®¶ææ„è§ï¼Œæˆ‘å¾ˆå¼€å¿ƒèƒ½å’Œå¤§å®¶ä¸€èµ·äº¤æµå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚ å¤šè°¢é˜…è¯»","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"}]},{"title":"å®ç°ä¸€ä¸ªè‡ªåŠ¨æ— çº¿å¾ªç¯è½®æ’­å›¾","date":"2017-04-07T04:00:00.000Z","path":"2017/04/07/SlideShow/","text":"GitHub ä»»åŠ¡æè¿° æ¯éš”3ç§’è½®æ’­å›¾è‡ªåŠ¨æ»šåŠ¨è§¦æ‘¸æ”¹è½®æ’­å›¾çš„æ—¶å€™ï¼Œè½®æ’­å›¾åœæ­¢è‡ªåŠ¨æ»šåŠ¨è½®æ’­å›¾èƒ½å¤Ÿå¾ªç¯æ»šåŠ¨ï¼Œå¹¶ä¸”ç¬¬ä¸€å¹…å›¾å‘å·¦æ»šåŠ¨çš„æ•ˆæœå’Œå…¶ä»–å›¾ç‰‡æ»šåŠ¨çš„æ•ˆæœè¦æ±‚ä¸€è‡´ã€‚åŒç†ï¼Œæœ€åä¸€å¹…å›¾å‘å³æ»šåŠ¨çš„æ•ˆæœä¹Ÿè¦æ±‚å’Œå…¶ä»–å›¾ç‰‡çš„æ•ˆæœä¸€è‡´demoçš„è½®æ’­å›¾è‡³å°‘åŒ…å«3å¹…å›¾ å®ç°æ•ˆæœ å®ç°è¿‡ç¨‹ ç•Œé¢è®¾è®¡ é¦–å…ˆè¦çŸ¥é“æˆ‘ä»¬çš„UIç•Œé¢æ˜¯æ€ä¹ˆæ ·çš„ï¼Œæ­¤å¤„çš„è®¾è®¡å¦‚ä¸‹å›¾æ‰€ç¤º ä»£ç ï¼š 1234567891011121314151617&lt;android.support.v4.view.ViewPager android:id=\"@+id/vpWallpaper\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt;&lt;/android.support.v4.view.ViewPager&gt;&lt;LinearLayout android:id=\"@+id/dotLayout\" android:gravity=\"center\" android:orientation=\"horizontal\" android:layout_alignParentBottom=\"true\" android:layout_marginBottom=\"28dp\" android:layout_centerInParent=\"true\" android:layout_width=\"match_parent\" android:layout_height=\"50dp\"&gt;&lt;/LinearLayout&gt; ç»˜åˆ¶UI(å…ˆè®¾è®¡æ»šåŠ¨çš„é¡µé¢ï¼Œå†è®¾è®¡æŒ‡ç¤ºå™¨) è¦ç»™ViewPageræ·»åŠ å›¾ç‰‡ï¼Œå°±è¦è®¾ç½®é€‚é…å™¨å’Œèµ„æº 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061/** * Set ViewPager Fragment */public static class ViewPagerFragment extends Fragment &#123; private ImageView image; private int id; public ViewPagerFragment(int id) &#123; this.id = id; &#125; @Nullable @Override public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) &#123; View rootView = inflater.inflate(R.layout.fragment_adapter, container, false); image = (ImageView) rootView.findViewById(R.id.image); image.setImageResource(id); return rootView; &#125;&#125;// fragement layout(fragment_adapter)&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:orientation=\"horizontal\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt; &lt;ImageView android:id=\"@+id/image\" android:scaleType=\"fitXY\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" android:contentDescription=\"@string/image\" /&gt;&lt;/LinearLayout&gt;/** * Set ViewPager Adapter */private class ViewPagerAdapter extends FragmentPagerAdapter &#123; private List&lt;Fragment&gt; fragmentList = new ArrayList&lt;&gt;(); // Add pages to ViewPager private void addPage(Fragment fragment) &#123; fragmentList.add(fragment); &#125; ViewPagerAdapter(FragmentManager fm) &#123; super(fm); &#125; @Override public Fragment getItem(int position) &#123; return fragmentList.get(position); &#125; @Override public int getCount() &#123; return fragmentList.size(); &#125;&#125; æ·»åŠ èµ„æº 123456789101112131415161718private static final int[] srcId = &#123; R.drawable.pic0, R.drawable.pic1, R.drawable.pic2, R.drawable.pic3, R.drawable.pic4, R.drawable.pic5, R.drawable.pic6&#125;;ViewPagerAdapter adapter = new ViewPagerAdapter(getSupportFragmentManager());// Add Fragmentsfor (int i = 0; i &lt; 7; i++) &#123; ViewPagerFragment fragment = new ViewPagerFragment(srcId[i]); adapter.addPage(fragment);&#125;viewPager.setAdapter(adapter); è®¾ç½®å¾ªç¯æ•ˆæœ è¿™é‡Œå°±æ˜¯éš¾ç‚¹ï¼Œè¦æƒ³å®ç°ä¸¤ç«¯çš„å¹³ç¼“å¾ªç¯æ»šåŠ¨å¯ä»¥åœ¨ä¸¤ç«¯æ·»åŠ ä¸€ä¸ªcache pageï¼Œ[ 0 ( 1 2 3 4 0) 1]ï¼Œåªæ˜¾ç¤ºï¼ˆï¼‰ä¸­çš„é¡µï¼Œä½†æ˜¯ä¸€æ—¦å‡ºç°cache pageç«‹é©¬è¿›è¡Œè·³è½¬ã€‚è¿™æ ·å°±èƒ½å®ç°å¾ªç¯ã€‚æ¥ä¸‹æ¥å°±æ˜¯è®¾ç½®è®¡æ—¶å™¨äº†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243/** * Set page change timer */@RequiresApi(api = Build.VERSION_CODES.KITKAT)private void setTimer() &#123; timer = new Timer(); timer.schedule(new TimerTask() &#123; @Override public void run() &#123; handler.sendEmptyMessage(viewPager.getCurrentItem()); &#125; &#125;, 2000, 2000);&#125;private Handler handler = new Handler() &#123; @Override public void handleMessage(Message msg) &#123; super.handleMessage(msg); switch (msg.what) &#123; case 1: case 2: case 3: case 4: case 5: &#123; viewPager.setCurrentItem(msg.what + 1, true); break; &#125; // To make start or end slip smoothly case 0: &#123; viewPager.setCurrentItem(5, false); viewPager.setCurrentItem(6, true); break; &#125; case 6: &#123; viewPager.setCurrentItem(1, false); viewPager.setCurrentItem(2, true); break; &#125; default: break; &#125; &#125;&#125;; è®¾ç½®å¹³ç¼“çš„æ»‘åŠ¨æ•ˆæœä½†æ˜¯è¿™ç§æ•ˆæœä¸èƒ½æ»¡è¶³è¦æ±‚,æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªæ»‘åŠ¨å»¶æ—¶ 123456789101112131415161718192021222324252627282930313233343536373839404142/** * Set Duration */@RequiresApi(api = Build.VERSION_CODES.KITKAT)private void setDuration() &#123; try &#123; Field field = ViewPager.class.getDeclaredField(\"mScroller\"); field.setAccessible(true); FixSpeedScroller scroller = new FixSpeedScroller(this, new AccelerateInterpolator()); scroller.setDuration(500); field.set(viewPager, scroller); &#125; catch (NoSuchFieldException | IllegalAccessException e) &#123; e.printStackTrace(); &#125;&#125;/** * Set scroller duration, make it smoothly */class FixSpeedScroller extends Scroller &#123; private int _duration = 1000; FixSpeedScroller(Context context, Interpolator interpolator) &#123; super(context, interpolator); &#125; @Override public void startScroll(int startX, int startY, int dx, int dy) &#123; super.startScroll(startX, startY, dx, dy, _duration); &#125; @Override public void startScroll(int startX, int startY, int dx, int dy, int duration) &#123; super.startScroll(startX, startY, dx, dy, _duration); &#125; public void setDuration(int duration) &#123; _duration = duration; &#125;&#125; åŸºæœ¬æ•ˆæœå°±å·²ç»å®ç°äº†ï¼Œä½†æ˜¯å¦‚æœæœ‰è§¦æ‘¸äº‹ä»¶å‘ç”Ÿï¼Œæˆ‘ä»¬è¦å¦è¡Œå¤„ç† æ·»åŠ ç‚¹å‡»ç›‘å¬ 123456789101112131415161718viewPager.setOnTouchListener(new View.OnTouchListener() &#123; @Override public boolean onTouch(View v, MotionEvent event) &#123; // Cancel the timer if (timer != null) &#123; timer.cancel(); timer = null; &#125; // when slip out cache view(page0, page6), set an another same page instantly if (viewPager.getCurrentItem() == 0) &#123; viewPager.setCurrentItem(5, false); &#125; if (viewPager.getCurrentItem() == 6) &#123; viewPager.setCurrentItem(1, false); &#125; return false; &#125;&#125;); åœ¨æ»‘åŠ¨ç›‘å¬ä¸­æ¢å¤è®¡æ—¶ 12345678910111213141516171819viewPager.setOnPageChangeListener(new ViewPager.OnPageChangeListener() &#123; @Override public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) &#123; &#125; @RequiresApi(api = Build.VERSION_CODES.KITKAT) @Override public void onPageSelected(int position) &#123; &#125; @RequiresApi(api = Build.VERSION_CODES.KITKAT) @Override public void onPageScrollStateChanged(int state) &#123; // if this page was showed by figure slip, then set timer to continue auto slip for next page if (timer == null) &#123; setTimer(); &#125; &#125;&#125;); ViewPagerçš„æ•ˆæœå·²ç»å®ç°ã€‚ä¸‹é¢å¼€å§‹å®ç°æŒ‡ç¤ºå™¨ æŒ‡ç¤ºå™¨UI åˆ©ç”¨ä¸¤å¼ å›¾ç‰‡å®ç°é€‰ä¸­å’Œæ²¡é€‰ä¸­æ•ˆæœï¼Œæ¯å¼ å›¾ç‰‡æ·»åŠ è¿›ä¸€ä¸ªLinearLayoutï¼ŒæŠŠæ‰€æœ‰çš„LinearLayoutæ’åˆ—ç»å¦ä¸€ä¸ªLinearLayoutå°±å¯ä»¥å®ç°æ•ˆæœ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ·»åŠ è§†å›¾æ—¶ï¼Œè¦åŠ åˆ¤æ–­ 123if (viewSelected.getParent() != null) &#123; ((ViewGroup) viewSelected.getParent()).removeView(viewSelected);&#125; å¦åˆ™åœ¨æœ‰çˆ¶å¸ƒå±€çš„æƒ…å†µä¸‹æ·»åŠ ä¸è¿›åˆ«çš„è§†å›¾ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960/** * Create a dot view for an select view * @return view */private View createViewSelected() &#123; LinearLayout view = new LinearLayout(this); LinearLayout.LayoutParams lp = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.WRAP_CONTENT, LinearLayout.LayoutParams.WRAP_CONTENT); lp.setMargins(10, 0, 10, 0); view.setLayoutParams(lp); ImageView imageView = new ImageView(this); imageView.setImageResource(R.drawable.dot_selected); imageView.setLayoutParams(new LinearLayout.LayoutParams(30, 30)); imageView.setScaleType(ImageView.ScaleType.FIT_XY); view.addView(imageView); return view;&#125;/** * Create a dot view for an unselected view * @return view */private View createViewUnselected() &#123; LinearLayout view = new LinearLayout(this); LinearLayout.LayoutParams lp = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.WRAP_CONTENT, LinearLayout.LayoutParams.WRAP_CONTENT); lp.setMargins(10, 0, 10, 0); view.setLayoutParams(lp); ImageView imageView = new ImageView(this); imageView.setImageResource(R.drawable.dot_unselect); imageView.setLayoutParams(new LinearLayout.LayoutParams(30, 30)); imageView.setScaleType(ImageView.ScaleType.FIT_XY); view.addView(imageView); return view;&#125;/** * Refresh the Dot View when sliped * @param selectId current Id */private void refreshDotView(int selectId) &#123; dotLayout.removeAllViews(); for (int i = 1; i &lt; 6; i++) &#123; if (selectId != i) &#123; View viewUnselect = createViewUnselected(); if (viewUnselect.getParent() != null) &#123; ((ViewGroup) viewUnselect.getParent()).removeView(viewUnselect); &#125; dotLayout.addView(viewUnselect); &#125; else &#123; View viewSelected = createViewSelected(); if (viewSelected.getParent() != null) &#123; ((ViewGroup) viewSelected.getParent()).removeView(viewSelected); &#125; dotLayout.addView(viewSelected); &#125; &#125;&#125; å®ç°æŒ‡ç¤ºå™¨åŠŸèƒ½ UIå®ç°äº†ä¹‹åå°±æ˜¯å®ç°æŒ‡ç¤ºåŠŸèƒ½å°±æ˜¯ç›´æ¥åœ¨PageChangeç›‘å¬å¤„åŠ ç å°±å¯ä»¥äº†ï¼Œé€»è¾‘å¾ˆç®€å•ï¼Œä¸è¿‡æ³¨æ„åœ¨æ¶åŠ£ç¯å¢ƒä¸‹æœ‰å¯èƒ½ä¼šæ»‘åˆ°cache pageï¼Œè¿™æ˜¯ä¼ å…¥çš„page IDè¦è¿›è¡Œç›¸åº”çš„å˜æ¢ 123456789101112131415161718192021222324252627282930313233// Delay to change dotviewTimer timer = new Timer();timer.schedule(new TimerTask() &#123; @Override public void run() &#123; handler.sendEmptyMessage(DOT_VIEW_CHANGE_SELECTED); &#125;&#125;, 500);// Refresh the dotView when page was loadedcase DOT_VIEW_CHANGE_SELECTED: int currentId = viewPager.getCurrentItem(); switch (currentId) &#123; case 0: &#123; refreshDotView(5); break; &#125; case 1: case 2: case 3: case 4: case 5: &#123; refreshDotView(currentId); break; &#125; case 6: &#123; refreshDotView(1); break; &#125; default: break; &#125; onCreate()è°ƒç”¨é¡ºåºå¦‚ä¸‹ 12345678910public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_wallpaper); init(); listener(); setTimer(); setDuration();&#125; ä¸è¶³ä¸è¶³æ¯”è¾ƒå¤šï¼Œåœ¨æç«¯çš„æ“ä½œä¸‹ä¸æµç•…ï¼Œæ¯”å¦‚åœ¨è®¾ç½®çš„å»¶æ—¶ä¸­æ»‘åŠ¨æ¬¡æ•°è¿‡å¤šä¼šé€ æˆåˆ‡æ¢ä¸è‡ªç„¶ï¼Œåœ¨æ‰‹æŒ‡æ»‘åŠ¨æ—¶æ›´å¥½çš„åšæ³•æ˜¯ç›´æ¥ç›‘å¬æ‰‹æœºçš„ç§»åŠ¨é€Ÿåº¦è¿›è¡Œç›¸å…³å›¾ç‰‡çš„ç§»åŠ¨ã€‚è¿˜æœ‰å°±æ˜¯è€—å†…å­˜ï¼Œå†…å­˜æº¢å‡ºçš„è¯ï¼Œå¯ä»¥è‡ªå·±åœ¨Manifestæ–‡ä»¶åŠ ä¸¤å¥ä»£ç  12android:hardwareAccelerated=\"false\"android:largeHeap=\"true\"","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"}]},{"title":"è‡ªå®šä¹‰æ»‘åŠ¨åˆ é™¤åˆ—è¡¨","date":"2017-04-07T03:00:00.000Z","path":"2017/04/07/SlideDeleteList/","text":"GitHub ä»»åŠ¡æè¿° å®ç°ä¸€ä¸ªå¯ä»¥æ»‘åŠ¨åˆ é™¤çš„ListViewåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­çš„æ¯ä¸€è¡Œå¯ä»¥é€šè¿‡ä»å·¦å‘å³æ»‘åŠ¨æ˜¾ç¤ºå‡ºåˆ é™¤æŒ‰é’®ï¼Œç‚¹å‡»è¯¥æŒ‰é’®ä¹‹ååˆ é™¤è¯¥è¡Œ å®ç°æ•ˆæœ å®ç°è¿‡ç¨‹ æœ€å¼€å§‹è¿˜æ˜¯è¦è®¾è®¡layoutï¼Œè¿™å†³å®šç€ä½ çš„ä»£ç å†™æ³•ã€‚ layout activity_listview listitem content_view menu_view æˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸€ä¸ªItemè®¾ä¸ºä¸€ä¸ªå¸ƒå±€æ§ä»¶ï¼Œä¹Ÿå°±æ˜¯listitem 1234567891011121314151617&lt;merge xmlns:android=\"http://schemas.android.com/apk/res/android\" android:layout_width=\"match_parent\" android:layout_height=\"60dp\"&gt; &lt;LinearLayout android:id=\"@+id/content\" android:orientation=\"horizontal\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" &gt; &lt;/LinearLayout&gt; &lt;LinearLayout android:id=\"@+id/menu\" android:orientation=\"horizontal\" android:layout_width=\"80dp\" android:layout_height=\"match_parent\" &gt; &lt;/LinearLayout&gt;&lt;/merge&gt; æ¥ç€åˆ†åˆ«è¿ä¸ªå¸ƒå±€è®¾ç½®contentå’Œmenu 12345678910111213141516171819202122232425262728content_view&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt; &lt;TextView android:id=\"@+id/textView\" android:text=\"@string/init_text\" android:textAppearance=\"?android:attr/textAppearanceLarge\" android:gravity=\"center_vertical\" android:layout_marginLeft=\"20dp\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" /&gt;&lt;/RelativeLayout&gt;menu_view&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt; &lt;Button android:id=\"@+id/delete\" android:text=\"@string/delete\" android:textAllCaps=\"false\" android:textAppearance=\"?android:attr/textAppearanceLarge\" android:background=\"@color/colorAccent\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" /&gt;&lt;/RelativeLayout&gt; æ¥ä¸‹æ¥å°±å¾ˆæ¸…æ¥šäº†ã€‚åˆ©ç”¨listviewæ·»åŠ æ§ä»¶listitemä½œä¸ºé€‚é…å™¨çš„å¸ƒå±€ã€‚ ViewHolderç¼“å­˜åŠ è½½ é¿å…é‡å¤åŠ è½½æ§ä»¶ï¼Œé‡‡ç”¨ç¼“å­˜æœºåˆ¶æ˜¯æ¯”è¾ƒåˆç†çš„ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹adapterçš„getView() 1234567891011121314151617181920212223242526272829303132333435363738394041public View getView(final int position, View convertView, ViewGroup parent) &#123; ViewHolder holder; SlideItemView slideItemView = (SlideItemView) convertView; if (convertView == null) &#123; // get content and menu view View contentView = inflater.inflate(R.layout.content_view, null); View menuView = inflater.inflate(R.layout.menu_view, null); // add content and menu to slideItemView slideItemView = new SlideItemView(context); slideItemView.setContentView(contentView); slideItemView.setMenuView(menuView); // setting widgets holder = new ViewHolder(contentView, menuView); // setting slide listener slideItemView.setOnSlideListener((SlideItemView.OnSlideListener) context); slideItemView.setTag(holder); &#125; else &#123; holder = (ViewHolder) convertView.getTag(); &#125; // init widgets ItemMsg itemMsg = itemMsgList.get(position); itemMsg.setSlideItemView(slideItemView); itemMsg.getSlideItemView().shrink(); holder.text.setText(itemMsg.getContent()); holder.btnDel.setText(R.string.delete); holder.btnDel.setOnClickListener((View.OnClickListener) context); return slideItemView;&#125;private final class ViewHolder &#123; TextView text; Button btnDel; ViewHolder(View content, View menu) &#123; text = (TextView) content.findViewById(R.id.textView); btnDel = (Button) menu.findViewById(R.id.delete); &#125;&#125; ä»£ç åŸºæœ¬éƒ½æœ‰æ³¨é‡Šï¼Œé€»è¾‘æ¯”è¾ƒæ¸…æ™°ï¼Œä¸»è¦æ˜¯å¯¹é€‚é…å™¨çš„æ§ä»¶åˆå§‹åŒ–ã€‚æ³¨æ„è¿”å›çš„æ˜¯slideItemViewï¼ŒåŒæ—¶ä¹Ÿè®¾ç½®äº†ç›‘å¬ï¼Œæ‰€ä»¥æ­¤å¤„æ˜¯åŠ è½½ä¸¤ä¸ªå¸ƒå±€ï¼ˆcontent,menuï¼‰åˆæˆä¸€ä¸ªslideItemViewï¼Œè¿™æ ·ä¾¿äºä»¥åçš„å¸ƒå±€æ›´æ”¹ã€‚ä¹Ÿæ–¹ä¾¿è§†å›¾çš„æ·»åŠ å’Œæ§ä»¶çš„ç›‘æµ‹ã€‚ æ„é€ slideItemView éƒ¨åˆ†å‡½æ•° 12345678910111213141516private void initView() &#123; Context context = getContext(); scroller = new Scroller(context); // inflate layout View.inflate(context, R.layout.listitem, this); contentView = (LinearLayout) findViewById(R.id.content); menuView = (LinearLayout) findViewById(R.id.menu);&#125;public void setContentView(View content) &#123; contentView.addView(content);&#125;public void setMenuView(View menu) &#123; menuView.addView(menu);&#125; æ»‘åŠ¨ç›‘å¬ è¿™ä¸ªæ‰æ˜¯é‡ç‚¹éš¾ç‚¹ä»£ç å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980public boolean onTouchEvent(MotionEvent event) &#123; // Get event start coordinate int x = (int) event.getX(); int y = (int) event.getY(); int scrollX = getScrollX(); switch (event.getAction()) &#123; case MotionEvent.ACTION_DOWN: &#123; // if another event unfinished, then finished if (!scroller.isFinished()) &#123; scroller.abortAnimation(); &#125; // get menu width btnWidth = menuView.getMeasuredWidth(); if (onSlideListener != null) &#123; onSlideListener.onSlide(this, OnSlideListener.STATUS_SLIDE_SCROLL); &#125; // represent the event was handled or consumed, see the resource code return true; &#125; case MotionEvent.ACTION_MOVE: &#123; // get offset int offsetX = x - lastX; int offsetY = y - lastY; // if offsetX miner than offsetY or offsetY more than 20, then cancel this event if (offsetY &gt; 20) &#123; break; &#125; int newScrollX = scrollX - offsetX; if (offsetX != 0) &#123; if (newScrollX &lt; 0) &#123; newScrollX = 0; &#125; else if (newScrollX &gt; btnWidth)&#123; newScrollX = btnWidth; &#125; scrollTo(newScrollX, 0); &#125; break; &#125; case MotionEvent.ACTION_UP: case MotionEvent.ACTION_CANCEL: &#123; int newScroll = 0; // more than half of button width, scroll out. otherwise scroll in. if (scrollX - btnWidth * 0.7 &gt; 0) &#123; newScroll = btnWidth; &#125; smoothScrollTo(newScroll); // set item slide status if (onSlideListener != null) &#123; onSlideListener.onSlide(this, newScroll == 0 ? OnSlideListener.STATUS_SLIDE_OFF : OnSlideListener.STATUS_SLIDE_ON); &#125; break; &#125; &#125; lastX = x; lastY = y; return super.onTouchEvent(event);&#125;private void smoothScrollTo(int x) &#123; int scrollX = getScrollX(); int offsetX = x - scrollX; scroller.startScroll(scrollX, 0, offsetX, 0, Math.abs(offsetX)); invalidate();&#125;@Overridepublic void computeScroll() &#123; if (scroller.computeScrollOffset()) &#123; scrollTo(scroller.getCurrX(), scroller.getCurrY()); postInvalidate(); &#125;&#125;public void shrink() &#123; if (getScaleX() != 0) &#123; this.smoothScrollTo(0); &#125;&#125; å‚è€ƒ åˆ—è¡¨æ»‘åŠ¨åˆ é™¤æ•ˆæœ Androidè§¦æ‘¸å±äº‹ä»¶æ´¾å‘æœºåˆ¶è¯¦è§£ä¸æºç åˆ†æä¸€(Viewç¯‡) androidä¸­çš„dispatchTouchEventã€onInterceptTouchEventå’ŒonTouchEvent åä¸¤ç¯‡ä¸»è¦æ˜¯è®²Androidä¸­çš„äº‹ä»¶åˆ†å‘ï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆåœ¨MotionEvent.ACTION_DOWNä¸­return trueæ‰èƒ½å®ç°æ»‘åŠ¨æ•ˆæœã€‚çœ‹äº†æºç æˆ‘ä»¬çŸ¥é“trueä»£è¡¨è¿™ä¸ªæ§ä»¶çš„å‡½æ•°æ¶ˆè€—è¿™ä¸ªäº‹ä»¶ï¼Œä¸ä¼šå†åˆ†å‘ï¼Œæ‰€ä»¥æˆ‘ä»¬åé¢çš„å¤„ç†äº‹ä»¶çš„ä»£ç æ‰èƒ½å¤Ÿæ‰§è¡Œã€‚ è®¾ç½®æ¥å£ 123456789101112131415161718192021222324interface OnSlideListener &#123; int STATUS_SLIDE_OFF = 0; int STATUS_SLIDE_ON = 1; int STATUS_SLIDE_SCROLL = 2; void onSlide(View view, int status);&#125;public void setOnSlideListener(OnSlideListener onSlideListener) &#123; this.onSlideListener = onSlideListener;&#125;@Overridepublic void onSlide(View view, int status) &#123; // if last slide item is on, close it if (mLastSlideViewWithStatusOn != null &amp;&amp; mLastSlideViewWithStatusOn != view) &#123; mLastSlideViewWithStatusOn.shrink(); &#125; // if a new item slide out, mark it if (status == STATUS_SLIDE_ON) &#123; mLastSlideViewWithStatusOn = (SlideItemView) view; &#125;&#125; è¿™ä¸ªæ¥å£çš„ä¸»è¦ç›®çš„æ˜¯å¯¹è¿™ä¸ªListViewä¸­Itemçš„ç®¡ç†ï¼Œä¿è¯å½“å‰åªæœ‰ä¸€ä¸ªä¾§æ»‘å‡ºæ¥ã€‚","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"}]},{"title":"å®ç°ä¸€ä¸ªTABå¸ƒå±€","date":"2017-04-07T02:30:00.000Z","path":"2017/04/07/TabLayout/","text":"GitHub ä»»åŠ¡æè¿° å®ç°å¸¸è§çš„æ ‡ç­¾tabï¼Œå¹¶ä¸”ç‚¹å‡»tabè·³è½¬è‡³å¯¹åº”é¡µé¢å®ç°é¡µé¢æ»‘åŠ¨æ•ˆæœ å®ç°æ•ˆæœ TabLayout + ViewPagerï¼ˆGIFï¼‰ å®ç°è¿‡ç¨‹ ç»˜åˆ¶é¡µé¢ 12345678910111213141516171819&lt;android.support.v4.view.ViewPager android:id=\"@+id/viewPager\" android:scrollbars=\"none\" android:layout_weight=\"8\" android:layout_width=\"match_parent\" android:layout_height=\"0dp\"&gt;&lt;/android.support.v4.view.ViewPager&gt;&lt;android.support.design.widget.TabLayout android:id=\"@+id/tabLayout\" android:layout_weight=\"1\" android:layout_width=\"match_parent\" android:layout_height=\"0dp\" app:tabGravity=\"fill\" app:tabIndicatorHeight=\"0dp\" app:tabMode=\"fixed\" app:tabSelectedTextColor=\"#FF4081\" app:tabTextColor=\"#000\"&gt;&lt;/android.support.design.widget.TabLayout&gt; éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  compile â€˜com.android.support:design:23.2.0â€™ å‡†å¤‡Adapter 1234567891011121314151617181920212223242526272829class ViewPagerAdapter extends FragmentPagerAdapter &#123; private List&lt;Fragment&gt; fragmentList = new ArrayList&lt;&gt;(); private List&lt;String&gt; fragmentTitleList = new ArrayList&lt;&gt;(); ViewPagerAdapter(FragmentManager fm) &#123; super(fm); &#125; void addPage(Fragment fragment, String title) &#123; fragmentList.add(fragment); fragmentTitleList.add(title); &#125; @Override public Fragment getItem(int position) &#123; return fragmentList.get(position); &#125; @Override public int getCount() &#123; return fragmentTitleList.size(); &#125; @Override public CharSequence getPageTitle(int position) &#123; return fragmentTitleList.get(position); &#125;&#125; å‡†å¤‡Fragmentå¸ƒå±€ 1234567891011121314151617181920public class ViewPagerFragment extends Fragment &#123; private String content; public ViewPagerFragment(String content) &#123; this.content = content; &#125; public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) &#123; View rootView = inflater.inflate(R.layout.fragment_view_pager, container, false); TextView tvContent = (TextView) rootView.findViewById(R.id.tvContent); tvContent.setText(content); return rootView; &#125; @Override public void onCreate(@Nullable Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); &#125;&#125; 12345678&lt;TextView android:id=\"@+id/tvContent\" android:textSize=\"30sp\" android:hint=\"@string/default_text\" android:layout_gravity=\"center\" android:textAlignment=\"center\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" /&gt; ä¸ºäº†æ–¹ä¾¿ï¼Œæ­¤å¤„æ‰€æœ‰Fragmentå…±ç”¨ä¸€ä¸ª åˆå§‹åŒ–å¸ƒå±€ 123456789101112131415161718192021222324252627/** * Init Layout, Load Fragments and draw Layouts. */private void initLayout() &#123; viewPager = (ViewPager) findViewById(R.id.viewPager); tabLayout = (TabLayout) findViewById(R.id.tabLayout); ViewPagerAdapter adapter = new ViewPagerAdapter(getSupportFragmentManager()); // Add Fragments for (int i = 0; i &lt; 4; i++) &#123; adapter.addPage(new ViewPagerFragment(\"PAGE\" + i), \"PAGE\" + i); &#125; viewPager.setAdapter(adapter); // Connect TabLayout and ViewPage tabLayout.setupWithViewPager(viewPager); // Draw Tab View for (int i = 0; i &lt; 4; i++) &#123; tabListView.add(tabLayout.getTabAt(i)); if (i == 0) &#123; tabListView.get(i).setIcon(R.mipmap.selected_icon); &#125; else &#123; tabListView.get(i).setIcon(R.mipmap.ic_launcher); &#125; tabListView.get(i).setText(\"PAGE\" + i); &#125;&#125; è®¾ç½®ç›‘å¬ 123456789101112131415161718192021222324/** * Setting Tab Click Listener */private void initEvents() &#123; tabLayout.setOnTabSelectedListener(new TabLayout.OnTabSelectedListener() &#123; @Override public void onTabSelected(TabLayout.Tab tab) &#123; // Called when the tab was selected tabListView.get(tab.getPosition()).setIcon(R.mipmap.selected_icon); viewPager.setCurrentItem(tab.getPosition()); &#125; @Override public void onTabUnselected(TabLayout.Tab tab) &#123; // Called when a tab from selected switch to unselected tabListView.get(tab.getPosition()).setIcon(R.mipmap.ic_launcher); &#125; @Override public void onTabReselected(TabLayout.Tab tab) &#123; // Called when a tab selected more than twice consecutively &#125; &#125;);&#125; ä¸è¶³ åˆ©ç”¨æ§ä»¶å·²æœ‰çš„æ€§è´¨ï¼ŒåŸºæœ¬çš„Tabåˆ‡æ¢å·²ç»å®ç°ã€‚ä½†æ˜¯æ²¡æœ‰è‡ªå·±æ‰‹åŠ¨å®ç°æ»‘åŠ¨ç­‰æ§ä»¶çš„æ•ˆæœã€‚å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä»¥åæ¥è¡¥å……ã€‚ Tips: ä½œä¸ºä¸€ä¸ªAndroidå°ç™½ï¼Œè‡ªç„¶æœ‰å¾ˆå¤šä¸çŸ¥é“ä¸ç†è§£çš„åœ°æ–¹ã€‚å¦‚æœæ–‡ä¸­æœ‰é”™æˆ–è€…æœ‰å“ªäº›å€¼å¾—æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§å®¶ææ„è§ï¼Œæˆ‘å¾ˆå¼€å¿ƒèƒ½å’Œå¤§å®¶ä¸€èµ·äº¤æµå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚ å¤šè°¢é˜…è¯»","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"}]},{"title":"å¤ç°ANR","date":"2017-04-07T02:00:00.000Z","path":"2017/04/07/RecurrentANR/","text":"GitHub ä»»åŠ¡æè¿°å†™å‡ºä¸å°‘äº3ç§å¸¸è§ANRé”™è¯¯çš„Androidä»£ç  ä¸»çº¿ç¨‹å¤ç°ANR BroadcastReceiverå¤ç°ANR Serviceå¤ç°ANR 1.ä»€ä¹ˆæ˜¯ANR? ANR(Application Not Responding),åº”ç”¨ç¨‹åºæ— å“åº”. å‚è€ƒANRå®Œå…¨è§£æ 2.ANRçš„ä¸‰ç§ç±»å‹ KeyDispatchTimeout(5 seconds) ä¸»è¦ç±»å‹æŒ‰é”®æˆ–è§¦æ‘¸äº‹ä»¶åœ¨ç‰¹å®šæ—¶é—´å†…æ— å“åº” BroadcastTimeout(10 seconds) BroadcastReceiveråœ¨ç‰¹å®šæ—¶é—´å†…æ— æ³•å¤„ç†å®Œæˆ ServiceTimeout(20 seconds) å°æ¦‚ç‡ç±»å‹ Serviceåœ¨ç‰¹å®šçš„æ—¶é—´å†…æ— æ³•å¤„ç†å®Œæˆ 3.å¤ç°ANRI ä¸»çº¿ç¨‹å¤ç°ANR ä»£ç  1234567891011121314/** * Recurrent ANR in main Thread */private void mainThreadANR() &#123; Looper myLooper = Looper.myLooper(); Looper mainLooper = Looper.getMainLooper(); Log.i(\"MainThreadANR\", \"myLooper=\" + myLooper + \"; mainLooper=\" + mainLooper); try &#123; Thread.sleep(20 * 1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; Log.i(\"MainThreadANR\", \"mainThreadANR() Done\");&#125; ç»“æœ II BroadcastReceiverå¤ç°ANR ä»£ç  1234567891011121314public class BroadcastANR extends BroadcastReceiver &#123; @Override public void onReceive(Context context, Intent intent) &#123; Looper myLooper = Looper.myLooper(); Looper mainLooper = Looper.getMainLooper(); Log.i(\"BroadcastANR\", \"myLooper=\" + myLooper + \"; mainLooper=\" + mainLooper); try &#123; Thread.sleep(80 * 1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125; III Serviceå¤ç°ANR ä»£ç  1234567891011121314151617181920public class ServiceANR extends Service &#123; @Override public void onCreate() &#123; Looper myLooper = Looper.myLooper(); Looper mainLooper = Looper.getMainLooper(); Log.i(\"ServiceANR\", \"myLooper=\" + myLooper + \"; mainLooper=\" + mainLooper); try &#123; Thread.sleep(60 * 1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; @Nullable @Override public IBinder onBind(Intent intent) &#123; return null; &#125;&#125; 4.é¿å…ANRè¦æƒ³é¿å…ANRï¼Œé¦–å…ˆè¦åˆ†æä¸ºä»€ä¹ˆä¼šå‘ç”ŸANRï¼Œä¸»è¦æ˜¯åœ¨ä¸€äº›ä¸èƒ½è€—æ—¶æ“ä½œçš„å‡½æ•°ä¸­å¤„ç†ä»£ç çš„æ—¶é—´è¿‡é•¿ï¼Œæ‰€ä»¥æŠŠè€—æ—¶é•¿çš„ç¨‹åºå†™å…¥å…¶ä»–å­è¿›ç¨‹ä¸­å°±å¯ä»¥é¿å…ã€‚ANRæœºåˆ¶ä»¥åŠé—®é¢˜åˆ†æå†™çš„å¾ˆè¯¦ç»†ã€‚ é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹Log 12345678MainThreadANR: I/MainThreadANR: myLooper=Looper (main, tid 1) &#123;13467e36&#125;; mainLooper=Looper (main, tid 1) &#123;13467e36&#125;BroadcastANR:I/BroadcastANR: myLooper=Looper (main, tid 1) &#123;33c6137&#125;; mainLooper=Looper (main, tid 1) &#123;33c6137&#125;ServiceANR:I/ServiceANR: myLooper=Looper (main, tid 1) &#123;303e756a&#125;; mainLooper=Looper (main, tid 1) &#123;303e756a&#125; å‰é¢çš„ä¸‰ä¸ªANRéƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯å½“å‰çš„çº¿ç¨‹éƒ½æ˜¯ä¸»çº¿ç¨‹ï¼Œç»†å¿ƒç‚¹ä¼šå‘ç°å…¶å®è¿˜æœ‰ä¸€å¥ä¸¢å¸§Logæ‰“å° 1Skipped 1204 frames! The application may be doing too much work on its main thread. æˆ‘å®ç°ä¸‹é€šè¿‡åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹çš„æ–¹æ³•æ¥é¿å…ANR ä»£ç  1234567891011121314151617181920/** * Deal ANR in main Thread */private void mainThreadNotANR() &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; Looper myLooper = Looper.myLooper(); Looper mainLooper = Looper.getMainLooper(); Log.i(\"MainThreadNotANR\", \"myLooper=\" + myLooper + \"; mainLooper=\" + mainLooper); try &#123; Thread.sleep(20 * 1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; Log.i(\"MainThreadNotANR\", \"Thread Run() Done\"); &#125; &#125;).start(); Log.i(\"MainThreadNotANR\", \"mainThreadNotANR() Done\");&#125; ä¸‹é¢æˆ‘ä»¬æ¥å¯¹æ¯”ä¸‹å’Œä¸»çº¿ç¨‹ä¸­ç›´æ¥å¤„ç†çš„Logæœ‰ä»€ä¹ˆä¸åŒ 12345678910111213141516MainThreadNotANR:ç‚¹å‡»æŒ‰é’®MainThreadNotANRI/MainThreadNotANR: mainThreadNotANR() DoneI/MainThreadNotANR: myLooper=null; mainLooper=Looper (main, tid 1) &#123;303e756a&#125;I/MainThreadNotANR: ThreadRun() DoneW/art: Suspending all threads took: 6.032msMainThreadANR:ç‚¹å‡»æŒ‰é’®MainThreadANRI/MainThreadANR: myLooper=Looper (main, tid 1) &#123;303e756a&#125;; mainLooper=Looper (main, tid 1) &#123;303e756a&#125;I/MainThreadANR: mainThreadANR() Doneå†å¤šæ¬¡ç‚¹å‡»æŒ‰é’®MainThreadANRI/Choreographer: Skipped 1200 frames! The application may be doing too much work on its main thread.I/MainThreadANR: myLooper=Looper (main, tid 1) &#123;303e756a&#125;; mainLooper=Looper (main, tid 1) &#123;303e756a&#125;I/art: Thread[5,tid=2037,WaitingInMainSignalCatcherLoop,Thread*=0xef70d400,peer=0x12c00080,&quot;Signal Catcher&quot;]: reacting to signal 3I/art: Wrote stack traces to &apos;/data/anr/traces.txt&apos; ä»Logä¸­å¯ä»¥çœ‹å‡ºMainThreadNotANRä¸­å…ˆæ‰“å°mainThreadNotANR() Doneåæ‰“å°ThreadRun() Doneè¯´æ˜ä»£ç æ²¡åœ¨MainThreadNotANRè¿™ä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼Œä»myLooper=null; mainLooper=Looper (main, tid 1) {303e756a}å¯ä»¥éªŒè¯æˆ‘ä»¬çš„çŒœæƒ³ã€‚è€ŒMainThreadANRä¸­å°±å¾ˆæ˜æ˜¾ï¼Œå„ç§ä¸¢å¸§å¥”æºƒã€‚ä¸è¿‡I/art: Wrote stack traces to â€˜/data/anr/traces.txtâ€™å‘Šè¯‰æˆ‘ä»¬å¯ä»¥åœ¨/data/anr/traces.txtä¸­è¿½è¸ªå¥”æºƒçš„ç¼˜ç”±1234567891011121314151617181920212223242526traces.txtDALVIK THREADS (18):&quot;main&quot; prio=5 tid=1 Sleeping | group=&quot;main&quot; sCount=1 dsCount=0 obj=0x73581970 self=0xf4306800 | sysTid=2030 nice=0 cgrp=apps sched=0/0 handle=0xf7761160 | state=S schedstat=( 545706267 72336573 314 ) utm=30 stm=23 core=3 HZ=100 | stack=0xff7c7000-0xff7c9000 stackSize=8MB | held mutexes= at java.lang.Thread.sleep!(Native method) - sleeping on &lt;0x2ce90c0d&gt; (a java.lang.Object) at java.lang.Thread.sleep(Thread.java:1031) - locked &lt;0x2ce90c0d&gt; (a java.lang.Object) at java.lang.Thread.sleep(Thread.java:985) at org.fitzeng.recurrentanr.MainActivity.mainThreadANR(MainActivity.java:47) at org.fitzeng.recurrentanr.MainActivity.onClick(MainActivity.java:81) at android.view.View.performClick(View.java:4756) at android.view.View$PerformClick.run(View.java:19749) at android.os.Handler.handleCallback(Handler.java:739) at android.os.Handler.dispatchMessage(Handler.java:95) at android.os.Looper.loop(Looper.java:135) at android.app.ActivityThread.main(ActivityThread.java:5221) at java.lang.reflect.Method.invoke!(Native method) at java.lang.reflect.Method.invoke(Method.java:372) at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:899) at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:694) è¿™æ˜¯å®šä½ANRçš„æœ‰æ•ˆæ‰‹æ®µã€‚ Tips: ä½œä¸ºä¸€ä¸ªAndroidå°ç™½ï¼Œè‡ªç„¶æœ‰å¾ˆå¤šä¸çŸ¥é“ä¸ç†è§£çš„åœ°æ–¹ã€‚å¦‚æœæ–‡ä¸­æœ‰é”™æˆ–è€…æœ‰å“ªäº›å€¼å¾—æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§å®¶ææ„è§ï¼Œæˆ‘å¾ˆå¼€å¿ƒèƒ½å’Œå¤§å®¶ä¸€èµ·äº¤æµå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚ å¤šè°¢é˜…è¯»","tags":[{"name":"Android","slug":"Android","permalink":"http://fitzeng.org/tags/Android/"}]}]